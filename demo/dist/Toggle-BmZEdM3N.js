import{B as t}from"./index.esm-DNh4gpcb.js";import{E as e}from"./ComponentStates-CcJglg_C.js";class a extends t{static get defaults(){return{openClass:"open",transitioningClass:"transitioning",transitionDuration:750,capture:!1,manual:!1,multiple:!1,animateToggle:!0,closeOnEscape:!0,closeOnNavigation:!0}}_init(t){const r=super._init(t),s=this.getAttr(t,"target");if(!s)return this.logger?.warn("Toggle: No data-toggle-target attribute found",t),r;const n=document.querySelector(s);if(!n)return this.logger?.warn("Toggle: Target element not found",{selector:s,element:t}),r;const i=this.getAttr(t,"capture",a.defaults.capture),l=n.hasAttribute("data-toggle-manual")||this.getAttr(t,"manual",a.defaults.manual),o=this.getAttr(t,"multiple",a.defaults.multiple),g=this.getAttr(t,"animate",a.defaults.animateToggle),c=this.getAttr(t,"close-navigation",a.defaults.closeOnNavigation);r.target=n,r.targetSelector=s,r.capture=i,r.manual=l,r.multiple=o,r.animateToggle=g,r.closeOnNavigation=c,r.isOpen=n.classList.contains(a.defaults.openClass),r.transitionTimer=null;const u=r.isOpen?e.OPEN:e.CLOSED;this.setAttr(n,"target",u);const d=e=>this._handleClick(e,t,r);if(t.addEventListener("click",d),t.setAttribute("data-toggle-enhanced","true"),t.setAttribute("aria-expanded",String(r.isOpen)),t.getAttribute("aria-controls")||t.setAttribute("aria-controls",s.replace("#","")),a.defaults.closeOnEscape){const e=e=>this._handleEscape(e,t,r);document.addEventListener("keydown",e),r.escapeHandler=e}const h=r.cleanup;return r.cleanup=()=>{t.removeEventListener("click",d),r.escapeHandler&&document.removeEventListener("keydown",r.escapeHandler),this._clearTransitionTimer(r),this._removeGlobalListeners(r),h()},this.eventBus?.emit("toggle:mount",{element:t,target:n,isOpen:r.isOpen,timestamp:performance.now()}),this.logger?.info("Toggle initialized",{element:t,target:s,capture:i,manual:l,isOpen:r.isOpen}),r}_handleClick(t,e,a){t.preventDefault(),t.stopPropagation(),this.toggle(e)}_handleEscape(t,e,a){"Escape"===t.key&&a.isOpen&&!a.manual&&this.hide(e)}toggle(t){const e=this.getState(t);if(!e)return;e.target.classList.contains(a.defaults.openClass)?this.hide(t):this.show(t)}show(t){const r=this.getState(t);if(!r)return;const s=this.getAttr(r.target,"target");s!==e.OPENING&&s!==e.OPEN&&(r.multiple||this._closeOtherToggles(t),r.isOpen=!0,this._syncTriggerStates(r.targetSelector,!0),t.setAttribute("aria-expanded","true"),this._updateRelatedTriggers(r.targetSelector,!0),(r.capture||r.closeOnNavigation)&&this._setupGlobalListeners(t,r),r.animateToggle?(this.setAttr(r.target,"target",e.OPENING),r.target.classList.add(a.defaults.openClass),r.transitionTimer=setTimeout(()=>{this.setAttr(r.target,"target",e.OPEN),r.transitionTimer=null},a.defaults.transitionDuration)):(this.setAttr(r.target,"target",e.OPEN),r.target.classList.add(a.defaults.openClass)),this._dispatch(t,"toggle:show",{target:r.target,trigger:t}),this.eventBus?.emit("toggle:show",{element:t,target:r.target,timestamp:performance.now()}),this.logger?.debug("Toggle shown",{element:t,target:r.targetSelector}))}hide(t){const r=this.getState(t);if(!r)return;const s=this.getAttr(r.target,"target");s!==e.CLOSING&&s!==e.CLOSED&&(r.isOpen=!1,this._syncTriggerStates(r.targetSelector,!1),t.setAttribute("aria-expanded","false"),this._updateRelatedTriggers(r.targetSelector,!1),this._removeGlobalListeners(r),r.animateToggle?(this.setAttr(r.target,"target",e.CLOSING),r.transitionTimer=setTimeout(()=>{r.target.classList.remove(a.defaults.openClass),this.setAttr(r.target,"target",e.CLOSED),r.transitionTimer=null},a.defaults.transitionDuration)):(r.target.classList.remove(a.defaults.openClass),this.setAttr(r.target,"target",e.CLOSED)),this._dispatch(t,"toggle:hide",{target:r.target,trigger:t}),this.eventBus?.emit("toggle:hide",{element:t,target:r.target,timestamp:performance.now()}),this.logger?.debug("Toggle hidden",{element:t,target:r.targetSelector}))}hideAll(){document.querySelectorAll('[data-toggle-enhanced="true"]').forEach(t=>{const e=this.getState(t);e&&e.isOpen&&!e.manual&&this.hide(t)})}isOpen(t){const e=this.getState(t);return!!e&&e.isOpen}_updateRelatedTriggers(t,e){document.querySelectorAll(`[data-toggle-target="${t}"]`).forEach(t=>{t.setAttribute("aria-expanded",String(e))})}_setupGlobalListeners(t,e){const a=a=>{e.closeOnNavigation&&!e.manual&&this._isNavigationLink(a.target)?this.hide(t):a.stopPropagation()},r=a=>{e.manual||t.contains(a.target)||e.target.contains(a.target)||this.hide(t)};e.target.addEventListener("click",a),document.addEventListener("click",r),e.targetClickHandler=a,e.documentClickHandler=r}_removeGlobalListeners(t){t.targetClickHandler&&(t.target.removeEventListener("click",t.targetClickHandler),t.targetClickHandler=null),t.documentClickHandler&&(document.removeEventListener("click",t.documentClickHandler),t.documentClickHandler=null)}_isNavigationLink(t){let e=t;for(;e&&e!==document.body;){if("A"===e.tagName){const t=e.getAttribute("href");if(t&&!t.startsWith("#")&&!t.startsWith("javascript:")&&!t.startsWith("mailto:")&&!t.startsWith("tel:")&&!e.hasAttribute("download")&&"_blank"!==e.getAttribute("target"))return!0;break}e=e.parentElement}return!1}_clearTransitionTimer(t){t.transitionTimer&&(clearTimeout(t.transitionTimer),t.transitionTimer=null)}_closeOtherToggles(t){document.querySelectorAll('[data-toggle-enhanced="true"]').forEach(e=>{if(e!==t){const t=this.getState(e);t&&t.isOpen&&!t.manual&&this.hide(e)}})}_syncTriggerStates(t,e){document.querySelectorAll(`[data-toggle-target="${t}"][data-toggle-enhanced="true"]`).forEach(t=>{const a=this.getState(t);a&&(a.isOpen=e)})}getStatus(){const t=document.querySelectorAll('[data-toggle-enhanced="true"]');let e=0,r=0,s=0;return t.forEach(t=>{const a=this.getState(t);a&&(a.isOpen&&e++,a.capture&&r++,a.manual&&s++)}),{totalTriggers:t.length,openCount:e,captureCount:r,manualCount:s,defaults:a.defaults}}static enhanceAll(t="[data-toggle]",e){const r=new a(e);return document.querySelectorAll(t).forEach(t=>{r.mount(t)}),r}}export{a as default};
