import{B as e}from"./index.esm-BEZ9wTek.js";class t extends e{_getSelector(){return"data-scrollhide"}static get defaults(){return{scrollThreshold:50,overlayThreshold:100,scrolledClass:"scrollhide",overlayClass:"scrolloverlay",debounce:16,passive:!0}}_init(e){const s=super._init(e),l=this.getAttr(e,"target"),r=l?document.querySelector(l):e;if(!r)return this.logger?.warn("Scrollhide: Target element not found",{selector:l,element:e}),s;const o=this.getAttr(e,"scroll-threshold",t.defaults.scrollThreshold),a=this.getAttr(e,"overlay-threshold",t.defaults.overlayThreshold),n=this.getAttr(e,"scrolled-class",t.defaults.scrolledClass),i=this.getAttr(e,"overlay-class",t.defaults.overlayClass),h=this.getAttr(e,"debounce",t.defaults.debounce);s.target=r,s.targetSelector=l,s.scrollThreshold=parseInt(o,10),s.overlayThreshold=parseInt(a,10),s.scrolledClass=n,s.overlayClass=i,s.currentY=0,s.lastY=0,s.ticking=!1;const c=this._createScrollHandler(e,s),d=this._throttle(c,h);window.addEventListener("scroll",d,{passive:t.defaults.passive}),s.scrollHandler=d;const u=s.cleanup;return s.cleanup=()=>{window.removeEventListener("scroll",s.scrollHandler),s.animationFrame&&cancelAnimationFrame(s.animationFrame),u()},this._updateElementState(e,s),e.setAttribute("data-scrollhide-enhanced","true"),this.eventBus?.emit("scrollhide:mount",{element:e,target:r,scrollThreshold:s.scrollThreshold,overlayThreshold:s.overlayThreshold,timestamp:performance.now()}),this.logger?.info("Scrollhide initialized",{element:e,target:l||"self",scrollThreshold:s.scrollThreshold,overlayThreshold:s.overlayThreshold}),s}_createScrollHandler(e,t){return()=>{t.ticking||(t.animationFrame=requestAnimationFrame(()=>{this._onScroll(e,t),t.ticking=!1}),t.ticking=!0)}}_onScroll(e,t){t.currentY=window.scrollY,this._updateElementState(e,t),t.lastY=t.currentY}_updateElementState(e,t){const{target:s,currentY:l,lastY:r,scrollThreshold:o,overlayThreshold:a,scrolledClass:n,overlayClass:i}=t,h=s.classList.contains(i);l>a&&!h?(s.classList.add(i),this._emitStateChange(e,"overlay-added",{scrollY:l})):l<=a&&h&&(s.classList.remove(i),this._emitStateChange(e,"overlay-removed",{scrollY:l}));const c=s.classList.contains(n);l<=0?c&&(s.classList.remove(n),this._emitStateChange(e,"shown",{scrollY:l,reason:"top"})):l>o&&l>r&&!c?(s.classList.add(n),this._emitStateChange(e,"hidden",{scrollY:l,reason:"scroll-down"})):l<r&&c&&(s.classList.remove(n),this._emitStateChange(e,"shown",{scrollY:l,reason:"scroll-up"}))}_emitStateChange(e,t,s){const l=this.getState(e);this._dispatch(e,`scrollhide:${t}`,{target:l.target,...s}),this.eventBus?.emit(`scrollhide:${t}`,{element:e,target:l.target,timestamp:performance.now(),...s}),this.logger?.debug(`Scrollhide ${t}`,{element:e,target:l.targetSelector||"self",...s})}show(e){const t=this.getState(e);t&&(t.target.classList.remove(t.scrolledClass),this._emitStateChange(e,"shown",{scrollY:t.currentY,reason:"manual"}))}hide(e){const t=this.getState(e);t&&(t.target.classList.add(t.scrolledClass),this._emitStateChange(e,"hidden",{scrollY:t.currentY,reason:"manual"}))}toggle(e){this.getState(e)&&(this.isHidden(e)?this.show(e):this.hide(e))}isHidden(e){const t=this.getState(e);return!!t&&t.target.classList.contains(t.scrolledClass)}hasOverlay(e){const t=this.getState(e);return!!t&&t.target.classList.contains(t.overlayClass)}getScrollPosition(e){const t=this.getState(e);return t?t.currentY:window.scrollY}updateThresholds(e,{scrollThreshold:t,overlayThreshold:s}){const l=this.getState(e);l&&("number"==typeof t&&(l.scrollThreshold=t),"number"==typeof s&&(l.overlayThreshold=s),this._updateElementState(e,l),this.logger?.info("Scrollhide thresholds updated",{element:e,scrollThreshold:l.scrollThreshold,overlayThreshold:l.overlayThreshold}))}_throttle(e,t){let s=null,l=0;return function(...r){const o=Date.now();o-l>t?(e.apply(this,r),l=o):(clearTimeout(s),s=setTimeout(()=>{e.apply(this,r),l=Date.now()},t-(o-l)))}}getStatus(){const e=document.querySelectorAll('[data-scrollhide-enhanced="true"]');let s=0,l=0;return e.forEach(e=>{this.getState(e)&&(this.isHidden(e)&&s++,this.hasOverlay(e)&&l++)}),{totalElements:e.length,hiddenCount:s,overlayCount:l,currentScrollY:window.scrollY,defaults:t.defaults}}static enhanceAll(e="[data-scrollhide]",s){const l=new t(s);return document.querySelectorAll(e).forEach(e=>{l.mount(e)}),l}}export{t as default};
