import{B as t}from"./index.esm-BW_QP_AR.js";class e extends t{static get defaults(){return{closeOnEscape:!0,closeOnBackdrop:!0,showCounter:!0,showNavigation:!0,keyNavigation:!0,useDirectionalTransitions:!0,preloadStrategy:"adjacent",baseClass:"lightbox",overlayClass:"lightbox__overlay",containerClass:"lightbox__container",closeClass:"lightbox__close",prevClass:"lightbox__nav lightbox__nav--prev",nextClass:"lightbox__nav lightbox__nav--next",contentClass:"lightbox__content",imageClass:"lightbox__image",counterClass:"lightbox__counter",stateClosedClass:"is-closed",stateOpeningClass:"is-opening",stateOpenClass:"is-open",stateTransitioningClass:"is-transitioning",stateClosingClass:"is-closing",showClass:"show",slideLeftClass:"slide-left",slideRightClass:"slide-right"}}constructor(t={}){super(t),this.lightboxElement=null,this.keyHandler=null}_init(t){const e=super._init(t),s=this._getConfiguration(t),a=t.dataset.lightbox;return e.config=s,e.gallery=a,e.lightboxState="closed",e.currentIndex=0,e.galleryElements=[],t.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this._openLightbox(t)}),this.eventBus?.emit("lightbox:mounted",{element:t,gallery:a}),e}_getConfiguration(t){return{closeOnEscape:this._getDataAttr(t,"lightbox-close-escape",e.defaults.closeOnEscape),closeOnBackdrop:this._getDataAttr(t,"lightbox-close-backdrop",e.defaults.closeOnBackdrop),showCounter:this._getDataAttr(t,"lightbox-show-counter",e.defaults.showCounter),showNavigation:this._getDataAttr(t,"lightbox-show-nav",e.defaults.showNavigation),keyNavigation:this._getDataAttr(t,"lightbox-key-nav",e.defaults.keyNavigation),useDirectionalTransitions:this._getDataAttr(t,"lightbox-directional-transitions",e.defaults.useDirectionalTransitions),preloadStrategy:this._getDataAttr(t,"lightbox-preload",e.defaults.preloadStrategy),baseClass:this._getDataAttr(t,"lightbox-base-class",e.defaults.baseClass),overlayClass:this._getDataAttr(t,"lightbox-overlay-class",e.defaults.overlayClass),containerClass:this._getDataAttr(t,"lightbox-container-class",e.defaults.containerClass),closeClass:this._getDataAttr(t,"lightbox-close-class",e.defaults.closeClass),prevClass:this._getDataAttr(t,"lightbox-prev-class",e.defaults.prevClass),nextClass:this._getDataAttr(t,"lightbox-next-class",e.defaults.nextClass),contentClass:this._getDataAttr(t,"lightbox-content-class",e.defaults.contentClass),imageClass:this._getDataAttr(t,"lightbox-image-class",e.defaults.imageClass),counterClass:this._getDataAttr(t,"lightbox-counter-class",e.defaults.counterClass),stateClosedClass:this._getDataAttr(t,"lightbox-state-closed-class",e.defaults.stateClosedClass),stateOpeningClass:this._getDataAttr(t,"lightbox-state-opening-class",e.defaults.stateOpeningClass),stateOpenClass:this._getDataAttr(t,"lightbox-state-open-class",e.defaults.stateOpenClass),stateTransitioningClass:this._getDataAttr(t,"lightbox-state-transitioning-class",e.defaults.stateTransitioningClass),stateClosingClass:this._getDataAttr(t,"lightbox-state-closing-class",e.defaults.stateClosingClass),showClass:this._getDataAttr(t,"lightbox-show-class",e.defaults.showClass),slideLeftClass:this._getDataAttr(t,"lightbox-slide-left-class",e.defaults.slideLeftClass),slideRightClass:this._getDataAttr(t,"lightbox-slide-right-class",e.defaults.slideRightClass)}}_setState(t,e){const s=this.getState(t);if(!s)return;const a=s.lightboxState;if(s.lightboxState=e,this.lightboxElement&&s.config){const t=s.config;switch(this.lightboxElement.classList.remove(t.stateClosedClass,t.stateOpeningClass,t.stateOpenClass,t.stateTransitioningClass,t.stateClosingClass),e){case"closed":this.lightboxElement.classList.add(t.stateClosedClass);break;case"opening":this.lightboxElement.classList.add(t.stateOpeningClass);break;case"open":this.lightboxElement.classList.add(t.stateOpenClass);break;case"transitioning":this.lightboxElement.classList.add(t.stateTransitioningClass);break;case"closing":this.lightboxElement.classList.add(t.stateClosingClass)}}this.eventBus?.emit("lightbox:stateChange",{element:t,oldState:a,newState:e,gallery:s.gallery})}_openLightbox(t){const e=this.getState(t);if(!e||"closed"!==e.lightboxState)return;e.galleryElements=Array.from(document.querySelectorAll(`[data-lightbox="${e.gallery}"]`)),e.currentIndex=e.galleryElements.indexOf(t),this._setState(t,"opening"),this._createLightboxElement(t),this._showImage(t,e.currentIndex),this._setupEventListeners(t);const s=window.innerWidth-document.documentElement.clientWidth;document.documentElement.style.setProperty("--scrollbar-width",`${s}px`),document.body.classList.add("overflow--hidden"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.lightboxElement&&e.config&&(this.lightboxElement.classList.add(e.config.showClass),this.lightboxElement.addEventListener("transitionend",()=>{this._setState(t,"open")},{once:!0}))})}),this.eventBus?.emit("lightbox:opened",{gallery:e.gallery,index:e.currentIndex,total:e.galleryElements.length}),this._eagerLoadAdjacentImages(t)}_eagerLoadAdjacentImages(t){const e=this.getState(t);if(!e||!e.galleryElements)return;const s=e.config,a=e.currentIndex,l=e.galleryElements;if("none"===s.preloadStrategy)return;let i=[];"all"===s.preloadStrategy?i=l.map((t,e)=>e):(i=[a],s.showNavigation&&(a>0&&i.push(a-1),a<l.length-1&&i.push(a+1))),i.forEach(t=>{const a=l[t],i=a.href;a.querySelectorAll("[data-lazysrc]").forEach(a=>{const l=new CustomEvent("lazysrc:forceLoad",{bubbles:!0,detail:{source:"lightbox",gallery:e.gallery,index:t,strategy:s.preloadStrategy}});a.dispatchEvent(l)}),this._preloadImage(i)})}_preloadImage(t){(new Image).src=t}_createLightboxElement(t){const e=this.getState(t);if(!e)return;const s=e.config;this.lightboxElement=document.createElement("div"),this.lightboxElement.className=`${s.overlayClass} ${s.stateOpeningClass}`,this.lightboxElement.innerHTML=`\n      <div class="${s.containerClass}">\n        <button class="${s.closeClass}" data-lightbox-action="close" aria-label="Close"></button>\n        ${s.showNavigation?`\n          <button class="${s.prevClass}" data-lightbox-action="prev" aria-label="Previous"></button>\n          <button class="${s.nextClass}" data-lightbox-action="next" aria-label="Next"></button>\n        `:""}\n        <div class="${s.contentClass}">\n          <img class="${s.imageClass}" alt="">\n        </div>\n        ${s.showCounter?`<div class="${s.counterClass}"></div>`:""}\n      </div>\n    `,document.body.appendChild(this.lightboxElement),this.currentTriggerElement=t;if(this.lightboxElement.querySelector('[data-lightbox-action="close"]').addEventListener("click",e=>{e.stopPropagation(),this._closeLightbox(t)}),s.showNavigation){const e=this.lightboxElement.querySelector('[data-lightbox-action="prev"]'),s=this.lightboxElement.querySelector('[data-lightbox-action="next"]');e.addEventListener("click",e=>{e.stopPropagation(),this._previousImage(t)}),s.addEventListener("click",e=>{e.stopPropagation(),this._nextImage(t)}),e.disabled=!0,s.disabled=!0}s.closeOnBackdrop&&this.lightboxElement.addEventListener("click",e=>{e.target===this.lightboxElement&&this._closeLightbox(t)})}_showImage(t,e,s=null){const a=this.getState(t);if(!a)return;const l=a.config,i=a.galleryElements[e],n=i.href,o=i.querySelector("img")?.alt||"",r=this.lightboxElement.querySelector(`.${l.imageClass.split(" ")[0]}`);if(l.useDirectionalTransitions&&s&&"open"===a.lightboxState){this._setState(t,"transitioning");const e="next"===s?l.slideLeftClass:l.slideRightClass,a="next"===s?l.slideRightClass:l.slideLeftClass;r.classList.add(e),r.addEventListener("transitionend",()=>{const s=new Image;s.onload=()=>{r.src=n,r.alt=o,r.style.transition="none",r.classList.add(a),r.offsetHeight,r.classList.remove(e),requestAnimationFrame(()=>{r.style.transition="",r.classList.remove(a),r.addEventListener("transitionend",()=>{this._setState(t,"open")},{once:!0})})},s.onerror=()=>{r.src=n,r.alt=o,this._setState(t,"open")},s.src=n},{once:!0})}else r.src=n,r.alt=o;if(l.showCounter){this.lightboxElement.querySelector(`.${l.counterClass.split(" ")[0]}`).textContent=`${e+1} / ${a.galleryElements.length}`}if(l.showNavigation){const t=this.lightboxElement.querySelector('[data-lightbox-action="prev"]'),s=this.lightboxElement.querySelector('[data-lightbox-action="next"]');t&&(t.disabled=0===e),s&&(s.disabled=e===a.galleryElements.length-1)}}_previousImage(t){const e=this.getState(t);e&&"open"===e.lightboxState&&e.currentIndex>0&&(e.currentIndex--,this._showImage(t,e.currentIndex,"prev"))}_nextImage(t){const e=this.getState(t);e&&"open"===e.lightboxState&&e.currentIndex<e.galleryElements.length-1&&(e.currentIndex++,this._showImage(t,e.currentIndex,"next"))}_setupEventListeners(t){const e=this.getState(t);if(!e)return;const s=e.config;(s.closeOnEscape||s.keyNavigation)&&(this.keyHandler=a=>{if("open"!==e.lightboxState&&"transitioning"!==e.lightboxState)return;let l=!1;switch(a.key){case"Escape":s.closeOnEscape&&(this._closeLightbox(t),l=!0);break;case"ArrowLeft":s.keyNavigation&&(this._previousImage(t),l=!0);break;case"ArrowRight":s.keyNavigation&&(this._nextImage(t),l=!0)}l&&a.preventDefault()},document.addEventListener("keydown",this.keyHandler))}_closeLightbox(t){const e=this.getState(t);if(!e||"closed"===e.lightboxState||"closing"===e.lightboxState)return;this._setState(t,"closing"),this.lightboxElement.classList.remove(e.config.showClass);let s=!1;const a=()=>{s||(s=!0,this.keyHandler&&(document.removeEventListener("keydown",this.keyHandler),this.keyHandler=null),this.lightboxElement&&(this.lightboxElement.remove(),this.lightboxElement=null),document.body.classList.remove("overflow--hidden"),this._setState(t,"closed"),e.currentIndex=0,e.galleryElements=[],this.eventBus?.emit("lightbox:closed",{}))},l=t=>{t&&t.target!==this.lightboxElement||a()};this.lightboxElement.addEventListener("transitionend",l,{once:!0}),this.lightboxElement.addEventListener("animationend",l,{once:!0}),setTimeout(a,1e3)}open(t){this._openLightbox(t)}close(t){this._closeLightbox(t)}next(t){this._nextImage(t)}previous(t){this._previousImage(t)}goTo(t,e){const s=this.getState(t);s&&"open"===s.lightboxState&&e>=0&&e<s.galleryElements.length&&(s.currentIndex=e,this._showImage(t,s.currentIndex))}getStatus(t){const e=this.getState(t);return e?{lightboxState:e.lightboxState,currentIndex:e.currentIndex,gallerySize:e.galleryElements.length,gallery:e.gallery}:null}static enhanceAll(t="[data-lightbox]",s){const a=new e(s);return document.querySelectorAll(t).forEach(t=>a.mount(t)),a}}export{e as Lightbox,e as default};
