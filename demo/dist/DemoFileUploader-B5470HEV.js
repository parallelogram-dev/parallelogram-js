import{B as e}from"./parallelogram-demo.min.js";class t extends e{_init(e){const t=super._init(e);return this.element=e,this._setupEventListeners(e,t.controller.signal),this._setupMockAPI(),this._initEventLogging(),this.notifyPageLoaded(),t}_setupEventListeners(e,t){["uploader:mounted","uploader:files-added","uploader:upload-progress","uploader:file-uploaded","uploader:file-error","uploader:file-updated","uploader:file-deleted","uploader:files-reordered","uploader:drag-enter","uploader:drag-leave","uploader:ui-updated","uploader:error"].forEach(e=>{document.addEventListener(e,t=>{this.addEventToLog(e,t.detail)},{signal:t})}),e.addEventListener("click",e=>{e.target.matches('[data-btn-action="clearEventLog"]')&&this.clearEventLog()},{signal:t})}_setupMockAPI(){window.MockXHR?(this.logger&&this.logger.debug("Setting up MockXHR injection"),setTimeout(()=>{const e=document.querySelectorAll("[data-uploader]");this.logger&&this.logger.debug("Found uploader elements",{count:e.length}),e.forEach((e,t)=>{const n=e.__componentInstance;this.logger&&this.logger.debug(`Uploader ${t}`,{element:!!e,hasInstance:!!n,hasSetXHR:!!n&&!!n.setXHR}),n&&n.setXHR?(n.setXHR(window.MockXHR),this.logger&&this.logger.info("MockXHR injected into Uploader component",{index:t})):this.logger&&this.logger.debug("Uploader not yet mounted - MockXHR will use lazy initialization",{index:t,hasInstance:!!n})})},100)):this.logger&&this.logger.warn("MockXHR not available globally")}async _handleMockUpload(e,t){await new Promise(e=>setTimeout(e,800));const n=await t.body,o=n.get("action");if("upload"===o){const e=n.get("file");return new Response(JSON.stringify({id:this._generateId(),title:e.name.split(".")[0],filename:e.name,preview:e.type.startsWith("image/")?this._generatePreviewURL():null,info:`${this._formatFileSize(e.size)} â€¢ ${this._getFileTypeLabel(e)}`,type:e.type.startsWith("image/")?"image":"document"}),{status:200,headers:{"Content-Type":"application/json"}})}return"update"===o?new Response(JSON.stringify({id:n.get("id"),title:n.get("title"),info:"Updated via mock API"}),{status:200,headers:{"Content-Type":"application/json"}}):"delete"===o?new Response("OK",{status:200}):new Response("Invalid action",{status:400})}async _handleMockSequence(e,t){return await new Promise(e=>setTimeout(e,300)),new Response("OK",{status:200})}_initEventLogging(){const e=document.querySelectorAll("[data-uploader]");if(this.logger&&this.logger.debug("Found uploader elements",{count:e.length}),window.pageManager){this.logger&&this.logger.debug("PageManager exists");const e=window.componentRegistry||window.pageManager.registry;if(e){if(e.components){const t=e.components.find(e=>"uploader"===e.name);if(this.logger&&t){this.logger.debug("Found uploader in registry",t);const e=document.querySelectorAll(t.selector);this.logger.debug("Selector matches",{selector:t.selector,count:e.length})}}window.pageManager.scanAndMount&&this.logger&&(this.logger.debug("Attempting manual scan"),window.pageManager.scanAndMount())}else this.logger&&this.logger.warn("No component registry found")}else this.logger&&this.logger.warn("No pageManager found");const t=this.element.querySelector(".event__content");t&&(t.innerHTML=`\n        <div class="event__item">\n          <div class="event__entry">\n            <div>\n              <strong>demo:initialized</strong>\n              <pre>{"page": "/file-uploader", "mockAPI": true}</pre>\n            </div>\n            <small class="event__timestamp">${(new Date).toLocaleTimeString()}</small>\n          </div>\n        </div>\n      `)}addEventToLog(e,t){const n=this.element.querySelector(".event__content");if(!n)return;const o=(new Date).toLocaleTimeString(),i=document.createElement("div");i.className="event__item";const a=this._sanitizeEventData(t);i.innerHTML=`\n      <div class="event__entry">\n        <div>\n          <strong style="color: #2563eb;">${e}</strong>\n          <pre style="margin: 0.5rem 0 0 0; font-size: 0.8rem; color: #666; background: #f8f9fa; padding: 0.5rem; border-radius: 4px; overflow-x: auto;">${JSON.stringify(a,null,2)}</pre>\n        </div>\n        <small class="event__timestamp" style="color: #999; margin-left: 1rem; white-space: nowrap;">${o}</small>\n      </div>\n    `,n.insertBefore(i,n.firstChild);const s=n.querySelectorAll(".event__item");s.length>15&&s[s.length-1].remove()}clearEventLog(){const e=this.element.querySelector(".event__content");e&&(e.innerHTML=`\n        <div class="event__item">\n          <div class="event__entry">\n            <div>\n              <em>Event log cleared</em>\n            </div>\n            <small class="event__timestamp">${(new Date).toLocaleTimeString()}</small>\n          </div>\n        </div>\n      `)}_sanitizeEventData(e){if(!e||"object"!=typeof e)return e;const t={};for(const[n,o]of Object.entries(e))"target"===n||"element"===n?t[n]=o?{tagName:o.tagName,id:o.id||void 0,className:o.className||void 0}:null:"fileData"===n&&o?t[n]={id:o.id,filename:o.filename,type:o.type,state:o.state}:"object"==typeof o&&null!==o?Array.isArray(o)?t[n]=o.slice(0,5):t[n]=Object.keys(o).length>0?"[Object]":o:t[n]=o;return t}notifyPageLoaded(){window.eventBus&&window.eventBus.emit("page:loaded",{page:"/file-uploader",components:["file-uploader"],mockAPI:!0,timestamp:performance.now()})}_generateId(){return`demo_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}_generatePreviewURL(){return`https://picsum.photos/200/200?random=${Math.floor(1e3*Math.random())}`}_formatFileSize(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["Bytes","KB","MB","GB"][t]}_getFileTypeLabel(e){return e?.type?e.type.startsWith("image/")?"Image":e.type.includes("pdf")?"PDF":e.type.includes("document")||e.type.includes("word")?"Document":e.type.includes("spreadsheet")||e.type.includes("excel")?"Spreadsheet":e.type.includes("presentation")||e.type.includes("powerpoint")?"Presentation":"File":"Unknown"}}export{t as DemoFileUploader};
