import{B as e}from"./parallelogram-demo.min.js";class t extends e{static get defaults(){return{loadingClass:"loading",errorClass:"error",transition:"fade",transitionDuration:300,retainScroll:!1,emptyMessage:"Please select an option"}}_init(e){const s=super._init(e);if("SELECT"!==e.tagName)return this.logger?.error("SelectLoader: Element must be a <select>",{element:e}),s;const a=this._getConfigFromAttrs(e,{target:"target",loadingClass:"loading-class",errorClass:"error-class",transition:"transition",transitionDuration:"transition-duration",retainScroll:"retain-scroll",emptyMessage:"empty-message"}),r=this._getTargetElement(e,"target",{required:!0});return r?(s.config={...t.defaults,...a},s.targetElement=r,s.isLoading=!1,s.currentUrl=null,s.scrollPosition=0,this._setupEventListeners(e,s),e.value?this._loadFragment(e,s,e.value):this._showEmptyMessage(s),this.logger?.info("SelectLoader initialized",{element:e,target:a.target,options:e.options.length}),s):s}_setupEventListeners(e,t){e.addEventListener("change",s=>{this._handleChange(s,e,t)},{signal:t.controller.signal});const s=e.closest("form");s&&s.addEventListener("reset",async()=>{await this._delay(10),this._showEmptyMessage(t)},{signal:t.controller.signal}),this.eventBus?.on("router:navigate-success",e=>{t.targetElement&&!document.contains(t.targetElement)&&this.logger?.warn("SelectLoader: Target removed during navigation")})}async _handleChange(e,t,s){const a=t.value;if(!this._dispatch(t,"selectloader:before-change",{value:a,previousUrl:s.currentUrl,targetElement:s.targetElement}).defaultPrevented)return a&&""!==a?void await this._loadFragment(t,s,a):(this._showEmptyMessage(s),s.currentUrl=null,void this._dispatch(t,"selectloader:cleared",{targetElement:s.targetElement}));this.logger?.debug("SelectLoader: Change prevented by listener")}async _loadFragment(e,t,s){if(t.isLoading)this.logger?.warn("SelectLoader: Load already in progress");else{t.isLoading=!0,t.currentUrl=s,t.config.retainScroll&&(t.scrollPosition=t.targetElement.scrollTop),e.classList.add(t.config.loadingClass),e.disabled=!0,t.targetElement.classList.add(t.config.loadingClass),this._dispatch(e,"selectloader:loading",{url:s,targetElement:t.targetElement});try{if(!this.router)throw new Error("RouterManager not available");const a=(await this.router.get(s)).data;"none"!==t.config.transition&&await this._transitionOut(t),t.targetElement.innerHTML=a,t.config.retainScroll&&(t.targetElement.scrollTop=t.scrollPosition),"none"!==t.config.transition&&await this._transitionIn(t),this._dispatch(e,"selectloader:loaded",{url:s,targetElement:t.targetElement,html:a}),this.eventBus?.emit("selectloader:content-loaded",{element:e,url:s,targetElement:t.targetElement}),this.logger?.info("SelectLoader: Fragment loaded",{url:s})}catch(a){this.logger?.error("SelectLoader: Load failed",{url:s,error:a}),this._showErrorMessage(t,a),this._dispatch(e,"selectloader:error",{url:s,error:a,targetElement:t.targetElement}),this.eventBus?.emit("app:notification",{type:"error",message:`Failed to load content: ${a.message}`,duration:5e3})}finally{t.isLoading=!1,e.classList.remove(t.config.loadingClass),e.disabled=!1,t.targetElement.classList.remove(t.config.loadingClass),this._dispatch(e,"selectloader:complete",{url:s,success:!t.targetElement.classList.contains(t.config.errorClass)})}}}async _transitionOut(e){const{transition:t,transitionDuration:s}=e.config;"fade"===t?await this._fadeOut(e.targetElement,s):"slide"===t&&await this._slideOut(e.targetElement,s)}async _transitionIn(e){const{transition:t,transitionDuration:s}=e.config;"fade"===t?await this._fadeIn(e.targetElement,s):"slide"===t&&await this._slideIn(e.targetElement,s)}async _slideOut(e,t){const s=e.offsetHeight;e.style.overflow="hidden",e.style.height=`${s}px`,e.offsetHeight,e.style.transition=`height ${t}ms ease-out, opacity ${t}ms ease-out`,e.style.height="0",e.style.opacity="0",await this._delay(t)}async _slideIn(e,t){const s=e.scrollHeight;e.style.height="0",e.style.overflow="hidden",e.offsetHeight,e.style.transition=`height ${t}ms ease-in, opacity ${t}ms ease-in`,e.style.height=`${s}px`,e.style.opacity="1",await this._delay(t),e.style.height="",e.style.overflow="",e.style.transition=""}_showEmptyMessage(e){const t=e.config.emptyMessage;e.targetElement.innerHTML=`\n      <div class="select-loader__empty">\n        <p>${t}</p>\n      </div>\n    `,e.targetElement.classList.remove(e.config.errorClass)}_showErrorMessage(e,t){const s=t.message||"Failed to load content",a=this._generateId("retry");e.targetElement.innerHTML=`\n      <div class="select-loader__error">\n        <p>${s}</p>\n        <button type="button" id="${a}" class="btn btn--sm">Retry</button>\n      </div>\n    `,e.targetElement.classList.add(e.config.errorClass);const r=document.getElementById(a);r&&r.addEventListener("click",()=>{const t=Array.from(document.querySelectorAll("select")).find(t=>this.getState(t)===e);t&&e.currentUrl&&this._loadFragment(t,e,e.currentUrl)},{once:!0})}reload(e){const t=this._requireState(e,"reload");t&&t.currentUrl&&this._loadFragment(e,t,t.currentUrl)}load(e,t){const s=this._requireState(e,"load");s&&(e.value=t,this._loadFragment(e,s,t))}clear(e){const t=this._requireState(e,"clear");t&&(e.value="",this._showEmptyMessage(t),t.currentUrl=null)}getLoadState(e){const t=this.getState(e);return t?{isLoading:t.isLoading,currentUrl:t.currentUrl,hasContent:t.targetElement.children.length>0,hasError:t.targetElement.classList.contains(t.config.errorClass)}:null}}export{t as default};
