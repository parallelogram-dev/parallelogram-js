import{B as e}from"./index.esm-BW_QP_AR.js";import{C as t,E as a}from"./ComponentStates-CcJglg_C.js";import{c as r,a as s,d as n}from"./parallelogram-demo.min.js";class o extends e{static get defaults(){return{sortable:!0,filterable:!1,paginate:!1,pageSize:10,searchDelay:300,sortIcons:{unsorted:"↕",asc:"↑",desc:"↓"}}}constructor(e={}){super(e),this.searchTimeout=null}_init(e){const a=super._init(e);e.setAttribute("data-datatable",t.MOUNTED);const r=this._getConfiguration(e),s=Array.from(e.querySelectorAll("tbody tr"));return a.config=r,a.originalRows=s,a.filteredRows=[...s],a.currentSort={column:null,direction:null},a.currentPage=1,a.searchTerm="",a.errorMessage=null,r.sortable&&this._setupSorting(e,a),r.filterable&&this._setupFiltering(e,a),r.paginate&&this._setupPagination(e,a),this._render(e,a),this.eventBus?.emit("datatable:mounted",{element:e,config:r}),a}_getConfiguration(e){return{sortable:this._getDataAttr(e,"datatable-sortable",o.defaults.sortable),filterable:this._getDataAttr(e,"datatable-filterable",o.defaults.filterable),paginate:parseInt(this._getDataAttr(e,"datatable-paginate",o.defaults.paginate))||!1,pageSize:parseInt(this._getDataAttr(e,"datatable-page-size",o.defaults.pageSize)),searchDelay:parseInt(this._getDataAttr(e,"datatable-search-delay",o.defaults.searchDelay))}}_setupSorting(e,t){e.querySelectorAll("th[data-sort]").forEach(a=>{a.style.cursor="pointer",a.classList.add("sortable");const s=r("span",{className:"sort-icon"},o.defaults.sortIcons.unsorted);a.appendChild(s),a.addEventListener("click",()=>{this._handleSort(e,t,a)})})}_setupFiltering(e,t){const a=s("datatable-search"),o=r("label",{className:"form__label",htmlFor:a},"Search:"),l=r("input",{type:"text",id:a,placeholder:"Search table...",className:"form__control datatable-search"}),i=n(a=>{this._handleFilter(e,t,a)},t.config.searchDelay);l.addEventListener("input",e=>i(e.target.value));const d=r("div",{className:"form__field"});d.appendChild(l);const c=r("div",{className:"form__element form__element--sm datatable-filter"});c.appendChild(o),c.appendChild(d),e.parentNode.insertBefore(c,e)}_setupPagination(e,t){const a=document.createElement("div");a.className="datatable__pagination",e.parentNode.appendChild(a),t.paginationContainer=a}_handleSort(e,t,a){const r=a.dataset.sort,s=a.dataset.sortType||"string";let n="asc";t.currentSort.column===r&&"asc"===t.currentSort.direction&&(n="desc"),t.currentSort={column:r,direction:n},e.querySelectorAll(".sort-icon").forEach(e=>{e.textContent=o.defaults.sortIcons.unsorted});a.querySelector(".sort-icon").textContent=o.defaults.sortIcons[n];const l=Array.from(e.querySelectorAll("th"));t.filteredRows.sort((e,t)=>{const a=this._getCellValue(e,r,s,l),o=this._getCellValue(t,r,s,l);let i=0;return i="number"===s?parseFloat(a)-parseFloat(o):"date"===s?new Date(a)-new Date(o):a.localeCompare(o),"desc"===n?-i:i}),t.currentPage=1,this._render(e,t)}_handleFilter(e,t,a){t.searchTerm=a.toLowerCase(),t.filteredRows=a?t.originalRows.filter(e=>Array.from(e.cells).some(e=>e.textContent.toLowerCase().includes(t.searchTerm))):[...t.originalRows],t.currentPage=1,this._render(e,t)}_getCellValue(e,t,a,r=null){if(!e||!e.cells)return"";if(!r){const t=e.closest("table");if(!t)return"";r=Array.from(t.querySelectorAll("th"))}const s=r.findIndex(e=>e&&e.dataset&&e.dataset.sort===t);if(-1===s||!e.cells[s])return"";const n=e.cells[s];return n&&n.textContent?n.textContent.trim():""}_render(e,t){const a=e.querySelector("tbody");a.innerHTML="";let r=t.filteredRows;if(t.config.paginate){const e=(t.currentPage-1)*t.config.pageSize,a=e+t.config.pageSize;r=t.filteredRows.slice(e,a)}r.forEach(e=>a.appendChild(e.cloneNode(!0))),t.config.paginate&&this._renderPagination(e,t),this.eventBus?.emit("datatable:rendered",{element:e,totalRows:t.originalRows.length,filteredRows:t.filteredRows.length,displayedRows:r.length})}_renderPagination(e,t){const a=t.paginationContainer,r=Math.ceil(t.filteredRows.length/t.config.pageSize);if(a.innerHTML="",r<=1)return;const s=document.createElement("button");s.textContent="Previous",s.disabled=1===t.currentPage,s.addEventListener("click",()=>{t.currentPage>1&&(t.currentPage--,this._render(e,t))}),a.appendChild(s);for(let s=1;s<=r;s++){const r=document.createElement("button");r.textContent=s,r.classList.toggle("active",s===t.currentPage),r.addEventListener("click",()=>{t.currentPage=s,this._render(e,t)}),a.appendChild(r)}const n=document.createElement("button");n.textContent="Next",n.disabled=t.currentPage===r,n.addEventListener("click",()=>{t.currentPage<r&&(t.currentPage++,this._render(e,t))}),a.appendChild(n)}async loadData(e,r,s){const n=this.getState(e);if(n)try{e.setAttribute("data-datatable",a.LOADING),n.errorMessage=null;const t=await fetch(r);if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const o=await t.json();if(!Array.isArray(o))throw new Error("Response data must be an array");if(0===o.length)return e.setAttribute("data-datatable","empty"),n.originalRows=[],n.filteredRows=[],this._render(e,n),void this._dispatch(e,"datatable:empty",{url:r});e.querySelector("tbody").innerHTML="";const l=o.map(e=>s(e));n.originalRows=l,n.filteredRows=[...l],n.currentPage=1,e.setAttribute("data-datatable",a.LOADED),this._render(e,n),this._dispatch(e,"datatable:loaded",{url:r,rowCount:o.length}),this.eventBus?.emit("datatable:loaded",{element:e,url:r,rowCount:o.length})}catch(a){e.setAttribute("data-datatable",t.ERROR),e.setAttribute("data-error-message",a.message),n.errorMessage=a.message,this._dispatch(e,"datatable:error",{error:a,url:r,message:a.message}),this.eventBus?.emit("datatable:error",{element:e,error:a,url:r,message:a.message}),this.logger?.error("DataTable: Failed to load data",{error:a,url:r})}}clearError(e){const a=this.getState(e);a&&(a.errorMessage=null,e.removeAttribute("data-error-message"),e.setAttribute("data-datatable",t.MOUNTED))}sort(e,t,a="asc"){const r=this.getState(e);if(!r)return;const s=e.querySelector(`th[data-sort="${t}"]`);s&&(r.currentSort={column:t,direction:a},this._handleSort(e,r,s))}filter(e,t){const a=this.getState(e);a&&this._handleFilter(e,a,t)}goToPage(e,t){const a=this.getState(e);if(!a||!a.config.paginate)return;const r=Math.ceil(a.filteredRows.length/a.config.pageSize);t>=1&&t<=r&&(a.currentPage=t,this._render(e,a))}static enhanceAll(e="[data-datatable]",t){const a=new o(t);return document.querySelectorAll(e).forEach(e=>a.mount(e)),a}}export{o as DataTable,o as default};
