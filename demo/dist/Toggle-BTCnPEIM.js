import{B as t}from"./index.esm-BW_QP_AR.js";class e extends t{static get defaults(){return{openClass:"open",transitioningClass:"transitioning",transitionDuration:750,capture:!1,manual:!1,multiple:!1,animateToggle:!0,closeOnEscape:!0,closeOnNavigation:!0}}_init(t){const a=super._init(t),n=this._getDataAttr(t,"toggle-target");if(!n)return this.logger?.warn("Toggle: No data-toggle-target attribute found",t),a;const s=document.querySelector(n);if(!s)return this.logger?.warn("Toggle: Target element not found",{selector:n,element:t}),a;const i=this._getDataAttr(t,"toggle-capture",e.defaults.capture),r=s.hasAttribute("data-toggle-manual")||this._getDataAttr(t,"toggle-manual",e.defaults.manual),l=this._getDataAttr(t,"toggle-multiple",e.defaults.multiple),o=this._getDataAttr(t,"toggle-animate",e.defaults.animateToggle),g=this._getDataAttr(t,"toggle-close-navigation",e.defaults.closeOnNavigation);a.target=s,a.targetSelector=n,a.capture=i,a.manual=r,a.multiple=l,a.animateToggle=o,a.closeOnNavigation=g,a.isOpen=s.classList.contains(e.defaults.openClass),a.transitionTimer=null;const c=e=>this._handleClick(e,t,a);if(t.addEventListener("click",c),t.setAttribute("data-toggle-enhanced","true"),t.setAttribute("aria-expanded",String(a.isOpen)),t.getAttribute("aria-controls")||t.setAttribute("aria-controls",n.replace("#","")),e.defaults.closeOnEscape){const e=e=>this._handleEscape(e,t,a);document.addEventListener("keydown",e),a.escapeHandler=e}const u=a.cleanup;return a.cleanup=()=>{t.removeEventListener("click",c),a.escapeHandler&&document.removeEventListener("keydown",a.escapeHandler),this._clearTransitionTimer(a),this._removeGlobalListeners(a),u()},this.eventBus?.emit("toggle:mount",{element:t,target:s,isOpen:a.isOpen,timestamp:performance.now()}),this.logger?.info("Toggle initialized",{element:t,target:n,capture:i,manual:r,isOpen:a.isOpen}),a}_handleClick(t,e,a){t.preventDefault(),t.stopPropagation(),this.toggle(e)}_handleEscape(t,e,a){"Escape"===t.key&&a.isOpen&&!a.manual&&this.hide(e)}toggle(t){const a=this.getState(t);if(!a)return;a.target.classList.contains(e.defaults.openClass)?this.hide(t):this.show(t)}show(t){const a=this.getState(t);if(!a)return;a.target.classList.contains(e.defaults.openClass)||(a.multiple||this._closeOtherToggles(t),a.isOpen=!0,this._syncTriggerStates(a.targetSelector,!0),this._updateElementStates(t,a,!0),(a.capture||a.closeOnNavigation)&&this._setupGlobalListeners(t,a),a.animateToggle&&(a.target.classList.add(e.defaults.transitioningClass),a.transitionTimer=setTimeout(()=>{this._endTransition(a)},e.defaults.transitionDuration)),this._dispatch(t,"toggle:show",{target:a.target,trigger:t}),this.eventBus?.emit("toggle:show",{element:t,target:a.target,timestamp:performance.now()}),this.logger?.debug("Toggle shown",{element:t,target:a.targetSelector}))}hide(t){const a=this.getState(t);if(!a)return;a.target.classList.contains(e.defaults.openClass)&&(a.isOpen=!1,this._syncTriggerStates(a.targetSelector,!1),this._updateElementStates(t,a,!1),this._removeGlobalListeners(a),a.animateToggle&&(a.target.classList.add(e.defaults.transitioningClass),a.transitionTimer=setTimeout(()=>{this._endTransition(a)},e.defaults.transitionDuration)),this._dispatch(t,"toggle:hide",{target:a.target,trigger:t}),this.eventBus?.emit("toggle:hide",{element:t,target:a.target,timestamp:performance.now()}),this.logger?.debug("Toggle hidden",{element:t,target:a.targetSelector}))}hideAll(){document.querySelectorAll('[data-toggle-enhanced="true"]').forEach(t=>{const e=this.getState(t);e&&e.isOpen&&!e.manual&&this.hide(t)})}isOpen(t){const e=this.getState(t);return!!e&&e.isOpen}_updateElementStates(t,a,n){t.setAttribute("aria-expanded",String(n)),n?a.target.classList.add(e.defaults.openClass):a.target.classList.remove(e.defaults.openClass);document.querySelectorAll(`[data-toggle-target="${a.targetSelector}"]`).forEach(t=>{t.setAttribute("aria-expanded",String(n)),n?t.classList.add(e.defaults.openClass):t.classList.remove(e.defaults.openClass)})}_setupGlobalListeners(t,e){const a=a=>{e.closeOnNavigation&&!e.manual&&this._isNavigationLink(a.target)?this.hide(t):a.stopPropagation()},n=a=>{e.manual||t.contains(a.target)||e.target.contains(a.target)||this.hide(t)};e.target.addEventListener("click",a),document.addEventListener("click",n),e.targetClickHandler=a,e.documentClickHandler=n}_removeGlobalListeners(t){t.targetClickHandler&&(t.target.removeEventListener("click",t.targetClickHandler),t.targetClickHandler=null),t.documentClickHandler&&(document.removeEventListener("click",t.documentClickHandler),t.documentClickHandler=null)}_isNavigationLink(t){let e=t;for(;e&&e!==document.body;){if("A"===e.tagName){const t=e.getAttribute("href");if(t&&!t.startsWith("#")&&!t.startsWith("javascript:")&&!t.startsWith("mailto:")&&!t.startsWith("tel:")&&!e.hasAttribute("download")&&"_blank"!==e.getAttribute("target"))return!0;break}e=e.parentElement}return!1}_endTransition(t){t.target.classList.remove(e.defaults.transitioningClass),t.transitionTimer=null}_clearTransitionTimer(t){t.transitionTimer&&(clearTimeout(t.transitionTimer),t.transitionTimer=null)}_closeOtherToggles(t){document.querySelectorAll('[data-toggle-enhanced="true"]').forEach(e=>{if(e!==t){const t=this.getState(e);t&&t.isOpen&&!t.manual&&this.hide(e)}})}_syncTriggerStates(t,e){document.querySelectorAll(`[data-toggle-target="${t}"][data-toggle-enhanced="true"]`).forEach(t=>{const a=this.getState(t);a&&(a.isOpen=e)})}getStatus(){const t=document.querySelectorAll('[data-toggle-enhanced="true"]');let a=0,n=0,s=0;return t.forEach(t=>{const e=this.getState(t);e&&(e.isOpen&&a++,e.capture&&n++,e.manual&&s++)}),{totalTriggers:t.length,openCount:a,captureCount:n,manualCount:s,defaults:e.defaults}}static enhanceAll(t="[data-toggle]",a){const n=new e(a);return document.querySelectorAll(t).forEach(t=>{n.mount(t)}),n}}export{e as default};
