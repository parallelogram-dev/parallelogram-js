import{B as e}from"./index.esm-BW_QP_AR.js";import{c as t,a,d as r}from"./parallelogram-demo.min.js";class n extends e{static get defaults(){return{sortable:!0,filterable:!1,paginate:!1,pageSize:10,searchDelay:300,sortIcons:{unsorted:"↕",asc:"↑",desc:"↓"}}}constructor(e={}){super(e),this.searchTimeout=null}_init(e){const t=super._init(e),a=this._getConfiguration(e),r=Array.from(e.querySelectorAll("tbody tr"));return t.config=a,t.originalRows=r,t.filteredRows=[...r],t.currentSort={column:null,direction:null},t.currentPage=1,t.searchTerm="",a.sortable&&this._setupSorting(e,t),a.filterable&&this._setupFiltering(e,t),a.paginate&&this._setupPagination(e,t),this._render(e,t),this.eventBus?.emit("datatable:mounted",{element:e,config:a}),t}_getConfiguration(e){return{sortable:this._getDataAttr(e,"datatable-sortable",n.defaults.sortable),filterable:this._getDataAttr(e,"datatable-filterable",n.defaults.filterable),paginate:parseInt(this._getDataAttr(e,"datatable-paginate",n.defaults.paginate))||!1,pageSize:parseInt(this._getDataAttr(e,"datatable-page-size",n.defaults.pageSize)),searchDelay:parseInt(this._getDataAttr(e,"datatable-search-delay",n.defaults.searchDelay))}}_setupSorting(e,a){e.querySelectorAll("th[data-sort]").forEach(r=>{r.style.cursor="pointer",r.classList.add("sortable");const s=t("span",{className:"sort-icon"},n.defaults.sortIcons.unsorted);r.appendChild(s),r.addEventListener("click",()=>{this._handleSort(e,a,r)})})}_setupFiltering(e,n){const s=a("datatable-search"),o=t("label",{className:"form__label",htmlFor:s},"Search:"),l=t("input",{type:"text",id:s,placeholder:"Search table...",className:"form__control datatable-search"}),i=r(t=>{this._handleFilter(e,n,t)},n.config.searchDelay);l.addEventListener("input",e=>i(e.target.value));const c=t("div",{className:"form__field"});c.appendChild(l);const d=t("div",{className:"form__element form__element--sm datatable-filter"});d.appendChild(o),d.appendChild(c),e.parentNode.insertBefore(d,e)}_setupPagination(e,t){const a=document.createElement("div");a.className="datatable__pagination",e.parentNode.appendChild(a),t.paginationContainer=a}_handleSort(e,t,a){const r=a.dataset.sort,s=a.dataset.sortType||"string";let o="asc";t.currentSort.column===r&&"asc"===t.currentSort.direction&&(o="desc"),t.currentSort={column:r,direction:o},e.querySelectorAll(".sort-icon").forEach(e=>{e.textContent=n.defaults.sortIcons.unsorted});a.querySelector(".sort-icon").textContent=n.defaults.sortIcons[o];const l=Array.from(e.querySelectorAll("th"));t.filteredRows.sort((e,t)=>{const a=this._getCellValue(e,r,s,l),n=this._getCellValue(t,r,s,l);let i=0;return i="number"===s?parseFloat(a)-parseFloat(n):"date"===s?new Date(a)-new Date(n):a.localeCompare(n),"desc"===o?-i:i}),t.currentPage=1,this._render(e,t)}_handleFilter(e,t,a){t.searchTerm=a.toLowerCase(),t.filteredRows=a?t.originalRows.filter(e=>Array.from(e.cells).some(e=>e.textContent.toLowerCase().includes(t.searchTerm))):[...t.originalRows],t.currentPage=1,this._render(e,t)}_getCellValue(e,t,a,r=null){if(!e||!e.cells)return"";if(!r){const t=e.closest("table");if(!t)return"";r=Array.from(t.querySelectorAll("th"))}const n=r.findIndex(e=>e&&e.dataset&&e.dataset.sort===t);if(-1===n||!e.cells[n])return"";const s=e.cells[n];return s&&s.textContent?s.textContent.trim():""}_render(e,t){const a=e.querySelector("tbody");a.innerHTML="";let r=t.filteredRows;if(t.config.paginate){const e=(t.currentPage-1)*t.config.pageSize,a=e+t.config.pageSize;r=t.filteredRows.slice(e,a)}r.forEach(e=>a.appendChild(e.cloneNode(!0))),t.config.paginate&&this._renderPagination(e,t),this.eventBus?.emit("datatable:rendered",{element:e,totalRows:t.originalRows.length,filteredRows:t.filteredRows.length,displayedRows:r.length})}_renderPagination(e,t){const a=t.paginationContainer,r=Math.ceil(t.filteredRows.length/t.config.pageSize);if(a.innerHTML="",r<=1)return;const n=document.createElement("button");n.textContent="Previous",n.disabled=1===t.currentPage,n.addEventListener("click",()=>{t.currentPage>1&&(t.currentPage--,this._render(e,t))}),a.appendChild(n);for(let n=1;n<=r;n++){const r=document.createElement("button");r.textContent=n,r.classList.toggle("active",n===t.currentPage),r.addEventListener("click",()=>{t.currentPage=n,this._render(e,t)}),a.appendChild(r)}const s=document.createElement("button");s.textContent="Next",s.disabled=t.currentPage===r,s.addEventListener("click",()=>{t.currentPage<r&&(t.currentPage++,this._render(e,t))}),a.appendChild(s)}sort(e,t,a="asc"){const r=this.getState(e);if(!r)return;const n=e.querySelector(`th[data-sort="${t}"]`);n&&(r.currentSort={column:t,direction:a},this._handleSort(e,r,n))}filter(e,t){const a=this.getState(e);a&&this._handleFilter(e,a,t)}goToPage(e,t){const a=this.getState(e);if(!a||!a.config.paginate)return;const r=Math.ceil(a.filteredRows.length/a.config.pageSize);t>=1&&t<=r&&(a.currentPage=t,this._render(e,a))}static enhanceAll(e="[data-datatable]",t){const a=new n(t);return document.querySelectorAll(e).forEach(e=>a.mount(e)),a}}export{n as DataTable,n as default};
