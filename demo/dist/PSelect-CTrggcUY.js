class e{constructor({root:e=document,defaultY:t="1rem",defaultDur:s=320,defaultEase:i="cubic-bezier(0.22,1,0.36,1)"}={}){this.root=e,this.defaults={y:t,dur:s,ease:i}}async enter(e){const t=e.dataset.transitionEnterClass;return t?this._animateWithClass(e,t):this._animateWithJS(e,!0)}async exit(e){const t=e.dataset.transitionExitClass;return t?this._animateWithClass(e,t):this._animateWithJS(e,!1)}_animateWithClass(e,t){return new Promise(s=>{const i=()=>{e.removeEventListener("animationend",i),s()};e.addEventListener("animationend",i,{once:!0}),e.classList.add(t)})}_animateWithJS(e,t){const s=e.dataset.transitionY||this.defaults.y,i=Number(e.dataset.transitionDuration||this.defaults.dur),a=e.dataset.transitionEase||this.defaults.ease;return e.style.transition=`opacity ${i}ms ${a}, transform ${i}ms ${a}`,t?(e.style.opacity=0,e.style.transform=`translateY(${s})`,e.getBoundingClientRect(),e.style.opacity=1,e.style.transform="translateY(0)"):(e.style.opacity=1,e.style.transform="translateY(0)",e.getBoundingClientRect(),e.style.opacity=0,e.style.transform=`translateY(${s})`),new Promise(t=>setTimeout(()=>{e.style.transition="",t()},i))}async swap(e,t){const s=e.firstElementChild;s&&await this.exit(s),e.innerHTML="",t&&e.appendChild(t),t&&await this.enter(t)}}class t extends HTMLElement{static formAssociated=!0;constructor(){if(super(),!this.attachInternals)throw new Error("PSelect requires form-associated custom elements support");this._internals=this.attachInternals(),this.attachShadow({mode:"open"}),this.tm=new e,this.state={options:[],filtered:[],value:"",open:!1,highlightedIndex:-1,src:null,debounce:200,min:0,openOnFocus:!0,placeholder:this.getAttribute("placeholder")||"Select…",disabled:!1,required:!1,loading:!1,error:null},this._abortController=null,this._searchTimeout=null,this._announcementRegion=null,this._render(),this._setupEventListeners(),this._initializeFromAttributes()}connectedCallback(){this._createAnnouncementRegion(),this._parseOptionsFromDOM(),this.state.src&&0===this.state.min&&this._fetchOptions("").catch(this._handleFetchError.bind(this))}disconnectedCallback(){this._cancelPendingRequest(),this._searchTimeout&&clearTimeout(this._searchTimeout),this._announcementRegion&&this._announcementRegion.remove()}static get observedAttributes(){return["value","placeholder","disabled","name","required"]}attributeChangedCallback(e,t,s){if(t!==s)switch(e){case"value":this._updateValue(s);break;case"placeholder":this.state.placeholder=s||"Select…",this._updatePlaceholder();break;case"disabled":this._updateDisabledState(null!==s);break;case"name":this.name=s||"";break;case"required":this._updateRequiredState(null!==s)}}_render(){this.shadowRoot.innerHTML='\n      <style>:host{box-sizing:border-box;display:inline-block;position:relative}:host{--select-border-color:var(--surface-control-border-color);--select-focus-color:var(--color-primary);--select-bg:var(--surface-control-color-bg);--select-text:var(--surface-control-color-text);--select-placeholder:var(--color-text-secondary,#64748b);--select-hover-bg:var(--surface-dropdown-item-hover-bg);--select-selected-bg:var(--surface-dropdown-item-selected-bg);--select-current-bg:var(--surface-dropdown-item-current-bg);--select-padding:0.45rem 0.6rem;--select-border-radius:var(--surface-control-radius);--select-border:var(--surface-control-border-width) solid var(--select-border-color);--select-focus-shadow:inset 0 0 0 3px rgba(37,99,235,.3);--menu-border-radius:var(--surface-dropdown-radius);--menu-border-color:var(--surface-dropdown-border-color);--menu-bg:var(--surface-dropdown-color-bg);--menu-shadow:var(--surface-dropdown-shadow)}@media (prefers-color-scheme:dark){:host{--select-border-color:var(--border-color,var(--color-border,#374151));--select-bg:var(--background-color,var(--color-surface,#1f2937));--select-text:var(--text-color,var(--color-text,#f9fafb));--select-placeholder:var(--text-muted,var(--color-text-secondary,#9ca3af));--select-hover-bg:var(--hover-bg,var(--color-surface-hover,hsla(0,0%,100%,.1)));--select-selected-bg:var(--selected-bg,var(--color-surface-active,rgba(59,130,246,.2)));--select-current-bg:var(--current-bg,var(--color-surface-focus,hsla(0,0%,100%,.1)))}}.root{background:inherit;border:inherit;border-radius:inherit;color:inherit;font-family:inherit;font-size:inherit;height:100%;width:100%}.control,.root{box-sizing:border-box;left:0;padding:inherit;position:absolute;top:0}.control{align-items:center;bottom:0;cursor:pointer;display:flex;gap:.4rem;right:0;transition:border-color .2s ease,box-shadow .2s ease}.input{background:transparent;border:0;color:inherit;flex:1;font:inherit;min-width:2ch;outline:0;padding:0}.input::placeholder{color:inherit;opacity:.6}.arrow{flex-shrink:0;margin-left:auto;pointer-events:none;transition:transform .15s ease;user-select:none}.control[aria-expanded=true] .arrow{transform:rotate(180deg)}.menu{background:var(--menu-bg);border:var(--surface-dropdown-border-width,1px) solid var(--menu-border-color);border-radius:var(--menu-border-radius);box-shadow:var(--menu-shadow);color:var(--select-text);left:0;margin-top:.25rem;max-height:240px;overflow:auto;position:absolute;right:0;top:100%;z-index:10}.option{cursor:pointer;padding:.45rem .6rem;transition:background-color .15s ease}.option:hover{background:var(--select-hover-bg)}.option[aria-selected=true]{background:var(--select-selected-bg);font-weight:500}.option[aria-current=true]{background:var(--select-current-bg)}.option[aria-disabled=true]{background:transparent!important;cursor:not-allowed;opacity:.5}.noresults{font-style:italic;opacity:.6;padding:.6rem;text-align:center}</style>\n\n      <div class="root">\n        <div\n          class="control"\n          role="combobox"\n          aria-expanded="false"\n          aria-haspopup="listbox"\n        >\n          <input\n            class="input"\n            type="text"\n            autocomplete="off"\n          />\n          <span class="arrow" aria-hidden="true">▾</span>\n        </div>\n\n        <div class="menu" role="listbox" hidden></div>\n      </div>\n    ',this._els={control:this.shadowRoot.querySelector(".control"),input:this.shadowRoot.querySelector(".input"),menu:this.shadowRoot.querySelector(".menu"),arrow:this.shadowRoot.querySelector(".arrow")},this._updateDisplay()}_setupEventListeners(){this._els.control.addEventListener("mousedown",e=>{e.target!==this._els.input&&(e.preventDefault(),this._els.input.focus(),this.toggle())}),this._els.input.addEventListener("focus",()=>{this.state.openOnFocus&&this.open()}),this._els.input.addEventListener("input",e=>{this._handleInput(e)}),this._els.input.addEventListener("keydown",e=>{this._handleKeydown(e)}),document.addEventListener("click",e=>{this.contains(e.target)||this.shadowRoot.contains(e.target)||this.close()})}_initializeFromAttributes(){const e=this.dataset;this.state.src=e.selectSrc||null,this.state.debounce=Number(e.selectDebounce||200),this.state.min=Number(e.selectMin||0),this.state.openOnFocus="false"!==(e.selectOpenOnFocus??"true"),this.state.disabled=this.hasAttribute("disabled"),this.state.required=this.hasAttribute("required"),this.name=this.getAttribute("name")||""}_createAnnouncementRegion(){this._announcementRegion=document.createElement("div"),this._announcementRegion.setAttribute("aria-live","polite"),this._announcementRegion.style.cssText="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0)",document.body.appendChild(this._announcementRegion)}_announce(e){this._announcementRegion&&(this._announcementRegion.textContent=e)}_parseOptionsFromDOM(){const e=[];this.querySelectorAll("option").forEach((t,s)=>{const i=t.hasAttribute("disabled"),a=t.hasAttribute("selected"),r={value:t.value||t.textContent.trim(),label:t.textContent.trim(),disabled:i,selected:a};e.push(r),r.selected&&(this.state.value=r.value),t.style.display="none"}),e.length>0&&(this.setOptions(e),this._updateDisplay())}_handleInput(e){const t=e.target.value;this.state.src&&t.length>=this.state.min?(this._cancelPendingRequest(),this._searchTimeout=setTimeout(()=>{this._fetchOptions(t).catch(this._handleFetchError.bind(this))},this.state.debounce)):this._filterLocal(t)}_handleKeydown(e){if(!this.state.open)return void("ArrowDown"!==e.key&&"Enter"!==e.key||(e.preventDefault(),this.open()));const t=this.state.filtered.length-1;switch(e.key){case"ArrowDown":e.preventDefault(),this.state.highlightedIndex=Math.min(t,this.state.highlightedIndex+1),this._renderOptions();break;case"ArrowUp":e.preventDefault(),this.state.highlightedIndex=Math.max(0,this.state.highlightedIndex-1),this._renderOptions();break;case"Enter":if(e.preventDefault(),this.state.highlightedIndex>=0&&this.state.highlightedIndex<this.state.filtered.length){const e=this.state.filtered[this.state.highlightedIndex];e&&!e.disabled&&this.select(e.value)}break;case"Escape":e.preventDefault(),this.close()}}_cancelPendingRequest(){this._abortController&&(this._abortController.abort(),this._abortController=null),this._searchTimeout&&(clearTimeout(this._searchTimeout),this._searchTimeout=null)}async _fetchOptions(e){this.state.loading=!0}_handleFetchError(e){this.state.error=e.message,this._announce(`Error: ${e.message}`)}_filterLocal(e){const t=e.trim().toLowerCase();this.state.filtered=this.state.options.filter(e=>e.label.toLowerCase().includes(t)),this.state.highlightedIndex=this.state.filtered.length>0?0:-1,this._renderOptions()}_updateDisplay(){if(this.state.value){const e=this.state.options.find(e=>e.value===this.state.value);this._els.input.value=e?e.label:""}else this._els.input.value="",this._els.input.placeholder=this.state.placeholder}_updateValue(e){this.state.value=e,this._updateDisplay()}_updatePlaceholder(){this._els.input.placeholder=this.state.placeholder}_updateDisabledState(e){this.state.disabled=e,this._els.input.disabled=e}_updateRequiredState(e){this.state.required=e,this._els.input.required=e}open(){this.state.open||this.state.disabled||(this.state.open=!0,this.state.highlightedIndex=0,this._els.control.setAttribute("aria-expanded","true"),this._els.menu.hidden=!1,this._renderOptions(),this.tm.enter(this._els.menu),this.dispatchEvent(new CustomEvent("p-select:open",{bubbles:!0})))}close(){this.state.open&&(this.state.open=!1,this._els.control.setAttribute("aria-expanded","false"),this.tm.exit(this._els.menu).then(()=>{this._els.menu.hidden=!0}),this.dispatchEvent(new CustomEvent("p-select:close",{bubbles:!0})))}toggle(){this.state.open?this.close():this.open()}select(e){const t=this.state.options.find(t=>t.value==e);t&&!t.disabled&&(this.state.value=t.value,this._setFormValue(t.value,t.label),this._els.input.value=t.label,this.dispatchEvent(new CustomEvent("p-select:change",{detail:{value:t.value,label:t.label},bubbles:!0})),this.close())}setOptions(e){this.state.options=Array.isArray(e)?e.slice():[],this.state.filtered=this.state.options.slice(),this._renderOptions()}getValue(){return this.state.value}clear(){this.state.value="",this._setFormValue("",""),this._els.input.value="",this._els.input.placeholder=this.state.placeholder}get value(){return this.state.value}set value(e){this._updateValue(e)}refreshOptions(){this._parseOptionsFromDOM()}debug(){return{options:this.state.options,filtered:this.state.filtered,value:this.state.value,domOptions:this.querySelectorAll("option").length}}_setFormValue(e,t){if(this._internals?.setFormValue){const s=new FormData;this.name&&s.set(this.name,e),this._internals.setFormValue(s,t)}}_renderOptions(){const e=this._els.menu;e.innerHTML="";const t=this.state.filtered;if(0===t.length){const t=document.createElement("div");return t.className="noresults",t.textContent="No results found",void e.appendChild(t)}t.forEach((t,s)=>{const i=document.createElement("div");i.className="option",i.setAttribute("role","option"),i.setAttribute("aria-selected",String(t.value===this.state.value)),i.textContent=t.label,t.disabled&&i.setAttribute("aria-disabled","true"),s===this.state.highlightedIndex&&i.setAttribute("aria-current","true"),t.disabled||i.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.select(t.value)}),e.appendChild(i)})}}customElements.get("p-select")||customElements.define("p-select",t);export{t as default};
