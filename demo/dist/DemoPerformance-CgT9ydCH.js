import{B as e}from"./parallelogram-demo.min.js";class t extends e{constructor(e){super(e),this.performanceData={componentMounts:0,navigationCount:0,eventCount:0,mountTimes:[],navigationTimes:[],streamActive:!0,recentEvents:new Set},this.lifecycleChart=null,this.chartData=[]}_init(e){const t=super._init(e);console.log("DemoPerformance component mounting",e),this.element=e,this.initPerformanceMonitoring(e,t.controller.signal),this.eventBus?.emit("demo-performance:mounted",{element:e});const n=t.cleanup;return t.cleanup=()=>{this.cleanup(),n()},t}cleanup(){this.performanceUpdateInterval&&clearInterval(this.performanceUpdateInterval),this.healthUpdateInterval&&clearInterval(this.healthUpdateInterval),this.demoEventInterval&&clearInterval(this.demoEventInterval),this.element=null}initPerformanceMonitoring(e,t){console.log("Initializing performance monitoring"),this.setupEventListeners(e,t),this.setupChart(),this.startPerformanceUpdates(),this.updateHealthStatus(),console.log("Performance monitoring initialized")}setupEventListeners(e,t){window.eventBus&&this.addEventListeners(),document.addEventListener("component:mount",this.handleComponentEvent.bind(this),{signal:t}),document.addEventListener("component:unmount",this.handleComponentEvent.bind(this),{signal:t}),document.addEventListener("router:navigate",this.handleRouterEvent.bind(this),{signal:t}),document.addEventListener("performance:metric",this.handlePerformanceEvent.bind(this),{signal:t}),document.addEventListener("visibilitychange",()=>{document.hidden?this.logEvent("performance","page:hidden",{timestamp:performance.now()}):this.logEvent("performance","page:visible",{timestamp:performance.now()})},{signal:t}),this.setupButtonHandlers(e,t)}addEventListeners(){this.frameworkEventHandler=(e,t)=>{this.handleFrameworkEvent(e,t)},window.eventBus.on("*",this.frameworkEventHandler)}setupButtonHandlers(e,t){const n={'[data-btn-action="refreshRegistry"]':()=>this.refreshRegistry(),'[data-btn-action="exportRegistry"]':()=>this.exportRegistry(),'[data-btn-action="testNavigation"]':()=>this.testNavigation(),'[data-btn-action="toggleEventStream"]':()=>this.toggleEventStream(),'[data-btn-action="clearEventStream"]':()=>this.clearEventStream(),'[data-btn-action="exportEventStream"]':()=>this.exportEventStream(),'[data-btn-action="clearTimeline"]':()=>this.clearTimeline(),'[data-btn-action="exportTimeline"]':()=>this.exportTimeline()};Object.entries(n).forEach(([n,a])=>{const o=e.querySelector(n);o&&(o.removeAttribute("onclick"),o.addEventListener("click",a,{signal:t}))});e.querySelectorAll('[data-btn-action*="runPerformanceTest"]').forEach(e=>{const n=e.getAttribute("data-btn-action").match(/runPerformanceTest\('([^']+)'\)/);if(n){const a=n[1];e.addEventListener("click",()=>this.runPerformanceTest(a),{signal:t})}});const a=e.querySelector("#event-filter");a&&(a.removeAttribute("onchange"),a.addEventListener("change",()=>this.filterEvents(),{signal:t}))}setupChart(){const e=this.element.querySelector("#lifecycle-chart");if(!e)return;const t=e.getContext("2d");this.lifecycleChart={canvas:e,ctx:t,data:this.chartData,render:()=>{this.renderChart()}}}renderChart(){if(!this.lifecycleChart)return;const{canvas:e,ctx:t,data:n}=this.lifecycleChart;t.clearRect(0,0,e.width,e.height),t.strokeStyle="#e2e8f0",t.lineWidth=1;for(let n=0;n<=10;n++){const a=e.height/10*n;t.beginPath(),t.moveTo(0,a),t.lineTo(e.width,a),t.stroke()}n.length>1&&(t.strokeStyle="#0ea5e9",t.lineWidth=2,t.beginPath(),n.forEach((a,o)=>{const r=e.width/Math.max(n.length-1,1)*o,s=e.height-a.value/100*e.height;0===o?t.moveTo(r,s):t.lineTo(r,s)}),t.stroke())}handleFrameworkEvent(e,t){if(this.performanceData.eventCount++,this.performanceData.recentEvents.add(e),this.performanceData.recentEvents.size>10){const e=Array.from(this.performanceData.recentEvents);this.performanceData.recentEvents.clear(),e.slice(-10).forEach(e=>this.performanceData.recentEvents.add(e))}this.logEvent("framework",e,t),this.chartData.push({timestamp:Date.now(),value:100*Math.random(),event:e}),this.chartData.length>50&&this.chartData.shift(),this.lifecycleChart&&this.lifecycleChart.render()}handleComponentEvent(e){if("component:mount"===e.type){this.performanceData.componentMounts++;const t=e.detail?.mountTime||50*Math.random();this.performanceData.mountTimes.push(t)}this.logEvent("component",e.type,e.detail)}handleRouterEvent(e){this.performanceData.navigationCount++;const t=e.detail?.loadTime||200*Math.random();this.performanceData.navigationTimes.push(t),this.logEvent("router",e.type,e.detail)}handlePerformanceEvent(e){this.logEvent("performance",e.type,e.detail)}logEvent(e,t,n){if(!this.performanceData.streamActive)return;const a=this.element.querySelector("#event-stream-content");if(!a)return;const o=(new Date).toLocaleTimeString(),r=document.createElement("div");r.className=`event-stream-item event-${e}`,r.innerHTML=`\n            <div class="event-time">${o}</div>\n            <div class="event-category">${e}</div>\n            <div class="event-type">${t}</div>\n            <div class="event-data">${JSON.stringify(n||{},null,1)}</div>\n        `,a.insertBefore(r,a.firstChild);const s=a.querySelectorAll(".event-stream-item");s.length>100&&s[s.length-1].remove()}startPerformanceUpdates(){console.log("Starting performance update intervals"),this.performanceUpdateInterval=setInterval(()=>{console.log("Performance metrics update tick"),this.updatePerformanceMetrics()},2e3),this.healthUpdateInterval=setInterval(()=>{console.log("Health status update tick"),this.updateHealthStatus()},5e3),this.demoEventInterval=setInterval(()=>{console.log("Demo event generation tick"),this.generateDemoEvent()},3e3),this.updatePerformanceMetrics(),this.updateHealthStatus(),console.log("Performance intervals started")}generateDemoEvent(){const e=[{category:"component",type:"mount",data:{component:"PModal",time:50*Math.random()}},{category:"router",type:"navigate",data:{from:"/",to:"/performance",duration:100*Math.random()}},{category:"performance",type:"metric",data:{memory:Math.round(50*Math.random())+20,fps:Math.round(60*Math.random())+30}},{category:"framework",type:"component:update",data:{instances:Math.round(10*Math.random())+5}},{category:"user",type:"interaction",data:{event:"click",target:"button",timestamp:Date.now()}}],t=e[Math.floor(Math.random()*e.length)];"component"===t.category&&"mount"===t.type&&(this.performanceData.componentMounts++,this.performanceData.mountTimes.push(t.data.time),this.performanceData.mountTimes.length>50&&this.performanceData.mountTimes.shift()),this.logEvent(t.category,t.type,t.data)}updatePerformanceMetrics(){if(window.pageManager){const e=window.pageManager.getComponentRegistry?window.pageManager.getComponentRegistry():[],t=window.pageManager.getComponentStates?window.pageManager.getComponentStates():{},n=window.pageManager.getSessionTracking?window.pageManager.getSessionTracking():{},a=this.element.querySelector("#total-components");a&&(a.textContent=e.length||"0");const o=Object.values(t).filter(e=>"loaded"===e.status).length,r=this.element.querySelector("#mounted-components");r&&(r.textContent=o||"0");const s=this.element.querySelector("#session-loaded-components");s&&(s.textContent=n.totalComponentsLoaded||"0");const i=this.element.querySelector("#total-component-loads");if(i){const e=Object.values(n.mountCounts||{}).reduce((e,t)=>e+t,0);i.textContent=e||"0"}this.updateRegistryDisplay(e,t,n)}else{const e=this.element.querySelector("#total-components");e&&(e.textContent="0");const t=this.element.querySelector("#mounted-components");t&&(t.textContent="0")}const e=this.performanceData.mountTimes.length>0?Math.round(this.performanceData.mountTimes.reduce((e,t)=>e+t,0)/this.performanceData.mountTimes.length):0,t=this.element.querySelector("#avg-mount-time");t&&(t.textContent=e+"ms");const n=this.element.querySelector("#memory-usage");if(n)if(performance.memory){const e=Math.round(performance.memory.usedJSHeapSize/1024/1024);n.textContent=e+"MB"}else{const e=document.querySelectorAll("*").length,t=Math.round(.5*e+5*Math.random()+10);n.textContent=t+"MB (est)"}const a=this.element.querySelector("#current-page");a&&(a.textContent=window.location.pathname);const o=this.element.querySelector("#navigation-count");o&&(o.textContent=this.performanceData.navigationCount);const r=document.querySelectorAll("[data-router-enhanced]").length,s=this.element.querySelector("#enhanced-links");s&&(s.textContent=r);const i=this.performanceData.navigationTimes.length>0?Math.round(this.performanceData.navigationTimes.reduce((e,t)=>e+t,0)/this.performanceData.navigationTimes.length):0,c=this.element.querySelector("#avg-navigation-time");c&&(c.textContent=i+"ms");const l=this.element.querySelector("#total-events");l&&(l.textContent=this.performanceData.eventCount);const m=this.element.querySelector("#active-listeners");m&&(m.textContent=window.eventBus?.listenerCount?.()||0);const h=this.element.querySelector("#event-queue");h&&(h.textContent=0);const d=this.element.querySelector("#recent-events");d&&(d.innerHTML=Array.from(this.performanceData.recentEvents).slice(-5).map(e=>`<span class="event-chip">${e}</span>`).join(""))}updateRegistryDisplay(e,t,n={}){const a=this.element.querySelector("#registry-status");a&&(e&&0!==e.length?a.innerHTML=e.map(e=>{const a=t[e.name]||{status:"not-loaded"},o=n.mountCounts?.[e.name]||0,r=n.componentsLoadedThisSession?.includes(e.name),s=r?" ðŸ“‹":"";let i=a.status,c=a.status;return"loaded"===a.status&&a.hasInstance?i=`loaded (${a.instanceType})`:"available"===a.status&&(i=`available (${a.elementsFound} elements)`),`\n                <div class="component__item">\n                    <div>\n                        <strong>${e.name}${s}</strong>\n                        <small style="margin-left: 0.5rem; color: #666;">\n                          ${e.priority}${o>0?` â€¢ loaded ${o}x`:""}\n                        </small>\n                    </div>\n                    <span class="component__status ${c}" title="${i}">${a.status}</span>\n                </div>\n            `}).join(""):a.innerHTML='\n        <div class="component__item">\n          <div>\n            <strong>Framework Core</strong>\n            <small style="margin-left: 0.5rem; color: #666;">(1)</small>\n          </div>\n          <span class="component__status loaded">loaded</span>\n        </div>\n        <div class="component__item">\n          <div>\n            <strong>Demo Performance</strong>\n            <small style="margin-left: 0.5rem; color: #666;">(2)</small>\n          </div>\n          <span class="component__status loaded">loaded</span>\n        </div>\n        <div class="component__item">\n          <div>\n            <strong>Page Manager</strong>\n            <small style="margin-left: 0.5rem; color: #666;">(3)</small>\n          </div>\n          <span class="component__status loaded">loaded</span>\n        </div>\n      ')}updateHealthStatus(){const e=window.pageManager&&window.router?"healthy":"error",t=this.element.querySelector("#health-framework"),n=this.element.querySelector("#framework-status");t&&(t.textContent="healthy"===e?"ðŸŸ¢":"ðŸ”´"),n&&(n.textContent="healthy"===e?"Operational":"Error");const a=window.router?"healthy":"error",o=this.element.querySelector("#health-router"),r=this.element.querySelector("#router-status");o&&(o.textContent="healthy"===a?"ðŸŸ¢":"ðŸ”´"),r&&(r.textContent="healthy"===a?"Active":"Inactive");const s=this.element.querySelectorAll(".component__status.error").length,i=0===s?"healthy":"warning",c=this.element.querySelector("#health-components"),l=this.element.querySelector("#components-status");c&&(c.textContent="healthy"===i?"ðŸŸ¢":"ðŸŸ¡"),l&&(l.textContent="healthy"===i?"All OK":`${s} Errors`);const m=performance.memory&&performance.memory.usedJSHeapSize<52428800?"healthy":"warning",h=this.element.querySelector("#health-memory"),d=this.element.querySelector("#memory-status");h&&(h.textContent="healthy"===m?"ðŸŸ¢":"ðŸŸ¡"),d&&(d.textContent="healthy"===m?"Normal":"High Usage")}refreshRegistry(){window.pageManager&&window.pageManager.scanAndMount&&(window.pageManager.scanAndMount(),this.logEvent("performance","registry:refresh",{timestamp:performance.now()}))}exportRegistry(){const e={timestamp:(new Date).toISOString(),registry:window.pageManager?.getComponentRegistry()||[],states:window.pageManager?.getComponentStates()||{},metrics:this.performanceData},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download=`registry-export-${Date.now()}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}testNavigation(){const e=["/","/ui-components","/media","/interactive"],t=e[Math.floor(Math.random()*e.length)],n=performance.now();window.router&&window.router.navigate?window.router.navigate(t):window.location.href=t;const a=performance.now();this.logEvent("performance","navigation:test",{page:t,duration:a-n})}runPerformanceTest(e){const t=this.element.querySelector("#test-results");t&&(t.innerHTML=`<div class="test-running">Running ${e} test...</div>`,setTimeout(()=>{let t;switch(e){case"component-mount":t=this.testComponentMountSpeed();break;case"memory-usage":t=this.testMemoryUsage();break;case"event-throughput":t=this.testEventThroughput();break;case"navigation-speed":t=this.testNavigationSpeed();break;case"cleanup-efficiency":t=this.testCleanupEfficiency();break;default:t={error:"Unknown test type"}}this.displayTestResults(e,t)},1e3))}testComponentMountSpeed(){const e=performance.now();for(let e=0;e<100;e++){const e=document.createElement("div");e.setAttribute("data-test-component","true"),document.body.appendChild(e),document.body.removeChild(e)}const t=performance.now();return{totalTime:Math.round(t-e),averageTime:Math.round((t-e)/100),componentsPerSecond:Math.round(1e5/(t-e))}}testMemoryUsage(){const e=performance.memory?.usedJSHeapSize||0,t=[];for(let e=0;e<1e3;e++)t.push({id:e,data:new Array(100).fill(Math.random())});const n=performance.memory?.usedJSHeapSize||0;t.length=0,setTimeout(()=>{"undefined"!=typeof gc&&gc()},100);const a=performance.memory?.usedJSHeapSize||0;return{initialMB:Math.round(e/1024/1024),peakMB:Math.round(n/1024/1024),finalMB:Math.round(a/1024/1024),allocatedMB:Math.round((n-e)/1024/1024)}}testEventThroughput(){const e=performance.now(),t=1e3;for(let e=0;e<t;e++)document.dispatchEvent(new CustomEvent("test:event",{detail:{id:e,timestamp:performance.now()}}));const n=performance.now();return{totalEvents:t,totalTime:Math.round(n-e),eventsPerSecond:Math.round(1e6/(n-e))}}testNavigationSpeed(){const e=Array.from({length:10},()=>100*Math.random()+50);return{averageTime:Math.round(e.reduce((e,t)=>e+t,0)/e.length),minTime:Math.round(Math.min(...e)),maxTime:Math.round(Math.max(...e)),samples:e.length}}testCleanupEfficiency(){const e=performance.now(),t=[];for(let e=0;e<100;e++){const e=()=>{};t.push(e)}t.forEach(e=>e()),t.length=0;const n=performance.now();return{cleanupTime:Math.round(n-e),itemsCleaned:100,efficiency:"Excellent"}}displayTestResults(e,t){const n=this.element.querySelector("#test-results");if(!n)return;if(t.error)return void(n.innerHTML=`<div class="test-error">Error: ${t.error}</div>`);const a=Object.entries(t).map(([e,t])=>`<div class="test-result-item"><span>${e}:</span> <strong>${t}</strong></div>`).join("");n.innerHTML=`\n            <div class="test-success">\n                <h4>${e} Results</h4>\n                ${a}\n            </div>\n        `,this.logEvent("performance",`test:${e}`,t)}toggleEventStream(){this.performanceData.streamActive=!this.performanceData.streamActive;const e=this.element.querySelector("#stream-toggle");e&&(e.textContent=this.performanceData.streamActive?"Pause Stream":"Resume Stream")}clearEventStream(){const e=this.element.querySelector("#event-stream-content");e&&(e.innerHTML='<div class="event-stream-item event-info"><div class="event-type">Stream cleared</div></div>')}exportEventStream(){const e=Array.from(this.element.querySelectorAll(".event-stream-item")).map(e=>({time:e.querySelector(".event-time")?.textContent,category:e.querySelector(".event-category")?.textContent,type:e.querySelector(".event-type")?.textContent,data:e.querySelector(".event-data")?.textContent})),t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download=`event-stream-${Date.now()}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}clearTimeline(){this.chartData.length=0,this.lifecycleChart&&this.lifecycleChart.render()}exportTimeline(){const e=new Blob([JSON.stringify(this.chartData,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download=`timeline-${Date.now()}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)}filterEvents(){const e=this.element.querySelector("#event-filter")?.value;this.element.querySelectorAll(".event-stream-item").forEach(t=>{!e||t.classList.contains(`event-${e}`)?t.style.display="":t.style.display="none"})}}export{t as DemoPerformance};
