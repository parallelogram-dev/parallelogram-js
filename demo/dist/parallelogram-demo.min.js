!function(){"use strict";class e{constructor(e={}){this.basePath=e.basePath||"../components/",this.defaultPriority=e.defaultPriority||"normal",this.fileExtension=e.fileExtension||".js",this.useMinified=e.useMinified||!1,this.registry=[]}component(e,t,n={}){if(!n.loader)throw new Error(`Component '${e}' must provide a loader function`);const a={name:e,selector:t,priority:n.priority||this.defaultPriority,dependsOn:n.dependsOn,loader:n.loader};return this.registry.push(a),this}toPascalCase(e){return e.split(/[-_\s]+/).map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join("")}build(){return[...this.registry]}clear(){return this.registry=[],this}getStats(){const e=this.registry.reduce((e,t)=>(e[t.priority]=(e[t.priority]||0)+1,e),{}),t=this.registry.filter(e=>e.dependsOn?.length>0).length;return{totalComponents:this.registry.length,priorities:e,withDependencies:t,basePath:this.basePath}}validate(){const e=new Set(this.registry.map(e=>e.name)),t=[],n=[];this.registry.forEach(n=>{n.dependsOn&&n.dependsOn.forEach(a=>{e.has(a)||t.push(`Component '${n.name}' depends on '${a}' which is not in the registry`)})});const a=this.detectCycles();a.length>0&&t.push(`Circular dependencies detected: ${a.join(", ")}`);const r=new Map;return this.registry.forEach(e=>{r.has(e.selector)?n.push(`Duplicate selector '${e.selector}' used by '${e.name}' and '${r.get(e.selector)}'`):r.set(e.selector,e.name)}),{valid:0===t.length,errors:t,warnings:n}}detectCycles(){const e=new Set,t=new Set,n=[],a=(r,s=[])=>{if(t.has(r)){const e=s.indexOf(r);return void n.push(s.slice(e).concat(r).join(" -> "))}if(e.has(r))return;e.add(r),t.add(r);const o=this.registry.find(e=>e.name===r);o?.dependsOn&&o.dependsOn.forEach(e=>{a(e,[...s,r])}),t.delete(r)};return this.registry.forEach(t=>{e.has(t.name)||a(t.name)}),n}fork(t={}){return new e({basePath:this.basePath,defaultPriority:this.defaultPriority,fileExtension:this.fileExtension,useMinified:this.useMinified,...t})}static create(t="dev",n={}){const a={...{dev:{basePath:"/dist/esm/components/",useMinified:!1,fileExtension:".js"},production:{basePath:"/dist/esm/components/",useMinified:!0,fileExtension:".js"},custom:{}}[t],...n};return new e(a)}}class t{constructor(){this.listeners=new Map}on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set);return this.listeners.get(e).add(t),()=>this.off(e,t)}once(e,t){const n=this.on(e,e=>{n(),t(e)});return n}off(e,t){const n=this.listeners.get(e);n&&(n.delete(t),0===n.size&&this.listeners.delete(e))}emit(e,t){const n=this.listeners.get(e);if(!n)return;const a=[...n];for(const n of a)try{n(t)}catch(t){console.error(`[EventManager] Error in listener for "${e}":`,t)}}clear(e){e?this.listeners.delete(e):this.listeners.clear()}}class n{constructor({eventBus:e,logger:t,options:n={}}){this.eventBus=e,this.logger=t,this.options={baseUrl:"",timeout:1e4,retryAttempts:0,fragmentSelector:"[data-router-fragment]",loadingClass:"router-loading",errorClass:"router-error",...n},this.controller=null,this.currentUrl=new URL(location.href),this.isNavigating=!1,this.boundPopState=this._onPopState.bind(this),this.boundLinkClick=this._onLinkClick.bind(this),this._initialize()}_initialize(){this.logger?.info("RouterManager initializing"),window.addEventListener("popstate",this.boundPopState),window.addEventListener("pageshow",e=>{e.persisted&&this.eventBus.emit("router:bfcache-restore",{url:this.currentUrl})}),window.addEventListener("pagehide",()=>{this.eventBus.emit("router:bfcache-store",{url:this.currentUrl})}),this._enhanceLinks(),this.eventBus.on("dom:content-loaded",()=>{this._enhanceLinks()}),this.eventBus.emit("router:initialized",{currentUrl:this.currentUrl})}_enhanceLinks(){document.querySelectorAll("a[href]:not([data-router-enhanced])").forEach(e=>{this._shouldEnhanceLink(e)&&(e.addEventListener("click",this.boundLinkClick),e.setAttribute("data-router-enhanced","true"),this.logger?.debug("Enhanced link",{href:e.href}))})}_shouldEnhanceLink(e){const t=e.getAttribute("href");if(!t||t.startsWith("mailto:")||t.startsWith("tel:")||t.startsWith("javascript:"))return!1;if(e.hasAttribute("data-router-skip"))return!1;try{if(new URL(t,location.href).origin!==location.origin&&!e.hasAttribute("data-router-enhance"))return!1}catch{return!1}return!0}_onLinkClick(e){if(e.ctrlKey||e.metaKey||e.shiftKey||e.altKey)return;if(2===e.which)return;const t=e.currentTarget,n=t.getAttribute("href"),a=t.getAttribute("data-view-target")||"main";try{const r=new URL(n,location.href);if(r.pathname===location.pathname&&r.hash)return;e.preventDefault(),this.navigate(r,{viewTarget:a,replace:t.hasAttribute("data-router-replace"),trigger:"link-click",element:t})}catch(e){this.logger?.error("Failed to parse link URL",{href:n,error:e})}}_onPopState(e){const t=new URL(location.href);this.currentUrl=t,this.eventBus.emit("router:popstate",{url:t,state:e.state,trigger:"popstate"})}async get(e,t={}){const n="string"==typeof e?e:e.toString();this.logger?.group(`RouterManager GET ${n}`),this._abortInFlight();const a=new AbortController;this.controller=a;const r=setTimeout(()=>{a.abort()},this.options.timeout);try{const e=await fetch(n,{method:"GET",signal:a.signal,credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"text/html,application/json,*/*",...t.headers},...t});if(clearTimeout(r),!e.ok)throw this._createHttpError(e);const s=e.headers.get("content-type")||"";let o;return o=s.includes("application/json")?await e.json():await e.text(),this.logger?.info("GET successful",{url:n,status:e.status,contentType:s}),{response:e,data:o}}catch(e){if(clearTimeout(r),"AbortError"===e.name)throw this.logger?.warn("GET aborted",{url:n}),e;throw this.logger?.error("GET failed",{url:n,error:e}),e}finally{this.logger?.groupEnd(),this.controller=null}}async navigate(e,t={}){const{replace:n=!1,trigger:a="programmatic",element:r=null,force:s=!1}=t,o="string"==typeof e?new URL(e,location.href):e,i=o.toString();if(s||i!==this.currentUrl.toString())if(this.isNavigating)this.logger?.warn("Navigation in progress, aborting new navigation",{url:i});else{this.isNavigating=!0,this.currentUrl=o,this.eventBus.emit("router:navigate-start",{url:o,trigger:a,element:r,replace:n}),r&&r.classList.add(this.options.loadingClass),document.body.classList.add(this.options.loadingClass);try{const{data:e}=await this.get(i);if("string"!=typeof e)throw new Error("Expected HTML string response for navigation");const s={timestamp:Date.now(),trigger:a};return n?history.replaceState(s,"",i):history.pushState(s,"",i),this.eventBus.emit("router:navigate-success",{url:o,html:e,trigger:a,element:r,replace:n,viewTarget:t.viewTarget}),this.logger?.info("Navigation successful",{url:i,trigger:a,replace:n}),e}catch(e){throw r&&r.classList.add(this.options.errorClass),document.body.classList.add(this.options.errorClass),this.eventBus.emit("router:navigate-error",{url:o,error:e,trigger:a,element:r}),this.logger?.error("Navigation failed",{url:i,error:e,trigger:a}),e}finally{r&&r.classList.remove(this.options.loadingClass,this.options.errorClass),document.body.classList.remove(this.options.loadingClass,this.options.errorClass),this.isNavigating=!1,this.eventBus.emit("router:navigate-end",{url:o,trigger:a})}}else this.logger?.debug("Navigation skipped - same URL",{url:i})}back(){this.logger?.info("Navigating back"),history.back()}forward(){this.logger?.info("Navigating forward"),history.forward()}getCurrentUrl(){return this.currentUrl}isNavigating(){return this.isNavigating}_abortInFlight(){this.controller&&(this.controller.abort(),this.controller=null)}_createHttpError(e){const t=new Error(`HTTP ${e.status} ${e.statusText}`);return t.name="HttpError",t.status=e.status,t.statusText=e.statusText,t.response=e,t.url=e.url,t}destroy(){this.logger?.info("RouterManager destroying"),window.removeEventListener("popstate",this.boundPopState),document.querySelectorAll("a[data-router-enhanced]").forEach(e=>{e.removeEventListener("click",this.boundLinkClick),e.removeAttribute("data-router-enhanced")}),this._abortInFlight(),this.eventBus.off("dom:content-loaded"),this.eventBus.emit("router:destroyed",{}),this.logger?.info("RouterManager destroyed")}}function a(e){return e.replace(/-([a-z])/g,e=>e[1].toUpperCase())}function r(e="elem"){return`${e}-${Date.now()}-${Math.random().toString(36).slice(2,9)}`}function s(e,t=300){let n;return function(...a){clearTimeout(n),n=setTimeout(()=>{clearTimeout(n),e.apply(this,a)},t)}}function o(e=document){return Array.from(e.querySelectorAll(["a[href]","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"]):not([disabled])'].join(",")))}function i(e,t){const n=o(e);if(!n.length)return;const a=n[0],r=n[n.length-1],s=e.contains(document.activeElement)?document.activeElement:null;!t.shiftKey||s!==a&&s?t.shiftKey||s!==r||(a.focus(),t.preventDefault()):(r.focus(),t.preventDefault())}function l(e,t={},n=""){const a=document.createElement(e);for(const[e,n]of Object.entries(t))"className"===e||"class"===e?a.className=n:"style"===e&&"object"==typeof n?Object.assign(a.style,n):"dataset"===e&&"object"==typeof n?Object.assign(a.dataset,n):a.setAttribute(e,n);return"string"==typeof n?a.textContent=n:n instanceof HTMLElement&&a.appendChild(n),a}let d=class{constructor({eventBus:e,logger:t,router:n}){this.eventBus=e,this.logger=t,this.router=n,this.elements=new WeakMap,this.states=this.elements,this._keys=null}mount(e){if(this.elements.has(e))return this.update(e);const t=this._init(e);this.elements.set(e,t)}update(e){}unmount(e){const t=this.elements.get(e);if(t)try{t.cleanup?.()}finally{this.elements.delete(e)}}destroy(){for(const e of this._elementsKeys())this.unmount(e)}_elementsKeys(){return this._keys||(this._keys=new Set),this._keys}_track(e){this._keys||(this._keys=new Set),this._keys.add(e)}_untrack(e){this._keys?.delete(e)}_init(e){const t=new AbortController;return this._track(e),{cleanup:()=>{t.abort(),this._untrack(e)},controller:t}}getState(e){return this.elements.get(e)}_getDataAttr(e,t,n){return function(e,t,n){const r=t.includes("-")?a(t):t,s=e.dataset[r];return void 0===s?n:"true"===s||"false"!==s&&(isNaN(s)||""===s?s:Number(s))}(e,t,n)}_camelCase(e){return a(e)}_debounce(e,t=300){return s(e,t)}_throttle(e,t=100){return function(e,t=100){let n;return function(...a){n||(e.apply(this,a),n=!0,setTimeout(()=>{n=!1},t))}}(e,t)}_delay(e){return function(e){return new Promise(t=>setTimeout(t,e))}(e)}_getTargetElement(e,t,n={}){const a=`${t}-view`,r=this._getDataAttr(e,a);if(r){const t=document.querySelector(`[data-view="${r}"]`);return!t&&n.required&&this.logger?.warn(`Target element with data-view="${r}" not found`,{viewName:r,element:e,attribute:a}),t}const s=this._getDataAttr(e,t);if(!s)return n.required&&this.logger?.warn(`No ${t} or ${a} attribute found`,e),null;const o=document.querySelector(s);return!o&&n.required&&this.logger?.warn("Target element not found",{selector:s,element:e}),o}_getConfigFromAttrs(e,t){const n={};for(const[a,r]of Object.entries(t)){const t=this.constructor.defaults?.[a];n[a]=this._getDataAttr(e,r,t)}return n}_requireState(e,t="method"){const n=this.getState(e);return n||this.logger?.warn(`${t}: No state found for element`,e),n}_generateId(e="elem"){return r(e)}async _waitForTransition(e,t=2e3){return async function(e,t=2e3){return new Promise(n=>{const a=()=>{e.removeEventListener("animationend",a),e.removeEventListener("transitionend",a),n()};e.addEventListener("animationend",a,{once:!0}),e.addEventListener("transitionend",a,{once:!0}),setTimeout(()=>{e.removeEventListener("animationend",a),e.removeEventListener("transitionend",a),n()},t)})}(e,t)}async _fadeIn(e,t=300){return async function(e,t=300){return e.style.opacity="0",e.style.transition=`opacity ${t}ms ease-in-out`,e.offsetHeight,e.style.opacity="1",new Promise(n=>{setTimeout(()=>{e.style.transition="",n()},t)})}(e,t)}async _fadeOut(e,t=300){return async function(e,t=300){return e.style.opacity="1",e.style.transition=`opacity ${t}ms ease-in-out`,e.offsetHeight,e.style.opacity="0",new Promise(n=>{setTimeout(()=>{e.style.transition="",n()},t)})}(e,t)}_getFocusableElements(e=document){return o(e)}_trapFocus(e,t){return i(e,t)}_restoreFocus(e){return function(e){e&&"function"==typeof e.focus&&requestAnimationFrame(()=>e.focus())}(e)}_createElement(e,t={},n=""){return l(e,t,n)}_dispatch(e,t,n){const a=new CustomEvent(t,{detail:n,bubbles:!0,cancelable:!0});return e.dispatchEvent(a),this.eventBus?.emit(t,{element:e,...n}),a}};class c extends d{constructor(e,t){super({eventBus:{on(){},emit(){}},logger:{info(){},error(){},enabled:!1},router:null}),this._onMount=e,this._onUnmount=t}mount(e){this._onMount(e)}unmount(e){this._onUnmount(e)}}class u{constructor({containerSelector:e,registry:t,eventBus:n,logger:a,router:r,options:s={}}){this.eventBus=n,this.logger=a,this.router=r,this.containerSelector=e,this.registry=t,this.options={mountDelay:1200,scrollRestoration:!0,scrollPosition:"top",scrollElement:null,lazyLoadThreshold:"100px",retryFailedLoads:!0,maxRetryAttempts:3,batchUpdates:!0,updateThrottleMs:16,trackPerformance:!1,targetGroups:{main:["main","menubar","breadcrumb"],panel:["panel"],sidebar:["sidebar","toolbar"],modal:["modal"]},...s},this.instances=new Map,this.observer=null,this.loadingPromises=new Map,this.retryCount=new Map,this.performanceMetrics={fragmentReplacements:0,componentMounts:0,componentUnmounts:0,totalMountTime:0,averageMountTime:0},this.sessionTracking={componentsLoaded:new Set,loadHistory:[],mountCount:new Map,lastMountTime:new Map},this.throttledUpdate=this._createThrottledFunction(this._processBatchedUpdates.bind(this),this.options.updateThrottleMs),this.pendingUpdates=[],this._initialize()}_initialize(){this.logger?.info("PageManager initializing",{containerSelector:this.containerSelector,registrySize:this.registry.length}),this.eventBus.on("router:navigate-success",({html:e,url:t,trigger:n,viewTarget:a,viewTargets:r})=>{const s=this._resolveTargetGroups(r||[a||"main"]);this.replaceFragments(e,{fromNavigation:!0,url:t,trigger:n,viewTargets:s,preserveScroll:"popstate"===n&&"preserve"===this.options.scrollPosition})}),this.eventBus.on("router:popstate",async({url:e})=>{try{this.logger?.info("Handling popstate navigation",{url:e.toString()});const{data:t}=await this.router.get(e.toString());if("string"==typeof t){const n=this._resolveTargetGroups(["main"]);this.replaceFragments(t,{fromPopstate:!0,url:e,viewTargets:n,preserveScroll:"preserve"===this.options.scrollPosition})}}catch(t){this.logger?.error("Popstate fetch failed",{url:e.toString(),error:t}),this.eventBus.emit("page:popstate-error",{url:e,error:t})}}),this.eventBus.on("component:lazy-load",({element:e,componentName:t})=>{this._handleLazyLoad(e,t)}),this._initialMount(),this.eventBus.emit("page-manager:initialized",{containerSelector:this.containerSelector,options:this.options})}get container(){const e=document.querySelector(this.containerSelector);if(!e){const e=new Error(`Container not found: ${this.containerSelector}`);throw this.logger?.error("Container element not found",{selector:this.containerSelector}),e}return e}_resolveTargetGroups(e){const t=new Set;for(const n of e)if(this.options.targetGroups[n]){for(const e of this.options.targetGroups[n])t.add(e);this.logger?.info(`Resolved target group '${n}' to:`,this.options.targetGroups[n])}else t.add(n),this.logger?.debug(`Using target '${n}' directly (no group defined)`);const n=Array.from(t);return this.logger?.info("Final resolved targets:",n),n}async replaceFragments(e,t={}){const{fromNavigation:n=!1,fromPopstate:a=!1,preserveScroll:r=!1,url:s=null,trigger:o="unknown",viewTargets:i=["main"]}=t,l=this.options.trackPerformance?performance.now():0;this.logger?.group("Multiple fragments replacement",{fromNavigation:n,fromPopstate:a,preserveScroll:r,url:s?.toString(),trigger:o,viewTargets:i});try{let n=null;r&&(n={x:window.scrollX,y:window.scrollY});const a=(new DOMParser).parseFromString(e,"text/html"),s=[];let o=!1;for(const n of i)try{const r=await this._processSingleFragment(a,n,e,t);s.push(r),"main"===n&&(o=!0)}catch(e){this.logger?.error(`Failed to replace fragment ${n}`,{error:e}),s.push({viewTarget:n,success:!1,error:e.message})}o&&(this._handleScrollRestoration(n,t),this._updateDocumentHead(e));const d=s.filter(e=>e.success);for(const e of d)this.mountAllWithin(e.targetFragment,{priority:"critical",fragmentTarget:e.viewTarget}),this.eventBus.emit("dom:content-loaded",{fragment:e.targetFragment,viewTarget:e.viewTarget,trigger:"fragment-replacement"}),this.options.mountDelay>0?setTimeout(()=>{this.mountAllWithin(e.targetFragment,{priority:"normal",fragmentTarget:e.viewTarget})},this.options.mountDelay):this.mountAllWithin(e.targetFragment,{priority:"normal",fragmentTarget:e.viewTarget});if(this.options.trackPerformance){const e=performance.now()-l;this.performanceMetrics.fragmentReplacements++,this.logger?.info("Multiple fragments replacement completed",{duration:`${e.toFixed(2)}ms`,targetsProcessed:i.length,successfulReplacements:d.length,metrics:this.performanceMetrics})}this.eventBus.emit("page:fragments-replaced",{results:s,viewTargets:i,duration:this.options.trackPerformance?performance.now()-l:null,options:t})}catch(n){throw this.logger?.error("Multiple fragments replacement failed",{error:n,viewTargets:i,html:e.slice(0,100)}),this.eventBus.emit("page:fragments-replace-error",{viewTargets:i,error:n,options:t}),n}finally{this.logger?.groupEnd()}}async _processSingleFragment(e,t,n,a){const{sourceFragment:r,targetFragment:s}=this._extractTargetFragmentFromDoc(e,t);if(!r)throw new Error(`Source fragment with data-view="${t}" not found in fetched HTML`);if(!s)throw new Error(`Target fragment with data-view="${t}" not found in current document`);const o=this.options.targetGroupTransitions?.[t];this.eventBus.emit("page:fragment-will-replace",{sourceFragment:r,targetFragment:s,viewTarget:t,html:n,options:a,transitionConfig:o});try{o?.out&&await this._performFragmentTransition(s,"out",o),this.unmountAllWithin(s),o?.in?await this._replaceContentWithTransition(s,r,o):(s.innerHTML=r.innerHTML,this._copyFragmentAttributes(r,s)),this.eventBus.emit("page:fragment-did-replace",{targetFragment:s,viewTarget:t,options:a,transitionConfig:o})}catch(e){this.logger?.error(`Fragment transition failed for ${t}`,{error:e,viewTarget:t,transitionConfig:o}),this.unmountAllWithin(s),s.innerHTML=r.innerHTML,this._copyFragmentAttributes(r,s)}return{viewTarget:t,success:!0,sourceFragment:r,targetFragment:s,transitionConfig:o}}async _replaceContentWithTransition(e,t,n){return new Promise(a=>{requestAnimationFrame(()=>{e.innerHTML=t.innerHTML,this._copyFragmentAttributes(t,e),this._performFragmentTransition(e,"in",n).then(a)})})}async _performFragmentTransition(e,t,n){const a=n[t],r=n.duration||300,s=n.easing||"ease";this.logger?.debug(`Performing ${t} transition: ${a}`,{fragment:e,duration:r,easing:s});try{if("string"!=typeof a||a.includes("("))await this._performJSTransition(e,t,n);else{const s="in"===t?n.out:null;await this._performCSSTransition(e,a,r,t,s)}this.eventBus.emit(`page:fragment-transition-${t}`,{fragment:e,viewTarget:e.dataset.view,transitionType:a,duration:r})}catch(n){throw this.logger?.warn("Fragment transition failed",{fragment:e,direction:t,transitionType:a,error:n}),n}}_performCSSTransition(e,t,n,a="in",r=null){return new Promise(n=>{const s=r=>{r&&r.target!==e||(e.removeEventListener("animationend",s),e.removeEventListener("transitionend",s),"in"===a&&e.classList.remove(t),n())};e.addEventListener("animationend",s),e.addEventListener("transitionend",s),requestAnimationFrame(()=>{e.classList.add(t),"in"===a&&r&&e.classList.remove(r)})})}async _performJSTransition(e,t,n){const a=n.duration||300,r=n.easing||"ease";e.style.transition=`opacity ${a}ms ${r}, transform ${a}ms ${r}`,"out"===t?(e.style.opacity="0",e.style.transform="translateX(-20px)"):(e.style.opacity="0",e.style.transform="translateX(20px)",e.getBoundingClientRect(),e.style.opacity="1",e.style.transform="translateX(0)"),await new Promise(n=>{setTimeout(()=>{e.style.transition="","in"===t&&(e.style.opacity="",e.style.transform=""),n()},a)})}_extractTargetFragmentFromDoc(e,t){let n=null,a=null;return n=e.querySelector(`[data-view="${t}"]`),n||(this.logger?.warn(`Fragment data-view="${t}" not found, trying fallbacks`),n=e.querySelector(`#${t}`),n||"main"!==t||(n=e.querySelector("main")||e.querySelector('[role="main"]')||e.querySelector("#app")||e.querySelector(".main-content")),n||(n=e.querySelector(`.${t}`))),a=document.querySelector(`[data-view="${t}"]`),a||(this.logger?.warn(`Target fragment data-view="${t}" not found in current document, trying fallbacks`),a=document.querySelector(`#${t}`),a||"main"!==t||(a=document.querySelector("main")||document.querySelector('[role="main"]')||document.querySelector("#app")||document.querySelector(".main-content")),a||(a=document.querySelector(`.${t}`))),this.logger?.info("Fragment extraction result",{viewTarget:t,sourceFound:!!n,targetFound:!!a,sourceSelector:n?.tagName+(n?.className?"."+n.className:""),targetSelector:a?.tagName+(a?.className?"."+a.className:"")}),{sourceFragment:n,targetFragment:a}}replaceFragment(e,t={}){const{fromNavigation:n=!1,fromPopstate:a=!1,preserveScroll:r=!1,url:s=null,trigger:o="unknown",viewTarget:i="main"}=t;return this.replaceFragments(e,{fromNavigation:n,fromPopstate:a,preserveScroll:r,url:s,trigger:o,viewTargets:[i]})}_updateDocumentHead(e){try{const t=new DOMParser,n=t.parseFromString(e,"text/html").querySelector("head");if(!n)return void this.logger?.warn("No head element found in source HTML");this.logger?.group("Updating document head metadata");const a=["title",'meta[name="description"]','meta[name="keywords"]','meta[name="robots"]','meta[name="author"]','meta[property^="og:"]','meta[name^="twitter:"]','meta[property^="article:"]','link[rel="canonical"]','link[rel="alternate"]','meta[name="theme-color"]'];let r=0;for(const e of a){const t=n.querySelectorAll(e);if(0!==t.length){if("title"===e){const e=t[0];e&&e.textContent.trim()&&(document.title=e.textContent.trim(),r++,this.logger?.info("Updated document title",{newTitle:document.title}));continue}if('link[rel="canonical"]'===e){document.querySelectorAll('link[rel="canonical"]').forEach(e=>e.remove());const e=t[0];if(e&&e.href){const t=document.createElement("link");t.rel="canonical",t.href=e.href,document.head.appendChild(t),r++,this.logger?.info("Updated canonical URL",{canonicalUrl:e.href})}continue}for(const e of t)"meta"===e.tagName.toLowerCase()?(this._updateMetaTag(e),r++):"link"===e.tagName.toLowerCase()&&(this._updateLinkTag(e),r++)}}this.eventBus.emit("page:head-updated",{updatedElements:r,newTitle:document.title}),this.logger?.info(`Updated ${r} head elements`)}catch(e){this.logger?.error("Failed to update document head",{error:e}),this.eventBus.emit("page:head-update-error",{error:e})}finally{this.logger?.groupEnd()}}_updateMetaTag(e){const t=e.getAttribute("name"),n=e.getAttribute("property"),a=e.getAttribute("content");if(!a)return;let r;if(t)r=`meta[name="${t}"]`;else{if(!n)return;r=`meta[property="${n}"]`}document.querySelectorAll(r).forEach(e=>e.remove());const s=document.createElement("meta");t&&s.setAttribute("name",t),n&&s.setAttribute("property",n),s.setAttribute("content",a),["charset","http-equiv","scheme"].forEach(t=>{e.hasAttribute(t)&&s.setAttribute(t,e.getAttribute(t))}),document.head.appendChild(s),this.logger?.debug("Updated meta tag",{selector:r,content:a.substring(0,100)+(a.length>100?"...":"")})}_updateLinkTag(e){const t=e.getAttribute("rel"),n=e.getAttribute("href");if(!t||!n)return;if(["stylesheet","icon","manifest","preload","prefetch"].includes(t))return void this.logger?.debug("Skipping critical link tag",{rel:t,href:n});const a=`link[rel="${t}"]`,r=e.getAttribute("hreflang"),s=r?`link[rel="${t}"][hreflang="${r}"]`:a;document.querySelectorAll(s).forEach(e=>e.remove());const o=document.createElement("link");o.setAttribute("rel",t),o.setAttribute("href",n),["hreflang","type","media","sizes"].forEach(t=>{e.hasAttribute(t)&&o.setAttribute(t,e.getAttribute(t))}),document.head.appendChild(o),this.logger?.debug("Updated link tag",{rel:t,href:n})}_copyFragmentAttributes(e,t){if(["data-state","data-loading","data-error","data-version","aria-live","aria-label","aria-describedby"].forEach(n=>{e.hasAttribute(n)?t.setAttribute(n,e.getAttribute(n)):t.removeAttribute(n)}),e.className){const n=Array.from(t.classList).filter(e=>e.startsWith("component-")||e.startsWith("router-")||e.startsWith("page-"));t.className=e.className,n.forEach(e=>t.classList.add(e))}}_handleScrollRestoration(e,t){if(t.preserveScroll&&e)window.scrollTo(e.x,e.y);else switch(this.options.scrollPosition){case"top":window.scrollTo(0,0);break;case"element":if(this.options.scrollElement){const e=document.querySelector(this.options.scrollElement);e&&e.scrollIntoView({behavior:"smooth"})}}}_startObserver(e){"MutationObserver"in window?(this.observer=new MutationObserver(e=>{this.options.batchUpdates?(this.pendingUpdates.push(...e),this.throttledUpdate()):this._processMutations(e)}),this.observer.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["data-component","data-lazy-component"]}),this.logger?.info("DOM observer started",{root:this.containerSelector})):this.logger?.warn("MutationObserver not available, falling back to manual updates")}_processBatchedUpdates(){if(0===this.pendingUpdates.length)return;const e=[...this.pendingUpdates];this.pendingUpdates=[],this._processMutations(e)}_processMutations(e){const t=new Set,n=new Set;for(const a of e){if(a.addedNodes)for(const e of a.addedNodes)e.nodeType===Node.ELEMENT_NODE&&(t.add(e),e.querySelectorAll("[data-component], [data-lazy-component]").forEach(e=>t.add(e)));if(a.removedNodes)for(const e of a.removedNodes)e.nodeType===Node.ELEMENT_NODE&&n.add(e)}t.size>0&&this.mountAllWithin(this.container,{addedNodes:Array.from(t),trigger:"mutation"}),n.size>0&&this.unmountRemoved(Array.from(n))}mountAllWithin(e,t={}){const{addedNodes:n=null,priority:a="normal",trigger:r="initial",fragmentTarget:s=null}=t,o=this.options.trackPerformance?performance.now():0;this.logger?.group("Mounting components",{priority:a,trigger:r,fragmentTarget:s,addedNodesCount:n?.length||0,rootSelector:e.tagName+(e.id?"#"+e.id:"")+(e.className?"."+e.className.split(" ")[0]:"")});try{const t=this.registry.filter(e=>"critical"===a?"critical"===e.priority||!0===e.critical:"normal"!==a||"critical"!==e.priority);for(const a of t)try{this._mountComponentConfig(a,e,n,s)}catch(e){this.logger?.error(`Failed to mount component ${a.name}`,{error:e,config:a}),this.eventBus.emit("page:component-mount-error",{componentName:a.name,error:e,config:a,fragmentTarget:s})}if(this.options.trackPerformance){const e=performance.now()-o;this.performanceMetrics.totalMountTime+=e,this.performanceMetrics.averageMountTime=this.performanceMetrics.totalMountTime/Math.max(1,this.performanceMetrics.fragmentReplacements)}}finally{this.logger?.groupEnd()}}_mountComponentConfig(e,t,n,a){const r=(n||[t]).flatMap(t=>{const n=[];return t.matches&&t.matches(e.selector)&&n.push(t),n.push(...t.querySelectorAll(e.selector)),n});if(0===r.length)return;const s=this._ensureInstance(e);let o=0;for(const t of r)try{if(t.hasAttribute("data-component-mounted"))continue;s.mount(t),t.setAttribute("data-component-mounted",e.name),a&&t.setAttribute("data-fragment-target",a),o++,this.eventBus.emit("page:component-mounted",{componentName:e.name,element:t,instance:s,fragmentTarget:a})}catch(n){this.logger?.error(`Failed to mount ${e.name} on element`,{error:n,element:t})}o>0&&(this.performanceMetrics.componentMounts+=o,this.logger?.info(`Mounted ${o} instances of ${e.name}`,{fragmentTarget:a}))}unmountAllWithin(e){this.logger?.group("Unmounting components within root");try{let t=0;for(const[n,a]of this.instances)if(a._elementsKeys)for(const r of a._elementsKeys())if(e.contains(r))try{a.unmount(r),r.removeAttribute("data-component-mounted"),r.removeAttribute("data-fragment-target"),t++,this.eventBus.emit("page:component-unmounted",{componentName:n,element:r,instance:a})}catch(e){this.logger?.error(`Failed to unmount ${n}`,{error:e,element:r})}this.performanceMetrics.componentUnmounts+=t,t>0&&this.logger?.info(`Unmounted ${t} component instances`)}finally{this.logger?.groupEnd()}}unmountRemoved(e){let t=0;for(const[e,n]of this.instances)if(n._elementsKeys)for(const a of n._elementsKeys())if(!document.documentElement.contains(a))try{n.unmount(a),t++,this.eventBus.emit("page:component-unmounted",{componentName:e,element:a,instance:n,reason:"removed"})}catch(t){this.logger?.error(`Failed to unmount removed ${e}`,{error:t,element:a})}t>0&&this.logger?.info(`Unmounted ${t} components from removed nodes`)}_ensureInstance(e){const t=this.instances.get(e.name);if(t)return t;if(e.dependsOn?.length)for(const t of e.dependsOn){const n=this.registry.find(e=>e.name===t);n?this._ensureInstance(n):this.logger?.warn(`Dependency not found: ${t} for ${e.name}`)}const n=e.loader();if(!(n instanceof Promise)){const t=this._createInstance(n.default,e);return this.instances.set(e.name,t),this._trackComponentLoad(e.name),t}return this._handleAsyncLoading(e,n)}_handleAsyncLoading(e,t){const n=[],a=new c(e=>n.push(["mount",e]),e=>n.push(["unmount",e]));return this.instances.set(e.name,a),this.loadingPromises.set(e.name,t),t.then(t=>{const a=this._createInstance(t.default,e);for(const[t,r]of n)try{a[t](r),"mount"===t&&(r.setAttribute("data-component-mounted",e.name),r.classList.remove("component-loading"),r.removeAttribute("data-component-state"))}catch(n){this.logger?.error(`Dequeued ${e.name}.${t} failed`,{error:n,element:r}),"mount"===t&&(r.classList.remove("component-loading"),r.classList.add("component-error"),r.setAttribute("data-component-state","error"))}this.instances.set(e.name,a),this._trackComponentLoad(e.name),this.loadingPromises.delete(e.name),this.retryCount.delete(e.name),this.eventBus.emit("page:component-loaded",{componentName:e.name,instance:a,queueSize:n.length}),this.logger?.info(`Component ${e.name} loaded successfully`,{queuedOperations:n.length})}).catch(t=>{this.logger?.error(`Failed to load component ${e.name}`,{error:t});for(const[e,t]of n)"mount"===e&&(t.classList.remove("component-loading"),t.classList.add("component-error"),t.setAttribute("data-component-state","error"));if(this.options.retryFailedLoads){const t=this.retryCount.get(e.name)||0;if(t<this.options.maxRetryAttempts)return this.retryCount.set(e.name,t+1),this.logger?.info(`Retrying component load: ${e.name} (attempt ${t+1})`),void setTimeout(()=>{this._handleAsyncLoading(e,e.loader())},1e3*Math.pow(2,t))}this.instances.delete(e.name),this.loadingPromises.delete(e.name),this.eventBus.emit("page:component-load-error",{componentName:e.name,error:t,retries:this.retryCount.get(e.name)||0})}),a}_createInstance(e,t){let n;if("function"==typeof e)n=e;else if(e&&"function"==typeof e.default)n=e.default;else if(e&&"function"==typeof e[t.name])n=e[t.name];else{if(n=Object.values(e||{}).find(e=>"function"==typeof e),!n)throw new Error(`No valid constructor found in module for component ${t.name}. Available exports: ${Object.keys(e||{}).join(", ")}`)}this.logger?.info(`Creating instance of ${t.name}`,{ComponentClass:n.name,config:t});try{const e=new n({eventBus:this.eventBus,logger:this.logger,router:this.router,config:t});return this.logger?.info(`Created ${t.name} with DI pattern`,{config:t}),e}catch(e){this.logger?.warn(`DI constructor failed for ${t.name}, trying fallback patterns`,{error:e});try{const e=new n;return this.logger?.info(`Created ${t.name} with no-args constructor`,{config:t}),"function"==typeof e.setEventBus&&e.setEventBus(this.eventBus),"function"==typeof e.setLogger&&e.setLogger(this.logger),"function"==typeof e.setRouter&&e.setRouter(this.router),e}catch(a){throw this.logger?.error(`All constructor patterns failed for ${t.name}`,{originalError:e,fallbackError:a,ComponentClass:n.name}),new Error(`Cannot instantiate component ${t.name}: ${e.message}`)}}}_handleLazyLoad(e,t){const n=this.registry.find(e=>e.name===t);if(!n)return void this.logger?.warn(`Lazy load requested for unknown component: ${t}`);this.logger?.info(`Lazy loading component: ${t}`,{element:e});this._ensureInstance(n).mount(e)}_initialMount(){try{const e=this.container;this.mountAllWithin(e,{trigger:"initial"}),this._startObserver(e)}catch(e){this.logger?.error("Initial component mounting failed",{error:e})}}_createThrottledFunction(e,t){let n=null,a=0;return function(...r){const s=Date.now();s-a>t?(e.apply(this,r),a=s):(clearTimeout(n),n=setTimeout(()=>{e.apply(this,r),a=Date.now()},t-(s-a)))}}getPerformanceMetrics(){return{...this.performanceMetrics}}getInstances(){return new Map(this.instances)}getLoadingStatus(){return{loading:Array.from(this.loadingPromises.keys()),retries:Object.fromEntries(this.retryCount)}}getComponentRegistry(){return this.registry||[]}getComponentStates(){const e={},t=this.getLoadingStatus();return this.registry.forEach(n=>{const a=this.instances.get(n.name),r=t.loading.includes(n.name);t.retries[n.name];const s=document.querySelectorAll(n.selector).length;let o="not-loaded";r?o="loading":a?o="loaded":s>0&&(o="available"),e[n.name]={status:o,hasInstance:!!a,instanceType:a?a.constructor.name:null,elementsFound:s,isLoading:r,retryCount:t.retries[n.name]||0,selector:n.selector}}),e}getMetrics(){return{componentMounts:this.performanceMetrics?.componentMounts||0,componentUnmounts:this.performanceMetrics?.componentUnmounts||0,averageMountTime:this.performanceMetrics?.averageMountTime||0,fragmentReplacements:this.performanceMetrics?.fragmentReplacements||0,totalMountTime:this.performanceMetrics?.totalMountTime||0}}_trackComponentLoad(e){const t=Date.now();this.sessionTracking.componentsLoaded.add(e),this.sessionTracking.loadHistory.push({component:e,timestamp:t,page:window.location.pathname});const n=this.sessionTracking.mountCount.get(e)||0;this.sessionTracking.mountCount.set(e,n+1),this.sessionTracking.lastMountTime.set(e,t),this.sessionTracking.loadHistory.length>100&&this.sessionTracking.loadHistory.shift()}getSessionTracking(){return{totalComponentsLoaded:this.sessionTracking.componentsLoaded.size,componentsLoadedThisSession:Array.from(this.sessionTracking.componentsLoaded),loadHistory:[...this.sessionTracking.loadHistory],mountCounts:Object.fromEntries(this.sessionTracking.mountCount),lastMountTimes:Object.fromEntries(this.sessionTracking.lastMountTime)}}destroy(){if(this.logger?.info("PageManager destroying"),this.observer&&(this.observer.disconnect(),this.observer=null),this._lazyObserver&&(this._lazyObserver.disconnect(),this._lazyObserver=null),this._cleanupInterval&&(clearInterval(this._cleanupInterval),this._cleanupInterval=null),this.unmountAllWithin(this.container),this._componentPool){for(const[e,t]of this._componentPool)for(const n of t)if("function"==typeof n.destroy)try{n.destroy()}catch(t){this.logger?.warn(`Error destroying pooled instance of ${e}`,{error:t})}this._componentPool.clear()}this.instances.clear(),this.loadingPromises.clear(),this.retryCount.clear(),this._mountedElements&&this._mountedElements.clear(),this._errorCounts&&this._errorCounts.clear(),this._circuitBreakers&&this._circuitBreakers.clear(),this.eventBus.off("router:navigate-success"),this.eventBus.off("router:popstate"),this.eventBus.off("component:lazy-load"),this.eventBus.emit("page-manager:destroyed",{}),this.logger?.info("PageManager destroyed")}}class h{constructor(e,t=!1){this.namespace=e,this.enabled=t}setEnabled(e){this.enabled=Boolean(e)}_getPrefix(e){return`${(new Date).toISOString()} [${this.namespace}] ${e}:`}debug(...e){this.enabled&&console.debug(this._getPrefix("DEBUG"),...e)}log(...e){this.enabled&&console.log(this._getPrefix("LOG"),...e)}info(...e){this.enabled&&console.info(this._getPrefix("INFO"),...e)}warn(...e){this.enabled&&console.warn(this._getPrefix("WARN"),...e)}error(...e){console.error(this._getPrefix("ERROR"),...e)}child(e){return new h(`${this.namespace}:${e}`,this.enabled)}group(e,t){this.enabled&&console.groupCollapsed&&(console.groupCollapsed(`[${this.namespace}] ${e}`),t&&"object"==typeof t&&console.log("Details:",t))}groupEnd(){this.enabled&&console.groupEnd&&console.groupEnd()}}class g extends HTMLElement{static get observedAttributes(){return["open","data-modal-size","data-modal-closable"]}constructor(){super();const e=this.attachShadow({mode:"open"});e.innerHTML='\n      <style>\n        :host {\n          --modal-backdrop-bg: rgba(0, 0, 0, 0.45);\n          --modal-panel-bg: #0f172a;\n          --modal-panel-color: #e5e7eb;\n          --modal-panel-border: rgba(255, 255, 255, 0.08);\n          --modal-panel-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);\n          --modal-panel-radius: 16px;\n          --modal-header-bg: #0f172a;\n          --modal-footer-bg: #0f172a;\n          --modal-close-hover-bg: rgba(255, 255, 255, 0.1);\n          --modal-animation-duration: 0.2s;\n          --modal-animation-easing: ease-out;\n        }\n\n        /* Host states */\n        :host {\n          display: none;\n        }\n\n        :host([open]) {\n          display: block;\n          position: fixed;\n          inset: 0;\n          z-index: 9999;\n          animation: modal-fade-in var(--modal-animation-duration) var(--modal-animation-easing);\n        }\n\n        /* Block: Modal backdrop */\n        .modal__backdrop {\n          position: absolute;\n          inset: 0;\n          background: var(--modal-backdrop-bg);\n          animation: modal-backdrop-in var(--modal-animation-duration) var(--modal-animation-easing);\n        }\n\n        /* Block: Modal panel */\n        .modal__panel {\n          position: absolute;\n          top: 50%;\n          left: 50%;\n          transform: translate(-50%, -50%);\n          min-width: min(92vw, 640px);\n          max-width: 92vw;\n          max-height: 86vh;\n          overflow: auto;\n          background: var(--modal-panel-bg);\n          color: var(--modal-panel-color);\n          border: 1px solid var(--modal-panel-border);\n          border-radius: var(--modal-panel-radius);\n          box-shadow: var(--modal-panel-shadow);\n          animation: modal-panel-in var(--modal-animation-duration) var(--modal-animation-easing);\n        }\n\n        /* Panel size modifiers */\n        :host([data-modal-size="sm"]) .modal__panel {\n          min-width: min(92vw, 400px);\n        }\n\n        :host([data-modal-size="lg"]) .modal__panel {\n          min-width: min(92vw, 800px);\n        }\n\n        :host([data-modal-size="xs"]) .modal__panel {\n          min-width: min(92vw, 300px);\n        }\n\n        :host([data-modal-size="xl"]) .modal__panel {\n          min-width: min(92vw, 1000px);\n        }\n\n        :host([data-modal-size="fullscreen"]) .modal__panel {\n          width: 100vw;\n          height: 100vh;\n          max-width: 100vw;\n          max-height: 100vh;\n          border-radius: 0;\n          transform: none;\n          top: 0;\n          left: 0;\n        }\n\n        /* Element: Modal header */\n        .modal__header {\n          display: flex;\n          align-items: center;\n          gap: 8px;\n          padding: 12px 14px;\n          border-bottom: 1px solid var(--modal-panel-border);\n          position: sticky;\n          top: 0;\n          background: var(--modal-header-bg);\n          z-index: 1;\n        }\n\n        .modal__header h2 {\n          margin: 0;\n          font-size: 18px;\n          line-height: 1.3;\n          font-weight: 600;\n        }\n\n        /* Element: Header spacer */\n        .modal__spacer {\n          flex: 1;\n        }\n\n        /* Element: Close button */\n        .modal__close {\n          all: unset;\n          display: inline-flex;\n          align-items: center;\n          justify-content: center;\n          width: 28px;\n          height: 28px;\n          border-radius: 8px;\n          cursor: pointer;\n          font-size: 16px;\n          font-weight: bold;\n          transition: background-color var(--modal-animation-duration) ease;\n        }\n\n        .modal__close:hover {\n          background: var(--modal-close-hover-bg);\n        }\n\n        .modal__close:focus-visible {\n          outline: 2px solid currentColor;\n          outline-offset: 2px;\n        }\n\n        /* Element: Modal content */\n        .modal__content {\n          padding: 14px;\n        }\n\n        /* Element: Modal footer */\n        .modal__footer {\n          padding: 12px 14px;\n          border-top: 1px solid var(--modal-panel-border);\n          display: flex;\n          gap: 8px;\n          justify-content: flex-end;\n          position: sticky;\n          bottom: 0;\n          background: var(--modal-footer-bg);\n          z-index: 1;\n        }\n\n        /* Slotted button styles (BEM classes) */\n        ::slotted(.btn) {\n          appearance: none;\n          border: 0;\n          border-radius: 10px;\n          padding: 10px 14px;\n          background: #1f2937;\n          color: #fff;\n          cursor: pointer;\n          font-size: 14px;\n          font-weight: 500;\n          min-height: 3.125rem;\n          transition: all var(--modal-animation-duration) ease;\n        }\n\n        ::slotted(.btn:hover) {\n          background: #374151;\n        }\n\n        ::slotted(.btn--primary) {\n          background: #60a5fa;\n          color: #0b1020;\n          font-weight: 700;\n        }\n\n        ::slotted(.btn--primary:hover) {\n          background: #3b82f6;\n        }\n\n        ::slotted(.btn--danger) {\n          background: #dc2626;\n          color: white;\n        }\n\n        ::slotted(.btn--danger:hover) {\n          background: #b91c1c;\n        }\n\n        ::slotted(.btn:disabled) {\n          opacity: 0.5;\n          cursor: not-allowed;\n        }\n\n        /* Animations */\n        @keyframes modal-fade-in {\n          from { opacity: 0; }\n          to { opacity: 1; }\n        }\n\n        @keyframes modal-backdrop-in {\n          from { opacity: 0; }\n          to { opacity: 1; }\n        }\n\n        @keyframes modal-panel-in {\n          from { \n            opacity: 0;\n            transform: translate(-50%, -50%) scale(0.95);\n          }\n          to { \n            opacity: 1;\n            transform: translate(-50%, -50%) scale(1);\n          }\n        }\n\n        /* Reduced motion support */\n        @media (prefers-reduced-motion: reduce) {\n          :host([open]),\n          .modal__backdrop,\n          .modal__panel,\n          .modal__close,\n          ::slotted(.btn) {\n            animation: none;\n            transition: none;\n          }\n        }\n\n        /* Dark mode adjustments */\n        @media (prefers-color-scheme: light) {\n          :host {\n            --modal-panel-bg: white;\n            --modal-panel-color: #1f2937;\n            --modal-panel-border: rgba(0, 0, 0, 0.1);\n            --modal-header-bg: white;\n            --modal-footer-bg: white;\n            --modal-close-hover-bg: rgba(0, 0, 0, 0.1);\n          }\n\n          ::slotted(.btn) {\n            background: #f3f4f6;\n            color: #1f2937;\n          }\n\n          ::slotted(.btn:hover) {\n            background: #e5e7eb;\n          }\n        }\n      </style>\n      \n      <div class="modal__backdrop" part="backdrop"></div>\n      <div class="modal__panel" part="panel" role="dialog" aria-modal="true">\n        <header class="modal__header" part="header">\n          <slot name="title"><h2>Dialog</h2></slot>\n          <div class="modal__spacer"></div>\n          <button class="modal__close" aria-label="Close" part="close">×</button>\n        </header>\n        <section class="modal__content" part="content">\n          <slot></slot>\n        </section>\n        <footer class="modal__footer" part="footer">\n          <slot name="actions"></slot>\n        </footer>\n      </div>\n    ',this._elements={backdrop:e.querySelector(".modal__backdrop"),panel:e.querySelector(".modal__panel"),close:e.querySelector(".modal__close")},this._onKeydown=this._onKeydown.bind(this),this._onFocus=this._onFocus.bind(this)}connectedCallback(){this._upgradeProperty("open"),this._elements.backdrop.addEventListener("click",()=>{this._isBackdropClosable()&&this.close()}),this._elements.close.addEventListener("click",()=>{this._isClosable()&&this.close()}),document.addEventListener("keydown",this._onKeydown),this.addEventListener("focusin",this._onFocus),this.addEventListener("click",e=>{e.target.hasAttribute("data-modal-close")&&this._isClosable()&&this.close()}),this._elements.panel.setAttribute("aria-labelledby",this._getTitleId())}disconnectedCallback(){document.removeEventListener("keydown",this._onKeydown),this.removeEventListener("focusin",this._onFocus)}attributeChangedCallback(e,t,n){"open"===e&&(this.hasAttribute("open")?this._onOpen():this._onClose())}open(){this.setAttribute("open","")}close(){this.removeAttribute("open")}toggle(e){!0===e?this.open():!1===e||this.hasAttribute("open")?this.close():this.open()}_isClosable(){return"false"!==this.getAttribute("data-modal-closable")}_isBackdropClosable(){return this._isClosable()&&"false"!==this.getAttribute("data-modal-backdrop-close")}_isKeyboardEnabled(){return"false"!==this.getAttribute("data-modal-keyboard")}_onOpen(){this.dispatchEvent(new CustomEvent("modal:open",{bubbles:!0,detail:{modal:this}})),requestAnimationFrame(()=>{(this._getFirstFocusable()||this._elements.close).focus({preventScroll:!0})}),document.body.style.overflow="hidden"}_onClose(){this.dispatchEvent(new CustomEvent("modal:close",{bubbles:!0,detail:{modal:this}})),document.body.style.overflow=""}_onKeydown(e){this.hasAttribute("open")&&this._isKeyboardEnabled()&&("Escape"===e.key&&this._isClosable()&&(e.preventDefault(),this.close()),"Tab"===e.key&&this._trapTab(e))}_onFocus(){if(!this.contains(document.activeElement)){(this._getFirstFocusable()||this._elements.close).focus({preventScroll:!0})}}_getFocusableElements(){return o(this)}_getFirstFocusable(){return this._getFocusableElements()[0]||null}_trapTab(e){i(this,e)}_getTitleId(){const e=this.querySelector('[slot="title"]');return e&&e.id?e.id:"modal-title"}_upgradeProperty(e){if(this.hasOwnProperty(e)){const t=this[e];delete this[e],this[e]=t}}}customElements.get("p-modal")||customElements.define("p-modal",g);class m extends HTMLElement{constructor(){super();const e=this.attachShadow({mode:"open"});e.innerHTML='\n      <style>  \n        :host {\n          position: fixed;\n          inset: auto auto auto 0;\n          padding: 12px;\n          z-index: 2147483647;\n          display: grid;\n          gap: 8px;\n          pointer-events: none;\n        }\n        \n        :host([placement="top-left"]) { top: 0; left: 0; }\n        :host([placement="top-right"]) { top: 0; right: 0; left: auto; }\n        :host([placement="bottom-right"]) { bottom: 0; right: 0; left: auto; }\n        :host([placement="bottom-left"]) { bottom: 0; left: 0; }\n        \n        .toast {\n          padding: 10px 12px;\n          border-radius: 8px;\n          color: #fff;\n          box-shadow: 0 6px 20px rgba(0,0,0,.25);\n          opacity: 0;\n          transform: translateY(-6px);\n          animation: toast-in 0.18s ease-out forwards;\n          cursor: pointer;\n          font: 14px/1.4 system-ui, -apple-system, sans-serif;\n          outline: none;\n          pointer-events: auto;\n          min-width: 300px;\n        }\n        \n        .toast.info { background: #111827; }\n        .toast.success { background: #065f46; }\n        .toast.warning { background: #7c2d12; }\n        .toast.error { background: #7f1d1d; }\n        \n        @keyframes toast-in { \n          to { opacity: 1; transform: none; } \n        }\n        \n        .row {\n          display: flex;\n          align-items: center;\n          gap: 8px;\n        }\n        \n        .msg {\n          white-space: pre-wrap;\n          flex: 1;\n        }\n        \n        .btn.close {\n          all: unset;\n          display: inline-flex;\n          align-items: center;\n          justify-content: center;\n          width: 24px;\n          height: 24px;\n          min-height: 24px;\n          border-radius: 6px;\n          font-weight: 700;\n          background: rgba(255,255,255,0.1);\n          cursor: pointer;\n        }\n        \n        .btn.close:hover {\n          background: rgba(255,255,255,0.2);\n        }\n      </style>  \n      <div id="container" role="region" aria-live="polite"></div>\n    ',this._container=e.getElementById("container"),this._idCounter=0,this._toasts=new Map}toast({message:e,type:t="info",timeout:n=4e3,allowHTML:a=!1}){const r=++this._idCounter,s=document.createElement("div");s.className=`toast ${t}`,s.setAttribute("role","warn"===t||"error"===t?"alert":"status");const o=document.createElement("div");o.className="row";const i=document.createElement("span");i.className="msg",a?i.innerHTML=e:i.textContent=e;const l=document.createElement("button");l.className="btn close",l.setAttribute("aria-label","Dismiss notification"),l.textContent="×",o.appendChild(i),o.appendChild(l),s.appendChild(o),this._container.appendChild(s);let d=!1;const c=()=>{d||(d=!0,s.style.animation="toast-out 0.15s ease-in forwards",setTimeout(()=>s.remove(),150),this._toasts.delete(r),this.dispatchEvent(new CustomEvent("toast:close",{detail:{id:r,type:t,message:e},bubbles:!0})))};return l.addEventListener("click",c),n>0&&setTimeout(c,n),this._toasts.set(r,{element:s,type:t,dismiss:c}),this.dispatchEvent(new CustomEvent("toast:show",{detail:{id:r,type:t,message:e},bubbles:!0})),c}}customElements.get("p-toasts")||customElements.define("p-toasts",m);class p{constructor({root:e=document,defaultY:t="1rem",defaultDur:n=320,defaultEase:a="cubic-bezier(0.22,1,0.36,1)"}={}){this.root=e,this.defaults={y:t,dur:n,ease:a}}async enter(e){const t=e.dataset.transitionEnterClass;return t?this._animateWithClass(e,t):this._animateWithJS(e,!0)}async exit(e){const t=e.dataset.transitionExitClass;return t?this._animateWithClass(e,t):this._animateWithJS(e,!1)}_animateWithClass(e,t){return new Promise(n=>{const a=()=>{e.removeEventListener("animationend",a),n()};e.addEventListener("animationend",a,{once:!0}),e.classList.add(t)})}_animateWithJS(e,t){const n=e.dataset.transitionY||this.defaults.y,a=Number(e.dataset.transitionDuration||this.defaults.dur),r=e.dataset.transitionEase||this.defaults.ease;return e.style.transition=`opacity ${a}ms ${r}, transform ${a}ms ${r}`,t?(e.style.opacity=0,e.style.transform=`translateY(${n})`,e.getBoundingClientRect(),e.style.opacity=1,e.style.transform="translateY(0)"):(e.style.opacity=1,e.style.transform="translateY(0)",e.getBoundingClientRect(),e.style.opacity=0,e.style.transform=`translateY(${n})`),new Promise(t=>setTimeout(()=>{e.style.transition="",t()},a))}async swap(e,t){const n=e.firstElementChild;n&&await this.exit(n),e.innerHTML="",t&&e.appendChild(t),t&&await this.enter(t)}}class f extends HTMLElement{static formAssociated=!0;constructor(){if(super(),!this.attachInternals)throw new Error("PSelect requires form-associated custom elements support");this._internals=this.attachInternals(),this.attachShadow({mode:"open"}),this.tm=new p,this.state={options:[],filtered:[],value:"",open:!1,highlightedIndex:-1,src:null,debounce:200,min:0,openOnFocus:!0,placeholder:this.getAttribute("placeholder")||"Select…",disabled:!1,required:!1,loading:!1,error:null},this._abortController=null,this._searchTimeout=null,this._announcementRegion=null,this._render(),this._setupEventListeners(),this._initializeFromAttributes()}connectedCallback(){this._createAnnouncementRegion(),this._parseOptionsFromDOM(),this.state.src&&0===this.state.min&&this._fetchOptions("").catch(this._handleFetchError.bind(this))}disconnectedCallback(){this._cancelPendingRequest(),this._searchTimeout&&clearTimeout(this._searchTimeout),this._announcementRegion&&this._announcementRegion.remove()}static get observedAttributes(){return["value","placeholder","disabled","name","required"]}attributeChangedCallback(e,t,n){if(t!==n)switch(e){case"value":this._updateValue(n);break;case"placeholder":this.state.placeholder=n||"Select…",this._updatePlaceholder();break;case"disabled":this._updateDisabledState(null!==n);break;case"name":this.name=n||"";break;case"required":this._updateRequiredState(null!==n)}}_render(){this.shadowRoot.innerHTML='\n      <style>\n        :host {\n          display: inline-block;\n          position: relative;\n          box-sizing: border-box;\n        }\n\n        /* CSS custom properties with fallbacks to parent/theme colors */\n        :host {\n          --select-border-color: var(--border-color, var(--color-border, #e2e8f0));\n          --select-focus-color: var(--accent-color, var(--color-primary, #3b82f6));\n          --select-bg: var(--background-color, var(--color-surface, #fff));\n          --select-text: var(--text-color, var(--color-text, currentColor));\n          --select-placeholder: var(--text-muted, var(--color-text-secondary, #64748b));\n          --select-hover-bg: var(--hover-bg, var(--color-surface-hover, rgba(0,0,0,0.05)));\n          --select-selected-bg: var(--selected-bg, var(--color-surface-active, rgba(59, 130, 246, 0.1)));\n          --select-current-bg: var(--current-bg, var(--color-surface-focus, rgba(0,0,0,0.1)));\n          --select-padding: 0.45rem 0.6rem;\n          --select-border-radius: 6px;\n          --select-border: 1px solid var(--select-border-color);\n          --select-focus-shadow: 0 0 0 3px var(--focus-shadow-color, rgba(59, 130, 246, 0.1));\n        }\n\n        /* Dark mode adjustments */\n        @media (prefers-color-scheme: dark) {\n          :host {\n            --select-border-color: var(--border-color, var(--color-border, #374151));\n            --select-bg: var(--background-color, var(--color-surface, #1f2937));\n            --select-text: var(--text-color, var(--color-text, #f9fafb));\n            --select-placeholder: var(--text-muted, var(--color-text-secondary, #9ca3af));\n            --select-hover-bg: var(--hover-bg, var(--color-surface-hover, rgba(255,255,255,0.1)));\n            --select-selected-bg: var(--selected-bg, var(--color-surface-active, rgba(59, 130, 246, 0.2)));\n            --select-current-bg: var(--current-bg, var(--color-surface-focus, rgba(255,255,255,0.1)));\n          }\n        }\n\n        .root {\n          position: absolute;\n          top: 0;\n          left: 0;\n          width: 100%;\n          height: 100%;\n          box-sizing: border-box;\n          background: inherit;\n          color: inherit;\n          font-family: inherit;\n          font-size: inherit;\n          border: inherit;\n          border-radius: inherit;\n          padding: inherit;\n        }\n\n        .control {\n          position: absolute;\n          top: 0;\n          left: 0;\n          right: 0;\n          bottom: 0;\n          display: flex;\n          align-items: center;\n          gap: 0.4rem;\n          cursor: pointer;\n          transition: border-color 0.2s ease, box-shadow 0.2s ease;\n          box-sizing: border-box;\n          padding: inherit;\n        }\n\n        .input {\n          border: 0;\n          outline: 0;\n          flex: 1;\n          min-width: 2ch;\n          background: transparent;\n          color: inherit;\n          font: inherit;\n          padding: 0;\n        }\n\n        .input::placeholder {\n          color: inherit;\n          opacity: 0.6;\n        }\n\n        .arrow {\n          pointer-events: none;\n          transition: transform 0.15s ease;\n          user-select: none;\n          flex-shrink: 0;\n          margin-left: auto;\n        }\n\n        .control[aria-expanded="true"] .arrow {\n          transform: rotate(180deg);\n        }\n\n        .menu {\n          position: absolute;\n          z-index: 10;\n          left: 0;\n          right: 0;\n          top: 100%;\n          margin-top: 0.25rem;\n          background: var(--select-bg);\n          color: var(--select-text);\n          border: 1px solid var(--select-border-color);\n          border-radius: 10px;\n          max-height: 240px;\n          overflow: auto;\n          box-shadow: 0 10px 30px var(--shadow-color, rgba(0, 0, 0, 0.08));\n        }\n\n        .option {\n          padding: 0.45rem 0.6rem;\n          cursor: pointer;\n          transition: background-color 0.15s ease;\n        }\n\n        .option:hover {\n          background: var(--select-hover-bg);\n        }\n\n        .option[aria-selected="true"] {\n          background: var(--select-selected-bg);\n          font-weight: 500;\n        }\n\n        .option[aria-current="true"] {\n          background: var(--select-current-bg);\n        }\n\n        .option[aria-disabled="true"] {\n          opacity: 0.5;\n          cursor: not-allowed;\n          background: transparent !important;\n        }\n\n        .noresults {\n          padding: 0.6rem;\n          font-style: italic;\n          text-align: center;\n          opacity: 0.6;\n        }\n      </style>\n      \n      <div class="root">\n        <div \n          class="control" \n          role="combobox" \n          aria-expanded="false" \n          aria-haspopup="listbox"\n        >\n          <input \n            class="input" \n            type="text" \n            autocomplete="off"\n          />\n          <span class="arrow" aria-hidden="true">▾</span>\n        </div>\n        \n        <div class="menu" role="listbox" hidden></div>\n      </div>\n    ',this._els={control:this.shadowRoot.querySelector(".control"),input:this.shadowRoot.querySelector(".input"),menu:this.shadowRoot.querySelector(".menu"),arrow:this.shadowRoot.querySelector(".arrow")},this._updateDisplay()}_setupEventListeners(){this._els.control.addEventListener("mousedown",e=>{e.target!==this._els.input&&(e.preventDefault(),this._els.input.focus(),this.toggle())}),this._els.input.addEventListener("focus",()=>{this.state.openOnFocus&&this.open()}),this._els.input.addEventListener("input",e=>{this._handleInput(e)}),this._els.input.addEventListener("keydown",e=>{this._handleKeydown(e)}),document.addEventListener("click",e=>{this.contains(e.target)||this.shadowRoot.contains(e.target)||this.close()})}_initializeFromAttributes(){const e=this.dataset;this.state.src=e.selectSrc||null,this.state.debounce=Number(e.selectDebounce||200),this.state.min=Number(e.selectMin||0),this.state.openOnFocus="false"!==(e.selectOpenOnFocus??"true"),this.state.disabled=this.hasAttribute("disabled"),this.state.required=this.hasAttribute("required"),this.name=this.getAttribute("name")||""}_createAnnouncementRegion(){this._announcementRegion=document.createElement("div"),this._announcementRegion.setAttribute("aria-live","polite"),this._announcementRegion.style.cssText="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0)",document.body.appendChild(this._announcementRegion)}_announce(e){this._announcementRegion&&(this._announcementRegion.textContent=e)}_parseOptionsFromDOM(){const e=[];this.querySelectorAll("option").forEach((t,n)=>{const a=t.hasAttribute("disabled"),r=t.hasAttribute("selected"),s={value:t.value||t.textContent.trim(),label:t.textContent.trim(),disabled:a,selected:r};e.push(s),s.selected&&(this.state.value=s.value),t.style.display="none"}),e.length>0&&(this.setOptions(e),this._updateDisplay())}_handleInput(e){const t=e.target.value;this.state.src&&t.length>=this.state.min?(this._cancelPendingRequest(),this._searchTimeout=setTimeout(()=>{this._fetchOptions(t).catch(this._handleFetchError.bind(this))},this.state.debounce)):this._filterLocal(t)}_handleKeydown(e){if(!this.state.open)return void("ArrowDown"!==e.key&&"Enter"!==e.key||(e.preventDefault(),this.open()));const t=this.state.filtered.length-1;switch(e.key){case"ArrowDown":e.preventDefault(),this.state.highlightedIndex=Math.min(t,this.state.highlightedIndex+1),this._renderOptions();break;case"ArrowUp":e.preventDefault(),this.state.highlightedIndex=Math.max(0,this.state.highlightedIndex-1),this._renderOptions();break;case"Enter":if(e.preventDefault(),this.state.highlightedIndex>=0&&this.state.highlightedIndex<this.state.filtered.length){const e=this.state.filtered[this.state.highlightedIndex];e&&!e.disabled&&this.select(e.value)}break;case"Escape":e.preventDefault(),this.close()}}_cancelPendingRequest(){this._abortController&&(this._abortController.abort(),this._abortController=null),this._searchTimeout&&(clearTimeout(this._searchTimeout),this._searchTimeout=null)}async _fetchOptions(e){this.state.loading=!0}_handleFetchError(e){this.state.error=e.message,this._announce(`Error: ${e.message}`)}_filterLocal(e){const t=e.trim().toLowerCase();this.state.filtered=this.state.options.filter(e=>e.label.toLowerCase().includes(t)),this.state.highlightedIndex=this.state.filtered.length>0?0:-1,this._renderOptions()}_updateDisplay(){if(this.state.value){const e=this.state.options.find(e=>e.value===this.state.value);this._els.input.value=e?e.label:""}else this._els.input.value="",this._els.input.placeholder=this.state.placeholder}_updateValue(e){this.state.value=e,this._updateDisplay()}_updatePlaceholder(){this._els.input.placeholder=this.state.placeholder}_updateDisabledState(e){this.state.disabled=e,this._els.input.disabled=e}_updateRequiredState(e){this.state.required=e,this._els.input.required=e}open(){this.state.open||this.state.disabled||(this.state.open=!0,this.state.highlightedIndex=0,this._els.control.setAttribute("aria-expanded","true"),this._els.menu.hidden=!1,this._renderOptions(),this.tm.enter(this._els.menu),this.dispatchEvent(new CustomEvent("p-select:open",{bubbles:!0})))}close(){this.state.open&&(this.state.open=!1,this._els.control.setAttribute("aria-expanded","false"),this.tm.exit(this._els.menu).then(()=>{this._els.menu.hidden=!0}),this.dispatchEvent(new CustomEvent("p-select:close",{bubbles:!0})))}toggle(){this.state.open?this.close():this.open()}select(e){const t=this.state.options.find(t=>t.value==e);t&&!t.disabled&&(this.state.value=t.value,this._setFormValue(t.value,t.label),this._els.input.value=t.label,this.dispatchEvent(new CustomEvent("p-select:change",{detail:{value:t.value,label:t.label},bubbles:!0})),this.close())}setOptions(e){this.state.options=Array.isArray(e)?e.slice():[],this.state.filtered=this.state.options.slice(),this._renderOptions()}getValue(){return this.state.value}clear(){this.state.value="",this._setFormValue("",""),this._els.input.value="",this._els.input.placeholder=this.state.placeholder}get value(){return this.state.value}set value(e){this._updateValue(e)}refreshOptions(){this._parseOptionsFromDOM()}debug(){return{options:this.state.options,filtered:this.state.filtered,value:this.state.value,domOptions:this.querySelectorAll("option").length}}_setFormValue(e,t){if(this._internals?.setFormValue){const n=new FormData;this.name&&n.set(this.name,e),this._internals.setFormValue(n,t)}}_renderOptions(){const e=this._els.menu;e.innerHTML="";const t=this.state.filtered;if(0===t.length){const t=document.createElement("div");return t.className="noresults",t.textContent="No results found",void e.appendChild(t)}t.forEach((t,n)=>{const a=document.createElement("div");a.className="option",a.setAttribute("role","option"),a.setAttribute("aria-selected",String(t.value===this.state.value)),a.textContent=t.label,t.disabled&&a.setAttribute("aria-disabled","true"),n===this.state.highlightedIndex&&a.setAttribute("aria-current","true"),t.disabled||a.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.select(t.value)}),e.appendChild(a)})}}customElements.get("p-select")||customElements.define("p-select",f);class v extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this._view=new Date,this._step=15,this._weekStart=1,this.shadowRoot.innerHTML='\n          <style>\n            :host{\n              display:inline-block;\n              position:relative;\n              box-sizing: border-box;\n            }\n\n            .field{\n              position: absolute;\n              top: 0;\n              left: 0;\n              right: 0;\n              bottom: 0;\n              display:flex;\n              align-items:center;\n              gap:.5rem;\n              box-sizing: border-box;\n            }\n\n            /* CSS custom properties with theme/parent color inheritance */\n            :host {\n              --datetime-bg: var(--background-color, var(--color-surface, #fff));\n              --datetime-border: var(--border-color, var(--color-border, #e5e7eb));\n              --datetime-text: var(--text-color, var(--color-text, currentColor));\n              --datetime-muted: var(--text-muted, var(--color-text-secondary, #666));\n              --datetime-accent: var(--accent-color, var(--color-primary, #3b82f6));\n              --datetime-primary: var(--primary-color, var(--color-emphasis, #111));\n              --datetime-surface: var(--surface-color, var(--color-surface-secondary, #f8f9fb));\n              --datetime-hover: var(--hover-bg, var(--color-surface-hover, #f8f9fb));\n              --datetime-focus: var(--focus-color, var(--color-focus, #3b82f6));\n            }\n\n            /* Dark mode adjustments */\n            @media (prefers-color-scheme: dark) {\n              :host {\n                --datetime-bg: var(--background-color, var(--color-surface, #1f2937));\n                --datetime-border: var(--border-color, var(--color-border, #374151));\n                --datetime-text: var(--text-color, var(--color-text, #f9fafb));\n                --datetime-muted: var(--text-muted, var(--color-text-secondary, #9ca3af));\n                --datetime-surface: var(--surface-color, var(--color-surface-secondary, #374151));\n                --datetime-hover: var(--hover-bg, var(--color-surface-hover, #4b5563));\n              }\n            }\n\n            /* Default standalone styles */\n            :host(:not([theme="inherit"])) .field {\n              padding: 0.75rem 1rem;\n              border: 1px solid var(--datetime-border);\n              border-radius: 6px;\n              background: var(--datetime-bg);\n              color: var(--datetime-text);\n              height: 2.5rem;\n              box-sizing: border-box;\n            }\n\n            /* When inheriting from parent, fill parent and inherit its styles */\n            :host([theme="inherit"]) {\n              width: 100%;\n              min-height: 100%;\n            }\n\n            :host([theme="inherit"]) .field {\n              background: inherit;\n              color: inherit;\n              font-family: inherit;\n              font-size: inherit;\n              border: inherit;\n              border-radius: inherit;\n              padding: inherit;\n            }\n\n            .panel{\n              position:absolute; top:100%; left:0; margin-top:.5rem;\n              background: var(--datetime-bg); border:1px solid var(--datetime-border);\n              border-radius:var(--p-radius,12px); box-shadow:var(--p-shadow,0 10px 30px rgba(0,0,0,.12));\n              padding:.75rem; z-index:1000; min-width:20rem;\n              opacity:0; transform:translateY(-8px); transition:all 0.15s ease;\n              pointer-events:none;\n            }\n            .panel.open{opacity:1; transform:translateY(0); pointer-events:all}\n            .panel[hidden]{display:none}\n\n            input{\n              border: none;\n              outline: none;\n              background: transparent;\n              color: inherit;\n              font: inherit;\n              flex: 1;\n              width: 100%;\n              padding: 0;\n              min-width: 0;\n            }\n\n            /* Default standalone input styles */\n            :host(:not([theme="inherit"])) input {\n              padding: 0;\n              border: 1px solid #e5e7eb;\n              border-radius: 6px;\n              background: #fff;\n              color: #1f2937;\n              font-size: 1rem;\n            }\n\n            :host(:not([theme="inherit"])) input:focus {\n              border-color: #3b82f6;\n              box-shadow: 0 0 0 3px rgba(59,130,246,.1);\n            }\n\n            input::placeholder {\n              color: inherit;\n              opacity: 0.6;\n            }\n            .calendar-btn{\n              background:none;\n              border:none;\n              cursor:pointer;\n              font-size:1.1rem;\n              padding:.25rem;\n              border-radius:.5rem;\n              color: inherit;\n              flex-shrink: 0;\n              opacity: 0.7;\n              margin-left: auto;\n            }\n\n            :host(:not([theme="inherit"])) .calendar-btn {\n              color: var(--datetime-muted);\n              padding: .5rem;\n            }\n            .calendar-btn:hover{background: var(--datetime-hover); color: var(--datetime-accent)}\n            \n            .nav{display:flex; align-items:center; justify-content:space-between; margin:0 0 .75rem}\n            .nav button{background:none; border:none; cursor:pointer; padding:.5rem; border-radius:.5rem; color: var(--datetime-muted)}\n            .nav button:hover{background: var(--datetime-hover)}\n            .month-year{font-weight:600; cursor:pointer; padding:.25rem .5rem; border-radius:.5rem}\n            .month-year:hover{background: var(--datetime-hover)}\n            \n            .grid{\n              display:grid; grid-template-columns:repeat(7,1fr);\n              gap:.125rem; justify-items:center; margin-bottom:.75rem;\n            }\n            .wd{font-size:.75rem; opacity:.6; font-weight:600; padding:.5rem 0; text-transform:uppercase}\n            .day{\n              width:100%; height:2.5rem; border-radius:.5rem; cursor:pointer;\n              background:none; border:none; font-size:.875rem; color: inherit;\n              transition:all 0.15s ease; display:flex; align-items:center; justify-content:center;\n            }\n            .day:hover{background: var(--datetime-hover); transform:scale(1.05)}\n            .day.today{background: var(--datetime-accent); color: var(--datetime-bg)}\n            .day.selected{background: var(--datetime-primary); color: var(--datetime-accent)}\n            .day:disabled{opacity:.3; cursor:not-allowed}\n            \n            .time{\n              display:flex; gap:.75rem; align-items:center; padding:.5rem 0;\n              margin:.5rem 0;\n            }\n            .time-group{display:flex; flex-direction:column; align-items:center; gap:.5rem}\n            .time-label{font-size:.7rem; text-transform:uppercase; color: var(--datetime-muted); font-weight:600}\n            .time-controls{display:flex; align-items:center; gap:.25rem; background: var(--datetime-bg); border:1px solid var(--datetime-border); border-radius:.5rem; padding:.25rem}\n            .time-btn{\n              width:1.5rem; height:1.5rem; border:none; background: var(--datetime-surface);\n              border-radius:.25rem; cursor:pointer; font-size:.8rem; display:flex; align-items:center; justify-content:center;\n            }\n            .time-btn:hover{background: var(--datetime-accent); color: var(--datetime-bg)}\n            .time-input{\n              width:3rem; text-align:center; border:none; background:transparent;\n              outline:none; font-size:1.1rem; font-weight:600;\n              -moz-appearance:textfield;\n            }\n            .time-input::-webkit-outer-spin-button,.time-input::-webkit-inner-spin-button{-webkit-appearance:none; margin:0}\n            \n            .ampm{background: var(--datetime-bg); border:1px solid var(--datetime-border); border-radius:.5rem; padding:.5rem; cursor:pointer}\n            \n            .quick-dates{display:flex; gap:.375rem; margin:.5rem 0; flex-wrap:wrap}\n            .preset{\n              padding:.375rem .75rem; background:none; border:1px solid var(--datetime-border);\n              border-radius:1rem; font-size:.8rem; cursor:pointer; color: var(--datetime-muted);\n            }\n            .preset:hover{background: var(--datetime-accent); color: var(--datetime-bg); border-color: var(--datetime-accent)}\n            \n            .actions{display:flex; gap:.5rem; justify-content:flex-end; margin-top:.75rem}\n            .btn{\n              border:1px solid var(--datetime-border); background: var(--datetime-surface);\n              border-radius:.5rem; padding:0.5rem 0.75rem; cursor:pointer; font-size:0.875rem;\n              min-height: 2rem; display: inline-flex; align-items: center; justify-content: center;\n              color: var(--datetime-text);\n            }\n            .btn:hover{background: var(--datetime-primary); color: var(--datetime-bg)}\n            .btn.primary{background: var(--datetime-accent); color: var(--datetime-bg); border-color: var(--datetime-accent)}\n\n            .range-fields{display:flex; gap:.5rem; align-items:flex-end}\n            .range-field{flex:1}\n            .range-label{display:block; font-size:.875rem; color: var(--datetime-text); margin-bottom:.5rem; font-weight:500}\n\n            .day.range-start{background: var(--datetime-accent); color: var(--datetime-bg)}\n            .day.range-end{background: var(--datetime-accent); color: var(--datetime-bg)}\n            .day.in-range{background: var(--datetime-surface); color: var(--datetime-text)}\n            .day.range-hover{background:rgba(59,130,246,0.1)}\n\n            .range-info{\n              padding:.5rem; background: var(--datetime-surface); border-radius:.5rem;\n              margin-bottom:.75rem; font-size:.8rem; color: var(--datetime-muted); text-align:center;\n            }\n          </style>\n\n          <div class="field">\n            <input type="text" readonly class="single-input" />\n            <div class="range-fields" hidden>\n              <div class="range-field">\n                <label class="range-label from-label">From</label>\n                <input type="text" readonly class="from-input" />\n              </div>\n              <div class="range-field">\n                <label class="range-label to-label">To</label>\n                <input type="text" readonly class="to-input" />\n              </div>\n            </div>\n            <button type="button" class="calendar-btn">📅</button>\n          </div>\n          \n          <div class="panel" hidden>\n            <div class="range-info" hidden>Click to select start date, then select end date</div>\n\n            <div class="nav">\n              <button class="prev">‹</button>\n              <div class="month-year">\n                <span class="month"></span> <span class="year"></span>\n              </div>\n              <button class="next">›</button>\n            </div>\n\n            <div class="grid"></div>\n            \n            <div class="quick-dates" hidden></div>\n            \n            <div class="time" hidden>\n              <div class="time-group">\n                <div class="time-label">Hours</div>\n                <div class="time-controls">\n                  <button class="time-btn" data-field="hh" data-dir="-1">−</button>\n                  <input class="time-input hh" type="number" min="0" max="23" value="00" />\n                  <button class="time-btn" data-field="hh" data-dir="1">+</button>\n                </div>\n              </div>\n              <div style="font-size:1.5rem; color: var(--datetime-muted)">:</div>\n              <div class="time-group">\n                <div class="time-label">Minutes</div>\n                <div class="time-controls">\n                  <button class="time-btn" data-field="mm" data-dir="-1">−</button>\n                  <input class="time-input mm" type="number" min="0" max="59" value="00" />\n                  <button class="time-btn" data-field="mm" data-dir="1">+</button>\n                </div>\n              </div>\n              <div class="time-group ampm-group" hidden>\n                <div class="time-label">Period</div>\n                <select class="ampm">\n                  <option value="AM">AM</option>\n                  <option value="PM">PM</option>\n                </select>\n              </div>\n            </div>\n            \n            <div class="actions">\n              <button class="btn btn--sm today">Today</button>\n              <button class="btn btn--sm clear">Clear</button>\n              <button class="btn btn--sm primary apply">Apply</button>\n            </div>\n          </div>\n        ',this._input=this.shadowRoot.querySelector(".single-input"),this._fromInput=this.shadowRoot.querySelector(".from-input"),this._toInput=this.shadowRoot.querySelector(".to-input"),this._rangeFields=this.shadowRoot.querySelector(".range-fields"),this._fromLabel=this.shadowRoot.querySelector(".from-label"),this._toLabel=this.shadowRoot.querySelector(".to-label"),this._btn=this.shadowRoot.querySelector(".calendar-btn"),this._panel=this.shadowRoot.querySelector(".panel"),this._grid=this.shadowRoot.querySelector(".grid"),this._month=this.shadowRoot.querySelector(".month"),this._year=this.shadowRoot.querySelector(".year"),this._timeWrap=this.shadowRoot.querySelector(".time"),this._hh=this.shadowRoot.querySelector(".hh"),this._mm=this.shadowRoot.querySelector(".mm"),this._ampm=this.shadowRoot.querySelector(".ampm"),this._ampmGroup=this.shadowRoot.querySelector(".ampm-group"),this._quickDates=this.shadowRoot.querySelector(".quick-dates"),this._rangeInfo=this.shadowRoot.querySelector(".range-info"),this._hidden=null,this._hiddenTo=null,this._currentField="from",this._rangeState=null}connectedCallback(){this._bindEvents(),this._render(),this.name&&this._ensureHidden(),requestAnimationFrame(()=>{this._updateTheme()})}_updateTheme(e=null){const t=e||this.getAttribute("theme");!t||"inherit"===t?this._applyInheritTheme():this._applyNamedTheme(t)}_applyInheritTheme(){this.hasAttribute("theme")||this.setAttribute("theme","inherit");const e=getComputedStyle(this);this.shadowRoot.querySelectorAll("input").forEach(t=>{t.style.setProperty("--datetime-input-color",e.color),t.style.setProperty("--datetime-input-font-size",e.fontSize),t.style.setProperty("--datetime-input-font-family",e.fontFamily)}),this.style.setProperty("--datetime-input-background",e.backgroundColor),this.style.setProperty("--datetime-input-color",e.color),this.style.setProperty("--datetime-input-font-size",e.fontSize),this.style.setProperty("--datetime-input-font-family",e.fontFamily)}_applyNamedTheme(e){"inherit"===this.getAttribute("theme")&&this.removeAttribute("theme"),e&&"inherit"!==e&&this.setAttribute("theme",e)}static get observedAttributes(){return["name","value","mode","time-format","show-quick-dates","quick-dates","range","range-to","from-label","to-label","theme"]}attributeChangedCallback(e,t,n){if(t!==n&&"theme"===e)this._updateTheme(n)}_bindEvents(){this._btn.addEventListener("click",()=>{this.isRange&&(this._currentField="from",this._rangeState="selecting-from"),this.toggle()}),this._input.addEventListener("click",()=>this.open()),this._fromInput.addEventListener("click",()=>{this.isRange&&(this._currentField="from",this._rangeState="selecting-from",this.open())}),this._toInput.addEventListener("click",()=>{this.isRange&&(this._currentField="to",this._rangeState="selecting-to",this.open())}),this.shadowRoot.querySelector(".prev").addEventListener("click",()=>{this._view.setMonth(this._view.getMonth()-1),this._render()}),this.shadowRoot.querySelector(".next").addEventListener("click",()=>{this._view.setMonth(this._view.getMonth()+1),this._render()}),this.shadowRoot.querySelector(".today").addEventListener("click",()=>{const e=new Date;"date"===this.mode?this.value=new Date(e.getFullYear(),e.getMonth(),e.getDate()).toISOString():(e.setSeconds(0,0),this.value=e.toISOString()),this._emitChange(),this._render(),"date"===this.mode&&this.close()}),this.shadowRoot.querySelector(".clear").addEventListener("click",()=>{this.value="",this._emitChange(),this._render()}),this.shadowRoot.querySelector(".apply").addEventListener("click",()=>{this.close()}),this.shadowRoot.querySelectorAll(".time-btn").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.dataset.field,n=+e.target.dataset.dir,a=this.shadowRoot.querySelector(`.${t}`),r=+a.value||0,s="mm"===t?this._step:1,o="hh"===t?"12"===this.timeFormat?12:23:59,i="hh"===t&&"12"===this.timeFormat?1:0;let l=r+n*s;l<i&&(l=o),l>o&&(l=i),a.value=String(l).padStart(2,"0"),this._syncTime()})}),this._hh.addEventListener("change",()=>this._syncTime()),this._mm.addEventListener("change",()=>this._syncTime()),this._ampm.addEventListener("change",()=>this._syncTime()),document.addEventListener("click",e=>{this.contains(e.target)||this.close()})}get mode(){return this.getAttribute("mode")||"date"}set mode(e){this.setAttribute("mode",e)}get value(){return this.getAttribute("value")||""}set value(e){e?this.setAttribute("value",e):this.removeAttribute("value")}get name(){return this.getAttribute("name")}set name(e){e?this.setAttribute("name",e):this.removeAttribute("name")}get timeFormat(){return this.getAttribute("time-format")||"24"}set timeFormat(e){this.setAttribute("time-format",e)}get showQuickDates(){return this.hasAttribute("show-quick-dates")}set showQuickDates(e){e?this.setAttribute("show-quick-dates",""):this.removeAttribute("show-quick-dates")}get quickDates(){return this.getAttribute("quick-dates")||"yesterday,today,tomorrow"}set quickDates(e){this.setAttribute("quick-dates",e)}get isRange(){return this.hasAttribute("range")}set isRange(e){e?this.setAttribute("range",""):this.removeAttribute("range")}get rangeTo(){return this.getAttribute("range-to")}set rangeTo(e){e?this.setAttribute("range-to",e):this.removeAttribute("range-to")}get fromLabel(){return this.getAttribute("from-label")||"From"}set fromLabel(e){this.setAttribute("from-label",e)}get toLabel(){return this.getAttribute("to-label")||"To"}set toLabel(e){this.setAttribute("to-label",e)}get rangeToValue(){return this.getAttribute("range-to-value")||""}set rangeToValue(e){e?this.setAttribute("range-to-value",e):this.removeAttribute("range-to-value")}attributeChangedCallback(){this.isConnected&&this._render()}static get observedAttributes(){return["mode","value","name","time-format","show-quick-dates","quick-dates","range","range-to","from-label","to-label","range-to-value"]}open(){this._panel.hidden=!1,requestAnimationFrame(()=>{this._panel.classList.add("open")})}close(){this._panel.classList.remove("open"),setTimeout(()=>{this._panel.hidden=!0},150)}toggle(){this._panel.hidden?this.open():this.close()}_render(){this._renderMode(),this._renderCalendar(),this._renderTime(),this._renderInput(),this._renderQuickDates()}_renderMode(){this.isRange?(this._input.style.display="none",this._rangeFields.style.display="flex",this._rangeInfo.hidden=!1,this._fromLabel.textContent=this.fromLabel,this._toLabel.textContent=this.toLabel,this.value?this.rangeToValue?this._rangeInfo.textContent="Range selected. Click dates to modify.":this._rangeInfo.textContent=`${this.fromLabel} selected. Now select ${this.toLabel.toLowerCase()}`:this._rangeInfo.textContent=`Click to select ${this.fromLabel.toLowerCase()}`):(this._input.style.display="block",this._rangeFields.style.display="none",this._rangeInfo.hidden=!0)}_renderCalendar(){const e=this._view.getFullYear(),t=this._view.getMonth(),n=new Date,a=this.value?new Date(this.value):null;this._month.textContent=new Intl.DateTimeFormat(void 0,{month:"long"}).format(this._view),this._year.textContent=String(e);const r=(new Date(e,t,1).getDay()-this._weekStart+7)%7,s=new Date(e,t+1,0).getDate();this._grid.innerHTML="";for(let e=0;e<7;e++){const t=(e+this._weekStart)%7,n=document.createElement("div");n.className="wd",n.textContent=new Intl.DateTimeFormat(void 0,{weekday:"narrow"}).format(new Date(2020,5,t+1)),this._grid.appendChild(n)}for(let e=0;e<r;e++)this._grid.appendChild(document.createElement("div"));for(let r=1;r<=s;r++){const s=new Date(e,t,r),o=document.createElement("button");if(o.className="day",o.textContent=String(r),s.toDateString()===n.toDateString()&&o.classList.add("today"),this.isRange){const e=this.value?new Date(this.value):null,t=this.rangeToValue?new Date(this.rangeToValue):null;e&&s.toDateString()===e.toDateString()&&o.classList.add("range-start"),t&&s.toDateString()===t.toDateString()&&o.classList.add("range-end"),e&&t&&s>e&&s<t&&o.classList.add("in-range")}else a&&s.toDateString()===a.toDateString()&&o.classList.add("selected");o.addEventListener("click",()=>{if(this.isRange){const e="date"===this.mode?new Date(s.getFullYear(),s.getMonth(),s.getDate()).toISOString():(()=>{const e=new Date;return e.setFullYear(s.getFullYear(),s.getMonth(),s.getDate()),"datetime"===this.mode&&e.setHours(9,0,0,0),e.toISOString()})();if(this.value)if(this.rangeToValue){const t=new Date(this.value),n=new Date(this.rangeToValue),a=new Date(e);Math.abs(a-t)<=Math.abs(a-n)?(this.value=e,new Date(e)>n&&(this.rangeToValue="")):new Date(e)>=t&&(this.rangeToValue=e)}else new Date(e)<new Date(this.value)?(this.rangeToValue=this.value,this.value=e):this.rangeToValue=e,"date"===this.mode&&this.close();else this.value=e,this._currentField="to";this._emitChange(),this._render()}else if("date"===this.mode)this.value=new Date(s.getFullYear(),s.getMonth(),s.getDate()).toISOString(),this._emitChange(),this.close();else{const e=this.value?new Date(this.value):new Date;e.setFullYear(s.getFullYear(),s.getMonth(),s.getDate()),this.value=e.toISOString(),this._emitChange(),this._render()}}),this._grid.appendChild(o)}}_renderTime(){const e="datetime"===this.mode;if(this._timeWrap.hidden=!e,e){const e="12"===this.timeFormat;if(this._ampmGroup.hidden=!e,this.value){const t=new Date(this.value);if(e){let e=t.getHours();this._ampm.value=e>=12?"PM":"AM",e=e%12||12,this._hh.value=String(e).padStart(2,"0")}else this._hh.value=String(t.getHours()).padStart(2,"0");this._mm.value=String(t.getMinutes()).padStart(2,"0")}}}_renderInput(){const e="date"===this.mode?{dateStyle:"medium"}:{dateStyle:"medium",timeStyle:"short"};if(this.isRange){if(this.value){const t=new Date(this.value);this._fromInput.value=new Intl.DateTimeFormat(void 0,e).format(t)}else this._fromInput.value="",this._fromInput.placeholder="date"===this.mode?"Start date...":"Start date & time...";if(this.rangeToValue){const t=new Date(this.rangeToValue);this._toInput.value=new Intl.DateTimeFormat(void 0,e).format(t)}else this._toInput.value="",this._toInput.placeholder="date"===this.mode?"End date...":"End date & time..."}else if(this.value){const t=new Date(this.value);this._input.value=new Intl.DateTimeFormat(void 0,e).format(t)}else this._input.value="",this._input.placeholder="date"===this.mode?"Select date...":"Select date & time..."}_renderQuickDates(){const e=this.showQuickDates;if(this._quickDates.hidden=!e,e){const e=this.quickDates.split(",").map(e=>e.trim()),t={yesterday:{days:-1,label:"Yesterday"},today:{days:0,label:"Today"},tomorrow:{days:1,label:"Tomorrow"}};this._quickDates.innerHTML="",e.forEach(e=>{if(t[e]){const n=document.createElement("button");n.className="preset",n.textContent=t[e].label,n.addEventListener("click",()=>{const n=new Date;n.setDate(n.getDate()+t[e].days),"date"===this.mode?this.value=new Date(n.getFullYear(),n.getMonth(),n.getDate()).toISOString():(n.setHours(9,0,0,0),this.value=n.toISOString()),this._emitChange(),this._render(),"date"===this.mode&&this.close()}),this._quickDates.appendChild(n)}})}}_syncTime(){if("datetime"!==this.mode)return;const e=this.value?new Date(this.value):new Date;let t=+this._hh.value||0;const n=+this._mm.value||0;if("12"===this.timeFormat){const e=this._ampm.value;"PM"===e&&12!==t&&(t+=12),"AM"===e&&12===t&&(t=0)}e.setHours(t,n,0,0),this.value=e.toISOString(),this._emitChange(),this._renderInput()}_ensureHidden(){this._hidden||(this._hidden=document.createElement("input"),this._hidden.type="hidden",this.appendChild(this._hidden)),this._hidden.name=this.name,this._hidden.value=this.value,this.isRange&&this.rangeTo&&(this._hiddenTo||(this._hiddenTo=document.createElement("input"),this._hiddenTo.type="hidden",this.appendChild(this._hiddenTo)),this._hiddenTo.name=this.rangeTo,this._hiddenTo.value=this.rangeToValue)}_emitChange(){this._hidden&&(this._hidden.value=this.value),this._hiddenTo&&(this._hiddenTo.value=this.rangeToValue);const e=this.isRange?{value:this.value,toValue:this.rangeToValue,from:this.value,to:this.rangeToValue}:{value:this.value};this.dispatchEvent(new CustomEvent("change",{detail:e}))}}customElements.define("p-datetime",v);class b extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.files=new Map,this.fieldSchema=null,this.draggedElement=null,this.draggedOverElement=null,this.XHRConstructor=null,this.eventBus=null,this.logger=null,this._render()}connectedCallback(){this._setupEventListeners(),this._loadFieldDefinitions(),this._loadExistingFiles(),setTimeout(()=>{this._validateFiles()},0)}disconnectedCallback(){this.abortController&&this.abortController.abort()}static get observedAttributes(){return["max-files","upload-url","update-url","delete-url","sequence-url","accept-types","max-file-size","allow-edit","allow-sort"]}get config(){const e=(e,t)=>this.getAttribute(e)||t,t=(e,t)=>parseInt(this.getAttribute(e))||t,n=e=>"false"!==this.getAttribute(e);return{maxFiles:t("max-files",5),uploadUrl:e("upload-url","/upload"),updateUrl:e("update-url","/update"),deleteUrl:e("delete-url","/delete"),sequenceUrl:e("sequence-url","/sequence"),inputName:e("input-name","files"),acceptTypes:e("accept-types","*/*"),maxFileSize:t("max-file-size",10485760),allowEdit:n("allow-edit"),allowSort:n("allow-sort")}}setXHR(e){this.XHRConstructor=e}setEventBus(e){this.eventBus=e}setLogger(e){this.logger=e}_getXHRConstructor(){return null===this.XHRConstructor&&(this.XHRConstructor=window.MockXHR||XMLHttpRequest),this.XHRConstructor}_loadFieldDefinitions(){const e=this.querySelector('p-uploader-fields[slot="field-definitions"]');if(!e)return this.logger&&this.logger.warn("PUploader: No field definitions found. Using defaults."),void(this.fieldSchema=this._getDefaultFields());const t=e.querySelectorAll("p-uploader-field");this.fieldSchema=new Map,t.forEach(e=>{const t=e.getAttribute("key"),n=e.getAttribute("label"),a=e.getAttribute("type")||"text",r=e.hasAttribute("required"),s=e.getAttribute("maxlength");t?this.fieldSchema.set(t,{key:t,label:n||t,type:a,required:r,maxlength:s?parseInt(s):null,element:e}):this.logger&&this.logger.error('PUploader: Field missing required "key" attribute',e)})}_validateFiles(){this.querySelectorAll("p-uploader-file").forEach(e=>{const t=e.querySelectorAll("p-uploader-data"),n=new Map;t.forEach(t=>{const a=t.getAttribute("key"),r=t.textContent.trim();if(!this.fieldSchema.has(a))return void(this.logger&&this.logger.warn(`PUploader: Unknown field key "${a}" in file ${e.getAttribute("file-id")}`));const s=this.fieldSchema.get(a);if(s.required&&!r&&this.logger&&this.logger.error(`PUploader: Required field "${a}" is empty in file ${e.getAttribute("file-id")}`),s.maxlength&&r.length>s.maxlength&&this.logger&&this.logger.warn(`PUploader: Field "${a}" exceeds maxlength of ${s.maxlength}`),"url"===s.type&&r)try{new URL(r)}catch{this.logger&&this.logger.error(`PUploader: Field "${a}" has invalid URL: ${r}`)}n.set(a,r)}),this.fieldSchema.forEach((t,a)=>{t.required&&!n.has(a)&&this.logger&&this.logger.error(`PUploader: Missing required field "${a}" in file ${e.getAttribute("file-id")}`)}),e._fieldData=n,e._fieldSchema=this.fieldSchema,e._render&&e._render()})}_getDefaultFields(){return new Map([["title",{key:"title",label:"Title",type:"text",required:!1}],["caption",{key:"caption",label:"Caption",type:"textarea",required:!1}],["link",{key:"link",label:"Link",type:"url",required:!1}]])}getFieldSchema(){return this.fieldSchema}_render(){const e=this.getAttribute("accept-types")||"*/*";this.shadowRoot.innerHTML=`\n      <style>\n        :host {\n          display: block;\n          position: relative;\n          padding: 0.375rem;\n          border: 2px solid #000;\n        }\n\n        .uploader__files {\n          display: grid;\n          gap: 0.375rem;\n          margin-bottom: 0.375rem;\n        }\n\n        .uploader__selector {\n          border: 2px solid #cbd5e1;\n          padding: 2rem;\n          text-align: center;\n          background: #f8fafc;\n          transition: all 0.2s;\n          cursor: pointer;\n        }\n\n        .uploader__selector:hover {\n          border-color: #94a3b8;\n          background: #f1f5f9;\n        }\n\n        .uploader__selector.dragover {\n          border-color: #3b82f6;\n          background: #dbeafe;\n        }\n\n        .uploader__fileinput {\n          display: none;\n        }\n\n        .uploader__label {\n          color: #64748b;\n          font-size: 1rem;\n          cursor: pointer;\n        }\n\n        ::slotted(p-uploader-file) {\n          display: block;\n        }\n\n        ::slotted(p-uploader-fields) {\n          display: none;\n        }\n      </style>\n\n      <slot name="field-definitions"></slot>\n\n      <div class="uploader__files">\n        <slot></slot>\n      </div>\n\n      <div class="uploader__selector" part="selector">\n        <input type="file" multiple accept="${e}" class="uploader__fileinput" id="file-input">\n        <label class="uploader__label" for="file-input">\n          + Add files by selecting or dragging here\n        </label>\n      </div>\n    `}_setupEventListeners(){this.abortController=new AbortController;const e=this.abortController.signal,t=this.shadowRoot.querySelector(".uploader__fileinput"),n=this.shadowRoot.querySelector(".uploader__selector");t.addEventListener("change",e=>this._handleFileSelect(e),{signal:e}),n.addEventListener("dragover",e=>{if(this.draggedElement)return e.preventDefault(),void e.stopPropagation();e.preventDefault(),n.classList.add("dragover")},{signal:e}),n.addEventListener("dragleave",e=>{this.draggedElement||(e.preventDefault(),n.classList.remove("dragover"))},{signal:e}),n.addEventListener("drop",e=>{if(this.draggedElement)return e.preventDefault(),void e.stopPropagation();e.preventDefault(),n.classList.remove("dragover"),this._handleFileDrop(e)},{signal:e}),this.config.allowSort&&(this.addEventListener("dragover",e=>{this.draggedElement&&(e.preventDefault(),e.dataTransfer.dropEffect="move")},{signal:e}),this.addEventListener("dragstart",e=>this._handleDragStart(e),{signal:e}),this.addEventListener("dragend",e=>this._handleDragEnd(e),{signal:e}),this.addEventListener("dragenter",e=>this._handleDragEnter(e),{signal:e}),this.addEventListener("dragleave",e=>this._handleDragLeave(e),{signal:e}),this.addEventListener("drop",e=>this._handleDrop(e),{signal:e})),this.addEventListener("file:delete",e=>{const t=e.detail.fileId;t&&this.files.has(t)&&this.files.delete(t)},{signal:e})}_loadExistingFiles(){const e=this.querySelectorAll("p-uploader-file");e.forEach((t,n)=>{const a=t.getAttribute("file-id");a&&(this.files.set(a,{id:a,element:t,state:"uploaded",order:n}),this.config.allowSort&&e.length>1&&t.setAttribute("draggable","true"))})}_handleFileSelect(e){this._processFiles(Array.from(e.target.files)),e.target.value=""}_handleFileDrop(e){e.dataTransfer?.files?.length&&this._processFiles(Array.from(e.dataTransfer.files))}_processFiles(e){const t=this.querySelectorAll("p-uploader-file").length,n=this.config.maxFiles-t;if(n<=0)return void alert(`Maximum ${this.config.maxFiles} files allowed`);const a=e.slice(0,n);e.length>n&&alert(`Only ${n} more file${1===n?"":"s"} can be added (${this.config.maxFiles} max)`),a.forEach(e=>{this._uploadFile(e)})}async _uploadFile(e){const t=r("file"),n={id:t,file:e,state:"uploading",progress:0};this.files.set(t,n);const a=document.createElement("p-uploader-file");if(a.setAttribute("file-id",t),a.setAttribute("filename",e.name),a.setAttribute("state","uploading"),a.setAttribute("allow-edit",this.config.allowEdit),a._fieldSchema=this.fieldSchema,a._fieldData=new Map,n.element=a,this.appendChild(a),e.type.startsWith("image/"))try{const t=await this._createThumbnail(e,240,240);a.setAttribute("preview",t)}catch(e){this.logger&&this.logger.warn("Failed to create thumbnail",e)}this._performUpload(n)}_performUpload(e){const t=new FormData;t.append("file",e.file);const n=new(this._getXHRConstructor());n.upload.addEventListener("progress",t=>{if(t.lengthComputable){const n=t.loaded/t.total*100;e.progress=n,e.element.setAttribute("progress",Math.round(n))}}),n.addEventListener("load",()=>{if(200===n.status)try{const t=JSON.parse(n.responseText);this._handleUploadSuccess(e,t)}catch(t){this._handleUploadError(e,"Invalid server response")}else this._handleUploadError(e,n.responseText||"Upload failed")}),n.addEventListener("error",()=>{this._handleUploadError(e,"Network error")}),n.open("POST",this.config.uploadUrl),n.send(t)}_handleUploadSuccess(e,t){e.state="uploaded",e.serverData=t,e.element.setAttribute("state","uploaded"),t.preview&&e.element.setAttribute("preview",t.preview),t.id&&e.element.setAttribute("file-id",t.id),this._updateDraggableState(),this.dispatchEvent(new CustomEvent("upload:success",{detail:{fileId:e.id,response:t},bubbles:!0}))}_handleUploadError(e,t){e.state="error",e.error=t,e.element.setAttribute("state","error"),e.element.setAttribute("error",t),this.dispatchEvent(new CustomEvent("upload:error",{detail:{fileId:e.id,error:t},bubbles:!0}))}_updateDraggableState(){if(!this.config.allowSort)return;const e=this.querySelectorAll("p-uploader-file"),t=e.length>1;e.forEach(e=>{const n=e.getAttribute("data-current-panel")||"info";t&&!("info"!==n)?e.setAttribute("draggable","true"):e.removeAttribute("draggable")})}_handleDragStart(e){const t=e.target.closest("p-uploader-file");if(t&&t.hasAttribute("draggable")){this.draggedElement=t,e.dataTransfer.effectAllowed="move",this.originalFileOrder=Array.from(this.querySelectorAll("p-uploader-file"));try{document.selection?document.selection.empty():window.getSelection().removeAllRanges()}catch(e){}setTimeout(()=>{this.draggedElement&&t.setAttribute("dragging","")},0)}}_handleDragEnd(e){if(!this.draggedElement)return;this.draggedElement.removeAttribute("dragging");this.querySelectorAll("p-uploader-file").forEach(e=>e.removeAttribute("drag-over")),this.draggedElement=null,this.draggedOverElement=null}_handleDragEnter(e){if(!this.draggedElement)return;const t=e.target.closest("p-uploader-file");if(!t||t===this.draggedElement)return;if(t===this.draggedOverElement)return;this.draggedOverElement&&this.draggedOverElement.removeAttribute("drag-over"),t.setAttribute("drag-over",""),this.draggedOverElement=t;const n=Array.from(this.querySelectorAll("p-uploader-file")),a=n.indexOf(this.draggedElement),r=n.indexOf(t);-1!==r&&(r>a?t.parentNode.insertBefore(this.draggedElement,t.nextSibling):t.parentNode.insertBefore(this.draggedElement,t))}_handleDragLeave(e){if(!this.draggedElement)return;const t=e.target.closest("p-uploader-file");t&&(t!==this.draggedOverElement||t.contains(e.relatedTarget)||(t.removeAttribute("drag-over"),this.draggedOverElement=null))}_handleDrop(e){this.draggedElement&&(e.preventDefault(),e.stopPropagation(),this._updateSequence())}async _updateSequence(){const e=Array.from(this.querySelectorAll("p-uploader-file")).map(e=>e.getAttribute("file-id")).filter(e=>null!==e);try{const t=await fetch(this.config.sequenceUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sequence:e})});if(t.ok)this.originalFileOrder=null,this.dispatchEvent(new CustomEvent("sequence:update",{detail:{sequence:e},bubbles:!0}));else{this.originalFileOrder&&this._revertSequence();const e=await t.text();this.logger&&this.logger.error("Failed to update sequence:",e)}}catch(e){this.originalFileOrder&&this._revertSequence(),this.logger&&this.logger.error("Failed to update sequence:",e)}}_revertSequence(){if(!this.originalFileOrder)return;const e=document.createDocumentFragment();this.originalFileOrder.forEach(t=>{t.parentNode&&t.parentNode.removeChild(t),e.appendChild(t)});const t=this.shadowRoot.querySelector(".uploader__selector");this.insertBefore(e,t),this.originalFileOrder=null}async _createThumbnail(e,t,n){return new Promise((a,r)=>{const s=new FileReader;s.onload=s=>{const o=new Image;o.onload=()=>{const r=Math.min(t/o.width,n/o.height,1),s=o.width*r,i=o.height*r,l=document.createElement("canvas");l.width=s,l.height=i,l.getContext("2d").drawImage(o,0,0,s,i),a(l.toDataURL(e.type||"image/jpeg",.9))},o.onerror=()=>r(new Error("Failed to load image")),o.src=s.target.result},s.onerror=()=>r(new Error("Failed to read file")),s.readAsDataURL(e)})}}class y extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this._fieldSchema=null,this._fieldData=new Map,this._render()}static get observedAttributes(){return["state","progress","preview","error","filename","allow-edit","data-current-panel"]}attributeChangedCallback(e,t,n){t!==n&&this._render()}_render(){const e=this.getAttribute("state")||"uploaded",t=parseInt(this.getAttribute("progress"))||0,n=this.getAttribute("preview")||"",a=this.getAttribute("error")||"",r=this.getAttribute("filename")||"",s="false"!==this.getAttribute("allow-edit"),o=this.getAttribute("data-current-panel")||"info";this.querySelector("p-uploader-data")&&!this._fieldData.size&&this._loadFieldData(),this.shadowRoot.innerHTML=`\n      <style>\n        *,\n        *::before,\n        *::after {\n          box-sizing: border-box;\n        }\n\n        :host {\n          display: block;\n          position: relative;\n          border: 1px solid #e2e8f0;\n          padding: 0.375rem;\n          background: white;\n          transition: border-color 0.2s ease-out, background-color 0.2s ease-out;\n        }\n\n        :host([dragging]) {\n          opacity: 0.5;\n          transition: none;\n        }\n\n        :host([drag-over]) {\n          border-color: #3b82f6;\n          background: #eff6ff;\n          transform: translateY(-4px);\n        }\n\n        :host([draggable="true"]) {\n          cursor: grab;\n          user-select: none;\n          -webkit-user-select: none;\n        }\n\n        :host([draggable="true"]:active) {\n          cursor: grabbing;\n        }\n\n        .uploader__overlay {\n          position: absolute;\n          inset: 0;\n          background: rgba(255, 255, 255, 0.95);\n          display: none;\n          align-items: center;\n          justify-content: center;\n          z-index: 10;\n        }\n\n        .uploader__overlay--show {\n          display: flex;\n        }\n\n        .uploader__progress {\n          width: 80%;\n          height: 8px;\n        }\n\n        .uploader__container {\n          display: flex;\n          gap: 0.375rem;\n          position: relative;\n        }\n\n        .uploader__preview {\n          flex-shrink: 0;\n          width: 6rem;\n          height: 6rem;\n          display: ${n?"block":"none"};\n          pointer-events: none;\n          user-select: none;\n        }\n\n        .uploader__preview img {\n          width: 100%;\n          height: 100%;\n          object-fit: cover;\n          pointer-events: none;\n          user-select: none;\n        }\n\n        .uploader__content {\n          flex: 1;\n          display: flex;\n          flex-direction: column;\n          min-width: 0;\n        }\n\n        .uploader__panel {\n          display: none;\n          pointer-events: auto;\n          flex: 1;\n        }\n\n        .uploader__panel--show {\n          display: flex;\n          flex-direction: column;\n        }\n\n        .uploader__body {\n          flex: 1;\n          padding-left: 0.375rem;\n          min-height: 4.75rem;\n          position: relative;\n        }\n\n        .uploader__delete-icon {\n          position: absolute;\n          top: 0;\n          right: 0;\n          width: 1.75rem;\n          height: 1.75rem;\n          border: none;\n          background-size: contain;\n          background: white url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='none' d='M0 0h24v24H0V0z'/%3E%3Cpath d='M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zm2.46-7.12l1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14l-2.13-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4z'/%3E%3Cpath fill='none' d='M0 0h24v24H0z'/%3E%3C/svg%3E") no-repeat center;\n          cursor: pointer;\n          opacity: 0.6;\n          transition: opacity 0.2s;\n          pointer-events: auto;\n          padding: 0;\n        }\n\n        .uploader__delete-icon:hover {\n          opacity: 1;\n        }\n\n        .uploader__filename {\n          font-weight: 600;\n          color: #1e293b;\n          font-size: 0.875rem;\n          padding-right: 2rem;\n          height: 1.5rem;\n          padding-top: 0.1875rem;\n          padding-bottom: 0.1875rem;\n          line-height: 1.125rem;\n          margin: 0;\n          display: flex;\n          align-items: center;\n        }\n\n        .uploader__field {\n          display: flex;\n          align-items: center;\n          gap: 0.375rem;\n          height: 1.5rem;\n          padding-top: 0.1875rem;\n          padding-bottom: 0.1875rem;\n          margin: 0;\n        }\n\n        .uploader__field-label {\n          font-weight: 600;\n          color: #475569;\n          font-size: 0.75rem;\n          min-width: 4rem;\n        }\n\n        .uploader__field-value {\n          flex: 1;\n          color: #64748b;\n          font-size: 0.75rem;\n          line-height: 1.3;\n          word-break: break-word;\n        }\n\n        .uploader__field-edit {\n          flex-shrink: 0;\n          width: 1.25rem;\n          height: 1.25rem;\n          border: 1px solid #cbd5e1;\n          background: white;\n          cursor: pointer;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 0.625rem;\n          transition: all 0.2s;\n          padding: 0;\n        }\n\n        .uploader__field-edit:hover {\n          background: #f1f5f9;\n          border-color: #94a3b8;\n        }\n\n        .uploader__actions {\n          display: flex;\n          gap: 0.375rem;\n          justify-content: flex-end;\n          margin-top: 0.375rem;\n        }\n\n        .uploader__btn {\n          padding: 0.375rem 0.75rem;\n          border: 1px solid #cbd5e1;\n          background: white;\n          cursor: pointer;\n          font-size: 0.75rem;\n          transition: all 0.2s;\n          pointer-events: auto;\n        }\n\n        .uploader__btn:hover {\n          background: #f1f5f9;\n        }\n\n        .uploader__btn--secondary {\n          background: #f1f5f9;\n        }\n\n        .uploader__btn--delete {\n          color: #dc2626;\n          border-color: #dc2626;\n        }\n\n        .uploader__btn--delete:hover {\n          background: #fee2e2;\n        }\n\n        .uploader__btn--primary {\n          background: #3b82f6;\n          color: white;\n          border-color: #3b82f6;\n        }\n\n        .uploader__btn--primary:hover {\n          background: #2563eb;\n        }\n\n        .uploader__input,\n        .uploader__textarea {\n          width: 100%;\n          padding: 0.375rem;\n          border: 1px solid #cbd5e1;\n          margin-bottom: 0.375rem;\n          font-family: inherit;\n          font-size: 0.75rem;\n          pointer-events: auto;\n        }\n\n        .uploader__textarea {\n          resize: vertical;\n          min-height: 60px;\n        }\n\n        .error-message {\n          color: #dc2626;\n          background: #fee2e2;\n          padding: 0.5rem;\n          font-size: 0.75rem;\n        }\n\n        slot {\n          display: none;\n        }\n      </style>\n\n      <slot></slot>\n\n      <div class="uploader__overlay ${"uploading"===e?"uploader__overlay--show":""}">\n        <progress class="uploader__progress" max="100" value="${t}"></progress>\n      </div>\n\n      <div class="uploader__container">\n        ${n?`\n          <picture class="uploader__preview">\n            <img src="${n}" alt="${r}">\n          </picture>\n        `:""}\n\n        <div class="uploader__content">\n          ${"error"===e||"uploaded"===e&&"error"===o?`\n            <div data-panel="error" class="uploader__panel ${"error"===o||"error"===e?"uploader__panel--show":""}">\n              <div class="uploader__body">\n                <div class="error-message">${a}</div>\n              </div>\n              <div class="uploader__actions">\n                ${"error"===e?'<button class="uploader__btn uploader__btn--delete" data-action="confirm-delete">Remove</button>':'<button class="uploader__btn uploader__btn--secondary" data-action="cancel">Cancel</button>'}\n              </div>\n            </div>\n          `:""}\n\n          ${"uploaded"===e?`\n            <div data-panel="info" class="uploader__panel ${"info"===o?"uploader__panel--show":""}">\n              <div class="uploader__body">\n                ${s?'<button class="uploader__delete-icon" data-action="show-delete" title="Delete file"></button>':""}\n                <div class="uploader__filename">${r}</div>\n                ${this._renderFields(s)}\n              </div>\n            </div>\n\n            ${this._renderEditPanels()}\n\n            <div data-panel="delete" class="uploader__panel ${"delete"===o?"uploader__panel--show":""}">\n              <div class="uploader__body">\n                <p class="uploader__filename">Delete this file?</p>\n              </div>\n              <div class="uploader__actions">\n                <button class="uploader__btn uploader__btn--delete" data-action="confirm-delete">Delete</button>\n                <button class="uploader__btn uploader__btn--secondary" data-action="cancel">Cancel</button>\n              </div>\n            </div>\n          `:""}\n        </div>\n      </div>\n    `,this._setupFileEventListeners()}_loadFieldData(){this.querySelectorAll("p-uploader-data").forEach(e=>{const t=e.getAttribute("key"),n=e.textContent.trim();t&&this._fieldData.set(t,n)})}_renderFields(e){if(!this._fieldSchema||0===this._fieldSchema.size)return"";let t="";return this._fieldSchema.forEach((n,a)=>{const r=this._fieldData.get(a)||"";t+=`\n        <div class="uploader__field">\n          <span class="uploader__field-label">${n.label}:</span>\n          <span class="uploader__field-value">${r||"<em>empty</em>"}</span>\n          ${e?`<button class="uploader__field-edit" data-action="edit-field" data-field="${a}" title="Edit ${n.label}">✎</button>`:""}\n        </div>\n      `}),t}_renderEditPanels(){if(!this._fieldSchema||0===this._fieldSchema.size)return"";const e=this.getAttribute("data-current-panel")||"info";let t="";return this._fieldSchema.forEach((n,a)=>{const r=this._fieldData.get(a)||"";t+=`\n        <div data-panel="edit-${a}" class="uploader__panel ${e===`edit-${a}`?"uploader__panel--show":""}">\n          <div class="uploader__body">\n            ${"textarea"===n.type?`<textarea class="uploader__textarea" name="${a}" placeholder="${n.label}" rows="3">${r}</textarea>`:`<input type="${n.type}" class="uploader__input" name="${a}" placeholder="${n.label}" value="${r}">`}\n          </div>\n          <div class="uploader__actions">\n            <button class="uploader__btn uploader__btn--primary" data-action="confirm-edit" data-field="${a}">Save</button>\n            <button class="uploader__btn uploader__btn--secondary" data-action="cancel">Cancel</button>\n          </div>\n        </div>\n      `}),t}_setupFileEventListeners(){this.shadowRoot.removeEventListener("click",this._clickHandler),this._clickHandler=e=>{const t=e.target.dataset.action;if(!t)return;const n={"edit-field":()=>this._setPanel(`edit-${e.target.dataset.field}`),"show-delete":()=>this._setPanel("delete"),cancel:()=>this._setPanel("info"),"confirm-edit":()=>this._handleConfirmEdit(e.target.dataset.field),"confirm-delete":()=>this._handleConfirmDelete()};n[t]?.()},this.shadowRoot.addEventListener("click",this._clickHandler)}_setPanel(e){this.setAttribute("data-current-panel",e),this._notifyDraggableStateChange()}_notifyDraggableStateChange(){const e=this.closest("p-uploader");e&&e._updateDraggableState&&e._updateDraggableState()}async _handleConfirmEdit(e){const t=this.shadowRoot.querySelector(`[name="${e}"]`);if(t){const n=t.value,a=this._fieldData.get(e)||"";this._fieldData.set(e,n);let r=this.querySelector(`p-uploader-data[key="${e}"]`);r||(r=document.createElement("p-uploader-data"),r.setAttribute("key",e),this.appendChild(r));const s=r.textContent;r.textContent=n;const o=this.closest("p-uploader");if(o&&o.config.updateUrl)try{const t=await fetch(o.config.updateUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:this.getAttribute("file-id"),field:e,value:n})});if(t.ok)this.dispatchEvent(new CustomEvent("file:update",{detail:{fileId:this.getAttribute("file-id"),field:e,value:n},bubbles:!0,composed:!0})),this.setAttribute("data-current-panel","info"),this._notifyDraggableStateChange();else{this._fieldData.set(e,a),r.textContent=s;const n=await t.text();o.logger&&o.logger.error("Failed to update field:",n),this.setAttribute("error",`Update failed: ${n||"Server error"}`),this.setAttribute("data-current-panel","error")}}catch(t){this._fieldData.set(e,a),r.textContent=s,o.logger&&o.logger.error("Failed to update field:",t),this.setAttribute("error",`Update failed: ${t.message||"Network error"}`),this.setAttribute("data-current-panel","error")}else this.setAttribute("data-current-panel","info"),this._notifyDraggableStateChange()}}async _handleConfirmDelete(){const e=this.closest("p-uploader"),t=this.getAttribute("file-id");if(e&&e.config.deleteUrl)try{const n=await fetch(e.config.deleteUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t})});if(n.ok)this._removeFile(),this.dispatchEvent(new CustomEvent("file:delete",{detail:{fileId:t},bubbles:!0,composed:!0}));else{const t=await n.text();e.logger&&e.logger.error("Failed to delete file:",t),this.setAttribute("error",`Delete failed: ${t||"Server error"}`),this.setAttribute("data-current-panel","error")}}catch(t){e.logger&&e.logger.error("Failed to delete file:",t),this.setAttribute("error",`Delete failed: ${t.message||"Network error"}`),this.setAttribute("data-current-panel","error")}else this._removeFile()}_removeFile(){const e=this.closest("p-uploader"),t=this.getAttribute("file-id");e&&t&&e.files.has(t)&&e.files.delete(t),this.remove(),e&&e._updateDraggableState&&e._updateDraggableState()}}class _ extends HTMLElement{}class w extends HTMLElement{}class E extends HTMLElement{}function S(e){return e.replace(/-([a-z])/g,e=>e[1].toUpperCase())}function C(e=document){return Array.from(e.querySelectorAll(["a[href]","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"]):not([disabled])'].join(",")))}customElements.get("p-uploader")||customElements.define("p-uploader",b),customElements.get("p-uploader-file")||customElements.define("p-uploader-file",y),customElements.get("p-uploader-fields")||customElements.define("p-uploader-fields",_),customElements.get("p-uploader-field")||customElements.define("p-uploader-field",w),customElements.get("p-uploader-data")||customElements.define("p-uploader-data",E);class x{constructor({eventBus:e,logger:t,router:n}){this.eventBus=e,this.logger=t,this.router=n,this.elements=new WeakMap,this.states=this.elements,this._keys=null}mount(e){if(this.elements.has(e))return this.update(e);const t=this._init(e);this.elements.set(e,t)}update(e){}unmount(e){const t=this.elements.get(e);if(t)try{t.cleanup?.()}finally{this.elements.delete(e)}}destroy(){for(const e of this._elementsKeys())this.unmount(e)}_elementsKeys(){return this._keys||(this._keys=new Set),this._keys}_track(e){this._keys||(this._keys=new Set),this._keys.add(e)}_untrack(e){this._keys?.delete(e)}_init(e){const t=new AbortController;return this._track(e),{cleanup:()=>{t.abort(),this._untrack(e)},controller:t}}getState(e){return this.elements.get(e)}_getDataAttr(e,t,n){return function(e,t,n){const a=t.includes("-")?S(t):t,r=e.dataset[a];return void 0===r?n:"true"===r||"false"!==r&&(isNaN(r)||""===r?r:Number(r))}(e,t,n)}_camelCase(e){return S(e)}_debounce(e,t=300){return function(e,t=300){let n;return function(...a){clearTimeout(n),n=setTimeout(()=>{clearTimeout(n),e.apply(this,a)},t)}}(e,t)}_throttle(e,t=100){return function(e,t=100){let n;return function(...a){n||(e.apply(this,a),n=!0,setTimeout(()=>{n=!1},t))}}(e,t)}_delay(e){return function(e){return new Promise(t=>setTimeout(t,e))}(e)}_getTargetElement(e,t,n={}){const a=`${t}-view`,r=this._getDataAttr(e,a);if(r){const t=document.querySelector(`[data-view="${r}"]`);return!t&&n.required&&this.logger?.warn(`Target element with data-view="${r}" not found`,{viewName:r,element:e,attribute:a}),t}const s=this._getDataAttr(e,t);if(!s)return n.required&&this.logger?.warn(`No ${t} or ${a} attribute found`,e),null;const o=document.querySelector(s);return!o&&n.required&&this.logger?.warn("Target element not found",{selector:s,element:e}),o}_getConfigFromAttrs(e,t){const n={};for(const[a,r]of Object.entries(t)){const t=this.constructor.defaults?.[a];n[a]=this._getDataAttr(e,r,t)}return n}_requireState(e,t="method"){const n=this.getState(e);return n||this.logger?.warn(`${t}: No state found for element`,e),n}_generateId(e="elem"){return function(e="elem"){return`${e}-${Date.now()}-${Math.random().toString(36).slice(2,9)}`}(e)}async _waitForTransition(e,t=2e3){return async function(e,t=2e3){return new Promise(n=>{const a=()=>{e.removeEventListener("animationend",a),e.removeEventListener("transitionend",a),n()};e.addEventListener("animationend",a,{once:!0}),e.addEventListener("transitionend",a,{once:!0}),setTimeout(()=>{e.removeEventListener("animationend",a),e.removeEventListener("transitionend",a),n()},t)})}(e,t)}async _fadeIn(e,t=300){return async function(e,t=300){return e.style.opacity="0",e.style.transition=`opacity ${t}ms ease-in-out`,e.offsetHeight,e.style.opacity="1",new Promise(n=>{setTimeout(()=>{e.style.transition="",n()},t)})}(e,t)}async _fadeOut(e,t=300){return async function(e,t=300){return e.style.opacity="1",e.style.transition=`opacity ${t}ms ease-in-out`,e.offsetHeight,e.style.opacity="0",new Promise(n=>{setTimeout(()=>{e.style.transition="",n()},t)})}(e,t)}_getFocusableElements(e=document){return C(e)}_trapFocus(e,t){return function(e,t){const n=C(e);if(!n.length)return;const a=n[0],r=n[n.length-1],s=e.contains(document.activeElement)?document.activeElement:null;!t.shiftKey||s!==a&&s?t.shiftKey||s!==r||(a.focus(),t.preventDefault()):(r.focus(),t.preventDefault())}(e,t)}_restoreFocus(e){return function(e){e&&"function"==typeof e.focus&&requestAnimationFrame(()=>e.focus())}(e)}_createElement(e,t={},n=""){return function(e,t={},n=""){const a=document.createElement(e);for(const[e,n]of Object.entries(t))"className"===e||"class"===e?a.className=n:"style"===e&&"object"==typeof n?Object.assign(a.style,n):"dataset"===e&&"object"==typeof n?Object.assign(a.dataset,n):a.setAttribute(e,n);return"string"==typeof n?a.textContent=n:n instanceof HTMLElement&&a.appendChild(n),a}(e,t,n)}_dispatch(e,t,n){const a=new CustomEvent(t,{detail:n,bubbles:!0,cancelable:!0});return e.dispatchEvent(a),this.eventBus?.emit(t,{element:e,...n}),a}}class L extends x{static get defaults(){return{size:"md",closable:!0,backdropClose:!0,keyboard:!0,focus:!0,multiple:!1,appendTo:"body"}}_init(e){const t=super._init(e),n=this._getDataAttr(e,"modal-target"),a=this._getDataAttr(e,"modal-size",L.defaults.size),r=this._getDataAttr(e,"modal-closable",L.defaults.closable),s=this._getDataAttr(e,"modal-backdrop-close",L.defaults.backdropClose),o=this._getDataAttr(e,"modal-keyboard",L.defaults.keyboard),i=this._getDataAttr(e,"modal-focus",L.defaults.focus),l=this._getDataAttr(e,"modal-multiple",L.defaults.multiple);if(!n)return this.logger?.warn("Modal: No data-modal-target attribute found",e),t;let d=document.querySelector(n);return d?"p-modal"!==d.tagName.toLowerCase()?(this.logger?.warn("Modal: Target is not an p-modal element",{target:n,element:e}),t):(this._configureModal(d,{size:a,closable:r,backdropClose:s,keyboard:o}),t.target=n,t.modalElement=d,t.size=a,t.closable=r,t.backdropClose=s,t.keyboard=o,t.focus=i,t.multiple=l,e.addEventListener("click",this._handleTriggerClick.bind(this,e),{signal:t.controller.signal}),d.addEventListener("modal:open",this._handleModalOpen.bind(this,e),{signal:t.controller.signal}),d.addEventListener("modal:close",this._handleModalClose.bind(this,e),{signal:t.controller.signal}),e.setAttribute("aria-haspopup","dialog"),e.setAttribute("aria-expanded","false"),e.getAttribute("aria-controls")||e.setAttribute("aria-controls",n.replace("#","")),this.logger?.info("Modal trigger initialized",{element:e,target:n,size:a,closable:r}),t):(this.logger?.warn("Modal: Target modal not found",{target:n,element:e}),t)}open(e){const t=this.getState(e);t?.modalElement&&(t.multiple||this._closeOtherModals(t.modalElement),t.modalElement._triggerElement=e,"function"==typeof t.modalElement.open?t.modalElement.open():customElements.whenDefined("p-modal").then(()=>{"function"==typeof t.modalElement.open?t.modalElement.open():this.logger?.error("PModal open method not available",t.modalElement)}))}close(e){const t=this.getState(e);t?.modalElement&&("function"==typeof t.modalElement.close?t.modalElement.close():this.logger?.error("PModal close method not available",t.modalElement))}toggle(e,t){const n=this.getState(e);n?.modalElement&&(!0===t?this.open(e):!1===t||n.modalElement.hasAttribute("open")?this.close(e):this.open(e))}isOpen(e){const t=this.getState(e);return t?.modalElement?.hasAttribute("open")||!1}_configureModal(e,t){t.size&&e.setAttribute("data-modal-size",t.size),void 0!==t.closable&&e.setAttribute("data-modal-closable",String(t.closable)),void 0!==t.backdropClose&&e.setAttribute("data-modal-backdrop-close",String(t.backdropClose)),void 0!==t.keyboard&&e.setAttribute("data-modal-keyboard",String(t.keyboard))}_handleTriggerClick(e,t){t.preventDefault(),this.open(e)}_handleModalOpen(e,t){e.setAttribute("aria-expanded","true"),this._dispatch(e,"modal:opened",{trigger:e,modal:t.detail.modal}),this.eventBus?.emit("modal:opened",{trigger:e,modal:t.detail.modal}),this.logger?.info("Modal opened",{triggerElement:e,modal:t.detail.modal})}_handleModalClose(e,t){e.setAttribute("aria-expanded","false");const n=this.getState(e);n?.focus&&t.detail.modal._triggerElement&&requestAnimationFrame(()=>{t.detail.modal._triggerElement.focus()}),this._dispatch(e,"modal:closed",{trigger:e,modal:t.detail.modal}),this.eventBus?.emit("modal:closed",{trigger:e,modal:t.detail.modal}),this.logger?.info("Modal closed",{triggerElement:e,modal:t.detail.modal})}_closeOtherModals(e){document.querySelectorAll("p-modal[open]").forEach(t=>{t!==e&&t.close()})}updateConfig(e,t){const n=this.getState(e);n?.modalElement&&(Object.assign(n,t),this._configureModal(n.modalElement,t),this.logger?.info("Modal configuration updated",{triggerElement:e,newConfig:t}))}static enhanceAll(e="[data-modal][data-modal-target]",t){const n=new L(t);return document.querySelectorAll(e).forEach(e=>{n.mount(e)}),n}static async create({title:e,content:t,actions:n=[],size:a="medium",options:s={}}){const o=document.createElement("p-modal");if(o.id=r("modal"),o.setAttribute("data-modal-size",a),Object.entries(s).forEach(([e,t])=>{o.setAttribute(`data-modal-${e}`,String(t))}),e){const t=l("h2",{slot:"title"},e);o.appendChild(t)}if(t){const e=document.createElement("div");e.innerHTML=t,o.appendChild(e)}if(n.length>0){const e=document.createElement("div");e.slot="actions",n.forEach(t=>{const n=l("button",{className:`btn btn--${t.type||"secondary"}`,"data-modal-close":!1!==t.close?"":void 0},t.label);t.onClick&&n.addEventListener("click",t.onClick),e.appendChild(n)}),o.appendChild(e)}document.body.appendChild(o)}}class A extends x{static get defaults(){return{defaultDuration:4e3,defaultType:"info",fadeOutDuration:300,typeMapping:{info:"info",success:"success",warn:"warning",warning:"warning",error:"error",danger:"error"}}}_init(e){const t=super._init(e),n=this._getDataAttr(e,"toast-message"),a=this._getDataAttr(e,"toast-trigger",A.defaults.defaultType),r=parseInt(this._getDataAttr(e,"toast-duration",A.defaults.defaultDuration)),s=this._getDataAttr(e,"toast-title"),o="false"!==this._getDataAttr(e,"toast-dismissible","true");if(!e.hasAttribute("data-toast-trigger"))return this.logger?.warn("Toast component mounted on element without data-toast-trigger attribute",e),t;if(!n)return this.logger?.warn("Toast trigger missing data-toast-message attribute",e),t;t.message=n,t.type=a,t.duration=r,t.title=s,t.dismissible=o;const i=t=>this._handleClick(t,e);e.addEventListener("click",i),e.setAttribute("data-toast-enhanced","true"),e.classList.add("toast-trigger--enhanced");const l=t.cleanup;return t.cleanup=()=>{e.removeEventListener("click",i),e.removeAttribute("data-toast-enhanced"),e.classList.remove("toast-trigger--enhanced"),l()},this.eventBus?.emit("toast:mount",{element:e,message:n,type:a,timestamp:performance.now()}),this.logger?.debug("Toast trigger initialized",{element:e,message:n,type:a,duration:r}),t}_handleClick(e,t){e.preventDefault();const n=this.getState(t);if(!n)return void this.logger?.warn("Toast trigger clicked but no state found",t);const a=A.defaults.typeMapping[n.type]||n.type;this._showToast({message:n.message,type:a,duration:n.duration,title:n.title,dismissible:n.dismissible,trigger:t})}_showToast(e){const{message:t,type:n=A.defaults.defaultType,duration:a=A.defaults.defaultDuration,title:r,dismissible:s=!0,trigger:o}=e;try{if(window.alertManager&&"function"==typeof window.alertManager.show)window.alertManager.show({message:t,type:n,duration:a,title:r,dismissible:s});else{const e=document.querySelector("p-toasts");e&&"function"==typeof e.toast?e.toast({message:t,type:n,duration:a,title:r,dismissible:s}):(this.logger?.warn("No toast system available, falling back to alert"),alert(`${n.toUpperCase()}: ${r?r+"\n":""}${t}`))}this._dispatch(o,"toast:shown",{message:t,type:n,duration:a,title:r}),this.eventBus?.emit("toast:show",{message:t,type:n,duration:a,title:r,trigger:o,timestamp:performance.now()}),this.logger?.info("Toast shown",{message:t,type:n,duration:a,title:r})}catch(a){this.logger?.error("Failed to show toast",a),this._dispatch(o,"toast:error",{error:a.message,message:t,type:n}),this.eventBus?.emit("toast:error",{error:a.message,options:e,trigger:o,timestamp:performance.now()}),alert(`${n.toUpperCase()}: ${r?r+"\n":""}${t}`)}}static show(e,t="info",n={}){(new A)._showToast({message:e,type:t,...n})}getStatus(){return{mountedTriggers:document.querySelectorAll('[data-toast-enhanced="true"]').length,availableTypes:Object.keys(A.defaults.typeMapping),alertManagerAvailable:!(!window.alertManager||"function"!=typeof window.alertManager.show),xToastsAvailable:!!document.querySelector("p-toasts"),defaults:A.defaults}}static enhanceAll(e="[data-toast-trigger][data-toast-message]",t){const n=new A(t);return document.querySelectorAll(e).forEach(e=>{n.mount(e)}),n}}class T extends x{static get defaults(){return{threshold:.1,rootMargin:"50px",loadingClass:"loading",loadedClass:"loaded",errorClass:"error",fadeInDuration:300,retryAttempts:3,retryDelay:1e3,useNativeLoading:!1}}constructor(e={}){super(e),this._createObserver(),this.loadingAttempts=new Map}_createObserver(){const e={root:null,rootMargin:T.defaults.rootMargin,threshold:T.defaults.threshold};this.observer=new IntersectionObserver(this._handleIntersection.bind(this),e),this.logger?.info("Lazysrc intersection observer created",e)}async _init(e){const t=super._init(e),n=this._getConfiguration(e);t.config=n,t.isLoaded=!1,t.isLoading=!1,t.hasError=!1,(n.useNativeLoading||e.hasAttribute("loading"))&&this._supportsNativeLoading()&&this._isImage(e)?this._setupNativeLoading(e,t):this._setupIntersectionLoading(e,t);const a=t.cleanup;return t.cleanup=()=>{this.observer.unobserve(e),this.loadingAttempts.delete(e),a()},this._dispatch(e,"lazysrc:mounted",{element:e,config:n,timestamp:performance.now()}),this.logger?.info("Lazysrc initialized",{element:e,threshold:n.threshold,useNative:n.useNativeLoading}),t}_getConfiguration(e){const t={...T.defaults};return e.dataset.lazysrcThreshold&&(t.threshold=parseFloat(e.dataset.lazysrcThreshold)),e.dataset.lazysrcRootMargin&&(t.rootMargin=e.dataset.lazysrcRootMargin),e.dataset.lazysrcLoadingClass&&(t.loadingClass=e.dataset.lazysrcLoadingClass),e.dataset.lazysrcLoadedClass&&(t.loadedClass=e.dataset.lazysrcLoadedClass),e.dataset.lazysrcErrorClass&&(t.errorClass=e.dataset.lazysrcErrorClass),e.dataset.lazysrcFadeDuration&&(t.fadeInDuration=parseInt(e.dataset.lazysrcFadeDuration,10)),e.dataset.lazysrcRetryAttempts&&(t.retryAttempts=parseInt(e.dataset.lazysrcRetryAttempts,10)),e.dataset.lazysrcRetryDelay&&(t.retryDelay=parseInt(e.dataset.lazysrcRetryDelay,10)),void 0!==e.dataset.lazysrcUseNative&&(t.useNativeLoading="false"!==e.dataset.lazysrcUseNative),t}_supportsNativeLoading(){return"loading"in HTMLImageElement.prototype}_isImage(e){return"IMG"===e.tagName}_setupNativeLoading(e,t){this._isImage(e)&&(e.hasAttribute("loading")||(e.loading="lazy"),this._applySources(e,t),e.addEventListener("load",()=>{this._onElementLoaded(e,t)}),e.addEventListener("error",()=>{this._onElementError(e,t)}))}_setupIntersectionLoading(e,t){this.logger?.info("Setting up intersection loading for element",{element:e,state:t}),this._storeAndClearSources(e,t),t.config.threshold!==T.defaults.threshold||t.config.rootMargin!==T.defaults.rootMargin?(this.logger?.info("Creating custom observer for element",{threshold:t.config.threshold,rootMargin:t.config.rootMargin}),t.customObserver=new IntersectionObserver(this._handleIntersection.bind(this),{root:null,rootMargin:t.config.rootMargin,threshold:t.config.threshold}),t.customObserver.observe(e),this.logger?.info("Element added to custom observer",{element:e})):(this.logger?.info("Adding element to default observer",{element:e}),this.observer.observe(e),this.logger?.info("Element added to default observer",{element:e}))}_storeAndClearSources(e,t){if("IMG"===e.tagName)e.src&&!e.dataset.lazysrcSrc&&(t.originalSrc=e.src,e.removeAttribute("src")),e.srcset&&!e.dataset.lazysrcSrcset&&(t.originalSrcset=e.srcset,e.removeAttribute("srcset")),e.sizes&&!e.dataset.lazysrcSizes&&(t.originalSizes=e.sizes);else if("PICTURE"===e.tagName){const n=e.querySelectorAll("source");t.originalSources=[],n.forEach((e,n)=>{e.srcset&&!e.dataset.lazysrcSrcset&&(t.originalSources[n]={srcset:e.srcset,sizes:e.sizes||null},e.removeAttribute("srcset"))});const a=e.querySelector("img");a&&(a.src&&!a.dataset.lazysrcSrc&&(t.originalSrc=a.src,a.removeAttribute("src")),a.srcset&&!a.dataset.lazysrcSrcset&&(t.originalSrcset=a.srcset,a.removeAttribute("srcset")))}}async _handleIntersection(e){this.logger?.info("Intersection handler called",{entriesCount:e.length});for(const t of e)if(this.logger?.info("Processing intersection entry",{isIntersecting:t.isIntersecting,element:t.target,intersectionRatio:t.intersectionRatio}),t.isIntersecting){const e=t.target,n=this.getState(e),a=n instanceof Promise?await n:n;this.logger?.debug("State structure debug:",{wasPromise:n instanceof Promise,hasState:!!a,stateKeys:a?Object.keys(a):null,hasConfig:!!a?.config,fullState:a}),this.logger?.info("Resolved state for intersecting element",{hasState:!!a,isLoaded:a?.isLoaded,isLoading:a?.isLoading}),!a||a.isLoaded||a.isLoading||(this.logger?.info("Calling _loadElement for element",{element:e}),await this._loadElement(e,a))}}async _loadElement(e,t){if(this.logger?.debug("_loadElement called with:",{element:e,componentState:t,componentStateKeys:t?Object.keys(t):null,hasConfig:!(!t||!t.config),configKeys:t?.config?Object.keys(t.config):null}),t)if(t.config){if(!t.isLoading&&!t.isLoaded){t.isLoading=!0,t.loadStartTime=performance.now(),e.classList.add(t.config.loadingClass),this._dispatch(e,"lazysrc:loading-start",{element:e,timestamp:performance.now()});try{e.dataset.lazysrcBg?await this._loadBackgroundImage(e,t):"PICTURE"===e.tagName?await this._loadPictureElement(e,t):this._isImage(e)?await this._loadImageElement(e,t):await this._loadBackgroundImage(e,t),this._onElementLoaded(e,t)}catch(n){this._onElementError(e,t,n)}}}else this.logger?.error("Missing config for element",{element:e,componentState:t,componentStateKeys:Object.keys(t)});else this.logger?.error("Invalid state for element",{element:e,componentState:t})}_loadImageElement(e,t){return new Promise((n,a)=>{const r=new Image;r.onload=()=>{this._applySources(e,t),n()},r.onerror=()=>{a(new Error("Image failed to load"))};const s=e.dataset.lazysrcSrc||t.originalSrc,o=e.dataset.lazysrcSrcset||t.originalSrcset,i=e.dataset.lazysrcSizes||t.originalSizes;if(o&&(r.srcset=o,i&&(r.sizes=i)),s)r.src=s;else if(!o)return void a(new Error("No src or srcset specified"))})}_loadPictureElement(e,t){return new Promise((n,a)=>{const r=e.querySelector("img");r?(r.onload=()=>{this._applyPictureSources(e,t),n()},r.onerror=()=>{a(new Error("Picture failed to load"))},this._applyPictureSources(e,t)):a(new Error("No img element found in picture"))})}_loadBackgroundImage(e,t){return new Promise((t,n)=>{const a=e.dataset.lazysrcBg;if(!a)return void n(new Error("No background image URL specified"));const r=new Image;r.onload=()=>{e.style.backgroundImage=`url("${a}")`,t()},r.onerror=()=>{n(new Error("Background image failed to load"))},r.src=a})}_applySources(e,t){e.dataset.lazysrcSrcset?e.srcset=e.dataset.lazysrcSrcset:t.originalSrcset&&(e.srcset=t.originalSrcset),e.dataset.lazysrcSizes?e.sizes=e.dataset.lazysrcSizes:t.originalSizes&&(e.sizes=t.originalSizes),e.dataset.lazysrcSrc?e.src=e.dataset.lazysrcSrc:t.originalSrc&&(e.src=t.originalSrc)}_applyPictureSources(e,t){e.querySelectorAll("source").forEach((e,n)=>{e.dataset.lazysrcSrcset?e.srcset=e.dataset.lazysrcSrcset:t.originalSources&&t.originalSources[n]&&(e.srcset=t.originalSources[n].srcset,t.originalSources[n].sizes&&(e.sizes=t.originalSources[n].sizes))});const n=e.querySelector("img");n&&this._applySources(n,t)}_onElementLoaded(e,t){t.isLoading=!1,t.isLoaded=!0,t.hasError=!1;const n=t.loadStartTime?performance.now()-t.loadStartTime:0;e.classList.remove(t.config.loadingClass),e.classList.add(t.config.loadedClass),e.setAttribute("data-lazysrc-complete","true"),t.config.fadeInDuration>0&&this._applyFadeInEffect(e,t.config.fadeInDuration),this.observer.unobserve(e),t.customObserver&&t.customObserver.unobserve(e),this.loadingAttempts.delete(e),this._dispatch(e,"lazysrc:loaded",{element:e,timestamp:performance.now(),loadTime:Math.round(n)}),this.logger?.debug("Element loaded successfully",{element:e,loadTime:n}),!1!==t.config.autoDetach&&setTimeout(()=>{this._detachElement(e,t)},100)}_onElementError(e,t,n){t.isLoading=!1,t.hasError=!0,e.classList.remove(t.config.loadingClass),e.classList.add(t.config.errorClass);const a=this.loadingAttempts.get(e)||0;if(a<t.config.retryAttempts)return this.loadingAttempts.set(e,a+1),setTimeout(()=>{t.isLoading=!1,t.hasError=!1,e.classList.remove(t.config.errorClass),this._loadElement(e,t)},t.config.retryDelay*(a+1)),void this.logger?.info(`Retrying load for element (attempt ${a+1}/${t.config.retryAttempts})`,{element:e});this._dispatch(e,"lazysrc:error",{element:e,error:n?.message||"Load failed",timestamp:performance.now()}),this.logger?.warn("Element failed to load after retries",{element:e,error:n})}_applyFadeInEffect(e,t){e.style.opacity="0",e.style.transition=`opacity ${t}ms ease-in-out`,e.offsetHeight,e.style.opacity="1",setTimeout(()=>{e.style.transition=""},t)}async loadElement(e){const t=this.getState(e),n=t instanceof Promise?await t:t;!n||n.isLoaded||n.isLoading||await this._loadElement(e,n)}async loadAll(e=document){const t=e.querySelectorAll('[data-lazysrc-enhanced="true"]');for(const e of t){const t=this.getState(e),n=t instanceof Promise?await t:t;!n||n.isLoaded||n.isLoading||await this._loadElement(e,n)}}update(e=document){e.querySelectorAll('[data-lazysrc]:not([data-lazysrc-enhanced="true"])').forEach(e=>{this.mount(e)})}async isLoaded(e){const t=this.getState(e),n=t instanceof Promise?await t:t;return!!n&&n.isLoaded}async isLoading(e){const t=this.getState(e),n=t instanceof Promise?await t:t;return!!n&&n.isLoading}async hasError(e){const t=this.getState(e),n=t instanceof Promise?await t:t;return!!n&&n.hasError}getStatus(){const e=document.querySelectorAll('[data-lazysrc-enhanced="true"]');let t=0,n=0,a=0;return e.forEach(e=>{this.isLoaded(e)&&t++,this.isLoading(e)&&n++,this.hasError(e)&&a++}),{totalElements:e.length,loadedCount:t,loadingCount:n,errorCount:a,observerActive:!!this.observer,supportsNative:this._supportsNativeLoading(),defaults:T.defaults}}_detachElement(e,t){t.isLoaded&&(t.customObserver&&(t.customObserver.disconnect(),t.customObserver=null),this._dispatch(e,"lazysrc:detached",{element:e,timestamp:performance.now()}),this.logger?.debug("Element detached after loading",{element:e}))}destroy(){this.observer&&(this.observer.disconnect(),this.observer=null),this.loadingAttempts.clear(),super.destroy(),this.logger?.info("Lazysrc destroyed")}static enhanceAll(e="[data-lazysrc]",t){const n=new T(t);return document.querySelectorAll(e).forEach(e=>{n.mount(e)}),n}}class k extends x{static get defaults(){return{openClass:"open",transitioningClass:"transitioning",transitionDuration:750,capture:!1,manual:!1,multiple:!1,animateToggle:!0,closeOnEscape:!0,closeOnNavigation:!0}}_init(e){const t=super._init(e),n=this._getDataAttr(e,"toggle-target");if(!n)return this.logger?.warn("Toggle: No data-toggle-target attribute found",e),t;const a=document.querySelector(n);if(!a)return this.logger?.warn("Toggle: Target element not found",{selector:n,element:e}),t;const r=this._getDataAttr(e,"toggle-capture",k.defaults.capture),s=a.hasAttribute("data-toggle-manual")||this._getDataAttr(e,"toggle-manual",k.defaults.manual),o=this._getDataAttr(e,"toggle-multiple",k.defaults.multiple),i=this._getDataAttr(e,"toggle-animate",k.defaults.animateToggle),l=this._getDataAttr(e,"toggle-close-navigation",k.defaults.closeOnNavigation);t.target=a,t.targetSelector=n,t.capture=r,t.manual=s,t.multiple=o,t.animateToggle=i,t.closeOnNavigation=l,t.isOpen=a.classList.contains(k.defaults.openClass),t.transitionTimer=null;const d=n=>this._handleClick(n,e,t);if(e.addEventListener("click",d),e.setAttribute("data-toggle-enhanced","true"),e.setAttribute("aria-expanded",String(t.isOpen)),e.getAttribute("aria-controls")||e.setAttribute("aria-controls",n.replace("#","")),k.defaults.closeOnEscape){const n=n=>this._handleEscape(n,e,t);document.addEventListener("keydown",n),t.escapeHandler=n}const c=t.cleanup;return t.cleanup=()=>{e.removeEventListener("click",d),t.escapeHandler&&document.removeEventListener("keydown",t.escapeHandler),this._clearTransitionTimer(t),this._removeGlobalListeners(t),c()},this.eventBus?.emit("toggle:mount",{element:e,target:a,isOpen:t.isOpen,timestamp:performance.now()}),this.logger?.info("Toggle initialized",{element:e,target:n,capture:r,manual:s,isOpen:t.isOpen}),t}_handleClick(e,t,n){e.preventDefault(),e.stopPropagation(),this.toggle(t)}_handleEscape(e,t,n){"Escape"===e.key&&n.isOpen&&!n.manual&&this.hide(t)}toggle(e){const t=this.getState(e);if(!t)return;t.target.classList.contains(k.defaults.openClass)?this.hide(e):this.show(e)}show(e){const t=this.getState(e);if(!t)return;t.target.classList.contains(k.defaults.openClass)||(t.multiple||this._closeOtherToggles(e),t.isOpen=!0,this._syncTriggerStates(t.targetSelector,!0),this._updateElementStates(e,t,!0),(t.capture||t.closeOnNavigation)&&this._setupGlobalListeners(e,t),t.animateToggle&&(t.target.classList.add(k.defaults.transitioningClass),t.transitionTimer=setTimeout(()=>{this._endTransition(t)},k.defaults.transitionDuration)),this._dispatch(e,"toggle:show",{target:t.target,trigger:e}),this.eventBus?.emit("toggle:show",{element:e,target:t.target,timestamp:performance.now()}),this.logger?.debug("Toggle shown",{element:e,target:t.targetSelector}))}hide(e){const t=this.getState(e);if(!t)return;t.target.classList.contains(k.defaults.openClass)&&(t.isOpen=!1,this._syncTriggerStates(t.targetSelector,!1),this._updateElementStates(e,t,!1),this._removeGlobalListeners(t),t.animateToggle&&(t.target.classList.add(k.defaults.transitioningClass),t.transitionTimer=setTimeout(()=>{this._endTransition(t)},k.defaults.transitionDuration)),this._dispatch(e,"toggle:hide",{target:t.target,trigger:e}),this.eventBus?.emit("toggle:hide",{element:e,target:t.target,timestamp:performance.now()}),this.logger?.debug("Toggle hidden",{element:e,target:t.targetSelector}))}hideAll(){document.querySelectorAll('[data-toggle-enhanced="true"]').forEach(e=>{const t=this.getState(e);t&&t.isOpen&&!t.manual&&this.hide(e)})}isOpen(e){const t=this.getState(e);return!!t&&t.isOpen}_updateElementStates(e,t,n){e.setAttribute("aria-expanded",String(n)),n?t.target.classList.add(k.defaults.openClass):t.target.classList.remove(k.defaults.openClass);document.querySelectorAll(`[data-toggle-target="${t.targetSelector}"]`).forEach(e=>{e.setAttribute("aria-expanded",String(n)),n?e.classList.add(k.defaults.openClass):e.classList.remove(k.defaults.openClass)})}_setupGlobalListeners(e,t){const n=n=>{t.closeOnNavigation&&!t.manual&&this._isNavigationLink(n.target)?this.hide(e):n.stopPropagation()},a=n=>{t.manual||e.contains(n.target)||t.target.contains(n.target)||this.hide(e)};t.target.addEventListener("click",n),document.addEventListener("click",a),t.targetClickHandler=n,t.documentClickHandler=a}_removeGlobalListeners(e){e.targetClickHandler&&(e.target.removeEventListener("click",e.targetClickHandler),e.targetClickHandler=null),e.documentClickHandler&&(document.removeEventListener("click",e.documentClickHandler),e.documentClickHandler=null)}_isNavigationLink(e){let t=e;for(;t&&t!==document.body;){if("A"===t.tagName){const e=t.getAttribute("href");if(e&&!e.startsWith("#")&&!e.startsWith("javascript:")&&!e.startsWith("mailto:")&&!e.startsWith("tel:")&&!t.hasAttribute("download")&&"_blank"!==t.getAttribute("target"))return!0;break}t=t.parentElement}return!1}_endTransition(e){e.target.classList.remove(k.defaults.transitioningClass),e.transitionTimer=null}_clearTransitionTimer(e){e.transitionTimer&&(clearTimeout(e.transitionTimer),e.transitionTimer=null)}_closeOtherToggles(e){document.querySelectorAll('[data-toggle-enhanced="true"]').forEach(t=>{if(t!==e){const e=this.getState(t);e&&e.isOpen&&!e.manual&&this.hide(t)}})}_syncTriggerStates(e,t){document.querySelectorAll(`[data-toggle-target="${e}"][data-toggle-enhanced="true"]`).forEach(e=>{const n=this.getState(e);n&&(n.isOpen=t)})}getStatus(){const e=document.querySelectorAll('[data-toggle-enhanced="true"]');let t=0,n=0,a=0;return e.forEach(e=>{const r=this.getState(e);r&&(r.isOpen&&t++,r.capture&&n++,r.manual&&a++)}),{totalTriggers:e.length,openCount:t,captureCount:n,manualCount:a,defaults:k.defaults}}static enhanceAll(e="[data-toggle]",t){const n=new k(t);return document.querySelectorAll(e).forEach(e=>{n.mount(e)}),n}}class M extends x{static get defaults(){return{autoplayDelay:5e3,loop:!0,showDots:!0,showArrows:!0,slideSelector:"[data-carousel-slide]",trackSelector:"[data-carousel-track]",swipeThreshold:50,transitionDuration:300,pauseOnHover:!0,keyboardNavigation:!0}}_init(e){const t=super._init(e),n=this._getDataAttr(e,"carousel-autoplay-delay",M.defaults.autoplayDelay),a=this._getDataAttr(e,"carousel-loop",M.defaults.loop),r=this._getDataAttr(e,"carousel-show-dots",M.defaults.showDots),s=this._getDataAttr(e,"carousel-show-arrows",M.defaults.showArrows),o=this._getDataAttr(e,"carousel-pause-on-hover",M.defaults.pauseOnHover),i=this._getDataAttr(e,"carousel-keyboard",M.defaults.keyboardNavigation),l=e.querySelector(M.defaults.trackSelector),d=e.querySelectorAll(M.defaults.slideSelector);return l&&0!==d.length?(t.currentSlide=0,t.totalSlides=d.length,t.autoplayDelay=n,t.loop=a,t.track=l,t.slides=Array.from(d),t.autoplayTimer=null,t.isPlaying=n>0,e.setAttribute("role","region"),e.setAttribute("aria-label","Carousel"),l.setAttribute("aria-live","polite"),d.forEach((e,t)=>{e.setAttribute("role","group"),e.setAttribute("aria-roledescription","slide"),e.setAttribute("aria-label",`${t+1} of ${d.length}`),e.setAttribute("aria-hidden",0===t?"false":"true")}),s&&this._createArrows(e,t),r&&this._createDots(e,t),this._setupEventListeners(e,t,{pauseOnHover:o,keyboardNavigation:i}),t.isPlaying&&this._startAutoplay(t),this._updateSlidePosition(e,t),this.logger?.info("Carousel initialized",{element:e,totalSlides:t.totalSlides,autoplayDelay:n,loop:a}),t):(this.logger?.warn("Carousel: No track or slides found",e),t)}goToSlide(e,t){const n=this.getState(e);if(!n)return;const a=this._validateSlideIndex(t,n);a!==n.currentSlide&&(n.currentSlide=a,this._updateSlidePosition(e,n),this._restartAutoplay(n),this._dispatch(e,"carousel:slide-change",{currentSlide:n.currentSlide,totalSlides:n.totalSlides}))}next(e){const t=this.getState(e);if(!t)return;let n=t.currentSlide+1;n>=t.totalSlides&&(n=t.loop?0:t.totalSlides-1),this.goToSlide(e,n)}previous(e){const t=this.getState(e);if(!t)return;let n=t.currentSlide-1;n<0&&(n=t.loop?t.totalSlides-1:0),this.goToSlide(e,n)}play(e){const t=this.getState(e);t&&(t.isPlaying=!0,this._startAutoplay(t),this._dispatch(e,"carousel:play",{}))}pause(e){const t=this.getState(e);t&&(t.isPlaying=!1,this._stopAutoplay(t),this._dispatch(e,"carousel:pause",{}))}_createArrows(e,t){const n=document.createElement("button");n.className="carousel__arrow carousel__arrow--prev",n.setAttribute("aria-label","Previous slide"),n.innerHTML="←";const a=document.createElement("button");a.className="carousel__arrow carousel__arrow--next",a.setAttribute("aria-label","Next slide"),a.innerHTML="→",e.appendChild(n),e.appendChild(a),t.prevButton=n,t.nextButton=a,n.addEventListener("click",()=>this.previous(e),{signal:t.controller.signal}),a.addEventListener("click",()=>this.next(e),{signal:t.controller.signal})}_createDots(e,t){const n=document.createElement("div");n.className="carousel__dots",n.setAttribute("role","tablist"),n.setAttribute("aria-label","Carousel navigation"),t.dots=[];for(let a=0;a<t.totalSlides;a++){const r=document.createElement("button");r.className="carousel__dot",r.setAttribute("role","tab"),r.setAttribute("aria-label",`Go to slide ${a+1}`),r.setAttribute("aria-controls",`slide-${a}`),0===a?(r.classList.add("active"),r.setAttribute("aria-selected","true")):r.setAttribute("aria-selected","false"),r.addEventListener("click",()=>this.goToSlide(e,a),{signal:t.controller.signal}),n.appendChild(r),t.dots.push(r)}e.appendChild(n),t.dotsContainer=n}_setupEventListeners(e,t,n){n.pauseOnHover&&(e.addEventListener("mouseenter",()=>this._stopAutoplay(t),{signal:t.controller.signal}),e.addEventListener("mouseleave",()=>{t.isPlaying&&this._startAutoplay(t)},{signal:t.controller.signal})),n.keyboardNavigation&&e.addEventListener("keydown",n=>{switch(n.key){case"ArrowLeft":n.preventDefault(),this.previous(e);break;case"ArrowRight":n.preventDefault(),this.next(e);break;case" ":n.preventDefault(),t.isPlaying?this.pause(e):this.play(e)}},{signal:t.controller.signal}),this._setupTouchEvents(e,t)}_setupTouchEvents(e,t){let n=0,a=0,r=!1;e.addEventListener("touchstart",e=>{const s=e.touches[0];n=s.clientX,a=s.clientY,r=!0,this._stopAutoplay(t)},{passive:!0,signal:t.controller.signal}),e.addEventListener("touchmove",e=>{if(!r)return;const t=e.touches[0],s=t.clientX-n,o=t.clientY-a;Math.abs(s)>Math.abs(o)&&e.preventDefault()},{passive:!1,signal:t.controller.signal}),e.addEventListener("touchend",a=>{if(!r)return;r=!1;const s=a.changedTouches[0].clientX-n;Math.abs(s)>M.defaults.swipeThreshold&&(s>0?this.previous(e):this.next(e)),t.isPlaying&&this._startAutoplay(t)},{passive:!0,signal:t.controller.signal})}_updateSlidePosition(e,t){t.slides.forEach((e,n)=>{e.setAttribute("aria-hidden",n===t.currentSlide?"false":"true"),n===t.currentSlide?e.classList.add("carousel__slide--active"):e.classList.remove("carousel__slide--active")});const n=-100*t.currentSlide;t.track.style.transform=`translateX(${n}%)`,t.dots&&t.dots.forEach((e,n)=>{const a=n===t.currentSlide;a?e.classList.add("carousel__dot--active"):e.classList.remove("carousel__dot--active"),e.setAttribute("aria-selected",a?"true":"false")}),t.prevButton&&t.nextButton&&!t.loop&&(t.prevButton.disabled=0===t.currentSlide,t.nextButton.disabled=t.currentSlide===t.totalSlides-1)}_startAutoplay(e){this._stopAutoplay(e),e.autoplayDelay>0&&(e.autoplayTimer=setTimeout(()=>{this.next(e.track.closest("[data-carousel]"))},e.autoplayDelay))}_stopAutoplay(e){e.autoplayTimer&&(clearTimeout(e.autoplayTimer),e.autoplayTimer=null)}_restartAutoplay(e){e.isPlaying&&this._startAutoplay(e)}_validateSlideIndex(e,t){return Math.max(0,Math.min(e,t.totalSlides-1))}unmount(e){const t=this.getState(e);t&&this._stopAutoplay(t),super.unmount(e)}static enhanceAll(e="[data-carousel]",t){const n=new M(t);return document.querySelectorAll(e).forEach(e=>{n.mount(e)}),n}}class D extends x{static get defaults(){return{scrollThreshold:50,overlayThreshold:100,scrolledClass:"scrollhide",overlayClass:"scrolloverlay",debounce:16,passive:!0}}_init(e){const t=super._init(e),n=this._getDataAttr(e,"scrollhide-target"),a=n?document.querySelector(n):e;if(!a)return this.logger?.warn("Scrollhide: Target element not found",{selector:n,element:e}),t;const r=this._getDataAttr(e,"scroll-threshold",D.defaults.scrollThreshold),s=this._getDataAttr(e,"overlay-threshold",D.defaults.overlayThreshold),o=this._getDataAttr(e,"scrolled-class",D.defaults.scrolledClass),i=this._getDataAttr(e,"overlay-class",D.defaults.overlayClass),l=this._getDataAttr(e,"debounce",D.defaults.debounce);t.target=a,t.targetSelector=n,t.scrollThreshold=parseInt(r,10),t.overlayThreshold=parseInt(s,10),t.scrolledClass=o,t.overlayClass=i,t.currentY=0,t.lastY=0,t.ticking=!1;const d=this._createScrollHandler(e,t),c=this._throttle(d,l);window.addEventListener("scroll",c,{passive:D.defaults.passive}),t.scrollHandler=c;const u=t.cleanup;return t.cleanup=()=>{window.removeEventListener("scroll",t.scrollHandler),t.animationFrame&&cancelAnimationFrame(t.animationFrame),u()},this._updateElementState(e,t),e.setAttribute("data-scrollhide-enhanced","true"),this.eventBus?.emit("scrollhide:mount",{element:e,target:a,scrollThreshold:t.scrollThreshold,overlayThreshold:t.overlayThreshold,timestamp:performance.now()}),this.logger?.info("Scrollhide initialized",{element:e,target:n||"self",scrollThreshold:t.scrollThreshold,overlayThreshold:t.overlayThreshold}),t}_createScrollHandler(e,t){return()=>{t.ticking||(t.animationFrame=requestAnimationFrame(()=>{this._onScroll(e,t),t.ticking=!1}),t.ticking=!0)}}_onScroll(e,t){t.currentY=window.scrollY,this._updateElementState(e,t),t.lastY=t.currentY}_updateElementState(e,t){const{target:n,currentY:a,lastY:r,scrollThreshold:s,overlayThreshold:o,scrolledClass:i,overlayClass:l}=t,d=n.classList.contains(l);a>o&&!d?(n.classList.add(l),this._emitStateChange(e,"overlay-added",{scrollY:a})):a<=o&&d&&(n.classList.remove(l),this._emitStateChange(e,"overlay-removed",{scrollY:a}));const c=n.classList.contains(i);a<=0?c&&(n.classList.remove(i),this._emitStateChange(e,"shown",{scrollY:a,reason:"top"})):a>s&&a>r&&!c?(n.classList.add(i),this._emitStateChange(e,"hidden",{scrollY:a,reason:"scroll-down"})):a<r&&c&&(n.classList.remove(i),this._emitStateChange(e,"shown",{scrollY:a,reason:"scroll-up"}))}_emitStateChange(e,t,n){const a=this.getState(e);this._dispatch(e,`scrollhide:${t}`,{target:a.target,...n}),this.eventBus?.emit(`scrollhide:${t}`,{element:e,target:a.target,timestamp:performance.now(),...n}),this.logger?.debug(`Scrollhide ${t}`,{element:e,target:a.targetSelector||"self",...n})}show(e){const t=this.getState(e);t&&(t.target.classList.remove(t.scrolledClass),this._emitStateChange(e,"shown",{scrollY:t.currentY,reason:"manual"}))}hide(e){const t=this.getState(e);t&&(t.target.classList.add(t.scrolledClass),this._emitStateChange(e,"hidden",{scrollY:t.currentY,reason:"manual"}))}toggle(e){this.getState(e)&&(this.isHidden(e)?this.show(e):this.hide(e))}isHidden(e){const t=this.getState(e);return!!t&&t.target.classList.contains(t.scrolledClass)}hasOverlay(e){const t=this.getState(e);return!!t&&t.target.classList.contains(t.overlayClass)}getScrollPosition(e){const t=this.getState(e);return t?t.currentY:window.scrollY}updateThresholds(e,{scrollThreshold:t,overlayThreshold:n}){const a=this.getState(e);a&&("number"==typeof t&&(a.scrollThreshold=t),"number"==typeof n&&(a.overlayThreshold=n),this._updateElementState(e,a),this.logger?.info("Scrollhide thresholds updated",{element:e,scrollThreshold:a.scrollThreshold,overlayThreshold:a.overlayThreshold}))}_throttle(e,t){let n=null,a=0;return function(...r){const s=Date.now();s-a>t?(e.apply(this,r),a=s):(clearTimeout(n),n=setTimeout(()=>{e.apply(this,r),a=Date.now()},t-(s-a)))}}getStatus(){const e=document.querySelectorAll('[data-scrollhide-enhanced="true"]');let t=0,n=0;return e.forEach(e=>{this.getState(e)&&(this.isHidden(e)&&t++,this.hasOverlay(e)&&n++)}),{totalElements:e.length,hiddenCount:t,overlayCount:n,currentScrollY:window.scrollY,defaults:D.defaults}}static enhanceAll(e="[data-scrollhide]",t){const n=new D(t);return document.querySelectorAll(e).forEach(e=>{n.mount(e)}),n}}class q extends x{static get defaults(){return{threshold:.1,rootMargin:"0px",once:!0,delay:0,stagger:100,initialState:"hidden"}}constructor(e={}){super(e),this.transitionManager=e.transitionManager,this.revealQueue=[],this.isProcessingQueue=!1,this._createObserver()}_createObserver(){const e={root:null,rootMargin:q.defaults.rootMargin,threshold:q.defaults.threshold};this.observer=new IntersectionObserver(this._handleIntersection.bind(this),e),this.logger?.info("Scrollreveal intersection observer created",e)}_init(e){const t=super._init(e),n=this._getDataAttr(e,"scrollreveal-threshold",q.defaults.threshold),a=this._getDataAttr(e,"scrollreveal-once",q.defaults.once),r=this._getDataAttr(e,"scrollreveal-delay",q.defaults.delay),s=this._getDataAttr(e,"scrollreveal-stagger",q.defaults.stagger),o=this._getDataAttr(e,"scrollreveal-initial",q.defaults.initialState);t.threshold=parseFloat(n),t.once=Boolean(a),t.delay=parseInt(r,10),t.stagger=parseInt(s,10),t.initialState=o,t.hasBeenRevealed=!1,t.isRevealing=!1,t.items=[e],this._setInitialState(e,t),e.setAttribute("data-scrollreveal-enhanced","true"),t.threshold!==q.defaults.threshold?(t.customObserver=new IntersectionObserver(this._handleIntersection.bind(this),{root:null,rootMargin:q.defaults.rootMargin,threshold:t.threshold}),t.customObserver.observe(e)):this.observer.observe(e);const i=t.cleanup;return t.cleanup=()=>{t.customObserver?(t.customObserver.unobserve(e),t.customObserver.disconnect()):this.observer.unobserve(e),this.revealQueue=this.revealQueue.filter(t=>t.element!==e),i()},this.eventBus?.emit("scrollreveal:mount",{element:e,threshold:t.threshold,stagger:t.stagger,timestamp:performance.now()}),this.logger?.info("Scrollreveal initialized",{element:e,threshold:t.threshold,once:t.once,stagger:t.stagger}),t}_setInitialState(e,t){if("hidden"===t.initialState){if(!e.dataset.scrollrevealClass){e.style.opacity="0";const t=e.dataset.transitionY||"1rem";e.style.transform=`translateY(${t})`}e.setAttribute("data-reveal-state","hidden")}}_handleIntersection(e){e.forEach(e=>{const t=e.target,n=this.getState(t);n&&(!e.isIntersecting||n.hasBeenRevealed||n.isRevealing?e.isIntersecting||n.once||!n.hasBeenRevealed||this._hideElement(t,n):n.stagger>0?this._addToRevealQueue(t,n):this._revealElement(t,n))})}_addToRevealQueue(e,t){this.revealQueue.push({element:e,state:t,timestamp:performance.now()}),this._processRevealQueue()}_processRevealQueue(){this.isProcessingQueue||0===this.revealQueue.length||(this.isProcessingQueue=!0,requestAnimationFrame(()=>{this._processNextInQueue()}))}_processNextInQueue(){if(0===this.revealQueue.length)return void(this.isProcessingQueue=!1);const{element:e,state:t}=this.revealQueue.shift();t.isRevealing||t.hasBeenRevealed?this._scheduleNextQueueItem(0):(this._revealElement(e,t,!0).catch(t=>{this.logger?.error("Queue reveal failed",{element:e,error:t})}),this._scheduleNextQueueItem(t.stagger))}_scheduleNextQueueItem(e=0){e>0?setTimeout(()=>{this._processNextInQueue()},e):requestAnimationFrame(()=>{this._processNextInQueue()})}async _revealElement(e,t,n=!0){t.isRevealing=!0,this.eventBus?.emit("scrollreveal:reveal-start",{element:e,timestamp:performance.now()});try{n&&t.delay>0&&await this._delay(t.delay),await this._revealItems([e],e),t.hasBeenRevealed=!0,t.once&&(t.customObserver?t.customObserver.unobserve(e):this.observer.unobserve(e)),this.eventBus?.emit("scrollreveal:reveal-complete",{element:e,timestamp:performance.now()}),this.logger?.debug("Scrollreveal animation completed",{element:e})}catch(t){this.logger?.error("Scrollreveal animation failed",{element:e,error:t}),this.eventBus?.emit("scrollreveal:reveal-error",{element:e,error:t,timestamp:performance.now()})}finally{t.isRevealing=!1}}async _hideElement(e,t){if(!t.once)try{await this._hideItems([e],e),t.hasBeenRevealed=!1,this.eventBus?.emit("scrollreveal:hide-complete",{element:e,timestamp:performance.now()})}catch(t){this.logger?.error("Scrollreveal hide animation failed",{element:e,error:t})}}async _revealItems(e,t){const n=e.map(async e=>{e.setAttribute("data-reveal-state","revealing");try{const t=e.dataset.scrollrevealClass;t?await this._animateWithClass(e,t):this.transitionManager?await this.transitionManager.enter(e):(e.style.transition="opacity 0.6s ease, transform 0.6s ease",e.style.opacity="1",e.style.transform="translateY(0)"),e.setAttribute("data-reveal-state","visible")}catch(t){throw e.setAttribute("data-reveal-state","error"),t}});await Promise.all(n)}async _hideItems(e,t){const n=e.map(async e=>{e.setAttribute("data-reveal-state","hiding");try{const t=e.dataset.scrollrevealClass,n=e.dataset.scrollrevealExitClass;if(n)await this._animateWithClass(e,n);else if(t){const n=t.split(" ").filter(e=>e.trim());e.classList.remove(...n)}else if(this.transitionManager)await this.transitionManager.exit(e);else{const t=e.dataset.transitionY||"1rem";e.style.opacity="0",e.style.transform=`translateY(${t})`}e.setAttribute("data-reveal-state","hidden")}catch(t){throw e.setAttribute("data-reveal-state","error"),t}});await Promise.all(n)}_animateWithClass(e,t){return new Promise(n=>{const a=()=>{e.removeEventListener("animationend",a),e.removeEventListener("transitionend",a),n()};e.addEventListener("animationend",a,{once:!0}),e.addEventListener("transitionend",a,{once:!0});const r=t.split(" ").filter(e=>e.trim());e.classList.add(...r),setTimeout(()=>{e.removeEventListener("animationend",a),e.removeEventListener("transitionend",a),n()},2e3)})}_delay(e){return new Promise(t=>setTimeout(t,e))}setStagger(e){this.staggerDelay=e}clearQueue(){this.revealQueue=[],this.isProcessingQueue=!1}async reveal(e){const t=this.getState(e);!t||t.hasBeenRevealed||t.isRevealing||await this._revealElement(e,t)}async hide(e){const t=this.getState(e);t&&t.hasBeenRevealed&&await this._hideElement(e,t)}reset(e){const t=this.getState(e);t&&(t.hasBeenRevealed=!1,t.isRevealing=!1,this._setInitialState(e,t),t.once&&(t.customObserver?t.customObserver.observe(e):this.observer.observe(e)),this.logger?.debug("Scrollreveal reset",{element:e}))}isRevealed(e){const t=this.getState(e);return!!t&&t.hasBeenRevealed}updateThreshold(e,t){const n=this.getState(e);n&&(n.threshold=t,n.customObserver&&n.customObserver.disconnect(),n.customObserver=new IntersectionObserver(this._handleIntersection.bind(this),{root:null,rootMargin:q.defaults.rootMargin,threshold:t}),n.customObserver.observe(e),this.logger?.info("Scrollreveal threshold updated",{element:e,threshold:t}))}getStatus(){const e=document.querySelectorAll('[data-scrollreveal-enhanced="true"]');let t=0,n=0;return e.forEach(e=>{const a=this.getState(e);a&&(a.hasBeenRevealed&&t++,a.isRevealing&&n++)}),{totalElements:e.length,revealedCount:t,revealingCount:n,queuedCount:this.revealQueue.length,observerActive:!!this.observer,defaults:q.defaults}}destroy(){this.observer&&(this.observer.disconnect(),this.observer=null),this.revealQueue=[],this.isProcessingQueue=!1,super.destroy(),this.logger?.info("Scrollreveal destroyed")}static enhanceAll(e="[data-scrollreveal]",t){const n=new q(t);return document.querySelectorAll(e).forEach(e=>{n.mount(e)}),n}}class I extends x{static get defaults(){return{activeClass:"tab--active",panelActiveClass:"tab-panel--active",defaultTab:null,keyboardNavigation:!0,autoFocus:!1,transitionDuration:200,transitionClass:"tab-panel--transitioning"}}_init(e){const t=super._init(e),n=e.querySelector("[data-tabs-list]"),a=e.querySelector("[data-tabs-panels]");if(!n||!a)return this.logger?.warn("Tabs: Missing required elements (data-tabs-list or data-tabs-panels)",e),t;const r=[...n.querySelectorAll("[data-tab]")],s=[...a.querySelectorAll("[data-tab-panel]")];if(0===r.length||0===s.length)return this.logger?.warn("Tabs: No tabs or panels found",e),t;const o=this._getDataAttr(e,"tabs-default-tab",I.defaults.defaultTab),i=this._getDataAttr(e,"tabs-keyboard",I.defaults.keyboardNavigation),l=this._getDataAttr(e,"tabs-autofocus",I.defaults.autoFocus);t.tabsList=n,t.tabsContainer=a,t.tabs=r,t.panels=s,t.activeTab=null,t.activePanel=null,t.keyboardNavigation=i,t.autoFocus=l,this._setupTabs(e,t);const d=this._getInitialTab(r,o);d&&this._activateTab(e,d.dataset.tab,t,!1),this._setupEventListeners(e,t),e.setAttribute("data-tabs-enhanced","true"),e.classList.add("tabs--enhanced");const c=t.cleanup;return t.cleanup=()=>{this._removeEventListeners(e,t),e.removeAttribute("data-tabs-enhanced"),e.classList.remove("tabs--enhanced"),c()},this.eventBus?.emit("tabs:mount",{element:e,tabCount:r.length,panelCount:s.length,timestamp:performance.now()}),this.logger?.info("Tabs initialized",{element:e,tabCount:r.length,panelCount:s.length}),t}_setupTabs(e,t){t.tabs.forEach((e,n)=>{e.setAttribute("role","tab"),e.setAttribute("tabindex","-1"),e.id||(e.id=r("tab"));const a=e.dataset.tab,s=t.panels.find(e=>e.id===a);s&&(s.setAttribute("role","tabpanel"),s.setAttribute("aria-labelledby",e.id),s.setAttribute("tabindex","0"))}),t.tabsList.setAttribute("role","tablist")}_getInitialTab(e,t){const n=e.find(e=>"true"===e.getAttribute("aria-selected"));if(n)return n;if(t){const n=e.find(e=>e.dataset.tab===t);if(n)return n}return e[0]}_setupEventListeners(e,t){t.clickHandlers=new Map,t.keydownHandlers=new Map,t.tabs.forEach(n=>{const a=n=>this._handleTabClick(n,e,t),r=n=>this._handleKeyDown(n,e,t);n.addEventListener("click",a),t.keyboardNavigation&&n.addEventListener("keydown",r),t.clickHandlers.set(n,a),t.keydownHandlers.set(n,r)})}_removeEventListeners(e,t){t.clickHandlers&&t.clickHandlers.forEach((e,t)=>{t.removeEventListener("click",e)}),t.keydownHandlers&&t.keydownHandlers.forEach((e,t)=>{t.removeEventListener("keydown",e)})}_handleTabClick(e,t,n){e.preventDefault();const a=e.currentTarget.dataset.tab;a&&a!==n.activeTab&&this._activateTab(t,a,n,!0)}_handleKeyDown(e,t,n){const a=n.tabs.findIndex(t=>t===e.currentTarget);let r=-1;switch(e.key){case"ArrowRight":case"ArrowDown":e.preventDefault(),r=(a+1)%n.tabs.length;break;case"ArrowLeft":case"ArrowUp":e.preventDefault(),r=(a-1+n.tabs.length)%n.tabs.length;break;case"Home":e.preventDefault(),r=0;break;case"End":e.preventDefault(),r=n.tabs.length-1;break;case"Enter":case" ":e.preventDefault();const s=e.currentTarget.dataset.tab;return void this._activateTab(t,s,n,!0)}if(r>=0){const e=n.tabs[r];n.autoFocus&&e.focus(),this._activateTab(t,e.dataset.tab,n,!0)}}async _activateTab(e,t,n,a=!0){const r=n.tabs.find(e=>e.dataset.tab===t),s=n.panels.find(e=>e.id===t);if(!r||!s)return void this.logger?.warn("Tabs: Invalid tab or panel ID",{panelId:t,element:e});const o=n.activeTab,i=n.activePanel;n.tabs.forEach(e=>{const n=e.dataset.tab===t;e.setAttribute("aria-selected",n?"true":"false"),e.setAttribute("tabindex",n?"0":"-1"),e.classList.toggle(I.defaults.activeClass,n)}),a&&i&&i!==s?await this._transitionPanels(i,s,n):n.panels.forEach(e=>{const n=e.id===t;e.style.display=n?"":"none",e.classList.toggle(I.defaults.panelActiveClass,n)}),n.activeTab=t,n.activePanel=s,n.autoFocus&&r.focus(),this._dispatch(e,"tabs:change",{activeTab:t,previousTab:o,tab:r,panel:s}),this.eventBus?.emit("tabs:change",{element:e,activeTab:t,previousTab:o,tab:r,panel:s,timestamp:performance.now()}),this.logger?.debug("Tab activated",{panelId:t,previousTab:o})}async _transitionPanels(e,t,n){const a=I.defaults.transitionDuration;e.classList.add(I.defaults.transitionClass),t.classList.add(I.defaults.transitionClass),t.style.display="",t.classList.add(I.defaults.panelActiveClass),e.style.opacity="0",await new Promise(e=>setTimeout(e,a/2)),e.style.display="none",e.classList.remove(I.defaults.panelActiveClass),e.style.opacity="",t.style.opacity="0",requestAnimationFrame(()=>{t.style.transition=`opacity ${a}ms ease-in-out`,t.style.opacity="1"}),setTimeout(()=>{t.style.transition="",t.style.opacity="",e.classList.remove(I.defaults.transitionClass),t.classList.remove(I.defaults.transitionClass)},a)}activateTab(e,t){const n=this.getState(e);n&&this._activateTab(e,t,n,!0)}getActiveTab(e){const t=this.getState(e);return t?t.activeTab:null}getStatus(){const e=document.querySelectorAll('[data-tabs-enhanced="true"]');let t=0,n=0;return e.forEach(e=>{const a=this.getState(e);a&&(t+=a.tabs.length,n+=a.panels.length)}),{containers:e.length,totalTabs:t,totalPanels:n,keyboardNavigationSupported:!0,defaults:I.defaults}}static enhanceAll(e="[data-tabs]",t){const n=new I(t);return document.querySelectorAll(e).forEach(e=>{n.mount(e)}),n}}class P extends x{static get defaults(){return{playThreshold:.3,pauseThreshold:.1,pauseOnExit:!0,muteWhenPlaying:null,restoreVolumeOnPause:!1,rootMargin:"0px",enableInBackground:!1,preloadOnMount:!0,requireUserInteraction:!1}}constructor(e={}){super(e),this._createObserver(),this._setupVisibilityHandling()}_createObserver(){const e={root:null,rootMargin:P.defaults.rootMargin,threshold:[0,.1,.3,.5,.7,1]};this.observer=new IntersectionObserver(this._handleIntersection.bind(this),e),this.logger?.info("Videoplay intersection observer created",e)}_setupVisibilityHandling(){this.isPageVisible=!document.hidden;const e=()=>{this.isPageVisible=!document.hidden,this.isPageVisible?this._resumeVisibleVideos():this._pauseAllBackgroundVideos()};document.addEventListener("visibilitychange",e),this.visibilityHandler=e}_init(e){const t=super._init(e),n=this._getDataAttr(e,"video-target"),a=n?document.querySelector(n):"VIDEO"===e.tagName?e:e.querySelector("video");if(!a)return this.logger?.warn("Videoplay: No video element found",{element:e,selector:n}),t;const r=this._getDataAttr(e,"videoplay-threshold",P.defaults.playThreshold),s=this._getDataAttr(e,"videoplay-pause-threshold",P.defaults.pauseThreshold),o=this._getDataAttr(e,"videoplay-autopause",P.defaults.pauseOnExit),i=this._getDataAttr(e,"videoplay-automute",P.defaults.muteWhenPlaying),l=this._getDataAttr(e,"videoplay-restore-volume",P.defaults.restoreVolumeOnPause),d=this._getDataAttr(e,"videoplay-background",P.defaults.enableInBackground),c=this._getDataAttr(e,"videoplay-preload",P.defaults.preloadOnMount),u=this._getDataAttr(e,"videoplay-require-interaction",P.defaults.requireUserInteraction),h=a.hasAttribute("autoplay");t.video=a,t.videoSelector=n,t.playThreshold=parseFloat(r),t.pauseThreshold=parseFloat(s),t.pauseOnExit=Boolean(o),t.muteWhenPlaying=null===i?null:Boolean(i),t.restoreVolumeOnPause=Boolean(l),t.enableInBackground=Boolean(d),t.preloadOnMount=Boolean(c),t.requireUserInteraction=Boolean(u),t.hasAutoplay=h,t.isPlaying=!1,t.isIntersecting=!1,t.intersectionRatio=0,t.originalMuted=a.muted,t.originalVolume=a.volume,t.hasUserInteracted=!1,this._setupVideo(a,t),e.setAttribute("data-videoplay-enhanced","true"),this.observer.observe(e);const g=t.cleanup;return t.cleanup=()=>{this.observer.unobserve(e),this._resetVideo(a,t),g()},this.eventBus?.emit("videoplay:mount",{element:e,video:a,hasAutoplay:t.hasAutoplay,playThreshold:t.playThreshold,timestamp:performance.now()}),this.logger?.info("Videoplay initialized",{element:e,video:n||"self",hasAutoplay:t.hasAutoplay,playThreshold:t.playThreshold,pauseOnExit:t.pauseOnExit}),t}_setupVideo(e,t){t.preloadOnMount&&!e.getAttribute("preload")&&(e.preload="metadata"),null===t.muteWhenPlaying&&t.hasAutoplay&&!e.hasAttribute("muted")&&(e.muted=!0,t.originalMuted=!1);const n=()=>{t.isPlaying=!0,this._emitVideoEvent(e,"play",{reason:"browser-play"})},a=()=>{t.isPlaying=!1,this._emitVideoEvent(e,"pause",{reason:"browser-pause"})},r=t=>{this.logger?.error("Video playback error",{video:e,error:t}),this._emitVideoEvent(e,"error",{error:t})},s=()=>{t.hasUserInteracted=!0,this.logger?.debug("User interacted with video",{video:e})};e.addEventListener("play",n),e.addEventListener("pause",a),e.addEventListener("error",r),e.addEventListener("click",s),e.addEventListener("play",s),t.playHandler=n,t.pauseHandler=a,t.errorHandler=r,t.userInteractionHandler=s}_handleIntersection(e){e.forEach(e=>{const t=e.target,n=this.getState(t);if(!n)return;n.isIntersecting=e.isIntersecting,n.intersectionRatio=e.intersectionRatio;const a=n.hasAutoplay&&(!n.requireUserInteraction||n.hasUserInteracted),r=e.isIntersecting&&e.intersectionRatio>=n.playThreshold&&(this.isPageVisible||n.enableInBackground)&&a,s=(!e.isIntersecting||e.intersectionRatio<n.pauseThreshold)&&n.pauseOnExit&&(!n.requireUserInteraction||n.hasUserInteracted);r&&!n.isPlaying?this._playVideo(t,n,"scroll-in"):s&&n.isPlaying&&this._pauseVideo(t,n,"scroll-out")})}async _playVideo(e,t,n="manual"){const{video:a}=t;try{!0===t.muteWhenPlaying?a.muted=!0:!1===t.muteWhenPlaying&&(a.muted=!1);const e=a.play();void 0!==e&&await e,t.isPlaying=!0,this._emitVideoEvent(a,"play",{reason:n,intersectionRatio:t.intersectionRatio,muted:a.muted}),this.logger?.debug("Video playing",{video:t.videoSelector||"self",reason:n,intersectionRatio:t.intersectionRatio})}catch(e){this.logger?.warn("Failed to play video",{video:t.videoSelector||"self",error:e.message,reason:n}),this._emitVideoEvent(a,"play-error",{reason:n,error:e.message})}}_pauseVideo(e,t,n="manual"){const{video:a}=t;try{a.pause(),t.isPlaying=!1,t.restoreVolumeOnPause&&!t.originalMuted&&(a.muted=!1,a.volume=t.originalVolume),this._emitVideoEvent(a,"pause",{reason:n,intersectionRatio:t.intersectionRatio}),this.logger?.debug("Video paused",{video:t.videoSelector||"self",reason:n,intersectionRatio:t.intersectionRatio})}catch(e){this.logger?.warn("Failed to pause video",{video:t.videoSelector||"self",error:e.message})}}_emitVideoEvent(e,t,n){e.dispatchEvent(new CustomEvent(`videoplay:${t}`,{detail:n,bubbles:!0})),this.eventBus?.emit(`videoplay:${t}`,{video:e,timestamp:performance.now(),...n})}_pauseAllBackgroundVideos(){document.querySelectorAll('[data-videoplay-enhanced="true"]').forEach(e=>{const t=this.getState(e);t&&t.isPlaying&&!t.enableInBackground&&this._pauseVideo(e,t,"page-hidden")})}_resumeVisibleVideos(){document.querySelectorAll('[data-videoplay-enhanced="true"]').forEach(e=>{const t=this.getState(e);t&&!t.isPlaying&&t.isIntersecting&&t.intersectionRatio>=t.playThreshold&&t.hasAutoplay&&this._playVideo(e,t,"page-visible")})}async play(e){const t=this.getState(e);t&&await this._playVideo(e,t,"manual")}pause(e){const t=this.getState(e);t&&this._pauseVideo(e,t,"manual")}isPlaying(e){const t=this.getState(e);return!!t&&t.isPlaying}getIntersectionRatio(e){const t=this.getState(e);return t?t.intersectionRatio:0}updatePlayThreshold(e,t){const n=this.getState(e);n&&(n.playThreshold=Math.max(0,Math.min(1,t)),this.logger?.info("Videoplay threshold updated",{element:e,newThreshold:n.playThreshold}))}_resetVideo(e,t){try{t.playHandler&&e.removeEventListener("play",t.playHandler),t.pauseHandler&&e.removeEventListener("pause",t.pauseHandler),t.errorHandler&&e.removeEventListener("error",t.errorHandler),t.userInteractionHandler&&(e.removeEventListener("click",t.userInteractionHandler),e.removeEventListener("play",t.userInteractionHandler)),e.muted=t.originalMuted,e.volume=t.originalVolume}catch(t){this.logger?.warn("Error resetting video",{video:e,error:t})}}getStatus(){const e=document.querySelectorAll('[data-videoplay-enhanced="true"]');let t=0,n=0,a=0,r=0;return e.forEach(e=>{const s=this.getState(e);s&&(r++,s.isPlaying&&t++,s.isIntersecting&&n++,s.hasAutoplay&&a++)}),{totalVideos:r,playingCount:t,intersectingCount:n,autoplayCount:a,pageVisible:this.isPageVisible,observerActive:!!this.observer,defaults:P.defaults}}destroy(){this.observer&&(this.observer.disconnect(),this.observer=null),this.visibilityHandler&&(document.removeEventListener("visibilitychange",this.visibilityHandler),this.visibilityHandler=null),super.destroy(),this.logger?.info("Videoplay destroyed")}static enhanceAll(e="[data-videoplay]",t){const n=new P(t);return document.querySelectorAll(e).forEach(e=>{n.mount(e)}),n}}class F extends x{static get defaults(){return{sortable:!0,filterable:!1,paginate:!1,pageSize:10,searchDelay:300,sortIcons:{unsorted:"↕",asc:"↑",desc:"↓"}}}constructor(e={}){super(e),this.searchTimeout=null}_init(e){const t=super._init(e),n=this._getConfiguration(e),a=Array.from(e.querySelectorAll("tbody tr"));return t.config=n,t.originalRows=a,t.filteredRows=[...a],t.currentSort={column:null,direction:null},t.currentPage=1,t.searchTerm="",n.sortable&&this._setupSorting(e,t),n.filterable&&this._setupFiltering(e,t),n.paginate&&this._setupPagination(e,t),this._render(e,t),this.eventBus?.emit("datatable:mounted",{element:e,config:n}),t}_getConfiguration(e){return{sortable:this._getDataAttr(e,"datatable-sortable",F.defaults.sortable),filterable:this._getDataAttr(e,"datatable-filterable",F.defaults.filterable),paginate:parseInt(this._getDataAttr(e,"datatable-paginate",F.defaults.paginate))||!1,pageSize:parseInt(this._getDataAttr(e,"datatable-page-size",F.defaults.pageSize)),searchDelay:parseInt(this._getDataAttr(e,"datatable-search-delay",F.defaults.searchDelay))}}_setupSorting(e,t){e.querySelectorAll("th[data-sort]").forEach(n=>{n.style.cursor="pointer",n.classList.add("sortable");const a=l("span",{className:"sort-icon"},F.defaults.sortIcons.unsorted);n.appendChild(a),n.addEventListener("click",()=>{this._handleSort(e,t,n)})})}_setupFiltering(e,t){const n=r("datatable-search"),a=l("label",{className:"form__label",htmlFor:n},"Search:"),o=l("input",{type:"text",id:n,placeholder:"Search table...",className:"form__control datatable-search"}),i=s(n=>{this._handleFilter(e,t,n)},t.config.searchDelay);o.addEventListener("input",e=>i(e.target.value));const d=l("div",{className:"form__field"});d.appendChild(o);const c=l("div",{className:"form__element form__element--sm datatable-filter"});c.appendChild(a),c.appendChild(d),e.parentNode.insertBefore(c,e)}_setupPagination(e,t){const n=document.createElement("div");n.className="datatable__pagination",e.parentNode.appendChild(n),t.paginationContainer=n}_handleSort(e,t,n){const a=n.dataset.sort,r=n.dataset.sortType||"string";let s="asc";t.currentSort.column===a&&"asc"===t.currentSort.direction&&(s="desc"),t.currentSort={column:a,direction:s},e.querySelectorAll(".sort-icon").forEach(e=>{e.textContent=F.defaults.sortIcons.unsorted});n.querySelector(".sort-icon").textContent=F.defaults.sortIcons[s];const o=Array.from(e.querySelectorAll("th"));t.filteredRows.sort((e,t)=>{const n=this._getCellValue(e,a,r,o),i=this._getCellValue(t,a,r,o);let l=0;return l="number"===r?parseFloat(n)-parseFloat(i):"date"===r?new Date(n)-new Date(i):n.localeCompare(i),"desc"===s?-l:l}),t.currentPage=1,this._render(e,t)}_handleFilter(e,t,n){t.searchTerm=n.toLowerCase(),t.filteredRows=n?t.originalRows.filter(e=>Array.from(e.cells).some(e=>e.textContent.toLowerCase().includes(t.searchTerm))):[...t.originalRows],t.currentPage=1,this._render(e,t)}_getCellValue(e,t,n,a=null){if(!e||!e.cells)return"";if(!a){const t=e.closest("table");if(!t)return"";a=Array.from(t.querySelectorAll("th"))}const r=a.findIndex(e=>e&&e.dataset&&e.dataset.sort===t);if(-1===r||!e.cells[r])return"";const s=e.cells[r];return s&&s.textContent?s.textContent.trim():""}_render(e,t){const n=e.querySelector("tbody");n.innerHTML="";let a=t.filteredRows;if(t.config.paginate){const e=(t.currentPage-1)*t.config.pageSize,n=e+t.config.pageSize;a=t.filteredRows.slice(e,n)}a.forEach(e=>n.appendChild(e.cloneNode(!0))),t.config.paginate&&this._renderPagination(e,t),this.eventBus?.emit("datatable:rendered",{element:e,totalRows:t.originalRows.length,filteredRows:t.filteredRows.length,displayedRows:a.length})}_renderPagination(e,t){const n=t.paginationContainer,a=Math.ceil(t.filteredRows.length/t.config.pageSize);if(n.innerHTML="",a<=1)return;const r=document.createElement("button");r.textContent="Previous",r.disabled=1===t.currentPage,r.addEventListener("click",()=>{t.currentPage>1&&(t.currentPage--,this._render(e,t))}),n.appendChild(r);for(let r=1;r<=a;r++){const a=document.createElement("button");a.textContent=r,a.classList.toggle("active",r===t.currentPage),a.addEventListener("click",()=>{t.currentPage=r,this._render(e,t)}),n.appendChild(a)}const s=document.createElement("button");s.textContent="Next",s.disabled=t.currentPage===a,s.addEventListener("click",()=>{t.currentPage<a&&(t.currentPage++,this._render(e,t))}),n.appendChild(s)}sort(e,t,n="asc"){const a=this.getState(e);if(!a)return;const r=e.querySelector(`th[data-sort="${t}"]`);r&&(a.currentSort={column:t,direction:n},this._handleSort(e,a,r))}filter(e,t){const n=this.getState(e);n&&this._handleFilter(e,n,t)}goToPage(e,t){const n=this.getState(e);if(!n||!n.config.paginate)return;const a=Math.ceil(n.filteredRows.length/n.config.pageSize);t>=1&&t<=a&&(n.currentPage=t,this._render(e,n))}static enhanceAll(e="[data-datatable]",t){const n=new F(t);return document.querySelectorAll(e).forEach(e=>n.mount(e)),n}}class R extends x{static get defaults(){return{closeOnEscape:!0,closeOnBackdrop:!0,showCounter:!0,showNavigation:!0,keyNavigation:!0,useDirectionalTransitions:!0,baseClass:"lightbox",overlayClass:"lightbox__overlay",containerClass:"lightbox__container",closeClass:"lightbox__close",prevClass:"lightbox__nav lightbox__nav--prev",nextClass:"lightbox__nav lightbox__nav--next",contentClass:"lightbox__content",imageClass:"lightbox__image",counterClass:"lightbox__counter",showClass:"show",slideLeftClass:"slide-left",slideRightClass:"slide-right"}}constructor(e={}){super(e),this.lightboxElement=null,this.currentGallery=[],this.currentIndex=0,this.isOpen=!1,this.isTransitioning=!1}_init(e){const t=super._init(e),n=this._getConfiguration(e),a=e.dataset.lightbox;return t.config=n,t.gallery=a,e.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),this._openLightbox(e,t)}),this.eventBus?.emit("lightbox:mounted",{element:e,gallery:a}),t}_getConfiguration(e){return{closeOnEscape:this._getDataAttr(e,"lightbox-close-escape",R.defaults.closeOnEscape),closeOnBackdrop:this._getDataAttr(e,"lightbox-close-backdrop",R.defaults.closeOnBackdrop),showCounter:this._getDataAttr(e,"lightbox-show-counter",R.defaults.showCounter),showNavigation:this._getDataAttr(e,"lightbox-show-nav",R.defaults.showNavigation),keyNavigation:this._getDataAttr(e,"lightbox-key-nav",R.defaults.keyNavigation),useDirectionalTransitions:this._getDataAttr(e,"lightbox-directional-transitions",R.defaults.useDirectionalTransitions),baseClass:this._getDataAttr(e,"lightbox-base-class",R.defaults.baseClass),overlayClass:this._getDataAttr(e,"lightbox-overlay-class",R.defaults.overlayClass),containerClass:this._getDataAttr(e,"lightbox-container-class",R.defaults.containerClass),closeClass:this._getDataAttr(e,"lightbox-close-class",R.defaults.closeClass),prevClass:this._getDataAttr(e,"lightbox-prev-class",R.defaults.prevClass),nextClass:this._getDataAttr(e,"lightbox-next-class",R.defaults.nextClass),contentClass:this._getDataAttr(e,"lightbox-content-class",R.defaults.contentClass),imageClass:this._getDataAttr(e,"lightbox-image-class",R.defaults.imageClass),counterClass:this._getDataAttr(e,"lightbox-counter-class",R.defaults.counterClass),showClass:this._getDataAttr(e,"lightbox-show-class",R.defaults.showClass),slideLeftClass:this._getDataAttr(e,"lightbox-slide-left-class",R.defaults.slideLeftClass),slideRightClass:this._getDataAttr(e,"lightbox-slide-right-class",R.defaults.slideRightClass)}}_openLightbox(e,t){if(this.isOpen)return;this.currentGallery=Array.from(document.querySelectorAll(`[data-lightbox="${t.gallery}"]`)),this.currentIndex=this.currentGallery.indexOf(e),this.currentConfig=t.config,this._createLightboxElement(t.config),this._showImage(this.currentIndex,t.config),this._setupEventListeners(t.config),this.isOpen=!0;const n=window.innerWidth-document.documentElement.clientWidth;document.documentElement.style.setProperty("--scrollbar-width",`${n}px`),document.body.classList.add("overflow--hidden"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.lightboxElement.classList.add(t.config.showClass)})}),this.eventBus?.emit("lightbox:opened",{gallery:t.gallery,index:this.currentIndex,total:this.currentGallery.length})}_createLightboxElement(e){this.lightboxElement=document.createElement("div"),this.lightboxElement.className=e.overlayClass,this.lightboxElement.innerHTML=`\n            <div class="${e.containerClass}">\n                <button class="${e.closeClass}" data-lightbox-action="close" aria-label="Close">&times;</button>\n                ${e.showNavigation?`\n                    <button class="${e.prevClass}" data-lightbox-action="prev" aria-label="Previous">&larr;</button>\n                    <button class="${e.nextClass}" data-lightbox-action="next" aria-label="Next">&rarr;</button>\n                `:""}\n                <div class="${e.contentClass}">\n                    <img class="${e.imageClass}" alt="">\n                </div>\n                ${e.showCounter?`<div class="${e.counterClass}"></div>`:""}\n            </div>\n        `,document.body.appendChild(this.lightboxElement);if(this.lightboxElement.querySelector('[data-lightbox-action="close"]').addEventListener("click",e=>{e.stopPropagation(),this._closeLightbox()}),e.showNavigation){const t=this.lightboxElement.querySelector('[data-lightbox-action="prev"]'),n=this.lightboxElement.querySelector('[data-lightbox-action="next"]');t.addEventListener("click",t=>{t.stopPropagation(),this._previousImage(e)}),n.addEventListener("click",t=>{t.stopPropagation(),this._nextImage(e)}),t.disabled=!0,n.disabled=!0}e.closeOnBackdrop&&this.lightboxElement.addEventListener("click",e=>{e.target===this.lightboxElement&&this._closeLightbox()})}_showImage(e,t,n=null){const a=this.currentGallery[e],r=a.href,s=a.querySelector("img")?.alt||"",o=this.lightboxElement.querySelector(`.${t.imageClass.split(" ")[0]}`);if(t.useDirectionalTransitions&&n){this.isTransitioning=!0;const e="next"===n?t.slideLeftClass:t.slideRightClass,a="next"===n?t.slideRightClass:t.slideLeftClass;o.classList.add(e),o.addEventListener("transitionend",()=>{const t=new Image;t.onload=()=>{o.src=r,o.alt=s,o.style.transition="none",o.classList.add(a),o.offsetHeight,o.classList.remove(e),requestAnimationFrame(()=>{o.style.transition="",o.classList.remove(a),o.addEventListener("transitionend",()=>{this.isTransitioning=!1},{once:!0})})},t.onerror=()=>{o.src=r,o.alt=s,this.isTransitioning=!1},t.src=r},{once:!0})}else o.src=r,o.alt=s;if(t.showCounter){this.lightboxElement.querySelector(`.${t.counterClass.split(" ")[0]}`).textContent=`${e+1} / ${this.currentGallery.length}`}if(t.showNavigation){const t=this.lightboxElement.querySelector('[data-lightbox-action="prev"]'),n=this.lightboxElement.querySelector('[data-lightbox-action="next"]');t&&(t.disabled=0===e),n&&(n.disabled=e===this.currentGallery.length-1)}}_previousImage(e){this.isTransitioning||this.currentIndex>0&&(this.currentIndex--,this._showImage(this.currentIndex,e,"prev"))}_nextImage(e){this.isTransitioning||this.currentIndex<this.currentGallery.length-1&&(this.currentIndex++,this._showImage(this.currentIndex,e,"next"))}_setupEventListeners(e){(e.closeOnEscape||e.keyNavigation)&&(this.keyHandler=t=>{let n=!1;switch(t.key){case"Escape":e.closeOnEscape&&(this._closeLightbox(),n=!0);break;case"ArrowLeft":e.keyNavigation&&(this._previousImage(e),n=!0);break;case"ArrowRight":e.keyNavigation&&(this._nextImage(e),n=!0)}n&&t.preventDefault()},document.addEventListener("keydown",this.keyHandler))}_closeLightbox(){if(!this.isOpen)return;this.lightboxElement.classList.remove(this.currentConfig.showClass);let e=!1;const t=()=>{e||(e=!0,this.keyHandler&&(document.removeEventListener("keydown",this.keyHandler),this.keyHandler=null),this.lightboxElement&&(this.lightboxElement.remove(),this.lightboxElement=null),document.body.classList.remove("overflow--hidden"),this.isOpen=!1,this.currentGallery=[],this.currentIndex=0,this.currentConfig=null,this.eventBus?.emit("lightbox:closed",{}))},n=e=>{e&&e.target!==this.lightboxElement||t()};this.lightboxElement.addEventListener("transitionend",n,{once:!0}),this.lightboxElement.addEventListener("animationend",n,{once:!0}),setTimeout(t,1e3)}open(e){const t=this.getState(e);t&&this._openLightbox(e,t)}close(){this._closeLightbox()}next(){if(this.isOpen&&this.lightboxElement){const e={showNavigation:!0,keyNavigation:!0};this._nextImage(e)}}previous(){if(this.isOpen&&this.lightboxElement){const e={showNavigation:!0,keyNavigation:!0};this._previousImage(e)}}goTo(e){if(this.isOpen&&e>=0&&e<this.currentGallery.length){this.currentIndex=e;const t={showCounter:!0,showNavigation:!0};this._showImage(this.currentIndex,t)}}getStatus(){return{isOpen:this.isOpen,currentIndex:this.currentIndex,gallerySize:this.currentGallery.length}}static enhanceAll(e="[data-lightbox]",t){const n=new R(t);return document.querySelectorAll(e).forEach(e=>n.mount(e)),n}}class O extends x{static get defaults(){return{validateOnInput:!0,validateOnBlur:!0,showErrorsImmediately:!1,errorClass:"error",validClass:"valid",debounce:300}}static get rules(){return{required:e=>e.trim().length>0,email:e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),min:(e,t)=>e.length>=parseInt(t),max:(e,t)=>e.length<=parseInt(t),minnum:(e,t)=>parseFloat(e)>=parseFloat(t),maxnum:(e,t)=>parseFloat(e)<=parseFloat(t),number:e=>!isNaN(parseFloat(e))&&isFinite(e),url:e=>{try{return new URL(e),!0}catch{return!1}},pattern:(e,t)=>new RegExp(t).test(e)}}constructor(e={}){super(e),this.debounceTimers=new Map}_init(e){const t=super._init(e),n=this._getConfiguration(e),a=this._getValidatedFields(e);return t.config=n,t.fields=a,t.errors=new Map,t.touched=new Set,a.forEach(e=>this._setupFieldValidation(e,t)),e.addEventListener("submit",n=>{this._handleSubmit(n,e,t)}),this.eventBus?.emit("form-validator:mounted",{element:e,fieldCount:a.length}),t}_getConfiguration(e){return{validateOnInput:this._getDataAttr(e,"validate-on-input",O.defaults.validateOnInput),validateOnBlur:this._getDataAttr(e,"validate-on-blur",O.defaults.validateOnBlur),showErrorsImmediately:this._getDataAttr(e,"show-errors-immediately",O.defaults.showErrorsImmediately),debounce:parseInt(this._getDataAttr(e,"validate-debounce",O.defaults.debounce))}}_getValidatedFields(e){return Array.from(e.querySelectorAll("[data-validate]"))}_setupFieldValidation(e,t){const n=e.name||e.id;t.config.validateOnInput&&e.addEventListener("input",()=>{this._debounceValidation(e,t,n)}),t.config.validateOnBlur&&e.addEventListener("blur",()=>{t.touched.add(n),this._validateField(e,t)}),e.addEventListener("focus",()=>{this._clearFieldError(e,t)})}_debounceValidation(e,t,n){clearTimeout(this.debounceTimers.get(n)),this.debounceTimers.set(n,setTimeout(()=>{(t.touched.has(n)||t.config.showErrorsImmediately)&&this._validateField(e,t)},t.config.debounce))}_validateField(e,t){const n=e.dataset.validate.split("|"),a=e.value,r=e.name||e.id;for(const s of n){const[n,o]=s.split(":"),i=O.rules[n];if(i&&!i(a,o)){const a=this._getErrorMessage(e,n,o);return this._showFieldError(e,t,a),t.errors.set(r,a),!1}}return this._showFieldValid(e,t),t.errors.delete(r),!0}_getErrorMessage(e,t,n){const a=e.dataset.validateMessage;if(a)return a;return{required:"This field is required",email:"Please enter a valid email address",min:`Minimum ${n} characters required`,max:`Maximum ${n} characters allowed`,minnum:`Value must be at least ${n}`,maxnum:`Value must be no more than ${n}`,number:"Please enter a valid number",url:"Please enter a valid URL",pattern:"Invalid format"}[t]||"Invalid value"}_showFieldError(e,t,n){e.classList.add(t.config.errorClass),e.classList.remove(t.config.validClass);const a=this._getErrorContainer(e);a&&(a.textContent=n,a.style.display="block")}_showFieldValid(e,t){e.classList.remove(t.config.errorClass),e.classList.add(t.config.validClass);const n=this._getErrorContainer(e);n&&(n.style.display="none")}_clearFieldError(e,t){e.classList.remove(t.config.errorClass);const n=this._getErrorContainer(e);n&&(n.style.display="none")}_getErrorContainer(e){const t=e.name||e.id;return document.querySelector(`[data-error-for="${t}"]`)}_handleSubmit(e,t,n){let a=!0;n.fields.forEach(e=>{const t=e.name||e.id;n.touched.add(t),this._validateField(e,n)||(a=!1)}),a?this.eventBus?.emit("form-validator:submit-valid",{element:t}):(e.preventDefault(),this.eventBus?.emit("form-validator:submit-blocked",{element:t,errors:Array.from(n.errors.entries())}))}validate(e){const t=this.getState(e);if(!t)return!1;let n=!0;return t.fields.forEach(e=>{this._validateField(e,t)||(n=!1)}),n}getErrors(e){const t=this.getState(e);return t?Array.from(t.errors.entries()):[]}static enhanceAll(e="[data-form-validator]",t){const n=new O(t);return document.querySelectorAll(e).forEach(e=>n.mount(e)),n}}class $ extends x{static get defaults(){return{successMessage:"Copied!",errorMessage:"Copy failed",successDuration:2e3,successClass:"copy-success",errorClass:"copy-error"}}_init(e){const t=super._init(e),n=this._getConfiguration(e),a=this._getTarget(e);return t.config=n,t.target=a,t.originalText=e.textContent,e.addEventListener("click",n=>{n.preventDefault(),this._handleCopy(e,t)}),this.eventBus?.emit("copy-to-clipboard:mounted",{element:e,target:a}),t}_getConfiguration(e){return{successMessage:this._getDataAttr(e,"copy-success-message",$.defaults.successMessage),errorMessage:this._getDataAttr(e,"copy-error-message",$.defaults.errorMessage),successDuration:parseInt(this._getDataAttr(e,"copy-success-duration",$.defaults.successDuration)),successClass:this._getDataAttr(e,"copy-success-class",$.defaults.successClass),errorClass:this._getDataAttr(e,"copy-error-class",$.defaults.errorClass)}}_getTarget(e){const t=e.dataset.copyTarget,n=e.dataset.copyText;if(n)return{type:"text",content:n};if(t){const e=document.querySelector(t);if(e)return{type:"element",element:e}}return{type:"text",content:e.textContent}}async _handleCopy(e,t){try{let n="";if("text"===t.target.type?n=t.target.content:"element"===t.target.type&&(n=t.target.element.value||t.target.element.textContent),!n)throw new Error("No text to copy");navigator.clipboard&&window.isSecureContext?await navigator.clipboard.writeText(n):this._fallbackCopy(n),this._showSuccess(e,t),this.eventBus?.emit("copy-to-clipboard:success",{element:e,text:n})}catch(n){this._showError(e,t),this.eventBus?.emit("copy-to-clipboard:error",{element:e,error:n.message})}}_fallbackCopy(e){const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy")}finally{document.body.removeChild(t)}}_showSuccess(e,t){e.textContent=t.config.successMessage,e.classList.add(t.config.successClass),e.disabled=!0,setTimeout(()=>{e.textContent=t.originalText,e.classList.remove(t.config.successClass),e.disabled=!1},t.config.successDuration)}_showError(e,t){e.textContent=t.config.errorMessage,e.classList.add(t.config.errorClass),setTimeout(()=>{e.textContent=t.originalText,e.classList.remove(t.config.errorClass)},t.config.successDuration)}static enhanceAll(e="[data-copy-to-clipboard]",t){const n=new $(t);return document.querySelectorAll(e).forEach(e=>n.mount(e)),n}}class z extends x{_init(e){const t=super._init(e);return this.element=e,this.config={maxFiles:parseInt(e.dataset.uploaderMaxFiles)||5,uploadUrl:e.dataset.uploaderUploadUrl||"/upload",sequenceUrl:e.dataset.uploaderSequenceUrl||"/sequence",inputName:e.dataset.uploaderInputName||"files",acceptTypes:e.dataset.uploaderAcceptTypes||"*/*",maxFileSize:parseInt(e.dataset.uploaderMaxFileSize)||10485760,allowEdit:"false"!==e.dataset.uploaderAllowEdit,allowSort:"false"!==e.dataset.uploaderAllowSort},this.XHRConstructor=null,this.files=new Map,this.draggedElement=null,this.draggedOverElement=null,this.placeholder=null,this.selector=e.querySelector("[data-uploader-selector]"),this.fileInput=e.querySelector(".uploader__fileinput"),this.filesContainer=e.querySelector("[data-uploader-files]")||e,this.logger&&this.logger.debug("Uploader initialized",{selector:!!this.selector,fileInput:!!this.fileInput,config:this.config}),this._setupEventListeners(t.controller.signal),this._loadExistingFiles(),t}setXHR(e){this.XHRConstructor=e,this.logger&&this.logger.debug("Custom XHR constructor set",{isMock:e!==XMLHttpRequest})}_getXHRConstructor(){return null===this.XHRConstructor&&(window.MockXHR?(this.XHRConstructor=window.MockXHR,this.logger&&this.logger.debug("Using MockXHR constructor from window")):(this.XHRConstructor=XMLHttpRequest,this.logger&&this.logger.debug("Using default XMLHttpRequest constructor"))),this.XHRConstructor}_setupEventListeners(e){this.fileInput&&this.selector?(this.logger&&this.logger.debug("Setting up Uploader event listeners"),this.fileInput.addEventListener("change",e=>{this.logger&&this.logger.debug("File input changed",{fileCount:e.target.files.length}),this._handleFileSelect(e)},{signal:e}),this.element.addEventListener("click",e=>{this._handleButtonClick(e)},{signal:e}),this.config.allowSort&&this.filesContainer&&(this.filesContainer.addEventListener("dragstart",e=>{this._handleDragStart(e)},{signal:e}),this.filesContainer.addEventListener("dragend",e=>{this._handleDragEnd(e)},{signal:e}),this.filesContainer.addEventListener("dragover",e=>{this._handleDragOver(e)},{signal:e}),this.filesContainer.addEventListener("dragenter",e=>{this._handleDragEnter(e)},{signal:e}),this.filesContainer.addEventListener("dragleave",e=>{this._handleDragLeave(e)},{signal:e}),this.filesContainer.addEventListener("drop",e=>{this._handleDrop(e)},{signal:e}))):this.logger&&this.logger.warn("Cannot set up event listeners - missing elements",{fileInput:!!this.fileInput,selector:!!this.selector})}_loadExistingFiles(){const e=this.element.querySelectorAll(".uploader__file");e.forEach((t,n)=>{const a=t.querySelector('input[type="hidden"]');if(a){const r={id:a.value,element:t,state:"uploaded",order:n};this.files.set(r.id,r),this.config.allowSort&&e.length>1&&(t.setAttribute("draggable","true"),t.setAttribute("data-uploader-drag-handle",""))}})}_handleFileSelect(e){const t=Array.from(e.target.files);this._processFiles(t),e.target.value=""}_handleFileDrop(e){if(!e.dataTransfer.files||0===e.dataTransfer.files.length)return;const t=Array.from(e.dataTransfer.files);this._processFiles(t)}_processFiles(e){this.files.size>=this.config.maxFiles?alert(`Maximum ${this.config.maxFiles} files allowed`):e.slice(0,this.config.maxFiles-this.files.size).forEach(e=>{this._uploadFile(e)})}async _uploadFile(e){const t=this._generateId("file"),n={id:t,file:e,state:"uploading",progress:0};this.files.set(t,n);const a=this._createFileElement(n);if(n.element=a,this.filesContainer.appendChild(a),e.type.startsWith("image/"))try{const t=await this._createThumbnail(e,240,240),r=a.querySelector(".uploader__preview img");r&&(r.src=t,r.style.display="block",a.querySelector(".uploader__preview").classList.add("uploader__preview--show"),n.hasClientThumbnail=!0)}catch(e){this.logger&&this.logger.warn("Failed to create thumbnail",{error:e})}this._performUpload(n)}_createFileElement(e){const t=document.createElement("div");return t.className="uploader__file uploader__file--show",this.config.allowSort&&(t.setAttribute("draggable","true"),t.setAttribute("data-uploader-drag-handle",""),t.style.userSelect="none",t.style.webkitUserSelect="none"),t.innerHTML=`\n      <input type="hidden" value="${e.id}" name="${this.config.inputName}">\n\n      <div class="uploader__overlay">\n        <progress class="uploader__progress" max="100" value="${e.progress}">\n          <span>0%</span>\n        </progress>\n      </div>\n\n      <picture class="uploader__preview">\n        <img alt="" draggable="false" src="" style="display: none;">\n      </picture>\n\n      <div data-panel="info" class="uploader__panel uploader__panel--show">\n        <div class="uploader__body">\n          <p class="uploader__filename">${e.file?e.file.name:""}</p>\n          <p class="uploader__title"></p>\n          <p class="uploader__caption"></p>\n          <p class="uploader__link"></p>\n        </div>\n        <div class="uploader__actions">\n          ${this.config.allowEdit?'\n            <button class="uploader__btn uploader__btn--update" type="button" data-uploader-action="show-rename">Edit Title/Caption</button>\n            <button class="uploader__btn uploader__btn--link" type="button" data-uploader-action="show-link">Edit Link</button>\n          ':""}\n          <button class="uploader__btn uploader__btn--delete" type="button" data-uploader-action="show-delete">Delete</button>\n        </div>\n      </div>\n\n      <div data-panel="error" class="uploader__panel">\n        <div class="uploader__body">\n          <p class="uploader__title">Upload Error</p>\n          <p class="uploader__info"></p>\n        </div>\n        <button class="uploader__btn uploader__btn--secondary" type="button" data-uploader-action="cancel">Cancel</button>\n      </div>\n\n      <div data-panel="rename" class="uploader__panel">\n        <div class="uploader__body">\n          <input name="title" class="uploader__input" placeholder="Title" type="text">\n          <textarea rows="6" name="caption" class="uploader__input" placeholder="Caption"></textarea>\n        </div>\n        <button class="uploader__btn uploader__btn--primary" type="button" data-uploader-action="confirm">Confirm</button>\n        <button class="uploader__btn uploader__btn--secondary" type="button" data-uploader-action="cancel">Cancel</button>\n      </div>\n\n      <div data-panel="link" class="uploader__panel">\n        <div class="uploader__body">\n          <input name="link" class="uploader__input" placeholder="E.g. https://example.com" type="text">\n        </div>\n        <button class="uploader__btn uploader__btn--primary" type="button" data-uploader-action="confirm">Confirm</button>\n        <button class="uploader__btn uploader__btn--secondary" type="button" data-uploader-action="cancel">Cancel</button>\n      </div>\n\n      <div data-panel="delete" class="uploader__panel">\n        <div class="uploader__body">\n          <p class="uploader__title">Delete this file?</p>\n        </div>\n        <button class="uploader__btn uploader__btn--delete" type="button" data-uploader-action="confirm">Delete</button>\n        <button class="uploader__btn uploader__btn--secondary" type="button" data-uploader-action="cancel">Cancel</button>\n      </div>\n    `,t}_performUpload(e){this.logger&&this.logger.warn("_performUpload called",{fileId:e.id,hasFile:!!e.file,fileName:e.file?e.file.name:"NO FILE"});const t=new FormData;t.append("file",e.file);const n=new(this._getXHRConstructor());n.upload.addEventListener("progress",t=>{if(t.lengthComputable){const n=t.loaded/t.total*100;e.progress=n,this._updateProgress(e.element,n)}}),n.addEventListener("load",()=>{if(200===n.status)try{const t=JSON.parse(n.responseText);this._handleUploadSuccess(e,t)}catch(t){this._handleUploadError(e,"Invalid server response")}else this._handleUploadError(e,n.responseText||"Upload failed")}),n.addEventListener("error",()=>{this._handleUploadError(e,"Network error")}),n.open("POST",this.config.uploadUrl),n.send(t)}_updateProgress(e,t){const n=e.querySelector(".uploader__progress");if(n){n.value=t;const e=n.querySelector("span");e&&(e.textContent=Math.round(t)+"%")}}async _handleUploadSuccess(e,t){e.state="uploaded",e.serverData=t;const n=e.element.querySelector(".uploader__overlay");n&&(n.classList.add("hide"),await this._waitForTransition(n),n.remove());const a=e.element.querySelector(".uploader__preview img");a&&t.preview&&!e.hasClientThumbnail&&(a.src=t.preview,a.style.display="block",e.element.querySelector(".uploader__preview").classList.add("uploader__preview--show"));const r=e.element.querySelector('input[type="hidden"]');r&&t.id&&(r.value=t.id),this._updateDraggableState(),this._dispatch(this.element,"uploader:upload:success",{fileId:e.id,fileName:e.file?e.file.name:null,response:t})}_handleUploadError(e,t){e.state="error",e.error=t,this._showPanel(e.element,"error");const n=e.element.querySelector('[data-panel="error"] .uploader__info');n&&(n.textContent=t),this._dispatch(this.element,"uploader:upload:error",{fileId:e.id,fileName:e.file?e.file.name:null,error:t})}_handleButtonClick(e){const t=e.target.closest("[data-uploader-action]");if(!t)return;const n=t.closest(".uploader__file");if(!n)return;const a=n.querySelector('input[type="hidden"]'),r=a?a.value:null,s=this.files.get(r);e.preventDefault();switch(t.dataset.uploaderAction){case"show-rename":this._showPanel(n,"rename");break;case"show-link":this._showPanel(n,"link");break;case"show-delete":this._showPanel(n,"delete");break;case"confirm":this._handleConfirm(n,s);break;case"cancel":this._showPanel(n,"info")}}_showPanel(e,t){e.querySelectorAll(".uploader__panel").forEach(e=>e.classList.remove("uploader__panel--show"));const n=e.querySelector(`[data-panel="${t}"]`);n&&n.classList.add("uploader__panel--show")}_handleConfirm(e,t){const n=e.querySelector(".uploader__panel.uploader__panel--show"),a=n.getAttribute("data-panel");if("rename"===a){const a=n.querySelector('input[name="title"]').value,r=n.querySelector('textarea[name="caption"]').value;e.querySelector(".uploader__title").textContent=a,e.querySelector(".uploader__caption").textContent=r,this._dispatch(this.element,"uploader:file:edit",{fileId:t?t.id:null,title:a,caption:r})}else if("link"===a){const a=n.querySelector('input[name="link"]').value;e.querySelector(".uploader__link").textContent=a,this._dispatch(this.element,"uploader:file:link",{fileId:t?t.id:null,link:a})}else if("delete"===a){const n=t?t.id:null;return t&&this.files.delete(t.id),e.remove(),void this._dispatch(this.element,"uploader:file:delete",{fileId:n})}this._showPanel(e,"info")}_updateDraggableState(){if(!this.config.allowSort)return;const e=this.element.querySelectorAll(".uploader__file"),t=e.length>1;e.forEach(e=>{if(t){e.setAttribute("draggable","true"),e.setAttribute("data-uploader-drag-handle",""),e.style.userSelect="none",e.style.webkitUserSelect="none";const t=e.querySelector("img");t&&t.setAttribute("draggable","false")}else e.removeAttribute("draggable"),e.removeAttribute("data-uploader-drag-handle"),e.style.userSelect="",e.style.webkitUserSelect=""})}_handleDragStart(e){const t=e.target.closest("img"),n=e.target.closest("a");if(t||n)return void e.preventDefault();const a=e.target.closest("[data-uploader-drag-handle]");if(!a)return;const r=a.closest(".uploader__file");r&&(this.draggedElement=r,e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",r.innerHTML),e.stopPropagation(),requestAnimationFrame(()=>{this.draggedElement&&this.draggedElement.classList.add("uploader__file--dragging")}))}_handleDragEnd(e){if(!this.draggedElement)return;this.draggedElement.classList.remove("uploader__file--dragging");this.element.querySelectorAll(".uploader__file").forEach(e=>e.classList.remove("uploader__file--drag-over")),this.draggedElement=null,this.draggedOverElement=null}_handleDragOver(e){if(!this.draggedElement)return;e.stopPropagation();const t=e.target.closest(".uploader__file");t&&t!==this.draggedElement&&(e.preventDefault(),e.dataTransfer.dropEffect="move")}_handleDragEnter(e){if(!this.draggedElement)return;if(e.target.closest("[data-uploader-selector]"))return;const t=e.target.closest(".uploader__file");if(!t||t===this.draggedElement)return;if(t===this.draggedOverElement)return;this.draggedOverElement&&this.draggedOverElement.classList.remove("uploader__file--drag-over"),t.classList.add("uploader__file--drag-over"),this.draggedOverElement=t;const n=Array.from(this.element.querySelectorAll(".uploader__file:not(.uploader__file--dragging)")),a=n.indexOf(this.draggedElement),r=n.indexOf(t);-1!==r&&(r>a?t.parentNode.insertBefore(this.draggedElement,t.nextSibling):t.parentNode.insertBefore(this.draggedElement,t))}_handleDragLeave(e){if(!this.draggedElement)return;const t=e.target.closest(".uploader__file");t&&(t!==this.draggedOverElement||t.contains(e.relatedTarget)||(t.classList.remove("uploader__file--drag-over"),this.draggedOverElement=null))}_handleDrop(e){this.draggedElement&&(e.preventDefault(),e.stopPropagation(),this._updateSequence())}async _updateSequence(){const e=Array.from(this.element.querySelectorAll(".uploader__file")).map(e=>{const t=e.querySelector('input[type="hidden"]');return t?t.value:null}).filter(e=>null!==e);this.logger&&this.logger.debug("Updating file sequence",{fileIds:e});const t=new(this._getXHRConstructor());t.addEventListener("load",()=>{200===t.status?(this.logger&&this.logger.debug("Sequence updated successfully"),this._dispatch(this.element,"uploader:sequence:update",{sequence:e})):(this.logger&&this.logger.error("Failed to update sequence",{status:t.status}),this._dispatch(this.element,"uploader:sequence:error",{sequence:e,status:t.status}))}),t.addEventListener("error",()=>{this.logger&&this.logger.error("Network error updating sequence")}),t.open("POST",this.config.sequenceUrl),t.setRequestHeader("Content-Type","application/json"),t.send(JSON.stringify({sequence:e}))}async _createThumbnail(e,t,n){return new Promise((a,r)=>{const s=new FileReader;s.onload=s=>{const o=new Image;o.onload=()=>{let r=o.width,s=o.height;r>s?r>t&&(s=s*t/r,r=t):s>n&&(r=r*n/s,s=n);const i=document.createElement("canvas");i.width=r,i.height=s;i.getContext("2d").drawImage(o,0,0,r,s);const l=i.toDataURL(e.type||"image/jpeg",.9);a(l)},o.onerror=()=>{r(new Error("Failed to load image"))},o.src=s.target.result},s.onerror=()=>{r(new Error("Failed to read file"))},s.readAsDataURL(e)})}}class N extends d{static get defaults(){return{loadingClass:"loading",errorClass:"error",transition:"fade",transitionDuration:300,retainScroll:!1,emptyMessage:"Please select an option"}}_init(e){const t=super._init(e);if("SELECT"!==e.tagName)return this.logger?.error("SelectLoader: Element must be a <select>",{element:e}),t;const n=this._getConfigFromAttrs(e,{target:"selectloader-target",loadingClass:"selectloader-loading-class",errorClass:"selectloader-error-class",transition:"selectloader-transition",transitionDuration:"selectloader-transition-duration",retainScroll:"selectloader-retain-scroll",emptyMessage:"selectloader-empty-message"}),a=this._getTargetElement(e,"selectloader-target",{required:!0});return a?(t.config={...N.defaults,...n},t.targetElement=a,t.isLoading=!1,t.currentUrl=null,t.scrollPosition=0,this._setupEventListeners(e,t),e.value?this._loadFragment(e,t,e.value):this._showEmptyMessage(t),this.logger?.info("SelectLoader initialized",{element:e,target:n.target,options:e.options.length}),t):t}_setupEventListeners(e,t){e.addEventListener("change",n=>{this._handleChange(n,e,t)},{signal:t.controller.signal});const n=e.closest("form");n&&n.addEventListener("reset",async()=>{await this._delay(10),this._showEmptyMessage(t)},{signal:t.controller.signal}),this.eventBus?.on("router:navigate-success",e=>{t.targetElement&&!document.contains(t.targetElement)&&this.logger?.warn("SelectLoader: Target removed during navigation")})}async _handleChange(e,t,n){const a=t.value;if(!this._dispatch(t,"selectloader:before-change",{value:a,previousUrl:n.currentUrl,targetElement:n.targetElement}).defaultPrevented)return a&&""!==a?void await this._loadFragment(t,n,a):(this._showEmptyMessage(n),n.currentUrl=null,void this._dispatch(t,"selectloader:cleared",{targetElement:n.targetElement}));this.logger?.debug("SelectLoader: Change prevented by listener")}async _loadFragment(e,t,n){if(t.isLoading)this.logger?.warn("SelectLoader: Load already in progress");else{t.isLoading=!0,t.currentUrl=n,t.config.retainScroll&&(t.scrollPosition=t.targetElement.scrollTop),e.classList.add(t.config.loadingClass),e.disabled=!0,t.targetElement.classList.add(t.config.loadingClass),this._dispatch(e,"selectloader:loading",{url:n,targetElement:t.targetElement});try{if(!this.router)throw new Error("RouterManager not available");const a=(await this.router.get(n)).data;"none"!==t.config.transition&&await this._transitionOut(t),t.targetElement.innerHTML=a,t.config.retainScroll&&(t.targetElement.scrollTop=t.scrollPosition),"none"!==t.config.transition&&await this._transitionIn(t),this._dispatch(e,"selectloader:loaded",{url:n,targetElement:t.targetElement,html:a}),this.eventBus?.emit("selectloader:content-loaded",{element:e,url:n,targetElement:t.targetElement}),this.logger?.info("SelectLoader: Fragment loaded",{url:n})}catch(a){this.logger?.error("SelectLoader: Load failed",{url:n,error:a}),this._showErrorMessage(t,a),this._dispatch(e,"selectloader:error",{url:n,error:a,targetElement:t.targetElement}),this.eventBus?.emit("app:notification",{type:"error",message:`Failed to load content: ${a.message}`,duration:5e3})}finally{t.isLoading=!1,e.classList.remove(t.config.loadingClass),e.disabled=!1,t.targetElement.classList.remove(t.config.loadingClass),this._dispatch(e,"selectloader:complete",{url:n,success:!t.targetElement.classList.contains(t.config.errorClass)})}}}async _transitionOut(e){const{transition:t,transitionDuration:n}=e.config;"fade"===t?await this._fadeOut(e.targetElement,n):"slide"===t&&await this._slideOut(e.targetElement,n)}async _transitionIn(e){const{transition:t,transitionDuration:n}=e.config;"fade"===t?await this._fadeIn(e.targetElement,n):"slide"===t&&await this._slideIn(e.targetElement,n)}async _slideOut(e,t){const n=e.offsetHeight;e.style.overflow="hidden",e.style.height=`${n}px`,e.offsetHeight,e.style.transition=`height ${t}ms ease-out, opacity ${t}ms ease-out`,e.style.height="0",e.style.opacity="0",await this._delay(t)}async _slideIn(e,t){const n=e.scrollHeight;e.style.height="0",e.style.overflow="hidden",e.offsetHeight,e.style.transition=`height ${t}ms ease-in, opacity ${t}ms ease-in`,e.style.height=`${n}px`,e.style.opacity="1",await this._delay(t),e.style.height="",e.style.overflow="",e.style.transition=""}_showEmptyMessage(e){const t=e.config.emptyMessage;e.targetElement.innerHTML=`\n      <div class="select-loader__empty">\n        <p>${t}</p>\n      </div>\n    `,e.targetElement.classList.remove(e.config.errorClass)}_showErrorMessage(e,t){const n=t.message||"Failed to load content",a=this._generateId("retry");e.targetElement.innerHTML=`\n      <div class="select-loader__error">\n        <p>${n}</p>\n        <button type="button" id="${a}" class="btn btn--sm">Retry</button>\n      </div>\n    `,e.targetElement.classList.add(e.config.errorClass);const r=document.getElementById(a);r&&r.addEventListener("click",()=>{const t=Array.from(document.querySelectorAll("select")).find(t=>this.getState(t)===e);t&&e.currentUrl&&this._loadFragment(t,e,e.currentUrl)},{once:!0})}reload(e){const t=this._requireState(e,"reload");t&&t.currentUrl&&this._loadFragment(e,t,t.currentUrl)}load(e,t){const n=this._requireState(e,"load");n&&(e.value=t,this._loadFragment(e,n,t))}clear(e){const t=this._requireState(e,"clear");t&&(e.value="",this._showEmptyMessage(t),t.currentUrl=null)}getLoadState(e){const t=this.getState(e);return t?{isLoading:t.isLoading,currentUrl:t.currentUrl,hasContent:t.targetElement.children.length>0,hasError:t.targetElement.classList.contains(t.config.errorClass)}:null}}class B extends d{constructor(e){super(e),this.performancePanelVisible=!1}_init(e){const t=super._init(e);this.togglePerformancePanel=this.togglePerformancePanel.bind(this),this.updatePerformancePanel=this.updatePerformancePanel.bind(this),this.updateComponentRegistry=this.updateComponentRegistry.bind(this),this._setupEventListeners(e,t.controller.signal),this.updateComponentRegistry(),this.performancePanelVisible=!1;const n=document.getElementById("performance-panel");return n&&n.classList.remove("active"),t}_setupEventListeners(e,t){const n=document.querySelector("[data-demo-performance-toggle]");n&&n.addEventListener("click",this.togglePerformancePanel,{signal:t});const a=document.querySelector(".performance-panel__close");a&&a.addEventListener("click",()=>{this.performancePanelVisible&&this.togglePerformancePanel()},{signal:t}),this.performanceInterval=setInterval(()=>{this.performancePanelVisible&&this.updatePerformancePanel()},1e3);const r=this.getState(e)?.cleanup;r&&(this.elements.get(e).cleanup=()=>{clearInterval(this.performanceInterval),r()})}togglePerformancePanel(){const e=document.getElementById("performance-panel");e&&(this.performancePanelVisible=!this.performancePanelVisible,e.classList.toggle("active",this.performancePanelVisible),this.performancePanelVisible&&this.updatePerformancePanel(),this._dispatch(e,"demo:performance-panel-toggled",{visible:this.performancePanelVisible}))}updatePerformancePanel(){const e=document.getElementById("performance-metrics");if(!e)return;const t=this._getPerformanceMetrics();e.innerHTML=`\n      <div class="performance__metric">\n        <span>Current Page:</span>\n        <strong>${window.location.pathname}</strong>\n      </div>\n      <div class="performance__metric">\n        <span>Components Mounted:</span>\n        <strong>${t.pageManager?.componentMounts||0}</strong>\n      </div>\n      <div class="performance__metric">\n        <span>Router Navigations:</span>\n        <strong>${t.router?.navigationCount||0}</strong>\n      </div>\n      <div class="performance__metric">\n        <span>Memory Usage:</span>\n        <strong>${t.memory?.usedMB||"N/A"} MB</strong>\n      </div>\n    `}updateComponentRegistry(){const e=document.getElementById("component-registry-display");if(e)if(window.pageManager){const t=window.pageManager.getComponentRegistry?window.pageManager.getComponentRegistry():[],n=window.pageManager.getComponentStates?window.pageManager.getComponentStates():{};t.length>0?e.innerHTML=t.map(e=>{const t=n[e.name]||{status:"not-loaded"};return`\n            <div class="component-registry__item ${`component-status--${t.status}`}">\n              <div class="component-registry__name">${e.name}</div>\n              <div class="component-registry__status">${t.status}</div>\n              <div class="component-registry__selector">${e.selector}</div>\n            </div>\n          `}).join(""):e.innerHTML='<p class="component-registry__empty">No components registered</p>'}else e.innerHTML='<p class="component-registry__loading">Loading component registry...</p>'}_getPerformanceMetrics(){const e=window.getPerformanceMetrics?window.getPerformanceMetrics():{};return window.performance&&window.performance.memory&&(e.memory={usedMB:Math.round(window.performance.memory.usedJSHeapSize/1024/1024)}),e}getPerformancePanelState(){return this.performancePanelVisible}showPerformancePanel(){this.performancePanelVisible||this.togglePerformancePanel()}hidePerformancePanel(){this.performancePanelVisible&&this.togglePerformancePanel()}}class H extends d{constructor(e={}){super(e),this.mediaMetrics={imagesLoaded:0,totalLoadTime:0,activeComponents:0,componentsCleaned:0}}_init(e){const t=super._init(e);return console.log("DemoMedia component initializing for element:",e),this.element=e,this.setupEventListeners(t),this.setupButtonHandlers(t),this.initializeMetricsDisplay(),this.notifyPageLoaded(),this.eventBus&&this.eventBus.emit("demo-media:mounted",{element:e}),t}setupEventListeners(e){const{controller:t}=e;document.addEventListener("click",e=>{this.handleGalleryClick(e)},{signal:t.signal}),document.addEventListener("lazysrc:loaded",e=>{console.log("lazysrc:loaded event received",e.detail),this.mediaMetrics.imagesLoaded++,e.detail&&e.detail.loadTime&&(this.mediaMetrics.totalLoadTime+=e.detail.loadTime),this.updateMetricsDisplay(),window.Toast&&window.Toast.show&&window.Toast.show("Image loaded successfully","success")},{signal:t.signal}),document.addEventListener("lazysrc:loading-start",e=>{this.updateMetricsDisplay()},{signal:t.signal}),document.addEventListener("lazysrc:detached",e=>{this.mediaMetrics.componentsCleaned++,this.updateMetricsDisplay()},{signal:t.signal}),document.addEventListener("carousel:slide-change",e=>{console.log("Carousel slide changed:",e.detail)},{signal:t.signal})}setupButtonHandlers(e){const{controller:t}=e;this.element.querySelectorAll('[data-btn-action="downloadCurrentImage"]').forEach(e=>{e.addEventListener("click",()=>this.downloadCurrentImage(),{signal:t.signal})})}handleGalleryClick(e){const t=e.target.closest("[data-gallery-item]");if(t){const e=t.querySelector("img"),n=e.getAttribute("data-gallery-full"),a=e.getAttribute("alt"),r=document.getElementById("gallery-preview-image");r.src=n,r.alt=a}}downloadCurrentImage(){const e=document.getElementById("gallery-preview-image");if(e.src){const t=document.createElement("a");t.href=e.src,t.download="gallery-image.jpg",document.body.appendChild(t),t.click(),document.body.removeChild(t)}}updateMetricsDisplay(){const e=document.getElementById("images-loaded");e&&(e.textContent=this.mediaMetrics.imagesLoaded);const t=document.getElementById("avg-load-time");t&&(t.textContent=this.mediaMetrics.imagesLoaded>0?Math.round(this.mediaMetrics.totalLoadTime/this.mediaMetrics.imagesLoaded)+"ms":"0ms");const n=document.getElementById("active-components");if(n){const e=document.querySelectorAll("[data-lazysrc]:not([data-lazysrc-complete])").length;n.textContent=e}const a=document.getElementById("memory-saved");a&&(a.textContent=this.mediaMetrics.componentsCleaned)}initializeMetricsDisplay(){console.log("Initializing metrics display"),this.updateMetricsDisplay()}notifyPageLoaded(){window.eventBus&&window.eventBus.emit("page:loaded",{page:"/media",components:["lazysrc","carousel","modal"],timestamp:performance.now()})}emit(e,t){this.eventBus&&this.eventBus.emit(e,t)}getMediaMetrics(){return{...this.mediaMetrics}}resetMetrics(){this.mediaMetrics={imagesLoaded:0,totalLoadTime:0,activeComponents:1,componentsCleaned:0},this.updateMetricsDisplay()}}class U extends d{constructor(e){super(e),this.performanceData={componentMounts:0,navigationCount:0,eventCount:0,mountTimes:[],navigationTimes:[],streamActive:!0,recentEvents:new Set},this.lifecycleChart=null,this.chartData=[]}_init(e){const t=super._init(e);console.log("DemoPerformance component mounting",e),this.element=e,this.initPerformanceMonitoring(e,t.controller.signal),this.eventBus?.emit("demo-performance:mounted",{element:e});const n=t.cleanup;return t.cleanup=()=>{this.cleanup(),n()},t}cleanup(){this.performanceUpdateInterval&&clearInterval(this.performanceUpdateInterval),this.healthUpdateInterval&&clearInterval(this.healthUpdateInterval),this.demoEventInterval&&clearInterval(this.demoEventInterval),this.element=null}initPerformanceMonitoring(e,t){console.log("Initializing performance monitoring"),this.setupEventListeners(e,t),this.setupChart(),this.startPerformanceUpdates(),this.updateHealthStatus(),console.log("Performance monitoring initialized")}setupEventListeners(e,t){window.eventBus&&this.addEventListeners(),document.addEventListener("component:mount",this.handleComponentEvent.bind(this),{signal:t}),document.addEventListener("component:unmount",this.handleComponentEvent.bind(this),{signal:t}),document.addEventListener("router:navigate",this.handleRouterEvent.bind(this),{signal:t}),document.addEventListener("performance:metric",this.handlePerformanceEvent.bind(this),{signal:t}),document.addEventListener("visibilitychange",()=>{document.hidden?this.logEvent("performance","page:hidden",{timestamp:performance.now()}):this.logEvent("performance","page:visible",{timestamp:performance.now()})},{signal:t}),this.setupButtonHandlers(e,t)}addEventListeners(){this.frameworkEventHandler=(e,t)=>{this.handleFrameworkEvent(e,t)},window.eventBus.on("*",this.frameworkEventHandler)}setupButtonHandlers(e,t){const n={'[data-btn-action="refreshRegistry"]':()=>this.refreshRegistry(),'[data-btn-action="exportRegistry"]':()=>this.exportRegistry(),'[data-btn-action="testNavigation"]':()=>this.testNavigation(),'[data-btn-action="toggleEventStream"]':()=>this.toggleEventStream(),'[data-btn-action="clearEventStream"]':()=>this.clearEventStream(),'[data-btn-action="exportEventStream"]':()=>this.exportEventStream(),'[data-btn-action="clearTimeline"]':()=>this.clearTimeline(),'[data-btn-action="exportTimeline"]':()=>this.exportTimeline()};Object.entries(n).forEach(([n,a])=>{const r=e.querySelector(n);r&&(r.removeAttribute("onclick"),r.addEventListener("click",a,{signal:t}))});e.querySelectorAll('[data-btn-action*="runPerformanceTest"]').forEach(e=>{const n=e.getAttribute("data-btn-action").match(/runPerformanceTest\('([^']+)'\)/);if(n){const a=n[1];e.addEventListener("click",()=>this.runPerformanceTest(a),{signal:t})}});const a=e.querySelector("#event-filter");a&&(a.removeAttribute("onchange"),a.addEventListener("change",()=>this.filterEvents(),{signal:t}))}setupChart(){const e=this.element.querySelector("#lifecycle-chart");if(!e)return;const t=e.getContext("2d");this.lifecycleChart={canvas:e,ctx:t,data:this.chartData,render:()=>{this.renderChart()}}}renderChart(){if(!this.lifecycleChart)return;const{canvas:e,ctx:t,data:n}=this.lifecycleChart;t.clearRect(0,0,e.width,e.height),t.strokeStyle="#e2e8f0",t.lineWidth=1;for(let n=0;n<=10;n++){const a=e.height/10*n;t.beginPath(),t.moveTo(0,a),t.lineTo(e.width,a),t.stroke()}n.length>1&&(t.strokeStyle="#0ea5e9",t.lineWidth=2,t.beginPath(),n.forEach((a,r)=>{const s=e.width/Math.max(n.length-1,1)*r,o=e.height-a.value/100*e.height;0===r?t.moveTo(s,o):t.lineTo(s,o)}),t.stroke())}handleFrameworkEvent(e,t){if(this.performanceData.eventCount++,this.performanceData.recentEvents.add(e),this.performanceData.recentEvents.size>10){const e=Array.from(this.performanceData.recentEvents);this.performanceData.recentEvents.clear(),e.slice(-10).forEach(e=>this.performanceData.recentEvents.add(e))}this.logEvent("framework",e,t),this.chartData.push({timestamp:Date.now(),value:100*Math.random(),event:e}),this.chartData.length>50&&this.chartData.shift(),this.lifecycleChart&&this.lifecycleChart.render()}handleComponentEvent(e){if("component:mount"===e.type){this.performanceData.componentMounts++;const t=e.detail?.mountTime||50*Math.random();this.performanceData.mountTimes.push(t)}this.logEvent("component",e.type,e.detail)}handleRouterEvent(e){this.performanceData.navigationCount++;const t=e.detail?.loadTime||200*Math.random();this.performanceData.navigationTimes.push(t),this.logEvent("router",e.type,e.detail)}handlePerformanceEvent(e){this.logEvent("performance",e.type,e.detail)}logEvent(e,t,n){if(!this.performanceData.streamActive)return;const a=this.element.querySelector("#event-stream-content");if(!a)return;const r=(new Date).toLocaleTimeString(),s=document.createElement("div");s.className=`event-stream-item event-${e}`,s.innerHTML=`\n            <div class="event-time">${r}</div>\n            <div class="event-category">${e}</div>\n            <div class="event-type">${t}</div>\n            <div class="event-data">${JSON.stringify(n||{},null,1)}</div>\n        `,a.insertBefore(s,a.firstChild);const o=a.querySelectorAll(".event-stream-item");o.length>100&&o[o.length-1].remove()}startPerformanceUpdates(){console.log("Starting performance update intervals"),this.performanceUpdateInterval=setInterval(()=>{console.log("Performance metrics update tick"),this.updatePerformanceMetrics()},2e3),this.healthUpdateInterval=setInterval(()=>{console.log("Health status update tick"),this.updateHealthStatus()},5e3),this.demoEventInterval=setInterval(()=>{console.log("Demo event generation tick"),this.generateDemoEvent()},3e3),this.updatePerformanceMetrics(),this.updateHealthStatus(),console.log("Performance intervals started")}generateDemoEvent(){const e=[{category:"component",type:"mount",data:{component:"PModal",time:50*Math.random()}},{category:"router",type:"navigate",data:{from:"/",to:"/performance",duration:100*Math.random()}},{category:"performance",type:"metric",data:{memory:Math.round(50*Math.random())+20,fps:Math.round(60*Math.random())+30}},{category:"framework",type:"component:update",data:{instances:Math.round(10*Math.random())+5}},{category:"user",type:"interaction",data:{event:"click",target:"button",timestamp:Date.now()}}],t=e[Math.floor(Math.random()*e.length)];"component"===t.category&&"mount"===t.type&&(this.performanceData.componentMounts++,this.performanceData.mountTimes.push(t.data.time),this.performanceData.mountTimes.length>50&&this.performanceData.mountTimes.shift()),this.logEvent(t.category,t.type,t.data)}updatePerformanceMetrics(){if(window.pageManager){const e=window.pageManager.getComponentRegistry?window.pageManager.getComponentRegistry():[],t=window.pageManager.getComponentStates?window.pageManager.getComponentStates():{},n=window.pageManager.getSessionTracking?window.pageManager.getSessionTracking():{},a=this.element.querySelector("#total-components");a&&(a.textContent=e.length||"0");const r=Object.values(t).filter(e=>"loaded"===e.status).length,s=this.element.querySelector("#mounted-components");s&&(s.textContent=r||"0");const o=this.element.querySelector("#session-loaded-components");o&&(o.textContent=n.totalComponentsLoaded||"0");const i=this.element.querySelector("#total-component-loads");if(i){const e=Object.values(n.mountCounts||{}).reduce((e,t)=>e+t,0);i.textContent=e||"0"}this.updateRegistryDisplay(e,t,n)}else{const e=this.element.querySelector("#total-components");e&&(e.textContent="0");const t=this.element.querySelector("#mounted-components");t&&(t.textContent="0")}const e=this.performanceData.mountTimes.length>0?Math.round(this.performanceData.mountTimes.reduce((e,t)=>e+t,0)/this.performanceData.mountTimes.length):0,t=this.element.querySelector("#avg-mount-time");t&&(t.textContent=e+"ms");const n=this.element.querySelector("#memory-usage");if(n)if(performance.memory){const e=Math.round(performance.memory.usedJSHeapSize/1024/1024);n.textContent=e+"MB"}else{const e=document.querySelectorAll("*").length,t=Math.round(.5*e+5*Math.random()+10);n.textContent=t+"MB (est)"}const a=this.element.querySelector("#current-page");a&&(a.textContent=window.location.pathname);const r=this.element.querySelector("#navigation-count");r&&(r.textContent=this.performanceData.navigationCount);const s=document.querySelectorAll("[data-router-enhanced]").length,o=this.element.querySelector("#enhanced-links");o&&(o.textContent=s);const i=this.performanceData.navigationTimes.length>0?Math.round(this.performanceData.navigationTimes.reduce((e,t)=>e+t,0)/this.performanceData.navigationTimes.length):0,l=this.element.querySelector("#avg-navigation-time");l&&(l.textContent=i+"ms");const d=this.element.querySelector("#total-events");d&&(d.textContent=this.performanceData.eventCount);const c=this.element.querySelector("#active-listeners");c&&(c.textContent=window.eventBus?.listenerCount?.()||0);const u=this.element.querySelector("#event-queue");u&&(u.textContent=0);const h=this.element.querySelector("#recent-events");h&&(h.innerHTML=Array.from(this.performanceData.recentEvents).slice(-5).map(e=>`<span class="event-chip">${e}</span>`).join(""))}updateRegistryDisplay(e,t,n={}){const a=this.element.querySelector("#registry-status");a&&(e&&0!==e.length?a.innerHTML=e.map(e=>{const a=t[e.name]||{status:"not-loaded"},r=n.mountCounts?.[e.name]||0,s=n.componentsLoadedThisSession?.includes(e.name),o=s?" 📋":"";let i=a.status,l=a.status;return"loaded"===a.status&&a.hasInstance?i=`loaded (${a.instanceType})`:"available"===a.status&&(i=`available (${a.elementsFound} elements)`),`\n                <div class="component__item">\n                    <div>\n                        <strong>${e.name}${o}</strong>\n                        <small style="margin-left: 0.5rem; color: #666;">\n                          ${e.priority}${r>0?` • loaded ${r}x`:""}\n                        </small>\n                    </div>\n                    <span class="component__status ${l}" title="${i}">${a.status}</span>\n                </div>\n            `}).join(""):a.innerHTML='\n        <div class="component__item">\n          <div>\n            <strong>Framework Core</strong>\n            <small style="margin-left: 0.5rem; color: #666;">(1)</small>\n          </div>\n          <span class="component__status loaded">loaded</span>\n        </div>\n        <div class="component__item">\n          <div>\n            <strong>Demo Performance</strong>\n            <small style="margin-left: 0.5rem; color: #666;">(2)</small>\n          </div>\n          <span class="component__status loaded">loaded</span>\n        </div>\n        <div class="component__item">\n          <div>\n            <strong>Page Manager</strong>\n            <small style="margin-left: 0.5rem; color: #666;">(3)</small>\n          </div>\n          <span class="component__status loaded">loaded</span>\n        </div>\n      ')}updateHealthStatus(){const e=window.pageManager&&window.router?"healthy":"error",t=this.element.querySelector("#health-framework"),n=this.element.querySelector("#framework-status");t&&(t.textContent="healthy"===e?"🟢":"🔴"),n&&(n.textContent="healthy"===e?"Operational":"Error");const a=window.router?"healthy":"error",r=this.element.querySelector("#health-router"),s=this.element.querySelector("#router-status");r&&(r.textContent="healthy"===a?"🟢":"🔴"),s&&(s.textContent="healthy"===a?"Active":"Inactive");const o=this.element.querySelectorAll(".component__status.error").length,i=0===o?"healthy":"warning",l=this.element.querySelector("#health-components"),d=this.element.querySelector("#components-status");l&&(l.textContent="healthy"===i?"🟢":"🟡"),d&&(d.textContent="healthy"===i?"All OK":`${o} Errors`);const c=performance.memory&&performance.memory.usedJSHeapSize<52428800?"healthy":"warning",u=this.element.querySelector("#health-memory"),h=this.element.querySelector("#memory-status");u&&(u.textContent="healthy"===c?"🟢":"🟡"),h&&(h.textContent="healthy"===c?"Normal":"High Usage")}refreshRegistry(){window.pageManager&&window.pageManager.scanAndMount&&(window.pageManager.scanAndMount(),this.logEvent("performance","registry:refresh",{timestamp:performance.now()}))}exportRegistry(){const e={timestamp:(new Date).toISOString(),registry:window.pageManager?.getComponentRegistry()||[],states:window.pageManager?.getComponentStates()||{},metrics:this.performanceData},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download=`registry-export-${Date.now()}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}testNavigation(){const e=["/","/ui-components","/media","/interactive"],t=e[Math.floor(Math.random()*e.length)],n=performance.now();window.router&&window.router.navigate?window.router.navigate(t):window.location.href=t;const a=performance.now();this.logEvent("performance","navigation:test",{page:t,duration:a-n})}runPerformanceTest(e){const t=this.element.querySelector("#test-results");t&&(t.innerHTML=`<div class="test-running">Running ${e} test...</div>`,setTimeout(()=>{let t;switch(e){case"component-mount":t=this.testComponentMountSpeed();break;case"memory-usage":t=this.testMemoryUsage();break;case"event-throughput":t=this.testEventThroughput();break;case"navigation-speed":t=this.testNavigationSpeed();break;case"cleanup-efficiency":t=this.testCleanupEfficiency();break;default:t={error:"Unknown test type"}}this.displayTestResults(e,t)},1e3))}testComponentMountSpeed(){const e=performance.now();for(let e=0;e<100;e++){const e=document.createElement("div");e.setAttribute("data-test-component","true"),document.body.appendChild(e),document.body.removeChild(e)}const t=performance.now();return{totalTime:Math.round(t-e),averageTime:Math.round((t-e)/100),componentsPerSecond:Math.round(1e5/(t-e))}}testMemoryUsage(){const e=performance.memory?.usedJSHeapSize||0,t=[];for(let e=0;e<1e3;e++)t.push({id:e,data:new Array(100).fill(Math.random())});const n=performance.memory?.usedJSHeapSize||0;t.length=0,setTimeout(()=>{"undefined"!=typeof gc&&gc()},100);const a=performance.memory?.usedJSHeapSize||0;return{initialMB:Math.round(e/1024/1024),peakMB:Math.round(n/1024/1024),finalMB:Math.round(a/1024/1024),allocatedMB:Math.round((n-e)/1024/1024)}}testEventThroughput(){const e=performance.now(),t=1e3;for(let e=0;e<t;e++)document.dispatchEvent(new CustomEvent("test:event",{detail:{id:e,timestamp:performance.now()}}));const n=performance.now();return{totalEvents:t,totalTime:Math.round(n-e),eventsPerSecond:Math.round(1e6/(n-e))}}testNavigationSpeed(){const e=Array.from({length:10},()=>100*Math.random()+50);return{averageTime:Math.round(e.reduce((e,t)=>e+t,0)/e.length),minTime:Math.round(Math.min(...e)),maxTime:Math.round(Math.max(...e)),samples:e.length}}testCleanupEfficiency(){const e=performance.now(),t=[];for(let e=0;e<100;e++){const e=()=>{};t.push(e)}t.forEach(e=>e()),t.length=0;const n=performance.now();return{cleanupTime:Math.round(n-e),itemsCleaned:100,efficiency:"Excellent"}}displayTestResults(e,t){const n=this.element.querySelector("#test-results");if(!n)return;if(t.error)return void(n.innerHTML=`<div class="test-error">Error: ${t.error}</div>`);const a=Object.entries(t).map(([e,t])=>`<div class="test-result-item"><span>${e}:</span> <strong>${t}</strong></div>`).join("");n.innerHTML=`\n            <div class="test-success">\n                <h4>${e} Results</h4>\n                ${a}\n            </div>\n        `,this.logEvent("performance",`test:${e}`,t)}toggleEventStream(){this.performanceData.streamActive=!this.performanceData.streamActive;const e=this.element.querySelector("#stream-toggle");e&&(e.textContent=this.performanceData.streamActive?"Pause Stream":"Resume Stream")}clearEventStream(){const e=this.element.querySelector("#event-stream-content");e&&(e.innerHTML='<div class="event-stream-item event-info"><div class="event-type">Stream cleared</div></div>')}exportEventStream(){const e=Array.from(this.element.querySelectorAll(".event-stream-item")).map(e=>({time:e.querySelector(".event-time")?.textContent,category:e.querySelector(".event-category")?.textContent,type:e.querySelector(".event-type")?.textContent,data:e.querySelector(".event-data")?.textContent})),t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download=`event-stream-${Date.now()}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}clearTimeline(){this.chartData.length=0,this.lifecycleChart&&this.lifecycleChart.render()}exportTimeline(){const e=new Blob([JSON.stringify(this.chartData,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download=`timeline-${Date.now()}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)}filterEvents(){const e=this.element.querySelector("#event-filter")?.value;this.element.querySelectorAll(".event-stream-item").forEach(t=>{!e||t.classList.contains(`event-${e}`)?t.style.display="":t.style.display="none"})}}class V extends d{constructor(e={}){super(e)}_init(e){const t=super._init(e);return console.log("DemoUIComponents component initializing for element:",e),this.element=e,this.setupEventListeners(t),this.setupButtonHandlers(t),this.notifyPageLoaded(),this.eventBus&&this.eventBus.emit("demo-ui-components:mounted",{element:e}),t}setupEventListeners(e){const{controller:t}=e;document.addEventListener("p-select:change",e=>{this.addEventToLog("p-select:change",e.detail)},{signal:t.signal}),document.addEventListener("modal:open",e=>{this.addEventToLog("modal:open",{modalId:e.target.id})},{signal:t.signal}),document.addEventListener("modal:close",e=>{this.addEventToLog("modal:close",{modalId:e.target.id})},{signal:t.signal})}setupButtonHandlers(e){const{controller:t}=e;this.element.querySelectorAll("[data-btn-action]").forEach(e=>{const n=e.getAttribute("data-btn-action");e.removeAttribute("onclick"),n.includes("handleFormSubmit")?e.addEventListener("click",e=>this.handleFormSubmit(e),{signal:t.signal}):n.includes("clearEventLog")?e.addEventListener("click",()=>this.clearEventLog(),{signal:t.signal}):n.includes("exportEventLog")?e.addEventListener("click",()=>this.exportEventLog(),{signal:t.signal}):n.includes("handleDatetimeDemo")?e.addEventListener("click",()=>this.handleDatetimeDemo(),{signal:t.signal}):n.includes("performance")?e.addEventListener("click",()=>{window.location.href="/performance"},{signal:t.signal}):e.addEventListener("click",t=>{"submit"!==e.type&&t.preventDefault(),this.handleModalAction(n,e)},{signal:t.signal})})}handleModalAction(e,t){switch(e){case"open-form-modal":this.handleOpenFormModal();break;case"cancel-form":this.handleCancelForm();break;case"submit-form":this.handleSubmitForm(t);break;case"close-gallery":this.handleCloseGallery();break;case"add-to-collection":this.handleAddToCollection(t);break;case"close-large-modal":this.handleCloseLargeModal();break;case"view-performance":this.handleViewPerformance(t)}}handleOpenFormModal(){this.addEventToLog("modal:action",{action:"open-form-modal",timestamp:Date.now()}),this.eventBus&&this.eventBus.emit("demo:form-modal-open",{modalType:"form"})}handleCancelForm(){this.addEventToLog("modal:action",{action:"cancel-form",timestamp:Date.now()})}handleSubmitForm(e){const t=e.textContent;e.textContent="Sending...",e.disabled=!0,setTimeout(()=>{e.textContent="Sent!",e.style.background="var(--color-success)",setTimeout(()=>{e.textContent=t,e.disabled=!1,e.style.background=""},2e3)},1500),this.addEventToLog("modal:action",{action:"submit-form",timestamp:Date.now()})}handleCloseGallery(){this.addEventToLog("modal:action",{action:"close-gallery",timestamp:Date.now()})}handleAddToCollection(e){const t=e.textContent;e.textContent="Added!",e.disabled=!0,e.style.background="var(--color-success)",setTimeout(()=>{e.textContent=t,e.disabled=!1,e.style.background=""},2e3),this.addEventToLog("modal:action",{action:"add-to-collection",item:"gallery-item",timestamp:Date.now()})}handleCloseLargeModal(){this.addEventToLog("modal:action",{action:"close-large-modal",timestamp:Date.now()})}handleViewPerformance(e){const t=e.textContent;e.textContent="📊 Loading...",e.disabled=!0,setTimeout(()=>{e.textContent="✅ Report Ready",e.style.background="var(--color-success)",this.addEventToLog("performance:report",{loadTime:"1.2s",components:15,events:47,timestamp:Date.now()}),setTimeout(()=>{e.textContent=t,e.disabled=!1,e.style.background=""},3e3)},2e3),this.addEventToLog("modal:action",{action:"view-performance",timestamp:Date.now()})}handleFormSubmit(e){e.preventDefault();const t=new FormData;document.querySelectorAll("p-select[name]").forEach(e=>{e.name&&e.getValue()&&t.set(e.name,e.getValue())});const n=Object.fromEntries(t);console.log("Form submitted with data:",n),window.Toast&&window.Toast.show?window.Toast.show("Form submitted successfully!","success"):alert(`Form submitted! Data: ${JSON.stringify(n)}`)}handleDatetimeDemo(){const e=document.querySelectorAll("p-datetime"),t={};e.forEach((e,n)=>{const a=e.getAttribute("name")||`datetime-${n}`,r=e.getValue?e.getValue():e.value;t[a]=r}),this.addEventToLog("datetime:demo-values",t),window.Toast&&window.Toast.show?window.Toast.show(`Datetime values: ${JSON.stringify(t)}`,"info"):alert(`Datetime values: ${JSON.stringify(t)}`)}clearEventLog(){const e=this.element.querySelector(".event__log-content");e&&(e.innerHTML='<div class="event__log-item"><div><em>Event log cleared</em></div></div>')}exportEventLog(){const e=this.element.querySelector(".event__log-content");if(!e)return;const t=Array.from(e.children).map(e=>({timestamp:e.querySelector("small")?.textContent,event:e.querySelector("strong")?.textContent,data:e.querySelector("pre")?.textContent})),n=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),a=URL.createObjectURL(n),r=document.createElement("a");r.href=a,r.download=`ui-events-${Date.now()}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a)}addEventToLog(e,t){const n=this.element.querySelector(".event__log-content");if(!n)return;const a=(new Date).toLocaleTimeString(),r=document.createElement("div");r.className="event__log-item",r.innerHTML=`\n            <div style="display: flex; justify-content: space-between; align-items: flex-start;">\n                <div>\n                    <strong>${e}</strong>\n                    <pre>${JSON.stringify(t,null,2)}</pre>\n                </div>\n                <small style="color: #999; margin-left: 1rem;">${a}</small>\n            </div>\n        `,n.insertBefore(r,n.firstChild);const s=n.querySelectorAll(".event__log-item");s.length>10&&s[s.length-1].remove()}emit(e,t){this.eventBus&&this.eventBus.emit(e,t)}notifyPageLoaded(){window.eventBus&&window.eventBus.emit("page:loaded",{page:"/ui-components",components:["modal","toast","select"],timestamp:performance.now()})}}class j extends d{_init(e){const t=super._init(e);return this.element=e,this._setupEventListeners(e,t.controller.signal),this._setupMockAPI(),this._initEventLogging(),this.notifyPageLoaded(),t}_setupEventListeners(e,t){["uploader:mounted","uploader:files-added","uploader:upload-progress","uploader:file-uploaded","uploader:file-error","uploader:file-updated","uploader:file-deleted","uploader:files-reordered","uploader:drag-enter","uploader:drag-leave","uploader:ui-updated","uploader:error"].forEach(e=>{document.addEventListener(e,t=>{this.addEventToLog(e,t.detail)},{signal:t})}),e.addEventListener("click",e=>{e.target.matches('[data-btn-action="clearEventLog"]')&&this.clearEventLog()},{signal:t})}_setupMockAPI(){window.MockXHR?(this.logger&&this.logger.debug("Setting up MockXHR injection"),setTimeout(()=>{const e=document.querySelectorAll("[data-uploader]");this.logger&&this.logger.debug("Found uploader elements",{count:e.length}),e.forEach((e,t)=>{const n=e.__componentInstance;this.logger&&this.logger.debug(`Uploader ${t}`,{element:!!e,hasInstance:!!n,hasSetXHR:!!n&&!!n.setXHR}),n&&n.setXHR?(n.setXHR(window.MockXHR),this.logger&&this.logger.info("MockXHR injected into Uploader component",{index:t})):this.logger&&this.logger.debug("Uploader not yet mounted - MockXHR will use lazy initialization",{index:t,hasInstance:!!n})})},100)):this.logger&&this.logger.warn("MockXHR not available globally")}async _handleMockUpload(e,t){await new Promise(e=>setTimeout(e,800));const n=await t.body,a=n.get("action");if("upload"===a){const e=n.get("file");return new Response(JSON.stringify({id:this._generateId(),title:e.name.split(".")[0],filename:e.name,preview:e.type.startsWith("image/")?this._generatePreviewURL():null,info:`${this._formatFileSize(e.size)} • ${this._getFileTypeLabel(e)}`,type:e.type.startsWith("image/")?"image":"document"}),{status:200,headers:{"Content-Type":"application/json"}})}return"update"===a?new Response(JSON.stringify({id:n.get("id"),title:n.get("title"),info:"Updated via mock API"}),{status:200,headers:{"Content-Type":"application/json"}}):"delete"===a?new Response("OK",{status:200}):new Response("Invalid action",{status:400})}async _handleMockSequence(e,t){return await new Promise(e=>setTimeout(e,300)),new Response("OK",{status:200})}_initEventLogging(){const e=document.querySelectorAll("[data-uploader]");if(this.logger&&this.logger.debug("Found uploader elements",{count:e.length}),window.pageManager){this.logger&&this.logger.debug("PageManager exists");const e=window.componentRegistry||window.pageManager.registry;if(e){if(e.components){const t=e.components.find(e=>"uploader"===e.name);if(this.logger&&t){this.logger.debug("Found uploader in registry",t);const e=document.querySelectorAll(t.selector);this.logger.debug("Selector matches",{selector:t.selector,count:e.length})}}window.pageManager.scanAndMount&&this.logger&&(this.logger.debug("Attempting manual scan"),window.pageManager.scanAndMount())}else this.logger&&this.logger.warn("No component registry found")}else this.logger&&this.logger.warn("No pageManager found");const t=this.element.querySelector(".event__content");t&&(t.innerHTML=`\n        <div class="event__item">\n          <div class="event__entry">\n            <div>\n              <strong>demo:initialized</strong>\n              <pre>{"page": "/file-uploader", "mockAPI": true}</pre>\n            </div>\n            <small class="event__timestamp">${(new Date).toLocaleTimeString()}</small>\n          </div>\n        </div>\n      `)}addEventToLog(e,t){const n=this.element.querySelector(".event__content");if(!n)return;const a=(new Date).toLocaleTimeString(),r=document.createElement("div");r.className="event__item";const s=this._sanitizeEventData(t);r.innerHTML=`\n      <div class="event__entry">\n        <div>\n          <strong style="color: #2563eb;">${e}</strong>\n          <pre style="margin: 0.5rem 0 0 0; font-size: 0.8rem; color: #666; background: #f8f9fa; padding: 0.5rem; border-radius: 4px; overflow-x: auto;">${JSON.stringify(s,null,2)}</pre>\n        </div>\n        <small class="event__timestamp" style="color: #999; margin-left: 1rem; white-space: nowrap;">${a}</small>\n      </div>\n    `,n.insertBefore(r,n.firstChild);const o=n.querySelectorAll(".event__item");o.length>15&&o[o.length-1].remove()}clearEventLog(){const e=this.element.querySelector(".event__content");e&&(e.innerHTML=`\n        <div class="event__item">\n          <div class="event__entry">\n            <div>\n              <em>Event log cleared</em>\n            </div>\n            <small class="event__timestamp">${(new Date).toLocaleTimeString()}</small>\n          </div>\n        </div>\n      `)}_sanitizeEventData(e){if(!e||"object"!=typeof e)return e;const t={};for(const[n,a]of Object.entries(e))"target"===n||"element"===n?t[n]=a?{tagName:a.tagName,id:a.id||void 0,className:a.className||void 0}:null:"fileData"===n&&a?t[n]={id:a.id,filename:a.filename,type:a.type,state:a.state}:"object"==typeof a&&null!==a?Array.isArray(a)?t[n]=a.slice(0,5):t[n]=Object.keys(a).length>0?"[Object]":a:t[n]=a;return t}notifyPageLoaded(){window.eventBus&&window.eventBus.emit("page:loaded",{page:"/file-uploader",components:["file-uploader"],mockAPI:!0,timestamp:performance.now()})}_generateId(){return`demo_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}_generatePreviewURL(){return`https://picsum.photos/200/200?random=${Math.floor(1e3*Math.random())}`}_formatFileSize(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["Bytes","KB","MB","GB"][t]}_getFileTypeLabel(e){return e?.type?e.type.startsWith("image/")?"Image":e.type.includes("pdf")?"PDF":e.type.includes("document")||e.type.includes("word")?"Document":e.type.includes("spreadsheet")||e.type.includes("excel")?"Spreadsheet":e.type.includes("presentation")||e.type.includes("powerpoint")?"Presentation":"File":"Unknown"}}class W extends d{constructor(e={}){super(e)}_init(e){const t=super._init(e);return this.logger?.info("DemoSelectLoader component initializing for element:",e),this.element=e,this.setupAPIDemo(t),this.setupEventDemo(t),this.setupFormDemo(t),this.eventBus&&this.eventBus.emit("demo-selectloader:mounted",{element:e}),t}setupAPIDemo(e){const{controller:t}=e,n=document.getElementById("api-select"),a=document.getElementById("api-output");if(!n||!a)return;const r=()=>window.pageManager?.instances?window.pageManager.instances.get("selectloader"):null,s=document.getElementById("btn-reload");s&&s.addEventListener("click",()=>{const e=r();e&&"function"==typeof e.reload?e.reload(n):this.logger?.warn("SelectLoader instance not found for reload")},{signal:t.signal});const o=document.getElementById("btn-load-demo1");o&&o.addEventListener("click",()=>{const e=r();e&&"function"==typeof e.load?e.load(n,"fragments/api-demo-1.html"):this.logger?.warn("SelectLoader instance not found for load")},{signal:t.signal});const i=document.getElementById("btn-clear");i&&i.addEventListener("click",()=>{const e=r();e&&"function"==typeof e.clear?e.clear(n):this.logger?.warn("SelectLoader instance not found for clear")},{signal:t.signal});const l=document.getElementById("btn-get-state");l&&l.addEventListener("click",()=>{const e=r();if(e&&"function"==typeof e.getLoadState){const t=e.getLoadState(n);a.textContent=JSON.stringify(t,null,2),a.style.display="block"}else this.logger?.warn("SelectLoader instance not found for getLoadState")},{signal:t.signal})}setupEventDemo(e){const{controller:t}=e,n=document.getElementById("events-select"),a=document.getElementById("event-log-list");if(!n||!a)return;const r=(e,t)=>{const n=document.createElement("li");n.className="event__log-item";const r=(new Date).toLocaleTimeString();n.innerHTML=`\n        <strong>${r}</strong> - ${e}\n        <pre>${JSON.stringify(t,null,2)}</pre>\n      `,a.insertBefore(n,a.firstChild),a.children.length>5&&a.removeChild(a.lastChild)};n.addEventListener("selectloader:before-change",e=>{r("selectloader:before-change",{value:e.detail.value})},{signal:t.signal}),n.addEventListener("selectloader:loading",e=>{r("selectloader:loading",{url:e.detail.url})},{signal:t.signal}),n.addEventListener("selectloader:loaded",e=>{r("selectloader:loaded",{url:e.detail.url})},{signal:t.signal}),n.addEventListener("selectloader:error",e=>{r("selectloader:error",{error:e.detail.error.message})},{signal:t.signal}),n.addEventListener("selectloader:cleared",e=>{r("selectloader:cleared",{})},{signal:t.signal});const s=document.getElementById("clear-log");s&&s.addEventListener("click",()=>{a.innerHTML=""},{signal:t.signal})}setupFormDemo(e){const{controller:t}=e,n=document.getElementById("region-form");n&&n.addEventListener("submit",e=>{e.preventDefault(),alert("Form submitted! (prevented for demo)")},{signal:t.signal})}}class X{constructor(){this.readyState=0,this.status=0,this.statusText="",this.responseText="",this.response=null,this.responseType="",this.responseURL="",this._listeners={},this._method=null,this._url=null,this._uploadDelay=1500,this._logger=new h("MockXHR",!0),this.upload={_listeners:{},addEventListener:(e,t)=>{this.upload._listeners[e]=this.upload._listeners[e]||[],this.upload._listeners[e].push(t)},dispatchEvent:e=>{const t=this.upload._listeners[e.type];t&&t.forEach(t=>t(e))}}}open(e,t){this._method=e,this._url=t,this.readyState=1,this._logger.debug("open",{method:e,url:t})}send(e){if(this._logger.debug("send",{url:this._url,hasBody:!!e}),"string"==typeof e)try{const t=JSON.parse(e);if(t.sequence)return void this._handleSequenceUpdate(t)}catch(e){}let t=null;e instanceof FormData&&(t=e.get("file")),t?this._simulateUpload(t):this._handleError("No file provided")}addEventListener(e,t){this._listeners[e]=this._listeners[e]||[],this._listeners[e].push(t)}removeEventListener(e,t){this._listeners[e]&&(this._listeners[e]=this._listeners[e].filter(e=>e!==t))}dispatchEvent(e){const t=this._listeners[e.type];t&&t.forEach(t=>t.call(this,e))}setRequestHeader(){}getResponseHeader(){return null}getAllResponseHeaders(){return""}abort(){this._logger.debug("abort")}async _simulateUpload(e){const t=e.size,n=this._uploadDelay/20;for(let e=0;e<=20;e++){await this._delay(n);const a=Math.min(e/20*t,t),r=new ProgressEvent("progress",{lengthComputable:!0,loaded:a,total:t});this.upload.dispatchEvent(r)}await this._generateMockResponse(e)}async _generateMockResponse(e){const t=e.type.startsWith("image/"),n="file_"+Date.now()+"_"+Math.random().toString(36).substr(2,9);let a=null;t&&(a=await this._createImagePreview(e));const r={id:n,title:e.name.replace(/\.[^/.]+$/,""),filename:e.name,preview:a,info:this._formatFileSize(e.size)+" • "+e.type,type:t?"image":"document"};this.status=200,this.statusText="OK",this.responseText=JSON.stringify(r),this.readyState=4,this._logger.info("upload complete",r),this.dispatchEvent(new Event("load"))}_handleSequenceUpdate(e){this._logger.info("sequence update",{sequence:e.sequence}),this.status=200,this.statusText="OK",this.responseText=JSON.stringify({success:!0}),this.readyState=4,this.dispatchEvent(new Event("load"))}_handleError(e){this.status=400,this.statusText="Bad Request",this.responseText=JSON.stringify({error:e}),this.readyState=4,this._logger.error("upload error",e),this.dispatchEvent(new Event("error"))}_createImagePreview(e){return new Promise(t=>{const n=new FileReader;n.onload=e=>{t(e.target.result)},n.onerror=()=>{t(null)},n.readAsDataURL(e)})}_formatFileSize(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["Bytes","KB","MB","GB"][t]}_delay(e){return new Promise(t=>setTimeout(t,e))}}function Y(e){return()=>Promise.resolve({default:e})}async function G(){try{const a=new h("Demo",!0);a.info("Initializing Enhancement Framework Demo"),window.MockXHR=X,a.debug("MockXHR available globally"),a.debug("Building component registry");const r=e.create("production"),s=r.component("lazysrc","[data-lazysrc]:not([data-lazysrc-complete])",{loader:Y(T)}).component("toggle","[data-toggle]",{loader:Y(k)}).component("carousel","[data-carousel]",{dependsOn:["lazysrc"],loader:Y(M)}).component("modal","[data-modal][data-modal-target]",{loader:Y(L)}).component("toast","[data-toast-trigger][data-toast-message]",{exportName:"Toast",loader:Y(A)}).component("scrollhide","[data-scrollhide]",{loader:Y(D)}).component("scrollreveal","[data-scrollreveal]",{loader:Y(q)}).component("tabs","[data-tabs]",{loader:Y(I)}).component("videoplay","[data-videoplay]",{loader:Y(P)}).component("datatable","[data-datatable]",{loader:Y(F)}).component("lightbox","[data-lightbox]",{loader:Y(R)}).component("form-validator","[data-form-validator]",{loader:Y(O)}).component("copy-to-clipboard","[data-copy-to-clipboard]",{loader:Y($)}).component("uploader","[data-uploader]",{loader:Y(z)}).component("selectloader","[data-selectloader]",{loader:Y(N)}).component("demo-home",'[data-demo="home"]',{loader:Y(B)}).component("demo-media",'[data-demo="media"]',{loader:Y(H)}).component("demo-performance",'[data-demo="performance"]',{loader:Y(U)}).component("demo-ui-components",'[data-demo="ui-components"]',{loader:Y(V)}).component("demo-uploader",'[data-demo="uploader"]',{loader:Y(j)}).component("demo-selectloader",'[data-demo="selectloader"]',{loader:Y(W)}).build();a.debug("Validating component registry");const o=r.validate();if(!o.valid)throw a.error("Component registry validation failed:",o.errors),new Error("Invalid component registry configuration");o.warnings.length>0&&a.warn("Component registry warnings:",o.warnings);const i=r.getStats();a.info("Component registry built successfully",i),a.debug("Initializing core framework components");const l=new t,d=new n({eventBus:l,logger:a,options:{timeout:1e4,loadingClass:"router-loading"}}),c=new u({containerSelector:'[data-view="main"]',registry:s,eventBus:l,logger:a,router:d,options:{targetGroups:{main:["main","navbar"]},targetGroupTransitions:{main:{out:"page-transition-out",in:"page-transition-in"},navbar:{out:"fade-scale-down",in:"fade-scale-up",duration:250},sidebar:{out:"slide-left",in:"slide-right",duration:200}},enableComponentPooling:!0,enableHealthMonitoring:!0,trackPerformance:!0}});g&&m&&f&&v&&b&&(a.debug("Web components loaded and registered",{PModal:customElements.get("p-modal"),PToasts:customElements.get("p-toasts"),PSelect:customElements.get("p-select"),PDatetime:customElements.get("p-datetime"),PUploader:customElements.get("p-uploader")}),Promise.all([customElements.whenDefined("p-modal"),customElements.whenDefined("p-toasts"),customElements.whenDefined("p-select"),customElements.whenDefined("p-datetime"),customElements.whenDefined("p-uploader"),customElements.whenDefined("p-uploader-file")]).then(()=>{a.info("All custom elements ready",{modalsInDOM:document.querySelectorAll("p-modal").length,toastsInDOM:document.querySelectorAll("p-toasts").length,selectsInDOM:document.querySelectorAll("p-select").length,datetimesInDOM:document.querySelectorAll("p-datetime").length,uploadersInDOM:document.querySelectorAll("p-uploader").length})}).catch(e=>{a.error("Error waiting for custom elements:",e)})),window.pageManager=c,window.router=d,window.eventBus=l,window.logger=a,window.componentRegistry=s,a.info("Framework initialized successfully")}catch(e){throw console.error("Failed to initialize framework:",e),e}}function J(){const e=document.querySelector(".event__log-content");if(!e||!window.eventBus)return;["lazysrc:loaded","lazysrc:error","lazysrc:loading-start","toast:show","toast:hide","tabs:change","modal:open","modal:close","scrollreveal:reveal-complete","videoplay:play","videoplay:pause","carousel:slide-change","datatable:mounted","datatable:rendered","lightbox:mounted","lightbox:opened","lightbox:closed","form-validator:mounted","form-validator:submit-blocked","form-validator:submit-valid","copy-to-clipboard:mounted","copy-to-clipboard:success","copy-to-clipboard:error","page:fragments-replaced","router:navigate-success"].forEach(t=>{window.eventBus.on(t,n=>{const a=(new Date).toLocaleTimeString(),r=document.createElement("div");r.className="event__log-item";const s=function(e){if(!e||"object"!=typeof e)return e;const t={};for(const[n,a]of Object.entries(e))"element"===n?t[n]=a?{tagName:a.tagName,id:a.id||void 0,className:a.className||void 0}:null:"timestamp"===n?t[n]=new Date(a).toLocaleTimeString():"fragment"===n||"targetFragment"===n?t[n]=a?{tagName:a.tagName,dataView:a.dataset?.view,childCount:a.children?.length}:null:"object"==typeof a&&null!==a?Array.isArray(a)?t[n]=a.slice(0,3):t[n]=Object.keys(a).length>0?"[Object]":a:t[n]=a;return t}(n);r.innerHTML=`\n                <div style="display: flex; justify-content: space-between; align-items: flex-start;">\n                    <div>\n                        <strong style="color: #2563eb;">${t}</strong>\n                        <pre style="margin: 0.5rem 0 0 0; font-size: 0.8rem; color: #666; background: #f8f9fa; padding: 0.5rem; border-radius: 4px; overflow-x: auto;">${JSON.stringify(s,null,2)}</pre>\n                    </div>\n                    <small style="color: #999; margin-left: 1rem; white-space: nowrap;">${a}</small>\n                </div>\n            `,e.insertBefore(r,e.firstChild);const o=e.querySelectorAll(".event__log-item");o.length>15&&o[o.length-1].remove()})})}window.demoUtils={testLazysrc:function(){const e=document.querySelectorAll("[data-lazysrc]");window.logger?.info("Found lazysrc elements:",e.length),e.forEach((e,t)=>{setTimeout(()=>{e.scrollIntoView({behavior:"smooth",block:"center"})},1e3*t)})},testScrollReveal:function(){const e=document.querySelectorAll("[data-scrollreveal]");window.logger?.info("Found scroll reveal elements:",e.length),e.forEach((e,t)=>{setTimeout(()=>{e.scrollIntoView({behavior:"smooth",block:"center"})},800*t)})},showComponentStatus:function(){if(!window.pageManager)return void console.log("PageManager not available");const e=window.pageManager.getComponentStates?.()||{};console.table(e),window.logger?.info("Component status:",e)},loadAllImages:function(){document.querySelectorAll('[data-lazysrc-enhanced="true"]').forEach(e=>{const t=window.componentRegistry?.getInstance?.(e);t&&"function"==typeof t.loadElement&&t.loadElement(e)}),window.logger?.info("Triggered load for all lazy images")}},document.addEventListener("DOMContentLoaded",async()=>{await G(),J();const e=document.querySelector(".demo-controls");e&&(e.innerHTML='\n            <div style="padding: 1rem; background: #f8f9fa; border-radius: 8px; margin: 1rem 0;">\n                <h4 style="margin: 0 0 1rem 0; color: #495057;">Demo Controls</h4>\n                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">\n                    <button data-btn-action="window.demoUtils.testLazysrc" style="padding: 0.5rem 1rem; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Test Lazy Loading</button>\n                    <button data-btn-action="window.demoUtils.testScrollReveal" style="padding: 0.5rem 1rem; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">Test Scroll Reveal</button>\n                    <button data-btn-action="window.demoUtils.showComponentStatus" style="padding: 0.5rem 1rem; background: #17a2b8; color: white; border: none; border-radius: 4px; cursor: pointer;">Component Status</button>\n                    <button data-btn-action="window.demoUtils.loadAllImages" style="padding: 0.5rem 1rem; background: #ffc107; color: black; border: none; border-radius: 4px; cursor: pointer;">Load All Images</button>\n                </div>\n            </div>\n        ')}),window.getPerformanceMetrics=function(){if(!window.pageManager)return{pageManager:{componentMounts:0,componentUnmounts:0,averageMountTime:0},components:{loading:[],retries:{}},router:{href:window.location.href}};return{pageManager:window.pageManager.getMetrics?window.pageManager.getMetrics():{},router:window.router?.getMetrics?window.router.getMetrics():{href:window.location.href},components:window.pageManager.getComponentStates?window.pageManager.getComponentStates():{},memory:performance.memory?{usedMB:Math.round(performance.memory.usedJSHeapSize/1024/1024*100)/100,totalMB:Math.round(performance.memory.totalJSHeapSize/1024/1024*100)/100}:{},timestamp:(new Date).toISOString()}},setInterval(()=>{const e=document.querySelector(".performance-display");if(e){const t=window.getPerformanceMetrics();e.innerHTML=`\n            <h4>Performance Metrics</h4>\n            <pre style="font-size: 0.8rem; background: #f8f9fa; padding: 1rem; border-radius: 4px; overflow-x: auto;">${JSON.stringify(t,null,2)}</pre>\n        `}},5e3),window.initFramework=G}();
