import{B as e}from"./index.esm-BW_QP_AR.js";class t extends e{static get defaults(){return{validateOnInput:!0,validateOnBlur:!0,showErrorsImmediately:!1,errorClass:"error",validClass:"valid",debounce:300}}static get rules(){return{required:e=>e.trim().length>0,email:e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),min:(e,t)=>e.length>=parseInt(t),max:(e,t)=>e.length<=parseInt(t),minnum:(e,t)=>parseFloat(e)>=parseFloat(t),maxnum:(e,t)=>parseFloat(e)<=parseFloat(t),number:e=>!isNaN(parseFloat(e))&&isFinite(e),url:e=>{try{return new URL(e),!0}catch{return!1}},pattern:(e,t)=>new RegExp(t).test(e)}}constructor(e={}){super(e),this.debounceTimers=new Map}_init(e){const t=super._init(e),r=this._getConfiguration(e),a=this._getValidatedFields(e);return t.config=r,t.fields=a,t.errors=new Map,t.touched=new Set,a.forEach(e=>this._setupFieldValidation(e,t)),e.addEventListener("submit",r=>{this._handleSubmit(r,e,t)}),this.eventBus?.emit("form-validator:mounted",{element:e,fieldCount:a.length}),t}_getConfiguration(e){return{validateOnInput:this._getDataAttr(e,"validate-on-input",t.defaults.validateOnInput),validateOnBlur:this._getDataAttr(e,"validate-on-blur",t.defaults.validateOnBlur),showErrorsImmediately:this._getDataAttr(e,"show-errors-immediately",t.defaults.showErrorsImmediately),debounce:parseInt(this._getDataAttr(e,"validate-debounce",t.defaults.debounce))}}_getValidatedFields(e){return Array.from(e.querySelectorAll("[data-validate]"))}_setupFieldValidation(e,t){const r=e.name||e.id;t.config.validateOnInput&&e.addEventListener("input",()=>{this._debounceValidation(e,t,r)}),t.config.validateOnBlur&&e.addEventListener("blur",()=>{t.touched.add(r),this._validateField(e,t)}),e.addEventListener("focus",()=>{this._clearFieldError(e,t)})}_debounceValidation(e,t,r){clearTimeout(this.debounceTimers.get(r)),this.debounceTimers.set(r,setTimeout(()=>{(t.touched.has(r)||t.config.showErrorsImmediately)&&this._validateField(e,t)},t.config.debounce))}_validateField(e,r){const a=e.dataset.validate.split("|"),i=e.value,s=e.name||e.id;for(const n of a){const[a,l]=n.split(":"),o=t.rules[a];if(o&&!o(i,l)){const t=this._getErrorMessage(e,a,l);return this._showFieldError(e,r,t),r.errors.set(s,t),!1}}return this._showFieldValid(e,r),r.errors.delete(s),!0}_getErrorMessage(e,t,r){const a=e.dataset.validateMessage;if(a)return a;return{required:"This field is required",email:"Please enter a valid email address",min:`Minimum ${r} characters required`,max:`Maximum ${r} characters allowed`,minnum:`Value must be at least ${r}`,maxnum:`Value must be no more than ${r}`,number:"Please enter a valid number",url:"Please enter a valid URL",pattern:"Invalid format"}[t]||"Invalid value"}_showFieldError(e,t,r){e.classList.add(t.config.errorClass),e.classList.remove(t.config.validClass);const a=this._getErrorContainer(e);a&&(a.textContent=r,a.style.display="block")}_showFieldValid(e,t){e.classList.remove(t.config.errorClass),e.classList.add(t.config.validClass);const r=this._getErrorContainer(e);r&&(r.style.display="none")}_clearFieldError(e,t){e.classList.remove(t.config.errorClass);const r=this._getErrorContainer(e);r&&(r.style.display="none")}_getErrorContainer(e){const t=e.name||e.id;return document.querySelector(`[data-error-for="${t}"]`)}_handleSubmit(e,t,r){let a=!0;r.fields.forEach(e=>{const t=e.name||e.id;r.touched.add(t),this._validateField(e,r)||(a=!1)}),a?this.eventBus?.emit("form-validator:submit-valid",{element:t}):(e.preventDefault(),this.eventBus?.emit("form-validator:submit-blocked",{element:t,errors:Array.from(r.errors.entries())}))}validate(e){const t=this.getState(e);if(!t)return!1;let r=!0;return t.fields.forEach(e=>{this._validateField(e,t)||(r=!1)}),r}getErrors(e){const t=this.getState(e);return t?Array.from(t.errors.entries()):[]}static enhanceAll(e="[data-form-validator]",r){const a=new t(r);return document.querySelectorAll(e).forEach(e=>a.mount(e)),a}}export{t as FormEnhancer,t as default};
