<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Uploader - Enhancement Framework</title>
        <link rel="stylesheet" href="dist/parallelogram-demo.min.css" />
        <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    </head>
    <body>
        <nav data-view="navbar">
            <div class="nav__container">
                <h1>Enhancement Framework</h1>
                <ul class="nav__list">
                    <li><a href="/" class="nav__link">Home</a></li>
                    <li><a href="/ui-components" class="nav__link">UI Components</a></li>
                    <li><a href="/media" class="nav__link">Media</a></li>
                    <li><a href="/interactive" class="nav__link">Interactive</a></li>
                    <li><a href="/select-loader" class="nav__link">SelectLoader</a></li>
                    <li><a href="/performance" class="nav__link">Performance</a></li>
                    <li><a href="/uploader" class="nav__link" aria-current="page">Uploader</a></li>
                </ul>
            </div>
        </nav>

        <main data-view="main" data-demo="uploader" class="page__content">
            <header class="page__header">
                <h1>Uploader Component</h1>
                <p>
                    Modern file upload component with drag & drop, progress tracking, sortable file management, 
                    and inline editing. Fully customizable via data attributes with accessibility support.
                </p>
            </header>

            <section class="demo__section" data-demo-section>
                <h2>Basic File Uploader</h2>
                <p>Simple image uploader with drag & drop support and basic file management:</p>

                <div class="demo__container">
                    <p-uploader max-files="3"
                                upload-action="/mock/upload"
                                update-action="/mock/update"
                                delete-action="/mock/delete"
                                sequence-action="/mock/sequence"
                                accept-types="image/*"
                                max-file-size="5242880"
                                allow-edit="true"
                                allow-sort="true"
                                input-name="images">

                        <!-- Field definitions for ALL files -->
                        <p-uploader-fields slot="field-definitions">
                            <p-uploader-field key="title" label="Title" type="text" required maxlength="100"></p-uploader-field>
                            <p-uploader-field key="caption" label="Caption" type="textarea" maxlength="500"></p-uploader-field>
                            <p-uploader-field key="link" label="Link" type="url"></p-uploader-field>
                        </p-uploader-fields>

                        <p-uploader-file file-id="demo1"
                                        filename="sample1.jpg"
                                        preview="https://picsum.photos/200/200?random=1"
                                        state="uploaded">
                            <p-uploader-data key="title">Beautiful Landscape</p-uploader-data>
                            <p-uploader-data key="caption">A stunning view captured at sunset during the golden hour, showcasing the magnificent natural beauty of rolling hills and distant mountains bathed in warm amber light, with dramatic cloud formations painting the sky in vibrant hues of orange, pink, and purple as day transitions into night.</p-uploader-data>
                            <p-uploader-data key="link">https://example.com/photo1</p-uploader-data>
                        </p-uploader-file>

                        <p-uploader-file file-id="demo2"
                                        filename="sample2.jpg"
                                        preview="https://picsum.photos/200/200?random=2"
                                        state="uploaded">
                            <p-uploader-data key="title">Urban Architecture</p-uploader-data>
                            <p-uploader-data key="caption">Modern building design featuring sleek glass facades, innovative structural elements, and contemporary architectural styling that exemplifies cutting-edge urban development and represents the perfect blend of form, function, and aesthetic excellence in today's metropolitan landscape.</p-uploader-data>
                        </p-uploader-file>

                        <p-uploader-file file-id="demo3"
                                        filename="error-file.jpg"
                                        preview="https://picsum.photos/200/200?random=3"
                                        state="error"
                                        error="Upload failed: File size exceeds 5MB limit">
                            <p-uploader-data key="title">Failed Upload</p-uploader-data>
                        </p-uploader-file>
                    </p-uploader>
                </div>

                <div class="features__details">
                    <h3>Basic Features</h3>
                    <ul>
                        <li><strong>Drag & Drop:</strong> Drop files directly onto the upload area</li>
                        <li><strong>File Validation:</strong> Automatic type and size validation</li>
                        <li><strong>Progress Tracking:</strong> Real-time upload progress bars</li>
                        <li><strong>Image Previews:</strong> Automatic thumbnail generation</li>
                    </ul>
                </div>
            </section>

            <!-- <section class="demo__section" data-demo-section>
                <h2>Advanced File Uploader</h2>
                <p>Full-featured uploader with sorting, editing, and multiple file types:</p>

                <div class="demo__container">
                    <div data-uploader
                         data-upload-url="/api/upload"
                         data-sequence-url="/api/sequence"
                         data-max-files="10"
                         data-input-name="documents"
                         data-accept-types="*/*"
                         data-max-file-size="10485760"
                         data-allow-edit="true"
                         data-allow-sort="true"
                         data-class-name="advanced-uploader">

                        <div data-upload-dropzone>
                            <input type="file" multiple data-upload-input id="advanced-files">
                            <label for="advanced-files" data-upload-label>
                                <div class="uploader__dropzone-icon">üìÅ</div>
                                <div class="uploader__dropzone-text">Drop any files here or click to browse</div>
                                <div class="uploader__dropzone-hint">Up to 10 files, 10MB each ‚Ä¢ Drag to reorder ‚Ä¢ Click to edit</div>
                            </label>
                        </div>

                        <div data-upload-files></div>

                        <input type="hidden"
                               data-file-id="doc1"
                               data-file-title="Project Proposal"
                               data-file-filename="proposal.pdf"
                               data-file-info="2.1 MB ‚Ä¢ PDF Document"
                               data-file-type="document">

                        <input type="hidden"
                               data-file-id="doc2"
                               data-file-title="Budget Spreadsheet"
                               data-file-filename="budget.xlsx"
                               data-file-info="890 KB ‚Ä¢ Excel File"
                               data-file-type="document">

                        <input type="hidden"
                               data-file-id="img1"
                               data-file-title="Team Photo"
                               data-file-filename="team.jpg"
                               data-file-preview="https://picsum.photos/200/200?random=2"
                               data-file-info="1.5 MB ‚Ä¢ JPEG Image"
                               data-file-type="image">
                    </div>
                </div>

                <div class="features__details">
                    <h3>Advanced Features</h3>
                    <ul>
                        <li><strong>Sortable Files:</strong> Drag and drop to reorder files</li>
                        <li><strong>Inline Editing:</strong> Edit file titles and metadata</li>
                        <li><strong>Multiple File Types:</strong> Support for documents, images, and more</li>
                        <li><strong>Customizable UI:</strong> Custom class names and styling</li>
                    </ul>
                </div>
            </section> -->

            <!-- <section class="demo__section" data-demo-section>
                <h2>Gallery Uploader</h2>
                <p>Specialized uploader for photo galleries with strict image requirements:</p>

                <div class="demo__container">
                    <div data-uploader
                         data-upload-url="/api/gallery-upload"
                         data-sequence-url="/api/gallery-sequence"
                         data-max-files="12"
                         data-input-name="gallery"
                         data-accept-types="image/jpeg,image/png,image/webp"
                         data-max-file-size="20971520"
                         data-allow-edit="true"
                         data-allow-sort="true"
                         data-class-name="gallery-uploader">

                        <div data-upload-dropzone>
                            <input type="file" multiple accept="image/jpeg,image/png,image/webp" data-upload-input id="gallery-files">
                            <label for="gallery-files" data-upload-label>
                                <div class="uploader__dropzone-icon">üñºÔ∏è</div>
                                <div class="uploader__dropzone-text">Add photos to your gallery</div>
                                <div class="uploader__dropzone-hint">JPEG, PNG, WebP only ‚Ä¢ Up to 12 photos ‚Ä¢ 20MB max each</div>
                            </label>
                        </div>

                        <div data-upload-files></div>

                        <input type="hidden"
                               data-file-id="gallery1"
                               data-file-title="Mountain Landscape"
                               data-file-filename="mountain.jpg"
                               data-file-preview="https://picsum.photos/200/200?random=10"
                               data-file-info="3.2 MB ‚Ä¢ 4000√ó3000"
                               data-file-type="image">

                        <input type="hidden"
                               data-file-id="gallery2"
                               data-file-title="City Skyline"
                               data-file-filename="city.jpg"
                               data-file-preview="https://picsum.photos/200/200?random=11"
                               data-file-info="2.8 MB ‚Ä¢ 3840√ó2160"
                               data-file-type="image">

                        <input type="hidden"
                               data-file-id="gallery3"
                               data-file-title="Ocean Sunset"
                               data-file-filename="sunset.jpg"
                               data-file-preview="https://picsum.photos/200/200?random=12"
                               data-file-info="4.1 MB ‚Ä¢ 5000√ó3333"
                               data-file-type="image">
                    </div>
                </div>

                <div class="features__details">
                    <h3>Gallery Features</h3>
                    <ul>
                        <li><strong>Image-Only:</strong> Strict file type validation for images</li>
                        <li><strong>High Resolution:</strong> Support for large image files up to 20MB</li>
                        <li><strong>Visual Organization:</strong> Sortable grid layout for galleries</li>
                        <li><strong>Metadata Editing:</strong> Add titles and descriptions to photos</li>
                    </ul>
                </div>
            </section> -->

            <section class="demo__section" data-demo-section>
                <h2>Event Monitoring</h2>
                <p>Real-time monitoring of file uploader events:</p>

                <div id="file-uploader-events" class="event">
                    <div class="event__header">
                        <strong>File Uploader Events</strong>
                        <div class="event__controls">
                            <button data-btn-action="clearEventLog" class="btn btn--xs">Clear</button>
                        </div>
                    </div>
                    <div class="event__content event__content--scrollable">
                        <div class="event__item">
                            <div class="event__entry">
                                <div>
                                    <strong>uploader:mounted</strong>
                                    <pre>{"maxFiles": 5, "allowEdit": true}</pre>
                                </div>
                                <small class="event__timestamp">Just now</small>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="features__details">
                    <h3>Available Events</h3>
                    <ul>
                        <li><code>uploader:mounted</code> - Component initialized</li>
                        <li><code>uploader:files-added</code> - New files added to queue</li>
                        <li><code>uploader:upload-progress</code> - Upload progress updates</li>
                        <li><code>uploader:file-uploaded</code> - File successfully uploaded</li>
                        <li><code>uploader:file-error</code> - Upload or validation error</li>
                        <li><code>uploader:file-updated</code> - File metadata updated</li>
                        <li><code>uploader:file-deleted</code> - File removed</li>
                        <li><code>uploader:files-reordered</code> - Files reordered by drag & drop</li>
                    </ul>
                </div>
            </section>

            <section class="demo__section" data-demo-section>
                <h2>API Integration</h2>
                <p>The FileUploader component expects specific API endpoints:</p>

                <div class="api__documentation">
                    <h3>Upload Endpoint</h3>
                    <div class="code__block">
                        <strong>POST</strong> <code>/api/upload</code>
                        <pre>
FormData:
- file: [File object]

Response:
{
  "id": "unique_file_id",
  "filename": "original.jpg",
  "preview": "/path/to/thumb.jpg",
  "fields": {
    "title": "File Title",
    "caption": "Optional caption",
    "link": "https://example.com"
  }
}</pre>
                    </div>

                    <h3>Update Endpoint</h3>
                    <div class="code__block">
                        <strong>POST</strong> <code>/api/upload</code>
                        <pre>
JSON:
{
  "id": "file_id",
  "field": "title",
  "value": "New Title"
}

Response:
{
  "id": "file_id",
  "field": "title",
  "value": "New Title"
}</pre>
                    </div>

                    <h3>Delete Endpoint</h3>
                    <div class="code__block">
                        <strong>POST</strong> <code>/api/upload</code>
                        <pre>
FormData:
- action: "delete"
- id: "file_id"

Response: 200 OK</pre>
                    </div>

                    <h3>Sequence Endpoint</h3>
                    <div class="code__block">
                        <strong>POST</strong> <code>/api/sequence</code>
                        <pre>
JSON:
{
  "sequence": ["file_id_1", "file_id_2", "file_id_3"]
}

Response: 200 OK</pre>
                    </div>
                </div>
            </section>

            <section class="demo__section" data-demo-section>
                <h2>Testing Error Handling & Revert</h2>
                <p>This demo includes mock API endpoints. To test the revert functionality when server operations fail:</p>

                <div class="features__details">
                    <h3>Success Mode (Current)</h3>
                    <p>Currently using <code>/mock/</code> URLs which simulate successful responses:</p>
                    <ul>
                        <li>‚úÖ Updates will succeed and persist</li>
                        <li>‚úÖ Deletes will succeed and remove files</li>
                        <li>‚úÖ Sequence changes will succeed and stay reordered</li>
                    </ul>

                    <h3>Failure Mode</h3>
                    <p>Change the action URLs to <code>/mock-fail/</code> pattern to test error handling:</p>
                    <div class="code__block">
                        <pre><!-- Example: Test failed updates -->
&lt;p-uploader
  update-action="/mock-fail/update"
  delete-action="/mock-fail/delete"
  sequence-action="/mock-fail/sequence"
  ...&gt;</pre>
                    </div>
                    <p>With failure URLs:</p>
                    <ul>
                        <li>‚ùå Updates will revert to original values</li>
                        <li>‚ùå Deletes will show error and keep the file</li>
                        <li>‚ùå Sequence changes will revert to original order</li>
                    </ul>
                </div>
            </section>

            <footer class="page__footer">
                <nav class="footer__nav">
                    <h3>Quick Navigation</h3>
                    <ul class="footer__list">
                        <li><a href="/" class="footer__link">Home</a></li>
                        <li><a href="/ui-components" class="footer__link">UI Components</a></li>
                        <li><a href="/media" class="footer__link">Media</a></li>
                        <li><a href="/interactive" class="footer__link">Interactive</a></li>
                        <li><a href="/select-loader" class="footer__link">SelectLoader</a></li>
                        <li><a href="/performance" class="footer__link">Performance</a></li>
                        <li><a href="/uploader" class="footer__link">Uploader</a></li>
                    </ul>
                </nav>
            </footer>
        </main>

        <!-- Toast container -->
        <p-toasts placement="top-right"></p-toasts>

        <!-- Mock fetch API for demo -->
        <script>
            /* Mock fetch to simulate server responses
             * Use URL pattern /mock-fail/endpoint to simulate failures
             * Use URL pattern /mock/endpoint for successful responses
             */
            const originalFetch = window.fetch;
            window.fetch = async (url, options) => {
                console.log('üîµ Mock fetch called:', url, options);

                /* Check if this is a mock request */
                const isMock = url.includes('/mock/') || url.includes('/mock-fail/');
                if (!isMock) {
                    return originalFetch(url, options);
                }

                /* Simulate network delay */
                await new Promise(resolve => setTimeout(resolve, 500));

                /* Parse request body if present */
                const body = options?.body ? JSON.parse(options.body) : null;

                /* Check for failure mode */
                const shouldFail = url.includes('/mock-fail/');

                /* Mock update endpoint */
                if (url.includes('/update')) {
                    console.log('üìù Update request:', body);
                    if (shouldFail) {
                        return new Response('Update failed: Server error', { status: 400 });
                    }
                    return new Response(JSON.stringify({ success: true }), {
                        status: 200,
                        headers: { 'Content-Type': 'application/json' }
                    });
                }

                /* Mock delete endpoint */
                if (url.includes('/delete')) {
                    console.log('üóëÔ∏è Delete request:', body);
                    if (shouldFail) {
                        return new Response('Delete not allowed', { status: 403 });
                    }
                    return new Response(JSON.stringify({ success: true }), {
                        status: 200,
                        headers: { 'Content-Type': 'application/json' }
                    });
                }

                /* Mock sequence endpoint */
                if (url.includes('/sequence')) {
                    console.log('üîÑ Sequence update:', body);
                    if (shouldFail) {
                        return new Response('Sequence update failed', { status: 500 });
                    }
                    return new Response(JSON.stringify({ success: true }), {
                        status: 200,
                        headers: { 'Content-Type': 'application/json' }
                    });
                }

                /* Mock upload endpoint */
                if (url.includes('/upload')) {
                    console.log('üì§ Upload request');
                    if (shouldFail) {
                        return new Response('Upload failed: Invalid file', { status: 400 });
                    }
                    return new Response(JSON.stringify({
                        id: 'file_' + Date.now(),
                        preview: 'https://picsum.photos/200/200?random=' + Date.now(),
                        success: true
                    }), {
                        status: 200,
                        headers: { 'Content-Type': 'application/json' }
                    });
                }

                /* Default: use original fetch */
                return originalFetch(url, options);
            };
        </script>

        <!-- Load the framework -->
        <script type="module" src="dist/parallelogram-demo.min.js"></script>
    </body>
</html>