class WebComponentLoader{constructor(o={},e={}){this.componentMap=o,this.options={eager:e.eager??!0,observeDOM:e.observeDOM??!1,rootElement:e.rootElement??document.documentElement,onLoad:e.onLoad??null,onError:e.onError??null},this.loadedComponents=new Set,this.loadingComponents=new Map,this.observer=null}init(){this.options.eager&&this.scanAndLoad(),this.options.observeDOM&&this.startObserving()}scanAndLoad(o=this.options.rootElement){Object.keys(this.componentMap).forEach(e=>{if(!this.loadedComponents.has(e)){o.querySelectorAll(e).length>0&&this.loadComponent(e)}})}async loadComponent(o){if(this.loadedComponents.has(o))return;if(this.loadingComponents.has(o))return this.loadingComponents.get(o);if(!this.componentMap[o])return void console.warn(`[WebComponentLoader] No loader defined for component: ${o}`);const e=this.componentMap[o]().then(()=>{this.loadedComponents.add(o),this.loadingComponents.delete(o),this.options.onLoad&&this.options.onLoad(o)}).catch(e=>{this.loadingComponents.delete(o),this.options.onError?this.options.onError(o,e):console.error(`[WebComponentLoader] Failed to load component: ${o}`,e)});return this.loadingComponents.set(o,e),e}startObserving(){this.observer||(this.observer=new MutationObserver(o=>{const e=new Set;o.forEach(o=>{o.addedNodes.forEach(o=>{o.nodeType===Node.ELEMENT_NODE&&e.add(o)})}),e.forEach(o=>{Object.keys(this.componentMap).forEach(e=>{this.loadedComponents.has(e)||(o.tagName?.toLowerCase()===e||o.querySelector&&o.querySelector(e))&&this.loadComponent(e)})})}),this.observer.observe(this.options.rootElement,{childList:!0,subtree:!0}))}stopObserving(){this.observer&&(this.observer.disconnect(),this.observer=null)}register(o,e){this.componentMap[o]=e}unregister(o){delete this.componentMap[o]}isLoaded(o){return this.loadedComponents.has(o)}isLoading(o){return this.loadingComponents.has(o)}destroy(){this.stopObserving(),this.loadedComponents.clear(),this.loadingComponents.clear()}}export{WebComponentLoader,WebComponentLoader as default};
