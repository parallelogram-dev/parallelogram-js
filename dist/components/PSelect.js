class TransitionManager{constructor({root:e=document,defaultY:t="1rem",defaultDur:r=320,defaultEase:o="cubic-bezier(0.22,1,0.36,1)"}={}){this.root=e,this.defaults={y:t,dur:r,ease:o}}async enter(e){const t=e.dataset.transitionEnterClass;return t?this._animateWithClass(e,t):this._animateWithJS(e,!0)}async exit(e){const t=e.dataset.transitionExitClass;return t?this._animateWithClass(e,t):this._animateWithJS(e,!1)}_animateWithClass(e,t){return new Promise(r=>{const o=()=>{e.removeEventListener("animationend",o),r()};e.addEventListener("animationend",o,{once:!0}),e.classList.add(t)})}_animateWithJS(e,t){const r=e.dataset.transitionY||this.defaults.y,o=Number(e.dataset.transitionDuration||this.defaults.dur),s=e.dataset.transitionEase||this.defaults.ease;return e.style.transition=`opacity ${o}ms ${s}, transform ${o}ms ${s}`,t?(e.style.opacity=0,e.style.transform=`translateY(${r})`,e.getBoundingClientRect(),e.style.opacity=1,e.style.transform="translateY(0)"):(e.style.opacity=1,e.style.transform="translateY(0)",e.getBoundingClientRect(),e.style.opacity=0,e.style.transform=`translateY(${r})`),new Promise(t=>setTimeout(()=>{e.style.transition="",t()},o))}async swap(e,t){const r=e.firstElementChild;r&&await this.exit(r),e.innerHTML="",t&&e.appendChild(t),t&&await this.enter(t)}}class PSelect extends HTMLElement{static formAssociated=!0;constructor(){if(super(),!this.attachInternals)throw new Error("PSelect requires form-associated custom elements support");this._internals=this.attachInternals(),this.attachShadow({mode:"open"}),this.tm=new TransitionManager,this.state={options:[],filtered:[],value:"",open:!1,highlightedIndex:-1,src:null,debounce:200,min:0,openOnFocus:!0,placeholder:this.getAttribute("placeholder")||"Select…",disabled:!1,required:!1,loading:!1,error:null},this._abortController=null,this._searchTimeout=null,this._announcementRegion=null,this._render(),this._setupEventListeners(),this._initializeFromAttributes()}connectedCallback(){this._createAnnouncementRegion(),this._parseOptionsFromDOM(),this.state.src&&0===this.state.min&&this._fetchOptions("").catch(this._handleFetchError.bind(this))}disconnectedCallback(){this._cancelPendingRequest(),this._searchTimeout&&clearTimeout(this._searchTimeout),this._announcementRegion&&this._announcementRegion.remove()}static get observedAttributes(){return["value","placeholder","disabled","name","required"]}attributeChangedCallback(e,t,r){if(t!==r)switch(e){case"value":this._updateValue(r);break;case"placeholder":this.state.placeholder=r||"Select…",this._updatePlaceholder();break;case"disabled":this._updateDisabledState(null!==r);break;case"name":this.name=r||"";break;case"required":this._updateRequiredState(null!==r)}}_render(){this.shadowRoot.innerHTML='\n      <style>:root{--surface-control-radius:0.25em;--surface-control-border-width:1px;--surface-control-border-color:rgba(0,0,0,.1);--surface-control-color-bg:#fff;--surface-control-color-text:currentColor;--surface-control-shadow:none;--surface-button-radius:0.25em;--surface-button-border-width:1px;--surface-button-shadow:none;--surface-panel-radius:0.5em;--surface-panel-border-width:1px;--surface-panel-border-color:rgba(0,0,0,.1);--surface-panel-color-bg:#fff;--surface-panel-color-text:currentColor;--surface-panel-shadow:0 4px 6px rgba(0,0,0,.12);--surface-dialog-radius:0.75em;--surface-dialog-border-width:1px;--surface-dialog-border-color:rgba(0,0,0,.1);--surface-dialog-color-bg:#fff;--surface-dialog-color-text:currentColor;--surface-dialog-shadow:0 1.25em 3em rgba(0,0,0,.5);--surface-dropdown-radius:0.25em;--surface-dropdown-border-width:1px;--surface-dropdown-border-color:rgba(0,0,0,.1);--surface-dropdown-color-bg:#fff;--surface-dropdown-color-text:currentColor;--surface-dropdown-shadow:0 4px 6px rgba(0,0,0,.12);--surface-dropdown-item-hover-bg:#f5f5f5;--surface-dropdown-item-selected-bg:rgba(59,130,246,.1);--surface-dropdown-item-current-bg:#f5f5f5;--surface-item-radius:0.25em;--surface-item-border-width:1px;--surface-item-border-color:rgba(0,0,0,.1);--surface-item-color-bg:transparent;--surface-item-color-text:currentColor;--surface-item-shadow:none;--surface-card-radius:0.125em;--surface-card-border-width:1px;--surface-card-border-color:#d4d4d4;--surface-card-color-bg:#fff;--surface-card-color-text:currentColor;--surface-card-shadow:none;--surface-touch-radius:0.125em;--surface-touch-border-width:1px;--surface-touch-border-color:#d4d4d4;--surface-touch-color-bg:#f5f5f5;--surface-touch-color-text:currentColor;--surface-touch-shadow:none;--surface-touch-hover-bg:#f5f5f5;--surface-touch-hover-border-color:rgba(59,130,246,.5);--form-control-padding-y:0.25em;--form-control-padding-x:0.75em;--form-control-padding-y-sm:0.125em;--form-control-padding-x-sm:0.5em;--form-control-padding-y-lg:0.5em;--form-control-padding-x-lg:1.25em;--form-control-border-width:var(--surface-control-border-width);--form-control-border-color:var(--surface-control-border-color);--form-control-border-radius:var(--surface-control-radius);--form-control-bg:var(--surface-control-color-bg);--form-control-color:var(--surface-control-color-text);--form-control-placeholder-color:rgba(0,0,0,.5);--form-control-focus-ring-width:2px;--form-control-focus-ring-color:#3b82f6;--form-control-focus-border-color:#3b82f6;--form-control-hover-border-color:#d4d4d4;--form-control-disabled-opacity:0.3;--form-control-disabled-bg:#f5f5f5;--form-control-font-size:0.875em;--form-control-font-size-sm:0.75em;--form-control-font-size-lg:1em;--form-control-font-family:inherit;--button-padding-y:0.25em;--button-padding-x:0.75em;--button-padding-y-sm:0.125em;--button-padding-x-sm:0.5em;--button-padding-y-lg:0.5em;--button-padding-x-lg:1.25em;--button-font-size:0.875em;--button-font-size-sm:0.75em;--button-font-size-lg:1em;--button-font-weight:600;--button-border-width:var(--surface-button-border-width);--button-border-radius:var(--surface-button-radius);--button-min-height:2.5em;--button-min-height-sm:2em;--button-min-height-lg:3em;--button-primary-bg:#3b82f6;--button-primary-color:#fff;--button-primary-border:#3b82f6;--button-primary-hover-bg:#2563eb;--button-primary-hover-border:#2563eb;--button-secondary-bg:transparent;--button-secondary-color:currentColor;--button-secondary-border:#d4d4d4;--button-secondary-hover-bg:#f5f5f5;--button-secondary-hover-border:#d4d4d4;--button-danger-bg:#ef4444;--button-danger-color:#fff;--button-danger-border:#ef4444;--button-danger-hover-bg:#dc2626;--button-danger-hover-border:#dc2626;--button-ghost-bg:transparent;--button-ghost-color:currentColor;--button-ghost-border:currentColor;--button-ghost-hover-bg:rgba(0,0,0,.05);--panel-bg:var(--surface-panel-color-bg);--panel-border-width:var(--surface-panel-border-width);--panel-border-color:var(--surface-panel-border-color);--panel-border-radius:var(--surface-panel-radius);--panel-color:var(--surface-panel-color-text);--panel-shadow:var(--surface-panel-shadow);--panel-padding:0.75em;--panel-padding-sm:0.5em;--panel-padding-lg:1.25em;--panel-header-padding:0.5em 0.75em;--panel-header-border:1px solid rgba(0,0,0,.1);--panel-footer-padding:0.5em 0.75em;--panel-footer-border:1px solid rgba(0,0,0,.1);--modal-bg:var(--surface-dialog-color-bg);--modal-border-width:var(--surface-dialog-border-width);--modal-border-color:var(--surface-dialog-border-color);--modal-border-radius:var(--surface-dialog-radius);--modal-color:var(--surface-dialog-color-text);--modal-shadow:var(--surface-dialog-shadow);--modal-backdrop-bg:rgba(0,0,0,.5)}@media (prefers-color-scheme:dark){:root{--form-control-bg:#171717;--form-control-color:#fff;--form-control-border-color:#525252;--form-control-placeholder-color:hsla(0,0%,100%,.5);--button-secondary-hover-bg:#525252;--panel-bg:#171717;--panel-border-color:#525252}}:host{box-sizing:border-box;display:inline-block;position:relative}:host{--select-border-color:var(--surface-control-border-color);--select-focus-color:#3b82f6;--select-bg:var(--surface-control-color-bg);--select-text:var(--surface-control-color-text);--select-placeholder:rgba(0,0,0,.5);--select-hover-bg:var(--surface-dropdown-item-hover-bg);--select-selected-bg:var(--surface-dropdown-item-selected-bg);--select-current-bg:var(--surface-dropdown-item-current-bg);--select-padding:0.45rem 0.6rem;--select-border-radius:var(--surface-control-radius);--select-border:var(--surface-control-border-width) solid var(--select-border-color);--select-focus-shadow:inset 0 0 0 3px rgba(59,130,246,.3);--menu-border-radius:var(--surface-dropdown-radius);--menu-border-color:var(--surface-dropdown-border-color);--menu-bg:var(--surface-dropdown-color-bg);--menu-shadow:var(--surface-dropdown-shadow)}@media (prefers-color-scheme:dark){:host{--select-placeholder:hsla(0,0%,100%,.5);--select-hover-bg:hsla(0,0%,100%,.1)}}.root{background:inherit;border:inherit;border-radius:inherit;color:inherit;font-family:inherit;font-size:inherit;height:100%;width:100%}.control,.root{box-sizing:border-box;left:0;padding:inherit;position:absolute;top:0}.control{align-items:center;bottom:0;cursor:pointer;display:flex;gap:.4rem;right:0;transition:border-color .2s ease,box-shadow .2s ease}.input{background:transparent;border:0;color:inherit;flex:1;font:inherit;min-width:2ch;outline:0;padding:0}.input::placeholder{color:inherit;opacity:.6}.arrow{flex-shrink:0;margin-left:auto;pointer-events:none;transition:transform .15s ease;user-select:none}.control[aria-expanded=true] .arrow{transform:rotate(180deg)}.menu{background:var(--menu-bg);border:var(--surface-dropdown-border-width,1px) solid var(--menu-border-color);border-radius:var(--menu-border-radius);box-shadow:var(--menu-shadow);color:var(--select-text);left:0;margin-top:.25rem;max-height:240px;overflow:auto;position:absolute;right:0;top:100%;z-index:10}.option{cursor:pointer;padding:.45rem .6rem;transition:background-color .15s ease}.option:hover{background:var(--select-hover-bg)}.option[aria-selected=true]{background:var(--select-selected-bg);font-weight:500}.option[aria-current=true]{background:var(--select-current-bg)}.option[aria-disabled=true]{background:transparent!important;cursor:not-allowed;opacity:.5}.noresults{font-style:italic;opacity:.6;padding:.6rem;text-align:center}</style>\n\n      <div class="root">\n        <div\n          class="control"\n          role="combobox"\n          aria-expanded="false"\n          aria-haspopup="listbox"\n        >\n          <input\n            class="input"\n            type="text"\n            autocomplete="off"\n          />\n          <span class="arrow" aria-hidden="true">▾</span>\n        </div>\n\n        <div class="menu" role="listbox" hidden></div>\n      </div>\n    ',this._els={control:this.shadowRoot.querySelector(".control"),input:this.shadowRoot.querySelector(".input"),menu:this.shadowRoot.querySelector(".menu"),arrow:this.shadowRoot.querySelector(".arrow")},this._updateDisplay()}_setupEventListeners(){this._els.control.addEventListener("mousedown",e=>{e.target!==this._els.input&&(e.preventDefault(),this._els.input.focus(),this.toggle())}),this._els.input.addEventListener("focus",()=>{this.state.openOnFocus&&this.open()}),this._els.input.addEventListener("input",e=>{this._handleInput(e)}),this._els.input.addEventListener("keydown",e=>{this._handleKeydown(e)}),document.addEventListener("click",e=>{this.contains(e.target)||this.shadowRoot.contains(e.target)||this.close()})}_initializeFromAttributes(){const e=this.dataset;this.state.src=e.selectSrc||null,this.state.debounce=Number(e.selectDebounce||200),this.state.min=Number(e.selectMin||0),this.state.openOnFocus="false"!==(e.selectOpenOnFocus??"true"),this.state.disabled=this.hasAttribute("disabled"),this.state.required=this.hasAttribute("required"),this.name=this.getAttribute("name")||""}_createAnnouncementRegion(){this._announcementRegion=document.createElement("div"),this._announcementRegion.setAttribute("aria-live","polite"),this._announcementRegion.style.cssText="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0)",document.body.appendChild(this._announcementRegion)}_announce(e){this._announcementRegion&&(this._announcementRegion.textContent=e)}_parseOptionsFromDOM(){const e=[];this.querySelectorAll("option").forEach((t,r)=>{const o=t.hasAttribute("disabled"),s=t.hasAttribute("selected"),a={value:t.value||t.textContent.trim(),label:t.textContent.trim(),disabled:o,selected:s};e.push(a),a.selected&&(this.state.value=a.value),t.style.display="none"}),e.length>0&&(this.setOptions(e),this._updateDisplay())}_handleInput(e){const t=e.target.value;this.state.src&&t.length>=this.state.min?(this._cancelPendingRequest(),this._searchTimeout=setTimeout(()=>{this._fetchOptions(t).catch(this._handleFetchError.bind(this))},this.state.debounce)):this._filterLocal(t)}_handleKeydown(e){if(!this.state.open)return void("ArrowDown"!==e.key&&"Enter"!==e.key||(e.preventDefault(),this.open()));const t=this.state.filtered.length-1;switch(e.key){case"ArrowDown":e.preventDefault(),this.state.highlightedIndex=Math.min(t,this.state.highlightedIndex+1),this._renderOptions();break;case"ArrowUp":e.preventDefault(),this.state.highlightedIndex=Math.max(0,this.state.highlightedIndex-1),this._renderOptions();break;case"Enter":if(e.preventDefault(),this.state.highlightedIndex>=0&&this.state.highlightedIndex<this.state.filtered.length){const e=this.state.filtered[this.state.highlightedIndex];e&&!e.disabled&&this.select(e.value)}break;case"Escape":e.preventDefault(),this.close()}}_cancelPendingRequest(){this._abortController&&(this._abortController.abort(),this._abortController=null),this._searchTimeout&&(clearTimeout(this._searchTimeout),this._searchTimeout=null)}async _fetchOptions(e){this.state.loading=!0}_handleFetchError(e){this.state.error=e.message,this._announce(`Error: ${e.message}`)}_filterLocal(e){const t=e.trim().toLowerCase();if(this.state.filtered=this.state.options.filter(e=>e.label.toLowerCase().includes(t)),!t&&this.state.value){const e=this.state.filtered.findIndex(e=>e.value===this.state.value);this.state.highlightedIndex=e>=0?e:-1}else this.state.highlightedIndex=this.state.filtered.length>0?0:-1;this._renderOptions()}_updateDisplay(){if(this.state.value){const e=this.state.options.find(e=>e.value===this.state.value);this._els.input.value=e?e.label:""}else this._els.input.value="",this._els.input.placeholder=this.state.placeholder}_updateValue(e){this.state.value=e,this._updateDisplay()}_updatePlaceholder(){this._els.input.placeholder=this.state.placeholder}_updateDisabledState(e){this.state.disabled=e,this._els.input.disabled=e}_updateRequiredState(e){this.state.required=e,this._els.input.required=e}open(){if(!this.state.open&&!this.state.disabled){if(this.state.open=!0,this.state.value){const e=this.state.filtered.findIndex(e=>e.value===this.state.value);this.state.highlightedIndex=e>=0?e:-1}else this.state.highlightedIndex=-1;this._els.control.setAttribute("aria-expanded","true"),this._els.menu.hidden=!1,this._renderOptions(),this.tm.enter(this._els.menu),this.dispatchEvent(new CustomEvent("p-select:open",{bubbles:!0}))}}close(){this.state.open&&(this.state.open=!1,this._els.control.setAttribute("aria-expanded","false"),this.tm.exit(this._els.menu).then(()=>{this._els.menu.hidden=!0}),this.dispatchEvent(new CustomEvent("p-select:close",{bubbles:!0})))}toggle(){this.state.open?this.close():this.open()}select(e){const t=this.state.options.find(t=>t.value==e);t&&!t.disabled&&(this.state.value=t.value,this._setFormValue(t.value,t.label),this._els.input.value=t.label,this.dispatchEvent(new CustomEvent("p-select:change",{detail:{value:t.value,label:t.label},bubbles:!0})),this.close())}setOptions(e){this.state.options=Array.isArray(e)?e.slice():[],this.state.filtered=this.state.options.slice(),this._renderOptions()}getValue(){return this.state.value}clear(){this.state.value="",this._setFormValue("",""),this._els.input.value="",this._els.input.placeholder=this.state.placeholder}get value(){return this.state.value}set value(e){this._updateValue(e)}refreshOptions(){this._parseOptionsFromDOM()}debug(){return{options:this.state.options,filtered:this.state.filtered,value:this.state.value,domOptions:this.querySelectorAll("option").length}}_setFormValue(e,t){if(this._internals?.setFormValue){const r=new FormData;this.name&&r.set(this.name,e),this._internals.setFormValue(r,t)}}_renderOptions(){const e=this._els.menu;e.innerHTML="";const t=this.state.filtered;if(0===t.length){const t=document.createElement("div");return t.className="noresults",t.textContent="No results found",void e.appendChild(t)}t.forEach((t,r)=>{const o=document.createElement("div");o.className="option",o.setAttribute("role","option");const s=this.state.value&&t.value===this.state.value;o.setAttribute("aria-selected",String(s)),o.textContent=t.label,t.disabled&&o.setAttribute("aria-disabled","true"),r===this.state.highlightedIndex&&o.setAttribute("aria-current","true"),t.disabled||o.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.select(t.value)}),e.appendChild(o)})}}customElements.get("p-select")||customElements.define("p-select",PSelect);export{PSelect as default};
