function t(t){return t.replace(/-([a-z])/g,t=>t[1].toUpperCase())}function e(t=document){return Array.from(t.querySelectorAll(["a[href]","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"]):not([disabled])'].join(",")))}class BaseComponent{constructor({eventBus:t,logger:e,router:a}){this.eventBus=t,this.logger=e,this.router=a,this.elements=new WeakMap,this.states=this.elements,this._keys=null}mount(t){if(this.elements.has(t))return this.update(t);const e=this._init(t);this.elements.set(t,e)}update(t){}unmount(t){const e=this.elements.get(t);if(e)try{e.cleanup?.()}finally{this.elements.delete(t)}}destroy(){for(const t of this._elementsKeys())this.unmount(t)}_elementsKeys(){return this._keys||(this._keys=new Set),this._keys}_track(t){this._keys||(this._keys=new Set),this._keys.add(t)}_untrack(t){this._keys?.delete(t)}_init(t){const e=new AbortController;return this._track(t),{cleanup:()=>{e.abort(),this._untrack(t)},controller:e}}getState(t){return this.elements.get(t)}_getDataAttr(e,a,n){return function(e,a,n){const s=a.includes("-")?t(a):a,r=e.dataset[s];return void 0===r?n:"true"===r||"false"!==r&&(isNaN(r)||""===r?r:Number(r))}(e,a,n)}_camelCase(e){return t(e)}_debounce(t,e=300){return function(t,e=300){let a;return function(...n){clearTimeout(a),a=setTimeout(()=>{clearTimeout(a),t.apply(this,n)},e)}}(t,e)}_throttle(t,e=100){return function(t,e=100){let a;return function(...n){a||(t.apply(this,n),a=!0,setTimeout(()=>{a=!1},e))}}(t,e)}_delay(t){return function(t){return new Promise(e=>setTimeout(e,t))}(t)}_getTargetElement(t,e,a={}){const n=`${e}-view`,s=this.getAttr(t,n);if(s){const t=document.querySelector(`[data-view="${s}"]`);return!t&&a.required,t}const r=this.getAttr(t,e);if(!r)return a.required,null;const i=document.querySelector(r);return!i&&a.required,i}_getConfigFromAttrs(t,e){const a={};for(const[n,s]of Object.entries(e)){const e=this.constructor.defaults?.[n];a[n]=this.getAttr(t,s,e)}return a}_requireState(t,e="method"){return this.getState(t)}_generateId(t="elem"){return function(t="elem"){return`${t}-${Date.now()}-${Math.random().toString(36).slice(2,9)}`}(t)}async _waitForTransition(t,e=2e3){return async function(t,e=2e3){return new Promise(a=>{const n=()=>{t.removeEventListener("animationend",n),t.removeEventListener("transitionend",n),a()};t.addEventListener("animationend",n,{once:!0}),t.addEventListener("transitionend",n,{once:!0}),setTimeout(()=>{t.removeEventListener("animationend",n),t.removeEventListener("transitionend",n),a()},e)})}(t,e)}async _fadeIn(t,e=300){return async function(t,e=300){return t.style.opacity="0",t.style.transition=`opacity ${e}ms ease-in-out`,t.offsetHeight,t.style.opacity="1",new Promise(a=>{setTimeout(()=>{t.style.transition="",a()},e)})}(t,e)}async _fadeOut(t,e=300){return async function(t,e=300){return t.style.opacity="1",t.style.transition=`opacity ${e}ms ease-in-out`,t.offsetHeight,t.style.opacity="0",new Promise(a=>{setTimeout(()=>{t.style.transition="",a()},e)})}(t,e)}_getFocusableElements(t=document){return e(t)}_trapFocus(t,a){return function(t,a){const n=e(t);if(!n.length)return;const s=n[0],r=n[n.length-1],i=t.contains(document.activeElement)?document.activeElement:null;!a.shiftKey||i!==s&&i?a.shiftKey||i!==r||(s.focus(),a.preventDefault()):(r.focus(),a.preventDefault())}(t,a)}_restoreFocus(t){return function(t){t&&"function"==typeof t.focus&&requestAnimationFrame(()=>t.focus())}(t)}_createElement(t,e={},a=""){return function(t,e={},a=""){const n=document.createElement(t);for(const[t,a]of Object.entries(e))"className"===t||"class"===t?n.className=a:"style"===t&&"object"==typeof a?Object.assign(n.style,a):"dataset"===t&&"object"==typeof a?Object.assign(n.dataset,a):n.setAttribute(t,a);return"string"==typeof a?n.textContent=a:a instanceof HTMLElement&&n.appendChild(a),n}(t,e,a)}_dispatch(t,e,a){const n=new CustomEvent(e,{detail:a,bubbles:!0,cancelable:!0});return t.dispatchEvent(n),this.eventBus?.emit(e,{element:t,...a}),n}_getSelector(){if(this._selector)return this._selector;const t=this.constructor.name.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();return this._selector=`data-${t}`,this._selector}setState(t,e){t.setAttribute(this._getSelector(),e)}getElementState(t){return t.getAttribute(this._getSelector())}setAttr(t,e,a){t.setAttribute(`${this._getSelector()}-${e}`,String(a))}getAttr(t,e,a=null){const n=t.getAttribute(`${this._getSelector()}-${e}`);return null!==n?n:a}removeAttr(t,e){t.removeAttribute(`${this._getSelector()}-${e}`)}hasAttr(t,e){return t.hasAttribute(`${this._getSelector()}-${e}`)}}class Tabs extends BaseComponent{_getSelector(){return"data-tabs"}static get defaults(){return{activeClass:"tab--active",panelActiveClass:"tab-panel--active",defaultTab:null,keyboardNavigation:!0,autoFocus:!1,transitionDuration:200,transitionClass:"tab-panel--transitioning"}}_init(t){const e=super._init(t),a=t.querySelector("[data-tabs-list]"),n=t.querySelector("[data-tabs-panels]");if(!a||!n)return e;const s=[...a.querySelectorAll("[data-tab]")],r=[...n.querySelectorAll("[data-tab-panel]")];if(0===s.length||0===r.length)return e;const i=this.getAttr(t,"default-tab",Tabs.defaults.defaultTab),o=this.getAttr(t,"keyboard",Tabs.defaults.keyboardNavigation),c=this.getAttr(t,"autofocus",Tabs.defaults.autoFocus);e.tabsList=a,e.tabsContainer=n,e.tabs=s,e.panels=r,e.activeTab=null,e.activePanel=null,e.keyboardNavigation=o,e.autoFocus=c,this._setupTabs(t,e);const l=this._getInitialTab(s,i);l&&this._activateTab(t,l.dataset.tab,e,!1),this._setupEventListeners(t,e),this.setAttr(t,"enhanced","true"),t.classList.add("tabs--enhanced");const u=e.cleanup;return e.cleanup=()=>{this._removeEventListeners(t,e),this.removeAttr(t,"enhanced"),t.classList.remove("tabs--enhanced"),u()},this.eventBus?.emit("tabs:mount",{element:t,tabCount:s.length,panelCount:r.length,timestamp:performance.now()}),e}_setupTabs(t,e){e.tabs.forEach((t,a)=>{t.setAttribute("role","tab"),t.setAttribute("tabindex","-1"),t.id||(t.id=function(t="elem"){return`${t}-${Date.now()}-${Math.random().toString(36).slice(2,9)}`}("tab"));const n=t.dataset.tab,s=e.panels.find(t=>t.id===n);s&&(s.setAttribute("role","tabpanel"),s.setAttribute("aria-labelledby",t.id),s.setAttribute("tabindex","0"),s.getAttribute("data-tab-panel")||s.setAttribute("data-tab-panel","inactive"))}),e.tabsList.setAttribute("role","tablist")}_getInitialTab(t,e){const a=t.find(t=>"true"===t.getAttribute("aria-selected"));if(a)return a;if(e){const a=t.find(t=>t.dataset.tab===e);if(a)return a}return t[0]}_setupEventListeners(t,e){e.clickHandlers=new Map,e.keydownHandlers=new Map,e.tabs.forEach(a=>{const n=a=>this._handleTabClick(a,t,e),s=a=>this._handleKeyDown(a,t,e);a.addEventListener("click",n),e.keyboardNavigation&&a.addEventListener("keydown",s),e.clickHandlers.set(a,n),e.keydownHandlers.set(a,s)})}_removeEventListeners(t,e){e.clickHandlers&&e.clickHandlers.forEach((t,e)=>{e.removeEventListener("click",t)}),e.keydownHandlers&&e.keydownHandlers.forEach((t,e)=>{e.removeEventListener("keydown",t)})}_handleTabClick(t,e,a){t.preventDefault();const n=t.currentTarget.dataset.tab;n&&n!==a.activeTab&&this._activateTab(e,n,a,!0)}_handleKeyDown(t,e,a){const n=a.tabs.findIndex(e=>e===t.currentTarget);let s=-1;switch(t.key){case"ArrowRight":case"ArrowDown":t.preventDefault(),s=(n+1)%a.tabs.length;break;case"ArrowLeft":case"ArrowUp":t.preventDefault(),s=(n-1+a.tabs.length)%a.tabs.length;break;case"Home":t.preventDefault(),s=0;break;case"End":t.preventDefault(),s=a.tabs.length-1;break;case"Enter":case" ":t.preventDefault();const r=t.currentTarget.dataset.tab;return void this._activateTab(e,r,a,!0)}if(s>=0){const t=a.tabs[s];a.autoFocus&&t.focus(),this._activateTab(e,t.dataset.tab,a,!0)}}async _activateTab(t,e,a,n=!0){const s=a.tabs.find(t=>t.dataset.tab===e),r=a.panels.find(t=>t.id===e);if(!s||!r)return;const i=a.activeTab,o=a.activePanel;a.tabs.forEach(t=>{const a=t.dataset.tab===e;t.setAttribute("aria-selected",a?"true":"false"),t.setAttribute("tabindex",a?"0":"-1")}),n&&o&&o!==r?await this._transitionPanels(o,r,a):a.panels.forEach(t=>{const a=t.id===e;t.style.display=a?"":"none",t.setAttribute("data-tab-panel",a?"active":"inactive")}),a.activeTab=e,a.activePanel=r,a.autoFocus&&s.focus(),this._dispatch(t,"tabs:change",{activeTab:e,previousTab:i,tab:s,panel:r}),this.eventBus?.emit("tabs:change",{element:t,activeTab:e,previousTab:i,tab:s,panel:r,timestamp:performance.now()})}async _transitionPanels(t,e,a){const n=Tabs.defaults.transitionDuration;t.setAttribute("data-tab-panel","transitioning"),e.setAttribute("data-tab-panel","transitioning"),e.style.display="",t.style.opacity="0",await new Promise(t=>setTimeout(t,n/2)),t.style.display="none",t.setAttribute("data-tab-panel","inactive"),t.style.opacity="",e.style.opacity="0",requestAnimationFrame(()=>{e.style.transition=`opacity ${n}ms ease-in-out`,e.style.opacity="1"}),setTimeout(()=>{e.style.transition="",e.style.opacity="",e.setAttribute("data-tab-panel","active")},n)}activateTab(t,e){const a=this.getState(t);a&&this._activateTab(t,e,a,!0)}getActiveTab(t){const e=this.getState(t);return e?e.activeTab:null}getStatus(){const t=document.querySelectorAll("[data-tabs]"),e=[];let a=0,n=0;return t.forEach(t=>{const s=this.getState(t);s&&this.hasAttr(t,"enhanced")&&(e.push(t),a+=s.tabs.length,n+=s.panels.length)}),{containers:e.length,totalTabs:a,totalPanels:n,keyboardNavigationSupported:!0,defaults:Tabs.defaults}}static enhanceAll(t="[data-tabs]",e){const a=new Tabs(e);return document.querySelectorAll(t).forEach(t=>{a.mount(t)}),a}}export{Tabs as default};
