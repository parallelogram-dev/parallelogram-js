function t(t){return t.replace(/-([a-z])/g,t=>t[1].toUpperCase())}function e(t=document){return Array.from(t.querySelectorAll(["a[href]","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"]):not([disabled])'].join(",")))}class BaseComponent{constructor({eventBus:t,logger:e,router:s}){this.eventBus=t,this.logger=e,this.router=s,this.elements=new WeakMap,this.states=this.elements,this._keys=null}mount(t){if(this.elements.has(t))return this.update(t);const e=this._init(t);this.elements.set(t,e)}update(t){}unmount(t){const e=this.elements.get(t);if(e)try{e.cleanup?.()}finally{this.elements.delete(t)}}destroy(){for(const t of this._elementsKeys())this.unmount(t)}_elementsKeys(){return this._keys||(this._keys=new Set),this._keys}_track(t){this._keys||(this._keys=new Set),this._keys.add(t)}_untrack(t){this._keys?.delete(t)}_init(t){const e=new AbortController;return this._track(t),{cleanup:()=>{e.abort(),this._untrack(t)},controller:e}}getState(t){return this.elements.get(t)}_getDataAttr(e,s,n){return function(e,s,n){const r=s.includes("-")?t(s):s,a=e.dataset[r];return void 0===a?n:"true"===a||"false"!==a&&(isNaN(a)||""===a?a:Number(a))}(e,s,n)}_camelCase(e){return t(e)}_debounce(t,e=300){return function(t,e=300){let s;return function(...n){clearTimeout(s),s=setTimeout(()=>{clearTimeout(s),t.apply(this,n)},e)}}(t,e)}_throttle(t,e=100){return function(t,e=100){let s;return function(...n){s||(t.apply(this,n),s=!0,setTimeout(()=>{s=!1},e))}}(t,e)}_delay(t){return function(t){return new Promise(e=>setTimeout(e,t))}(t)}_getTargetElement(t,e,s={}){const n=`${e}-view`,r=this.getAttr(t,n);if(r){const t=document.querySelector(`[data-view="${r}"]`);return!t&&s.required,t}const a=this.getAttr(t,e);if(!a)return s.required,null;const i=document.querySelector(a);return!i&&s.required,i}_getConfigFromAttrs(t,e){const s={};for(const[n,r]of Object.entries(e)){const e=this.constructor.defaults?.[n];s[n]=this.getAttr(t,r,e)}return s}_requireState(t,e="method"){return this.getState(t)}_generateId(t="elem"){return function(t="elem"){return`${t}-${Date.now()}-${Math.random().toString(36).slice(2,9)}`}(t)}async _waitForTransition(t,e=2e3){return async function(t,e=2e3){return new Promise(s=>{const n=()=>{t.removeEventListener("animationend",n),t.removeEventListener("transitionend",n),s()};t.addEventListener("animationend",n,{once:!0}),t.addEventListener("transitionend",n,{once:!0}),setTimeout(()=>{t.removeEventListener("animationend",n),t.removeEventListener("transitionend",n),s()},e)})}(t,e)}async _fadeIn(t,e=300){return async function(t,e=300){return t.style.opacity="0",t.style.transition=`opacity ${e}ms ease-in-out`,t.offsetHeight,t.style.opacity="1",new Promise(s=>{setTimeout(()=>{t.style.transition="",s()},e)})}(t,e)}async _fadeOut(t,e=300){return async function(t,e=300){return t.style.opacity="1",t.style.transition=`opacity ${e}ms ease-in-out`,t.offsetHeight,t.style.opacity="0",new Promise(s=>{setTimeout(()=>{t.style.transition="",s()},e)})}(t,e)}_getFocusableElements(t=document){return e(t)}_trapFocus(t,s){return function(t,s){const n=e(t);if(!n.length)return;const r=n[0],a=n[n.length-1],i=t.contains(document.activeElement)?document.activeElement:null;!s.shiftKey||i!==r&&i?s.shiftKey||i!==a||(r.focus(),s.preventDefault()):(a.focus(),s.preventDefault())}(t,s)}_restoreFocus(t){return function(t){t&&"function"==typeof t.focus&&requestAnimationFrame(()=>t.focus())}(t)}_createElement(t,e={},s=""){return function(t,e={},s=""){const n=document.createElement(t);for(const[t,s]of Object.entries(e))"className"===t||"class"===t?n.className=s:"style"===t&&"object"==typeof s?Object.assign(n.style,s):"dataset"===t&&"object"==typeof s?Object.assign(n.dataset,s):n.setAttribute(t,s);return"string"==typeof s?n.textContent=s:s instanceof HTMLElement&&n.appendChild(s),n}(t,e,s)}_dispatch(t,e,s){const n=new CustomEvent(e,{detail:s,bubbles:!0,cancelable:!0});return t.dispatchEvent(n),this.eventBus?.emit(e,{element:t,...s}),n}_getSelector(){if(this._selector)return this._selector;const t=this.constructor.name.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();return this._selector=`data-${t}`,this._selector}setState(t,e){t.setAttribute(this._getSelector(),e)}getElementState(t){return t.getAttribute(this._getSelector())}setAttr(t,e,s){t.setAttribute(`${this._getSelector()}-${e}`,String(s))}getAttr(t,e,s=null){const n=t.getAttribute(`${this._getSelector()}-${e}`);return null!==n?n:s}removeAttr(t,e){t.removeAttribute(`${this._getSelector()}-${e}`)}hasAttr(t,e){return t.hasAttribute(`${this._getSelector()}-${e}`)}}class Toast extends BaseComponent{_getSelector(){return"data-toast"}static get defaults(){return{defaultDuration:4e3,defaultType:"info",fadeOutDuration:300,typeMapping:{info:"info",success:"success",warn:"warning",warning:"warning",error:"error",danger:"error"}}}_init(t){const e=super._init(t),s=this.getAttr(t,"message"),n=this.getAttr(t,"trigger",Toast.defaults.defaultType),r=parseInt(this.getAttr(t,"duration",Toast.defaults.defaultDuration)),a=this.getAttr(t,"title"),i="false"!==this.getAttr(t,"dismissible","true");if(!t.hasAttribute("data-toast-trigger"))return e;if(!s)return e;e.message=s,e.type=n,e.duration=r,e.title=a,e.dismissible=i;const o=e=>this._handleClick(e,t);t.addEventListener("click",o),t.setAttribute("data-toast-enhanced","true"),t.classList.add("toast-trigger--enhanced");const u=e.cleanup;return e.cleanup=()=>{t.removeEventListener("click",o),t.removeAttribute("data-toast-enhanced"),t.classList.remove("toast-trigger--enhanced"),u()},this.eventBus?.emit("toast:mount",{element:t,message:s,type:n,timestamp:performance.now()}),e}_handleClick(t,e){t.preventDefault();const s=this.getState(e);if(!s)return;const n=Toast.defaults.typeMapping[s.type]||s.type;this._showToast({message:s.message,type:n,duration:s.duration,title:s.title,dismissible:s.dismissible,trigger:e})}_showToast(t){const{message:e,type:s=Toast.defaults.defaultType,duration:n=Toast.defaults.defaultDuration,title:r,dismissible:a=!0,trigger:i}=t;try{if(window.alertManager&&"function"==typeof window.alertManager.show)window.alertManager.show({message:e,type:s,duration:n,title:r,dismissible:a});else{const t=document.querySelector("p-toasts");t&&"function"==typeof t.toast?t.toast({message:e,type:s,duration:n,title:r,dismissible:a}):alert(`${s.toUpperCase()}: ${r?r+"\n":""}${e}`)}this._dispatch(i,"toast:shown",{message:e,type:s,duration:n,title:r}),this.eventBus?.emit("toast:show",{message:e,type:s,duration:n,title:r,trigger:i,timestamp:performance.now()})}catch(n){this._dispatch(i,"toast:error",{error:n.message,message:e,type:s}),this.eventBus?.emit("toast:error",{error:n.message,options:t,trigger:i,timestamp:performance.now()}),alert(`${s.toUpperCase()}: ${r?r+"\n":""}${e}`)}}static show(t,e="info",s={}){(new Toast)._showToast({message:t,type:e,...s})}getStatus(){return{mountedTriggers:document.querySelectorAll('[data-toast-enhanced="true"]').length,availableTypes:Object.keys(Toast.defaults.typeMapping),alertManagerAvailable:!(!window.alertManager||"function"!=typeof window.alertManager.show),xToastsAvailable:!!document.querySelector("p-toasts"),defaults:Toast.defaults}}static enhanceAll(t="[data-toast-trigger][data-toast-message]",e){const s=new Toast(e);return document.querySelectorAll(t).forEach(t=>{s.mount(t)}),s}}export{Toast as default};
