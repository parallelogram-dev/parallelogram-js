function t(t){return t.replace(/-([a-z])/g,t=>t[1].toUpperCase())}function e(t=document){return Array.from(t.querySelectorAll(["a[href]","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"]):not([disabled])'].join(",")))}class BaseComponent{constructor({eventBus:t,logger:e,router:n}){this.eventBus=t,this.logger=e,this.router=n,this.elements=new WeakMap,this.states=this.elements,this._keys=null}mount(t){if(this.elements.has(t))return this.update(t);const e=this._init(t);this.elements.set(t,e)}update(t){}unmount(t){const e=this.elements.get(t);if(e)try{e.cleanup?.()}finally{this.elements.delete(t)}}destroy(){for(const t of this._elementsKeys())this.unmount(t)}_elementsKeys(){return this._keys||(this._keys=new Set),this._keys}_track(t){this._keys||(this._keys=new Set),this._keys.add(t)}_untrack(t){this._keys?.delete(t)}_init(t){const e=new AbortController;return this._track(t),{cleanup:()=>{e.abort(),this._untrack(t)},controller:e}}getState(t){return this.elements.get(t)}_getDataAttr(e,n,s){return function(e,n,s){const r=n.includes("-")?t(n):n,a=e.dataset[r];return void 0===a?s:"true"===a||"false"!==a&&(isNaN(a)||""===a?a:Number(a))}(e,n,s)}_camelCase(e){return t(e)}_debounce(t,e=300){return function(t,e=300){let n;return function(...s){clearTimeout(n),n=setTimeout(()=>{clearTimeout(n),t.apply(this,s)},e)}}(t,e)}_throttle(t,e=100){return function(t,e=100){let n;return function(...s){n||(t.apply(this,s),n=!0,setTimeout(()=>{n=!1},e))}}(t,e)}_delay(t){return function(t){return new Promise(e=>setTimeout(e,t))}(t)}_getTargetElement(t,e,n={}){const s=`${e}-view`,r=this.getAttr(t,s);if(r){const t=document.querySelector(`[data-view="${r}"]`);return!t&&n.required,t}const a=this.getAttr(t,e);if(!a)return n.required,null;const i=document.querySelector(a);return!i&&n.required,i}_getConfigFromAttrs(t,e){const n={};for(const[s,r]of Object.entries(e)){const e=this.constructor.defaults?.[s];n[s]=this.getAttr(t,r,e)}return n}_requireState(t,e="method"){return this.getState(t)}_generateId(t="elem"){return function(t="elem"){return`${t}-${Date.now()}-${Math.random().toString(36).slice(2,9)}`}(t)}async _waitForTransition(t,e=2e3){return async function(t,e=2e3){return new Promise(n=>{const s=()=>{t.removeEventListener("animationend",s),t.removeEventListener("transitionend",s),n()};t.addEventListener("animationend",s,{once:!0}),t.addEventListener("transitionend",s,{once:!0}),setTimeout(()=>{t.removeEventListener("animationend",s),t.removeEventListener("transitionend",s),n()},e)})}(t,e)}async _fadeIn(t,e=300){return async function(t,e=300){return t.style.opacity="0",t.style.transition=`opacity ${e}ms ease-in-out`,t.offsetHeight,t.style.opacity="1",new Promise(n=>{setTimeout(()=>{t.style.transition="",n()},e)})}(t,e)}async _fadeOut(t,e=300){return async function(t,e=300){return t.style.opacity="1",t.style.transition=`opacity ${e}ms ease-in-out`,t.offsetHeight,t.style.opacity="0",new Promise(n=>{setTimeout(()=>{t.style.transition="",n()},e)})}(t,e)}_getFocusableElements(t=document){return e(t)}_trapFocus(t,n){return function(t,n){const s=e(t);if(!s.length)return;const r=s[0],a=s[s.length-1],i=t.contains(document.activeElement)?document.activeElement:null;!n.shiftKey||i!==r&&i?n.shiftKey||i!==a||(r.focus(),n.preventDefault()):(a.focus(),n.preventDefault())}(t,n)}_restoreFocus(t){return function(t){t&&"function"==typeof t.focus&&requestAnimationFrame(()=>t.focus())}(t)}_createElement(t,e={},n=""){return function(t,e={},n=""){const s=document.createElement(t);for(const[t,n]of Object.entries(e))"className"===t||"class"===t?s.className=n:"style"===t&&"object"==typeof n?Object.assign(s.style,n):"dataset"===t&&"object"==typeof n?Object.assign(s.dataset,n):s.setAttribute(t,n);return"string"==typeof n?s.textContent=n:n instanceof HTMLElement&&s.appendChild(n),s}(t,e,n)}_dispatch(t,e,n){const s=new CustomEvent(e,{detail:n,bubbles:!0,cancelable:!0});return t.dispatchEvent(s),this.eventBus?.emit(e,{element:t,...n}),s}_getSelector(){if(this._selector)return this._selector;const t=this.constructor.name.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();return this._selector=`data-${t}`,this._selector}setState(t,e){t.setAttribute(this._getSelector(),e)}getElementState(t){return t.getAttribute(this._getSelector())}setAttr(t,e,n){t.setAttribute(`${this._getSelector()}-${e}`,String(n))}getAttr(t,e,n=null){const s=t.getAttribute(`${this._getSelector()}-${e}`);return null!==s?s:n}removeAttr(t,e){t.removeAttribute(`${this._getSelector()}-${e}`)}hasAttr(t,e){return t.hasAttribute(`${this._getSelector()}-${e}`)}}const n="open",s="closed",r="opening",a="closing";class Toggle extends BaseComponent{_getSelector(){return"data-toggle"}static get defaults(){return{openClass:"open",transitioningClass:"transitioning",transitionDuration:750,capture:!1,manual:!1,multiple:!1,animateToggle:!0,closeOnEscape:!0,closeOnNavigation:!0}}_init(t){const e=super._init(t),r=this.getAttr(t,"target");if(!r)return e;const a=document.querySelector(r);if(!a)return e;const i=this.getAttr(t,"capture",Toggle.defaults.capture),o=a.hasAttribute("data-toggle-manual")||this.getAttr(t,"manual",Toggle.defaults.manual),l=this.getAttr(t,"multiple",Toggle.defaults.multiple),c=this.getAttr(t,"animate",Toggle.defaults.animateToggle),u=this.getAttr(t,"close-navigation",Toggle.defaults.closeOnNavigation);e.target=a,e.targetSelector=r,e.capture=i,e.manual=o,e.multiple=l,e.animateToggle=c,e.closeOnNavigation=u,e.isOpen=a.classList.contains(Toggle.defaults.openClass),e.transitionTimer=null;const g=e.isOpen?n:s;this.setAttr(a,"target",g);const d=n=>this._handleClick(n,t,e);if(t.addEventListener("click",d),t.setAttribute("data-toggle-enhanced","true"),t.setAttribute("aria-expanded",String(e.isOpen)),t.getAttribute("aria-controls")||t.setAttribute("aria-controls",r.replace("#","")),Toggle.defaults.closeOnEscape){const n=n=>this._handleEscape(n,t,e);document.addEventListener("keydown",n),e.escapeHandler=n}const h=e.cleanup;return e.cleanup=()=>{t.removeEventListener("click",d),e.escapeHandler&&document.removeEventListener("keydown",e.escapeHandler),this._clearTransitionTimer(e),this._removeGlobalListeners(e),h()},this.eventBus?.emit("toggle:mount",{element:t,target:a,isOpen:e.isOpen,timestamp:performance.now()}),e}_handleClick(t,e,n){t.preventDefault(),t.stopPropagation(),this.toggle(e)}_handleEscape(t,e,n){"Escape"===t.key&&n.isOpen&&!n.manual&&this.hide(e)}toggle(t){const e=this.getState(t);if(!e)return;e.target.classList.contains(Toggle.defaults.openClass)?this.hide(t):this.show(t)}show(t){const e=this.getState(t);if(!e)return;const s=this.getAttr(e.target,"target");s!==r&&s!==n&&(e.multiple||this._closeOtherToggles(t),e.isOpen=!0,this._syncTriggerStates(e.targetSelector,!0),t.setAttribute("aria-expanded","true"),this._updateRelatedTriggers(e.targetSelector,!0),(e.capture||e.closeOnNavigation)&&this._setupGlobalListeners(t,e),e.animateToggle?(this.setAttr(e.target,"target",r),e.target.classList.add(Toggle.defaults.openClass),e.transitionTimer=setTimeout(()=>{this.setAttr(e.target,"target",n),e.transitionTimer=null},Toggle.defaults.transitionDuration)):(this.setAttr(e.target,"target",n),e.target.classList.add(Toggle.defaults.openClass)),this._dispatch(t,"toggle:show",{target:e.target,trigger:t}),this.eventBus?.emit("toggle:show",{element:t,target:e.target,timestamp:performance.now()}))}hide(t){const e=this.getState(t);if(!e)return;const n=this.getAttr(e.target,"target");n!==a&&n!==s&&(e.isOpen=!1,this._syncTriggerStates(e.targetSelector,!1),t.setAttribute("aria-expanded","false"),this._updateRelatedTriggers(e.targetSelector,!1),this._removeGlobalListeners(e),e.animateToggle?(this.setAttr(e.target,"target",a),e.transitionTimer=setTimeout(()=>{e.target.classList.remove(Toggle.defaults.openClass),this.setAttr(e.target,"target",s),e.transitionTimer=null},Toggle.defaults.transitionDuration)):(e.target.classList.remove(Toggle.defaults.openClass),this.setAttr(e.target,"target",s)),this._dispatch(t,"toggle:hide",{target:e.target,trigger:t}),this.eventBus?.emit("toggle:hide",{element:t,target:e.target,timestamp:performance.now()}))}hideAll(){document.querySelectorAll('[data-toggle-enhanced="true"]').forEach(t=>{const e=this.getState(t);e&&e.isOpen&&!e.manual&&this.hide(t)})}isOpen(t){const e=this.getState(t);return!!e&&e.isOpen}_updateRelatedTriggers(t,e){document.querySelectorAll(`[data-toggle-target="${t}"]`).forEach(t=>{t.setAttribute("aria-expanded",String(e))})}_setupGlobalListeners(t,e){const n=n=>{e.closeOnNavigation&&!e.manual&&this._isNavigationLink(n.target)?this.hide(t):n.stopPropagation()},s=n=>{e.manual||t.contains(n.target)||e.target.contains(n.target)||this.hide(t)};e.target.addEventListener("click",n),document.addEventListener("click",s),e.targetClickHandler=n,e.documentClickHandler=s}_removeGlobalListeners(t){t.targetClickHandler&&(t.target.removeEventListener("click",t.targetClickHandler),t.targetClickHandler=null),t.documentClickHandler&&(document.removeEventListener("click",t.documentClickHandler),t.documentClickHandler=null)}_isNavigationLink(t){let e=t;for(;e&&e!==document.body;){if("A"===e.tagName){const t=e.getAttribute("href");if(t&&!t.startsWith("#")&&!t.startsWith("javascript:")&&!t.startsWith("mailto:")&&!t.startsWith("tel:")&&!e.hasAttribute("download")&&"_blank"!==e.getAttribute("target"))return!0;break}e=e.parentElement}return!1}_clearTransitionTimer(t){t.transitionTimer&&(clearTimeout(t.transitionTimer),t.transitionTimer=null)}_closeOtherToggles(t){document.querySelectorAll('[data-toggle-enhanced="true"]').forEach(e=>{if(e!==t){const t=this.getState(e);t&&t.isOpen&&!t.manual&&this.hide(e)}})}_syncTriggerStates(t,e){document.querySelectorAll(`[data-toggle-target="${t}"][data-toggle-enhanced="true"]`).forEach(t=>{const n=this.getState(t);n&&(n.isOpen=e)})}getStatus(){const t=document.querySelectorAll('[data-toggle-enhanced="true"]');let e=0,n=0,s=0;return t.forEach(t=>{const r=this.getState(t);r&&(r.isOpen&&e++,r.capture&&n++,r.manual&&s++)}),{totalTriggers:t.length,openCount:e,captureCount:n,manualCount:s,defaults:Toggle.defaults}}static enhanceAll(t="[data-toggle]",e){const n=new Toggle(e);return document.querySelectorAll(t).forEach(t=>{n.mount(t)}),n}}export{Toggle as default};
