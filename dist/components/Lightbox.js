function t(t){return t.replace(/-([a-z])/g,t=>t[1].toUpperCase())}function e(t=document){return Array.from(t.querySelectorAll(["a[href]","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"]):not([disabled])'].join(",")))}class BaseComponent{constructor({eventBus:t,logger:e,router:s}){this.eventBus=t,this.logger=e,this.router=s,this.elements=new WeakMap,this.states=this.elements,this._keys=null}mount(t){if(this.elements.has(t))return this.update(t);const e=this._init(t);this.elements.set(t,e)}update(t){}unmount(t){const e=this.elements.get(t);if(e)try{e.cleanup?.()}finally{this.elements.delete(t)}}destroy(){for(const t of this._elementsKeys())this.unmount(t)}_elementsKeys(){return this._keys||(this._keys=new Set),this._keys}_track(t){this._keys||(this._keys=new Set),this._keys.add(t)}_untrack(t){this._keys?.delete(t)}_init(t){const e=new AbortController;return this._track(t),{cleanup:()=>{e.abort(),this._untrack(t)},controller:e}}getState(t){return this.elements.get(t)}_getDataAttr(e,s,n){return function(e,s,n){const i=s.includes("-")?t(s):s,o=e.dataset[i];return void 0===o?n:"true"===o||"false"!==o&&(isNaN(o)||""===o?o:Number(o))}(e,s,n)}_camelCase(e){return t(e)}_debounce(t,e=300){return function(t,e=300){let s;return function(...n){clearTimeout(s),s=setTimeout(()=>{clearTimeout(s),t.apply(this,n)},e)}}(t,e)}_throttle(t,e=100){return function(t,e=100){let s;return function(...n){s||(t.apply(this,n),s=!0,setTimeout(()=>{s=!1},e))}}(t,e)}_delay(t){return function(t){return new Promise(e=>setTimeout(e,t))}(t)}_getTargetElement(t,e,s={}){const n=`${e}-view`,i=this.getAttr(t,n);if(i){const t=document.querySelector(`[data-view="${i}"]`);return!t&&s.required,t}const o=this.getAttr(t,e);if(!o)return s.required,null;const a=document.querySelector(o);return!a&&s.required,a}_getConfigFromAttrs(t,e){const s={};for(const[n,i]of Object.entries(e)){const e=this.constructor.defaults?.[n];s[n]=this.getAttr(t,i,e)}return s}_requireState(t,e="method"){return this.getState(t)}_generateId(t="elem"){return function(t="elem"){return`${t}-${Date.now()}-${Math.random().toString(36).slice(2,9)}`}(t)}async _waitForTransition(t,e=2e3){return async function(t,e=2e3){return new Promise(s=>{const n=()=>{t.removeEventListener("animationend",n),t.removeEventListener("transitionend",n),s()};t.addEventListener("animationend",n,{once:!0}),t.addEventListener("transitionend",n,{once:!0}),setTimeout(()=>{t.removeEventListener("animationend",n),t.removeEventListener("transitionend",n),s()},e)})}(t,e)}async _fadeIn(t,e=300){return async function(t,e=300){return t.style.opacity="0",t.style.transition=`opacity ${e}ms ease-in-out`,t.offsetHeight,t.style.opacity="1",new Promise(s=>{setTimeout(()=>{t.style.transition="",s()},e)})}(t,e)}async _fadeOut(t,e=300){return async function(t,e=300){return t.style.opacity="1",t.style.transition=`opacity ${e}ms ease-in-out`,t.offsetHeight,t.style.opacity="0",new Promise(s=>{setTimeout(()=>{t.style.transition="",s()},e)})}(t,e)}_getFocusableElements(t=document){return e(t)}_trapFocus(t,s){return function(t,s){const n=e(t);if(!n.length)return;const i=n[0],o=n[n.length-1],a=t.contains(document.activeElement)?document.activeElement:null;!s.shiftKey||a!==i&&a?s.shiftKey||a!==o||(i.focus(),s.preventDefault()):(o.focus(),s.preventDefault())}(t,s)}_restoreFocus(t){return function(t){t&&"function"==typeof t.focus&&requestAnimationFrame(()=>t.focus())}(t)}_createElement(t,e={},s=""){return function(t,e={},s=""){const n=document.createElement(t);for(const[t,s]of Object.entries(e))"className"===t||"class"===t?n.className=s:"style"===t&&"object"==typeof s?Object.assign(n.style,s):"dataset"===t&&"object"==typeof s?Object.assign(n.dataset,s):n.setAttribute(t,s);return"string"==typeof s?n.textContent=s:s instanceof HTMLElement&&n.appendChild(s),n}(t,e,s)}_dispatch(t,e,s){const n=new CustomEvent(e,{detail:s,bubbles:!0,cancelable:!0});return t.dispatchEvent(n),n}_getSelector(){if(this._selector)return this._selector;const t=this.constructor.name.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();return this._selector=`data-${t}`,this._selector}setState(t,e){t.setAttribute(this._getSelector(),e)}getElementState(t){return t.getAttribute(this._getSelector())}setAttr(t,e,s){t.setAttribute(`${this._getSelector()}-${e}`,String(s))}getAttr(t,e,s=null){const n=t.getAttribute(`${this._getSelector()}-${e}`);return null!==n?n:s}removeAttr(t,e){t.removeAttribute(`${this._getSelector()}-${e}`)}hasAttr(t,e){return t.hasAttribute(`${this._getSelector()}-${e}`)}}class Lightbox extends BaseComponent{_getSelector(){return"data-lightbox"}static get defaults(){return{closeOnEscape:!0,closeOnBackdrop:!0,showCounter:!0,showNavigation:!0,keyNavigation:!0,useDirectionalTransitions:!0,preloadStrategy:"adjacent",baseClass:"lightbox",overlayClass:"lightbox__overlay",containerClass:"lightbox__container",closeClass:"lightbox__close",prevClass:"lightbox__nav lightbox__nav--prev",nextClass:"lightbox__nav lightbox__nav--next",contentClass:"lightbox__content",imageClass:"lightbox__image",counterClass:"lightbox__counter",stateClosedClass:"is-closed",stateOpeningClass:"is-opening",stateOpenClass:"is-open",stateTransitioningClass:"is-transitioning",stateClosingClass:"is-closing",showClass:"show",slideLeftClass:"slide-left",slideRightClass:"slide-right"}}constructor(t={}){super(t),this.lightboxElement=null,this.keyHandler=null}_init(t){const e=super._init(t),s=this._getConfiguration(t),n=t.dataset.lightbox;return e.config=s,e.gallery=n,e.lightboxState="closed",e.currentIndex=0,e.galleryElements=[],t.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this._openLightbox(t)}),e}_getConfiguration(t){return{closeOnEscape:this.getAttr(t,"close-escape",Lightbox.defaults.closeOnEscape),closeOnBackdrop:this.getAttr(t,"close-backdrop",Lightbox.defaults.closeOnBackdrop),showCounter:this.getAttr(t,"show-counter",Lightbox.defaults.showCounter),showNavigation:this.getAttr(t,"show-nav",Lightbox.defaults.showNavigation),keyNavigation:this.getAttr(t,"key-nav",Lightbox.defaults.keyNavigation),useDirectionalTransitions:this.getAttr(t,"directional-transitions",Lightbox.defaults.useDirectionalTransitions),preloadStrategy:this.getAttr(t,"preload",Lightbox.defaults.preloadStrategy),baseClass:this.getAttr(t,"base-class",Lightbox.defaults.baseClass),overlayClass:this.getAttr(t,"overlay-class",Lightbox.defaults.overlayClass),containerClass:this.getAttr(t,"container-class",Lightbox.defaults.containerClass),closeClass:this.getAttr(t,"close-class",Lightbox.defaults.closeClass),prevClass:this.getAttr(t,"prev-class",Lightbox.defaults.prevClass),nextClass:this.getAttr(t,"next-class",Lightbox.defaults.nextClass),contentClass:this.getAttr(t,"content-class",Lightbox.defaults.contentClass),imageClass:this.getAttr(t,"image-class",Lightbox.defaults.imageClass),counterClass:this.getAttr(t,"counter-class",Lightbox.defaults.counterClass),stateClosedClass:this.getAttr(t,"state-closed-class",Lightbox.defaults.stateClosedClass),stateOpeningClass:this.getAttr(t,"state-opening-class",Lightbox.defaults.stateOpeningClass),stateOpenClass:this.getAttr(t,"state-open-class",Lightbox.defaults.stateOpenClass),stateTransitioningClass:this.getAttr(t,"state-transitioning-class",Lightbox.defaults.stateTransitioningClass),stateClosingClass:this.getAttr(t,"state-closing-class",Lightbox.defaults.stateClosingClass),showClass:this.getAttr(t,"show-class",Lightbox.defaults.showClass),slideLeftClass:this.getAttr(t,"slide-left-class",Lightbox.defaults.slideLeftClass),slideRightClass:this.getAttr(t,"slide-right-class",Lightbox.defaults.slideRightClass)}}_setState(t,e){const s=this.getState(t);s&&(s.lightboxState,s.lightboxState=e,this.lightboxElement&&this.setState(this.lightboxElement,e))}_openLightbox(t){const e=this.getState(t);if(!e||"closed"!==e.lightboxState)return;e.galleryElements=Array.from(document.querySelectorAll(`[data-lightbox="${e.gallery}"]`)),e.currentIndex=e.galleryElements.indexOf(t),this._setState(t,"opening"),this._createLightboxElement(t),this._showImage(t,e.currentIndex),this._setupEventListeners(t);const s=window.innerWidth-document.documentElement.clientWidth;document.documentElement.style.setProperty("--scrollbar-width",`${s}px`),document.body.classList.add("overflow--hidden"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.lightboxElement&&e.config&&(this.lightboxElement.classList.add(e.config.showClass),this.lightboxElement.addEventListener("transitionend",()=>{this._setState(t,"open")},{once:!0}))})}),this._eagerLoadAdjacentImages(t)}_eagerLoadAdjacentImages(t){const e=this.getState(t);if(!e||!e.galleryElements)return;const s=e.config,n=e.currentIndex,i=e.galleryElements;if("none"===s.preloadStrategy)return;let o=[];"all"===s.preloadStrategy?o=i.map((t,e)=>e):(o=[n],s.showNavigation&&(n>0&&o.push(n-1),n<i.length-1&&o.push(n+1))),o.forEach(t=>{const n=i[t],o=n.href;n.querySelectorAll("[data-lazysrc]").forEach(n=>{const i=new CustomEvent("lazysrc:forceLoad",{bubbles:!0,detail:{source:"lightbox",gallery:e.gallery,index:t,strategy:s.preloadStrategy}});n.dispatchEvent(i)}),this._preloadImage(o)})}_preloadImage(t){(new Image).src=t}_createLightboxElement(t){const e=this.getState(t);if(!e)return;const s=e.config;this.lightboxElement=document.createElement("div"),this.lightboxElement.className=s.overlayClass,this.setState(this.lightboxElement,"opening"),this.lightboxElement.innerHTML=`\n      <div class="${s.containerClass}">\n        <button class="${s.closeClass}" data-lightbox-action="close" aria-label="Close"></button>\n        ${s.showNavigation?`\n          <button class="${s.prevClass}" data-lightbox-action="prev" aria-label="Previous"></button>\n          <button class="${s.nextClass}" data-lightbox-action="next" aria-label="Next"></button>\n        `:""}\n        <div class="${s.contentClass}">\n          <img class="${s.imageClass}" alt="">\n        </div>\n        ${s.showCounter?`<div class="${s.counterClass}"></div>`:""}\n      </div>\n    `,document.body.appendChild(this.lightboxElement),this.currentTriggerElement=t;if(this.lightboxElement.querySelector('[data-lightbox-action="close"]').addEventListener("click",e=>{e.stopPropagation(),this._closeLightbox(t)}),s.showNavigation){const e=this.lightboxElement.querySelector('[data-lightbox-action="prev"]'),s=this.lightboxElement.querySelector('[data-lightbox-action="next"]');e.addEventListener("click",e=>{e.stopPropagation(),this._previousImage(t)}),s.addEventListener("click",e=>{e.stopPropagation(),this._nextImage(t)}),e.disabled=!0,s.disabled=!0}s.closeOnBackdrop&&this.lightboxElement.addEventListener("click",e=>{e.target===this.lightboxElement&&this._closeLightbox(t)})}_showImage(t,e,s=null){const n=this.getState(t);if(!n)return;const i=n.config,o=n.galleryElements[e],a=o.href,l=o.querySelector("img")?.alt||"",r=this.lightboxElement.querySelector(`.${i.imageClass.split(" ")[0]}`);if(i.useDirectionalTransitions&&s&&"open"===n.lightboxState){this._setState(t,"transitioning");const e="next"===s?i.slideLeftClass:i.slideRightClass,n="next"===s?i.slideRightClass:i.slideLeftClass;r.classList.add(e),r.addEventListener("transitionend",()=>{const s=new Image;s.onload=()=>{r.src=a,r.alt=l,r.style.transition="none",r.classList.add(n),r.offsetHeight,r.classList.remove(e),requestAnimationFrame(()=>{r.style.transition="",r.classList.remove(n),r.addEventListener("transitionend",()=>{this._setState(t,"open")},{once:!0})})},s.onerror=()=>{r.src=a,r.alt=l,this._setState(t,"open")},s.src=a},{once:!0})}else r.src=a,r.alt=l;if(i.showCounter){this.lightboxElement.querySelector(`.${i.counterClass.split(" ")[0]}`).textContent=`${e+1} / ${n.galleryElements.length}`}if(i.showNavigation){const t=this.lightboxElement.querySelector('[data-lightbox-action="prev"]'),s=this.lightboxElement.querySelector('[data-lightbox-action="next"]');t&&(t.disabled=0===e),s&&(s.disabled=e===n.galleryElements.length-1)}}_previousImage(t){const e=this.getState(t);e&&"open"===e.lightboxState&&e.currentIndex>0&&(e.currentIndex--,this._showImage(t,e.currentIndex,"prev"))}_nextImage(t){const e=this.getState(t);e&&"open"===e.lightboxState&&e.currentIndex<e.galleryElements.length-1&&(e.currentIndex++,this._showImage(t,e.currentIndex,"next"))}_setupEventListeners(t){const e=this.getState(t);if(!e)return;const s=e.config;(s.closeOnEscape||s.keyNavigation)&&(this.keyHandler=n=>{if("open"!==e.lightboxState&&"transitioning"!==e.lightboxState)return;let i=!1;switch(n.key){case"Escape":s.closeOnEscape&&(this._closeLightbox(t),i=!0);break;case"ArrowLeft":s.keyNavigation&&(this._previousImage(t),i=!0);break;case"ArrowRight":s.keyNavigation&&(this._nextImage(t),i=!0)}i&&n.preventDefault()},document.addEventListener("keydown",this.keyHandler))}_closeLightbox(t){const e=this.getState(t);if(!e||"closed"===e.lightboxState||"closing"===e.lightboxState)return;this._setState(t,"closing"),this.lightboxElement.classList.remove(e.config.showClass);let s=!1;const n=()=>{s||(s=!0,this.keyHandler&&(document.removeEventListener("keydown",this.keyHandler),this.keyHandler=null),this.lightboxElement&&(this.lightboxElement.remove(),this.lightboxElement=null),document.body.classList.remove("overflow--hidden"),this._setState(t,"closed"),e.currentIndex=0,e.galleryElements=[])},i=t=>{t&&t.target!==this.lightboxElement||n()};this.lightboxElement.addEventListener("transitionend",i,{once:!0}),this.lightboxElement.addEventListener("animationend",i,{once:!0}),setTimeout(n,1e3)}open(t){this._openLightbox(t)}close(t){this._closeLightbox(t)}next(t){this._nextImage(t)}previous(t){this._previousImage(t)}goTo(t,e){const s=this.getState(t);s&&"open"===s.lightboxState&&e>=0&&e<s.galleryElements.length&&(s.currentIndex=e,this._showImage(t,s.currentIndex))}getStatus(t){const e=this.getState(t);return e?{lightboxState:e.lightboxState,currentIndex:e.currentIndex,gallerySize:e.galleryElements.length,gallery:e.gallery}:null}static enhanceAll(t="[data-lightbox]",e){const s=new Lightbox(e);return document.querySelectorAll(t).forEach(t=>s.mount(t)),s}}export{Lightbox,Lightbox as default};
