function e(e){return e.replace(/-([a-z])/g,e=>e[1].toUpperCase())}function t(e=document){return Array.from(e.querySelectorAll(["a[href]","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"]):not([disabled])'].join(",")))}class BaseComponent{constructor({eventBus:e,logger:t,router:r}){this.eventBus=e,this.logger=t,this.router=r,this.elements=new WeakMap,this.states=this.elements,this._keys=null}mount(e){if(this.elements.has(e))return this.update(e);const t=this._init(e);this.elements.set(e,t)}update(e){}unmount(e){const t=this.elements.get(e);if(t)try{t.cleanup?.()}finally{this.elements.delete(e)}}destroy(){for(const e of this._elementsKeys())this.unmount(e)}_elementsKeys(){return this._keys||(this._keys=new Set),this._keys}_track(e){this._keys||(this._keys=new Set),this._keys.add(e)}_untrack(e){this._keys?.delete(e)}_init(e){const t=new AbortController;return this._track(e),{cleanup:()=>{t.abort(),this._untrack(e)},controller:t}}getState(e){return this.elements.get(e)}_getDataAttr(t,r,n){return function(t,r,n){const s=r.includes("-")?e(r):r,i=t.dataset[s];return void 0===i?n:"true"===i||"false"!==i&&(isNaN(i)||""===i?i:Number(i))}(t,r,n)}_camelCase(t){return e(t)}_debounce(e,t=300){return function(e,t=300){let r;return function(...n){clearTimeout(r),r=setTimeout(()=>{clearTimeout(r),e.apply(this,n)},t)}}(e,t)}_throttle(e,t=100){return function(e,t=100){let r;return function(...n){r||(e.apply(this,n),r=!0,setTimeout(()=>{r=!1},t))}}(e,t)}_delay(e){return function(e){return new Promise(t=>setTimeout(t,e))}(e)}_getTargetElement(e,t,r={}){const n=`${t}-view`,s=this.getAttr(e,n);if(s){const e=document.querySelector(`[data-view="${s}"]`);return!e&&r.required,e}const i=this.getAttr(e,t);if(!i)return r.required,null;const a=document.querySelector(i);return!a&&r.required,a}_getConfigFromAttrs(e,t){const r={};for(const[n,s]of Object.entries(t)){const t=this.constructor.defaults?.[n];r[n]=this.getAttr(e,s,t)}return r}_requireState(e,t="method"){return this.getState(e)}_generateId(e="elem"){return function(e="elem"){return`${e}-${Date.now()}-${Math.random().toString(36).slice(2,9)}`}(e)}async _waitForTransition(e,t=2e3){return async function(e,t=2e3){return new Promise(r=>{const n=()=>{e.removeEventListener("animationend",n),e.removeEventListener("transitionend",n),r()};e.addEventListener("animationend",n,{once:!0}),e.addEventListener("transitionend",n,{once:!0}),setTimeout(()=>{e.removeEventListener("animationend",n),e.removeEventListener("transitionend",n),r()},t)})}(e,t)}async _fadeIn(e,t=300){return async function(e,t=300){return e.style.opacity="0",e.style.transition=`opacity ${t}ms ease-in-out`,e.offsetHeight,e.style.opacity="1",new Promise(r=>{setTimeout(()=>{e.style.transition="",r()},t)})}(e,t)}async _fadeOut(e,t=300){return async function(e,t=300){return e.style.opacity="1",e.style.transition=`opacity ${t}ms ease-in-out`,e.offsetHeight,e.style.opacity="0",new Promise(r=>{setTimeout(()=>{e.style.transition="",r()},t)})}(e,t)}_getFocusableElements(e=document){return t(e)}_trapFocus(e,r){return function(e,r){const n=t(e);if(!n.length)return;const s=n[0],i=n[n.length-1],a=e.contains(document.activeElement)?document.activeElement:null;!r.shiftKey||a!==s&&a?r.shiftKey||a!==i||(s.focus(),r.preventDefault()):(i.focus(),r.preventDefault())}(e,r)}_restoreFocus(e){return function(e){e&&"function"==typeof e.focus&&requestAnimationFrame(()=>e.focus())}(e)}_createElement(e,t={},r=""){return function(e,t={},r=""){const n=document.createElement(e);for(const[e,r]of Object.entries(t))"className"===e||"class"===e?n.className=r:"style"===e&&"object"==typeof r?Object.assign(n.style,r):"dataset"===e&&"object"==typeof r?Object.assign(n.dataset,r):n.setAttribute(e,r);return"string"==typeof r?n.textContent=r:r instanceof HTMLElement&&n.appendChild(r),n}(e,t,r)}_dispatch(e,t,r){const n=new CustomEvent(t,{detail:r,bubbles:!0,cancelable:!0});return e.dispatchEvent(n),n}_getSelector(){if(this._selector)return this._selector;const e=this.constructor.name.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();return this._selector=`data-${e}`,this._selector}setState(e,t){e.setAttribute(this._getSelector(),t)}getElementState(e){return e.getAttribute(this._getSelector())}setAttr(e,t,r){e.setAttribute(`${this._getSelector()}-${t}`,String(r))}getAttr(e,t,r=null){const n=e.getAttribute(`${this._getSelector()}-${t}`);return null!==n?n:r}removeAttr(e,t){e.removeAttribute(`${this._getSelector()}-${t}`)}hasAttr(e,t){return e.hasAttribute(`${this._getSelector()}-${t}`)}}class FormEnhancer extends BaseComponent{_getSelector(){return"data-form-enhancer"}static get defaults(){return{validateOnInput:!0,validateOnBlur:!0,showErrorsImmediately:!1,errorClass:"error",validClass:"valid",debounce:300}}static get rules(){return{required:e=>e.trim().length>0,email:e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),min:(e,t)=>e.length>=parseInt(t),max:(e,t)=>e.length<=parseInt(t),minnum:(e,t)=>parseFloat(e)>=parseFloat(t),maxnum:(e,t)=>parseFloat(e)<=parseFloat(t),number:e=>!isNaN(parseFloat(e))&&isFinite(e),url:e=>{try{return new URL(e),!0}catch{return!1}},pattern:(e,t)=>new RegExp(t).test(e)}}constructor(e={}){super(e),this.debounceTimers=new Map}_init(e){const t=super._init(e),r=this._getConfiguration(e),n=this._getValidatedFields(e);return t.config=r,t.fields=n,t.errors=new Map,t.touched=new Set,n.forEach(e=>this._setupFieldValidation(e,t)),e.addEventListener("submit",r=>{this._handleSubmit(r,e,t)}),t}_getConfiguration(e){return{validateOnInput:this.getAttr(e,"validate-on-input",FormEnhancer.defaults.validateOnInput),validateOnBlur:this.getAttr(e,"validate-on-blur",FormEnhancer.defaults.validateOnBlur),showErrorsImmediately:this.getAttr(e,"show-errors-immediately",FormEnhancer.defaults.showErrorsImmediately),debounce:parseInt(this.getAttr(e,"validate-debounce",FormEnhancer.defaults.debounce))}}_getValidatedFields(e){return Array.from(e.querySelectorAll("[data-validate]"))}_setupFieldValidation(e,t){const r=e.name||e.id;t.config.validateOnInput&&e.addEventListener("input",()=>{this._debounceValidation(e,t,r)}),t.config.validateOnBlur&&e.addEventListener("blur",()=>{t.touched.add(r),this._validateField(e,t)}),e.addEventListener("focus",()=>{this._clearFieldError(e,t)})}_debounceValidation(e,t,r){clearTimeout(this.debounceTimers.get(r)),this.debounceTimers.set(r,setTimeout(()=>{(t.touched.has(r)||t.config.showErrorsImmediately)&&this._validateField(e,t)},t.config.debounce))}_validateField(e,t){const r=e.dataset.validate.split("|"),n=e.value,s=e.name||e.id;for(const i of r){const[r,a]=i.split(":"),o=FormEnhancer.rules[r];if(o&&!o(n,a)){const n=this._getErrorMessage(e,r,a);return this._showFieldError(e,t,n),t.errors.set(s,n),!1}}return this._showFieldValid(e,t),t.errors.delete(s),!0}_getErrorMessage(e,t,r){const n=e.dataset.validateMessage;if(n)return n;return{required:"This field is required",email:"Please enter a valid email address",min:`Minimum ${r} characters required`,max:`Maximum ${r} characters allowed`,minnum:`Value must be at least ${r}`,maxnum:`Value must be no more than ${r}`,number:"Please enter a valid number",url:"Please enter a valid URL",pattern:"Invalid format"}[t]||"Invalid value"}_showFieldError(e,t,r){e.classList.add(t.config.errorClass),e.classList.remove(t.config.validClass);const n=this._getErrorContainer(e);n&&(n.textContent=r,n.style.display="block")}_showFieldValid(e,t){e.classList.remove(t.config.errorClass),e.classList.add(t.config.validClass);const r=this._getErrorContainer(e);r&&(r.style.display="none")}_clearFieldError(e,t){e.classList.remove(t.config.errorClass);const r=this._getErrorContainer(e);r&&(r.style.display="none")}_getErrorContainer(e){const t=e.name||e.id;return document.querySelector(`[data-error-for="${t}"]`)}_handleSubmit(e,t,r){let n=!0;r.fields.forEach(e=>{const t=e.name||e.id;r.touched.add(t),this._validateField(e,r)||(n=!1)}),n||e.preventDefault()}validate(e){const t=this.getState(e);if(!t)return!1;let r=!0;return t.fields.forEach(e=>{this._validateField(e,t)||(r=!1)}),r}getErrors(e){const t=this.getState(e);return t?Array.from(t.errors.entries()):[]}static enhanceAll(e="[data-form-validator]",t){const r=new FormEnhancer(t);return document.querySelectorAll(e).forEach(e=>r.mount(e)),r}}export{FormEnhancer,FormEnhancer as default};
