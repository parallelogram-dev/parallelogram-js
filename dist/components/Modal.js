function t(t){return t.replace(/-([a-z])/g,t=>t[1].toUpperCase())}function e(t=document){return Array.from(t.querySelectorAll(["a[href]","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"]):not([disabled])'].join(",")))}class BaseComponent{constructor({eventBus:t,logger:e,router:n}){this.eventBus=t,this.logger=e,this.router=n,this.elements=new WeakMap,this.states=this.elements,this._keys=null}mount(t){if(this.elements.has(t))return this.update(t);const e=this._init(t);this.elements.set(t,e)}update(t){}unmount(t){const e=this.elements.get(t);if(e)try{e.cleanup?.()}finally{this.elements.delete(t)}}destroy(){for(const t of this._elementsKeys())this.unmount(t)}_elementsKeys(){return this._keys||(this._keys=new Set),this._keys}_track(t){this._keys||(this._keys=new Set),this._keys.add(t)}_untrack(t){this._keys?.delete(t)}_init(t){const e=new AbortController;return this._track(t),{cleanup:()=>{e.abort(),this._untrack(t)},controller:e}}getState(t){return this.elements.get(t)}_getDataAttr(e,n,o){return function(e,n,o){const s=n.includes("-")?t(n):n,a=e.dataset[s];return void 0===a?o:"true"===a||"false"!==a&&(isNaN(a)||""===a?a:Number(a))}(e,n,o)}_camelCase(e){return t(e)}_debounce(t,e=300){return function(t,e=300){let n;return function(...o){clearTimeout(n),n=setTimeout(()=>{clearTimeout(n),t.apply(this,o)},e)}}(t,e)}_throttle(t,e=100){return function(t,e=100){let n;return function(...o){n||(t.apply(this,o),n=!0,setTimeout(()=>{n=!1},e))}}(t,e)}_delay(t){return function(t){return new Promise(e=>setTimeout(e,t))}(t)}_getTargetElement(t,e,n={}){const o=`${e}-view`,s=this.getAttr(t,o);if(s){const t=document.querySelector(`[data-view="${s}"]`);return!t&&n.required,t}const a=this.getAttr(t,e);if(!a)return n.required,null;const r=document.querySelector(a);return!r&&n.required,r}_getConfigFromAttrs(t,e){const n={};for(const[o,s]of Object.entries(e)){const e=this.constructor.defaults?.[o];n[o]=this.getAttr(t,s,e)}return n}_requireState(t,e="method"){return this.getState(t)}_generateId(t="elem"){return function(t="elem"){return`${t}-${Date.now()}-${Math.random().toString(36).slice(2,9)}`}(t)}async _waitForTransition(t,e=2e3){return async function(t,e=2e3){return new Promise(n=>{const o=()=>{t.removeEventListener("animationend",o),t.removeEventListener("transitionend",o),n()};t.addEventListener("animationend",o,{once:!0}),t.addEventListener("transitionend",o,{once:!0}),setTimeout(()=>{t.removeEventListener("animationend",o),t.removeEventListener("transitionend",o),n()},e)})}(t,e)}async _fadeIn(t,e=300){return async function(t,e=300){return t.style.opacity="0",t.style.transition=`opacity ${e}ms ease-in-out`,t.offsetHeight,t.style.opacity="1",new Promise(n=>{setTimeout(()=>{t.style.transition="",n()},e)})}(t,e)}async _fadeOut(t,e=300){return async function(t,e=300){return t.style.opacity="1",t.style.transition=`opacity ${e}ms ease-in-out`,t.offsetHeight,t.style.opacity="0",new Promise(n=>{setTimeout(()=>{t.style.transition="",n()},e)})}(t,e)}_getFocusableElements(t=document){return e(t)}_trapFocus(t,n){return function(t,n){const o=e(t);if(!o.length)return;const s=o[0],a=o[o.length-1],r=t.contains(document.activeElement)?document.activeElement:null;!n.shiftKey||r!==s&&r?n.shiftKey||r!==a||(s.focus(),n.preventDefault()):(a.focus(),n.preventDefault())}(t,n)}_restoreFocus(t){return function(t){t&&"function"==typeof t.focus&&requestAnimationFrame(()=>t.focus())}(t)}_createElement(t,e={},n=""){return function(t,e={},n=""){const o=document.createElement(t);for(const[t,n]of Object.entries(e))"className"===t||"class"===t?o.className=n:"style"===t&&"object"==typeof n?Object.assign(o.style,n):"dataset"===t&&"object"==typeof n?Object.assign(o.dataset,n):o.setAttribute(t,n);return"string"==typeof n?o.textContent=n:n instanceof HTMLElement&&o.appendChild(n),o}(t,e,n)}_dispatch(t,e,n){const o=new CustomEvent(e,{detail:n,bubbles:!0,cancelable:!0});return t.dispatchEvent(o),this.eventBus?.emit(e,{element:t,...n}),o}_getSelector(){if(this._selector)return this._selector;const t=this.constructor.name.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();return this._selector=`data-${t}`,this._selector}setState(t,e){t.setAttribute(this._getSelector(),e)}getElementState(t){return t.getAttribute(this._getSelector())}setAttr(t,e,n){t.setAttribute(`${this._getSelector()}-${e}`,String(n))}getAttr(t,e,n=null){const o=t.getAttribute(`${this._getSelector()}-${e}`);return null!==o?o:n}removeAttr(t,e){t.removeAttribute(`${this._getSelector()}-${e}`)}hasAttr(t,e){return t.hasAttribute(`${this._getSelector()}-${e}`)}}function n(t,e={},n=""){const o=document.createElement(t);for(const[t,n]of Object.entries(e))"className"===t||"class"===t?o.className=n:"style"===t&&"object"==typeof n?Object.assign(o.style,n):"dataset"===t&&"object"==typeof n?Object.assign(o.dataset,n):o.setAttribute(t,n);return"string"==typeof n?o.textContent=n:n instanceof HTMLElement&&o.appendChild(n),o}class Modal extends BaseComponent{_getSelector(){return"data-modal"}static get defaults(){return{size:"md",closable:!0,backdropClose:!0,keyboard:!0,focus:!0,multiple:!1,appendTo:"body"}}_init(t){const e=super._init(t),n=this.getAttr(t,"target"),o=this.getAttr(t,"size",Modal.defaults.size),s=this.getAttr(t,"closable",Modal.defaults.closable),a=this.getAttr(t,"backdrop-close",Modal.defaults.backdropClose),r=this.getAttr(t,"keyboard",Modal.defaults.keyboard),i=this.getAttr(t,"focus",Modal.defaults.focus),l=this.getAttr(t,"multiple",Modal.defaults.multiple);if(!n)return e;let c=document.querySelector(n);return c?("p-modal"!==c.tagName.toLowerCase()||(this._configureModal(c,{size:o,closable:s,backdropClose:a,keyboard:r}),e.target=n,e.modalElement=c,e.size=o,e.closable=s,e.backdropClose=a,e.keyboard=r,e.focus=i,e.multiple=l,t.addEventListener("click",this._handleTriggerClick.bind(this,t),{signal:e.controller.signal}),c.addEventListener("modal:open",this._handleModalOpen.bind(this,t),{signal:e.controller.signal}),c.addEventListener("modal:close",this._handleModalClose.bind(this,t),{signal:e.controller.signal}),t.setAttribute("aria-haspopup","dialog"),t.setAttribute("aria-expanded","false"),t.getAttribute("aria-controls")||t.setAttribute("aria-controls",n.replace("#",""))),e):e}open(t){const e=this.getState(t);e?.modalElement&&(e.multiple||this._closeOtherModals(e.modalElement),e.modalElement._triggerElement=t,"function"==typeof e.modalElement.open?e.modalElement.open():customElements.whenDefined("p-modal").then(()=>{"function"==typeof e.modalElement.open&&e.modalElement.open()}))}close(t){const e=this.getState(t);e?.modalElement&&"function"==typeof e.modalElement.close&&e.modalElement.close()}toggle(t,e){const n=this.getState(t);n?.modalElement&&(!0===e?this.open(t):!1===e||n.modalElement.hasAttribute("open")?this.close(t):this.open(t))}isOpen(t){const e=this.getState(t);return e?.modalElement?.hasAttribute("open")||!1}_configureModal(t,e){e.size&&this.setAttr(t,"size",e.size),void 0!==e.closable&&this.setAttr(t,"closable",String(e.closable)),void 0!==e.backdropClose&&this.setAttr(t,"backdrop-close",String(e.backdropClose)),void 0!==e.keyboard&&this.setAttr(t,"keyboard",String(e.keyboard))}_handleTriggerClick(t,e){e.preventDefault(),this.open(t)}_handleModalOpen(t,e){t.setAttribute("aria-expanded","true"),this._dispatch(t,"modal:opened",{trigger:t,modal:e.detail.modal}),this.eventBus?.emit("modal:opened",{trigger:t,modal:e.detail.modal})}_handleModalClose(t,e){t.setAttribute("aria-expanded","false");const n=this.getState(t);n?.focus&&e.detail.modal._triggerElement&&requestAnimationFrame(()=>{e.detail.modal._triggerElement.focus()}),this._dispatch(t,"modal:closed",{trigger:t,modal:e.detail.modal}),this.eventBus?.emit("modal:closed",{trigger:t,modal:e.detail.modal})}_closeOtherModals(t){document.querySelectorAll("p-modal[open]").forEach(e=>{e!==t&&e.close()})}updateConfig(t,e){const n=this.getState(t);n?.modalElement&&(Object.assign(n,e),this._configureModal(n.modalElement,e))}static enhanceAll(t="[data-modal][data-modal-target]",e){const n=new Modal(e);return document.querySelectorAll(t).forEach(t=>{n.mount(t)}),n}static async create({title:t,content:e,actions:o=[],size:s="medium",options:a={}}){const r=document.createElement("p-modal");if(r.id=function(t="elem"){return`${t}-${Date.now()}-${Math.random().toString(36).slice(2,9)}`}("modal"),r.setAttribute("data-modal-size",s),Object.entries(a).forEach(([t,e])=>{r.setAttribute(`data-modal-${t}`,String(e))}),t){const e=n("h2",{slot:"title"},t);r.appendChild(e)}if(e){const t=document.createElement("div");t.innerHTML=e,r.appendChild(t)}if(o.length>0){const t=document.createElement("div");t.slot="actions",o.forEach(e=>{const o=n("button",{className:`btn btn--${e.type||"secondary"}`,"data-modal-close":!1!==e.close?"":void 0},e.label);e.onClick&&o.addEventListener("click",e.onClick),t.appendChild(o)}),r.appendChild(t)}document.body.appendChild(r)}}export{Modal as default};
